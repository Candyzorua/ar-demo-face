var WEBARROCKSFACE=(window.WEBARROCKSFACE=function(){function b(d){var S=null,C=null,U=null,le=0,_e=this,ye=null;this.B=function(){this.Ye(ye.fb),U.Cg({Pb:ye.Pb,Vc:ye.Vc,Ob:ye.Ob})},this.Jf=function(K){return S[K]},this.ac=function(K){["s32","s34","s27"].forEach(function(me){se.K(me,[{type:"2f",name:"u20",value:K}])}),S&&S.forEach(function(me){me.ac(K)})},this.Ye=function(K){var me=null;le=K.length;var Ee=null!==ye.grid&&d.grid.length&&!(1===d.grid[0]&&1===d.grid[1]),Be=Ee?ye.grid:[1,1];Ee&&this.ac(Be),S=K.map(function(we,Ie){return we=Object.assign({},we,{index:Ie,parent:_e,Rb:me,Wf:Ie===le-1,$a:Ee,aa:Be}),me=0===Ie?ee.instance(we):ie.instance(we)}),C=S[0],U=S[le-1],S.forEach(function(we,Ie){0!==Ie&&we.kg()})},this.W=function(K){K.h(0);var me=K;return S.forEach(function(Ee){me=Ee.W(me,!1)}),me},this.If=function(){return C.Hf()},this.Mf=function(){return U.I()},this.Ya=function(){return U.Lf()},this.Pd=function(){return U.Pd()},this.m=function(){S&&(S.forEach(function(K){K.m()}),U=C=S=null,le=0)},typeof d<"u"&&(ye=Object.assign({},{fb:[],Pb:"none",Vc:!1,Ob:null,grid:null},d),this.B())}function Rt(d,S){var C=S%8;return d[(S-C)/8]>>7-C&1}function ue(d,S,C){var U=1,le=0;for(C=S+C-1;C>=S;--C)le+=U*Rt(d,C),U*=2;return le}function nt(d){d=d.data;for(var S=(d=typeof btoa>"u"?Buffer.from(d,"base64").toString("latin1"):atob(d)).length,C=new Uint8Array(S),U=0;U<S;++U)C[U]=d.charCodeAt(U);return C}function mt(d){return"string"==typeof d?JSON.parse(d):d}function J(){return ui!==Jn.play&&(null===Qe.element||ui===Jn.Kb?(ui=Jn.Ie,!1):(ui=Jn.play,un.Zb(),Dn.stop(),Yt.Ac(),Rn(),!0))}function dt(){return ui===Jn.play&&(un.stop(),Dn.stop(),ui=Jn.pause,!0)}function $e(d,S,C,U,le){return U+(Tn.buffer[d=4*(S*Ar+d)+C]/255+Tn.buffer[d+4*Ar]/65025)*(le-U)}function tn(){var d=yi.za();return P.U(),w.viewport(0,0,Ar,2*d),se.set("s62"),Tn.da.h(0),Tn.kb.h(1),A.l(!1,!1),_i.enableAsyncReadPixels?Ne.Tb(0,0,Ar,2*d,Tn.buffer,Qt,_i.readPixelsAsyncDelay):Ne.ve(0,0,Ar,2*d,Tn.buffer)}function di(d){var S=br[d],C=Ia[d],U=pi[d];S.Wa=$e(1,d*=2,3,0,1),U.detectedRaw=S.Wa,U.detected=Ct.pa(U.detected,S.Wa,Si.Re);var le=U.isDetected;if(U.isDetected=U.detected>_i.threshold,S.x=$e(0,d,1,-1,1),S.y=$e(0,d,2,-1,1),S.P=$e(0,d,3,0,1),U.isDetected){for(S.rx=$e(1,d,0,-Tn.qa[0],Tn.qa[0]),S.ry=$e(1,d,1,-Tn.qa[1],Tn.qa[1]),S.Fa=$e(1,d,2,-Tn.qa[2],Tn.qa[2]),Tn.ab&&(S.Gc=$e(2,d,0,0,1),S.Hc=$e(2,d,1,0,2),S.Jc=$e(2,d,2,-Math.PI,Math.PI),S.Ic=$e(2,d,3,0,Math.PI),le?(U.lAmb=un.Xb(S.Gc,U.lAmb,le=fr.lightingRelaxationTime),U.lDir=un.Xb(S.Hc,U.lDir,le),U.lTheta=un.Xb(S.Jc,U.lTheta,le),U.lPhi=un.Xb(S.Ic,U.lPhi,le)):(U.lAmb=S.Gc,U.lDir=S.Hc,U.lTheta=S.Jc,U.lPhi=S.Ic)),le=0;le<Pi.Nb;++le){var _e=3+Math.floor(le/2);S.Kc[le][0]=$e(_e,d,le%2*2,-1.2,1.2),S.Kc[le][1]=$e(_e,d,le%2*2+1,-1.2,1.2)}C.dx=S.x-U.x,C.dy=S.y-U.y,C.pc=S.P-U.s,C.mc=S.rx-U.rx,C.nc=S.ry-U.ry,C.oc=Pn.ya?S.Fa:S.Fa-U.rz,d=un.Bf(),C=Ct.pa(fr.alphaRange[1],fr.alphaRange[0],Math.pow((1-De.Nc(fr.translationFactorRange[0],fr.translationFactorRange[1],Math.sqrt(C.dx*C.dx+C.dy*C.dy+C.pc*C.pc)/d))*(1-De.Nc(fr.rotationFactorRange[0],fr.rotationFactorRange[1],Math.sqrt(C.mc*C.mc+C.nc*C.nc+C.oc*C.oc)/d))*De.Nc(fr.qualityFactorRange[0],fr.qualityFactorRange[1],S.Wa),Si.Se)),Fi.mode===Fi.Lb.Wb&&(Fi.xa.ub=Math.cos(Math.sqrt(Math.abs(U.ry))),Fi.xa.tc=Fi.Bd*Math.sin(U.ry)),U.x=Ct.pa(U.x,S.x,C),U.y=Ct.pa(U.y,S.y,C),U.s=Ct.pa(U.s,S.P,C),U.rx=Ct.pa(U.rx,S.rx,C),U.ry=Ct.pa(U.ry,S.ry,C);var ye=1,ae=0;Pn.ya?(ye=Math.cos(U.rz),ae=Math.sin(U.rz),U.rz+=fr.followZRotAlphaFactor*C*S.Fa):U.rz=Ct.pa(U.rz,S.Fa,C),U.landmarks.forEach(function(K,me){var Ee=Pi.wd[me],Be=S.Kc[me],we=Ee[0]+Be[0]/Pi.rc;Ee=Ee[1]+Be[1]/Pi.rc,Fi.mode===Fi.Lb.Wb&&(we=we*Fi.xa.ub+Fi.xa.tc*S.P),Pn.ya&&(Be=Ee*ye+we*ae,we=we*ye-Ee*ae,Ee=Be),(me=S.cg[me])[0]=S.x+we*S.P,me[1]=S.y+Ee*S.P*Un.fc,K[0]=me[0],K[1]=me[1]}),++S.Ca}else Pn.ya&&(U.rz=0),Fi.mode===Fi.Lb.Wb&&(Fi.xa.ub=1,Fi.xa.tc=0),S.Ca=Math.floor(S.Ca/2)}function Rn(){ui===Jn.play&&(_i.isCleanGLStateAtEachIteration&&(se.Fd(),A.reset(),A.Ga(),w.disable(w.DEPTH_TEST),se.La()),Pn.Dc?un.$c(_n,tn,ti,Qt,At,_i.animateProcessOrder):(We(),Qt(),At()))}function _n(){P.ga(),Qe.eb||We();var d=un.Kf();yi.update(d,pi);for(var S=0;S<d;++S){yi.Zb(S),se.set("s64"),Fi.mode===Fi.Lb.Wb&&se.J("u51",Fi.xa.ub);var C=yi.za(),U=yi.Qd(),le=pi[U];Pn.ya&&se.J("u50",le.rz),yi.Le("u49"),le=xr.tf(Un.o,le,Jr),Un.Za.N(le,Jr),Qe.D.h(1),Tn.da.h(0),A.l(!1,!1),Tn.kb.v(),se.set("s3"),w.viewport(0,U,Ar,1),se.S("u10",1,1/C),se.S("u11",0,U/C),A.l(!1,!1),ki.W(Un.Za)}}function Qt(){P.Kg(),W.reset(),_i.isCleanGLStateAtEachIteration&&(P.reset(),w.enable(w.DEPTH_TEST)),Pn.hc&&Pn.hc(yi.he()?pi:pi[0]),_i.isCleanGLStateAtEachIteration&&(A.reset(),A.Ga(),w.disable(w.BLEND))}function ti(){for(var d=0;d<yi.za();++d)yi.ag(d)&&di(d)}function At(){ui===Jn.play&&Dn.$c(Rn)}function We(){if(Qe.Gb)Qe.element.needsUpdate&&(Qe.D.Ce(Qe.element.videoWidth,Qe.element.videoHeight),Qe.D.Na(Qe.element.arrayBuffer),Qe.element.needsUpdate=!1);else{var d=Qe.element.currentTime,S=d-Qe.Sb;0>S&&(Qe.Sb=d),1e3*S<Si.Ng||(Qe.Sb+=S,Qe.D.refresh())}}function sn(){se.K("s64",[{type:"1i",name:"u1",value:1},{type:"1i",name:"u47",value:0},{type:"2f",name:"u48",value:Un.H},{type:"1f",name:"u49",value:.5},{type:"1f",name:"u50",value:0},{type:"1f",name:"u51",value:1}]);var d=[{type:"1i",name:"u52",value:0},{type:"1f",name:"u58",value:Tn.size}];se.K("s63",[{type:"1i",name:"u47",value:1},{type:"1f",name:"u55",value:Si.Ig},{type:"1f",name:"u56",value:_i.threshold},{type:"3f",name:"u54",value:[Tn.X[0]*Un.H[0],Tn.X[1]*Un.H[1],Tn.X[2]]},{type:"1f",name:"u49",value:.5},{type:"1f",name:"u57",value:1},{type:"1f",name:"u50",value:0}].concat(d)),se.K("s67",[{type:"1f",name:"u57",value:1}].concat(d)),se.K("s68",d),se.K("s65",[{type:"1i",name:"u52",value:0}]),se.K("s62",[{type:"1i",name:"u47",value:0},{type:"1i",name:"u60",value:1},{type:"1f",name:"u62",value:Un.H[0]},{type:"2f",name:"u61",value:[0,.5/yi.za()]}])}function gt(){Jr=ki.If(),Tn.size=ki.Mf(),Un.H[0]=1,Un.H[1]=Un.o/Un.F,vi.B({Qb:_i.overlapFactors,pe:_i.nScaleLevels,o:Un.o,F:Un.F,ye:_i.scale0Factor,X:Tn.X,ad:_i.scanCenterFirst})}function en(d){if(null!==Pn.lb)cn(Pn.lb,d);else{var S=Pn.dc;"JSON"!==S.toUpperCase().split(".").pop()&&(S+=Si.neuralNetworkPath),ut.get(S,function(C){cn(C=JSON.parse(C),d)})}}function cn(d,S){if(d.exportData){var C=d.exportData;C.rotationEulerAnglesFactors&&(Tn.qa=C.rotationEulerAnglesFactors),C.translationScalingFactors&&(Tn.X=C.translationScalingFactors),Tn.ab=!!C.isOutputLighting,C.landmarksLabels&&(Pi.labels=C.landmarksLabels,Pi.Nb=Pi.labels.length,Pi.Tc=Math.ceil(Pi.Nb/2)),Pi.wd=C.landmarksCenters?C.landmarksCenters:Pi.labels.map(function(){return[0,0]}),C.landmarksFactor&&(Pi.rc=C.landmarksFactor),C.facegenMode&&(Fi.mode=C.facegenMode,C.facegenDisplaceXFactor&&(Fi.Bd=C.facegenDisplaceXFactor))}S(d)}function Kt(d){ki=new b({fb:d.layers,Pb:"gpuRawAvg",Ob:kn}),function dn(){function d(le,_e){se.K(le,[{name:"u40",type:"1f",value:_e/Ar}])}function S(){return Pi.labels.map(function(){return[0,0]})}var C=yi.za();Ar=3+Pi.Tc;var U=new Float32Array(4*Ar);U={width:Ar,height:C,isFloat:!0,isPot:!1,array:yi.pf(U)},Tn.da&&Tn.da.remove(),Tn.da=Zn.instance(U),Tn.kb=W.instance(U),Tn.buffer=new Uint8Array(8*Ar*C),Tn.fd=U.array,d("s63",.5),d("s62",1),d("s64",.5),br=yi.qc({Wa:0,x:0,y:0,P:1,rx:0,ry:0,Fa:0,Kc:S(),cg:S(),Ca:0,Gc:0,Hc:0,Jc:0,Ic:0}),pi=yi.qc({detected:0,detectedRaw:0,isDetected:!1,x:0,y:0,s:1,rx:0,ry:0,rz:0,landmarks:S(),lAmb:0,lDir:0,lTheta:0,lPhi:0}),Ia=yi.qc({dx:0,dy:0,pc:0,mc:0,nc:0,oc:0})}(),gt(),Tn.ab&&function xt(){var d=["u41","u42","u43","u44","u45"].map(function(S,C){var U=C+2*Pi.Nb+8;return{name:S,type:"2f",value:[(.5+(U-=(C=Math.floor(U/Tn.size))*Tn.size))/Tn.size,(.5+(C=Tn.size-1-C))/Tn.size]}});se.K("s65",d)}(),sn()}function kn(){var d=yi.Qd(),S=pi[d];Tn.da.rg(1),w.viewport(0,d,1,1),se.set("s63"),Pn.ya&&se.J("u50",S.rz),yi.Le("u49");var C=1,U=yi.Dg(br,pi,Un.o/Un.F);yi.he()&&(U&&(C=0,br[d].Ca=0,S.isDetected=!1,S.detected=0),se.J("u57",C)),se.yg("u53",vi.get(d)),A.l(!1,!1),(yi.Fc()||U)&&(w.viewport(1,d,1,1),se.set("s67"),se.J("u57",C),A.l(!1,!1)),yi.Fc()&&Tn.ab&&(w.viewport(2,d,1,1),se.set("s65"),A.l(!1,!1)),yi.Fc()&&(w.viewport(3,d,Pi.Tc,1),se.set("s68"),A.l(!1,!1)),Tn.da.sync()}function nn(){Qe.D&&Qe.D.remove(),Qe.Gb=!(!Qe.element||!Qe.element.isFakeVideo);var d=null;Qe.Gb?d={isFlipY:!1,array:Qe.element.arrayBuffer,width:Qe.element.videoWidth,height:Qe.element.videoHeight,isKeepArray:!0}:Qe.element&&(d={L:Qe.element}),Qe.gd=W.instance(Object.assign({isPot:!1,isLinear:!0,isFloat:!1},d)),Qe.D=Qe.gd}function In(){var d=[{type:"mat2",name:"u46",value:Qe.A}];se.K("s66",[{type:"1i",name:"u1",value:0}].concat(d)),se.K("s64",d)}function Ln(){var d=[.5,.5],S=Qe.H[1]/Qe.H[0],C=Yt.Z()/Yt.I();switch(90===Math.abs(Cn.rotate)&&(S=1/S),S>C?d[1]*=C/S:d[0]*=S/C,se.K("s63",[{name:"u59",type:"1f",value:C}]),Qe.A[0]=0,Qe.A[1]=0,Qe.A[2]=0,Qe.A[3]=0,Cn.rotate){case 0:Qe.A[0]=d[0],Qe.A[3]=d[1];break;case 180:Qe.A[0]=-d[0],Qe.A[3]=-d[1];break;case 90:Qe.A[1]=d[0],Qe.A[2]=-d[1];break;case-90:Qe.A[1]=-d[0],Qe.A[2]=d[1]}Qe.ea[0]=Qe.A[0],Qe.ea[1]=Qe.A[1],Qe.ea[2]=Qe.A[2],Qe.ea[3]=Qe.A[3],Qe.eb||(Qe.A[1]*=-1,Qe.A[3]*=-1),Qe.eb&&Qe.ae&&(Qe.ea[1]*=-1,Qe.ea[3]*=-1)}function Ti(){var d=Qe.element.videoWidth,S=Qe.element.videoHeight,C=Qe.H[0]!==d||Qe.H[1]!==S;return C&&(Qe.H[0]=d,Qe.H[1]=S),C}function nr(d,S){return ui!==Jn.error&&(Qe.element=d,Ti(),S&&S(),!0)}function Xi(d,S,C){d&&d(),Qe.Ta={video:{facingMode:{ideal:Cn.facingMode},width:{min:Cn.minWidth,max:Cn.maxWidth,ideal:Cn.idealWidth},height:{min:Cn.minHeight,max:Cn.maxHeight,ideal:Cn.idealHeight}},audio:!1},St.sd(Qe.Ta,Cn.deviceId),St.get(Qe.element?Qe.element:St.Ud(),function(U){S&&S(U),C(U)},function(){at("WEBCAM_UNAVAILABLE")},Qe.Ta)}function at(d){ui!==Jn.error&&(ui=Jn.error,Pn.Sa&&Pn.Sa(d))}var d,S,C,U,le,_e,ye,qe=null,Ct={Oh:function(d){return Math.ceil(Math.log2(d))},ii:function(d){return Math.log2(d)},fi:function(d){return Math.log2(d)%1==0},Yg:function(d){var S=[0,0,0,0];return d.forEach(function(C){S[0]+=C[0],S[1]+=C[1],S[2]+=C[2],S[3]+=C[3]}),S},Zg:function(d,S,C){return Math.min(Math.max(d,S),C)},bh:function(d){return d*Math.PI/180},si:function(d,S){return S=Math.pow(10,S),Math.round(d*S)/S},ti:function(d){return Math.round(1e6*d)/1e6},Ph:function(d,S){return(100*d/S).toFixed(3)},pa:function(d,S,C){return d*(1-C)+S*C},ji:function(d,S){return d[0]*(1-S)+d[1]*S},mf:function(d,S){return Ct.df(d-S)},df:function(d){for(;d>Math.PI;)d-=2*Math.PI;for(;d<=-Math.PI;)d+=2*Math.PI;return d},hh:function(d,S){return Math.abs(Ct.mf(d,S))},Og:function(d,S){return Math.atan2(Math.sin(d)+Math.sin(S),Math.cos(d)+Math.cos(S))}},ut={get:function(d,S,C){var U=new XMLHttpRequest;U.open("GET",d,!0),U.withCredentials=!1,U.onreadystatechange=function(){4===U.readyState&&(200===U.status||0===U.status?S(U.responseText):typeof C<"u"&&C(U.status))},U.send()},Nf:function(d){return new Promise(function(S,C){ut.get(d,S,C)})},Lh:function(d,S,C){d+=C?"?"+ut.sf(C):"",ut.get(d,function(U){S(JSON.parse(U))})},mi:function(d,S,C){var U=new XMLHttpRequest;U.open("POST",d,!0),U.setRequestHeader("Content-type","application/x-www-form-urlencoded"),U.onreadystatechange=function(){4!==U.readyState||200!==U.status&&0!==U.status||C(U.responseText)},U.send(S)},sf:function(d){return"string"==typeof d?d:Object.keys(d).map(function(S){return encodeURIComponent(S)+"="+encodeURIComponent(d[S])}).join("&")},Ah:function(d,S){var C=new XMLHttpRequest;C.open("POST",d,!0),C.responseType="arraybuffer",C.onload=function(){S(C.response)},C.send()}},Se={kc:function(d,S){if(0===S||"object"!=typeof d)return d;for(var C in S=void 0===S||-1===S?-1:S-1,d=Object.assign({},d))d[C]=Se.kc(d[C],S);return d},gh:function(d){return JSON.parse(JSON.stringify(d))}},De={Ei:function(d,S,C){return(d=Math.min(Math.max((C-d)/(S-d),0),1))*d*(3-2*d)},Nc:function(d,S,C){return Math.min(Math.max((C-d)/(S-d),0),1)},sh:function(d,S,C,U){return Math.pow(Math.min(Math.max((U-d)/(S-d),0),1),C)},Ji:function(){return 0},li:function(){return 1},hi:function(d){return d},ph:function(d){return d*d},uh:function(d){return d*(2-d)},mh:function(d){return.5>d?2*d*d:(4-2*d)*d-1},kh:function(d){return d*d*d},th:function(d){return--d*d*d+1},lh:function(d){return.5>d?4*d*d*d:(d-1)*(2*d-2)*(2*d-2)+1},qh:function(d){return d*d*d*d},vh:function(d){return 1- --d*d*d*d},nh:function(d){return.5>d?8*d*d*d*d:1-8*--d*d*d*d},rh:function(d){return d*d*d*d*d},wh:function(d){return 1+--d*d*d*d*d},oh:function(d){return.5>d?16*d*d*d*d*d:1+16*--d*d*d*d*d}},se=function(){function d(I,oe,Ze){return oe=I.createShader(oe),I.shaderSource(oe,Ze),I.compileShader(oe),I.getShaderParameter(oe,I.COMPILE_STATUS)?oe:null}function U(I,oe){if(oe.u=!!oe.u,!oe.u){oe.sa=oe.sa||"precision lowp float;attribute vec2 a0;varying vec2 vv0;void main(){gl_Position=vec4(a0,0.,1.),vv0=a0*.5+vec2(.5);}",oe.qb=oe.qb||["a0"],oe.Qa=oe.Qa||[2],oe.precision=oe.precision||we,oe.id=Ee++,void 0!==oe.Ae&&(oe.Ae.forEach(function(Ht,Kn){oe.g=oe.g.replace(Ht,oe.Ub[Kn])}),oe.Ae.splice(0)),oe.od=0,oe.Qa.forEach(function(Ht){oe.od+=4*Ht});var Ze=function C(I){return["float","sampler2D","int"].map(function(oe){return"precision "+I+" "+oe+";\n"}).join("")}(oe.precision);if(oe.Ea=function S(I,oe,Ze){oe=d(I,I.VERTEX_SHADER,oe),Ze=d(I,I.FRAGMENT_SHADER,Ze),I===w&&ae.push(oe,Ze);var Et=I.createProgram();return I.attachShader(Et,oe),I.attachShader(Et,Ze),I.linkProgram(Et),Et}(I,Ze+oe.sa,Ze+oe.g),oe.C={},oe.i.forEach(function(Ht){oe.C[Ht]=I.getUniformLocation(oe.Ea,Ht)}),oe.attributes={},oe.Ra=[],oe.qb.forEach(function(Ht){var Kn=I.getAttribLocation(oe.Ea,Ht);oe.attributes[Ht]=Kn,oe.Ra.push(Kn)}),oe.j)for(var Et in I.useProgram(oe.Ea),me=oe,K=oe.id,oe.j)I.uniform1i(oe.C[Et],oe.j[Et]);oe.Ba=!0}}function _e(I,oe,Ze){return U(I,oe),I.useProgram(oe.Ea),I.enableVertexAttribArray(oe.attributes.a0),K=-1,me=oe}var ae=[],K=-1,me=null,Ee=0,Be=!1,we="highp",Ie=["u1"],xe=["u0"],Ce={u1:0},N={u0:0},j={u1:0,u2:1},ge={u1:0,u3:1},V=["u1","u3","u4"],Q={u5:0},z=["u6","u7","u8","u9"],B={u6:0,u7:1},Te={s0:{g:"uniform sampler2D u1;varying vec2 vv0;void main(){gl_FragColor=texture2D(u1,vv0);}",i:["u1"],j:{u1:0}},s1:{g:"uniform sampler2D u1;varying vec2 vv0;void main(){gl_FragColor=texture2D(u1,vv0);}",i:Ie,j:Ce,precision:"lowp"},s2:{g:"uniform sampler2D u1,u2;varying vec2 vv0;void main(){vec4 a=texture2D(u2,vv0),b=texture2D(u1,vv0);gl_FragColor=a*b;}",i:["u1","u2"],j},s3:{g:"uniform sampler2D u1;uniform vec2 u10,u11;varying vec2 vv0;void main(){vec2 a=vv0*u10+u11;gl_FragColor=texture2D(u1,a);}",i:["u1","u10","u11"],j:Ce,u:!0},s4:{g:"uniform sampler2D u1;varying vec2 vv0;const vec4 f=vec4(1.,1.,1.,1.);void main(){vec4 a=texture2D(u1,vv0);gl_FragColor=a.r*f;}",i:Ie,j:Ce},s5:{g:"uniform sampler2D u1,u2;varying vec2 vv0;const vec4 f=vec4(1.,1.,1.,1.);void main(){vec4 a=texture2D(u2,vv0),b=texture2D(u1,vv0);gl_FragColor=a.a*b.r*f;}",i:["u1","u2"],j},s6:{g:"uniform sampler2D u1;varying vec2 vv0;void main(){gl_FragColor=texture2D(u1,vec2(1.-vv0.x,vv0.y));}",i:Ie,j:Ce},s7:{g:"uniform sampler2D u1;varying vec2 vv0;void main(){gl_FragColor=texture2D(u1,vec2(vv0.x,1.-vv0.y));}",i:Ie,j:Ce},s8:{g:"uniform sampler2D u0;uniform float u10;varying vec2 vv0;void main(){vec4 a=texture2D(u0,vv0);gl_FragColor=a*u10;}",i:["u0","u10"],j:N},s9:{g:"uniform sampler2D u0;uniform float u10;varying vec2 vv0;const vec4 f=vec4(.25),g=vec4(1.);void main(){vec4 a=texture2D(u0,vv0);float b=dot(a*u10,f);gl_FragColor=b*g;}",i:["u0","u10"],j:N},s10:{g:"uniform sampler2D u1;varying vec2 vv0;const vec4 e=vec4(1.,1.,1.,1.);void main(){float a=.25*dot(e,texture2D(u1,vv0));gl_FragColor=a*e;}",i:Ie,j:Ce},s11:{g:"uniform sampler2D u1,u12;uniform float u13;const vec4 f=vec4(1.);varying vec2 vv0;void main(){vec4 a=texture2D(u1,vv0),b=texture2D(u12,vv0);gl_FragColor=mix(b,a,u13*f);}",i:["u1","u12","u13"],j:{u1:0,u12:1}},s12:{g:"uniform sampler2D u1;uniform vec2 u14;varying vec2 vv0;void main(){gl_FragColor=.25*(texture2D(u1,vv0+u14)+texture2D(u1,vv0+u14*vec2(1.,-1.))+texture2D(u1,vv0+u14*vec2(-1.,-1.))+texture2D(u1,vv0+u14*vec2(-1.,1.)));}",i:["u1","u14"],j:Ce},s13:{g:"uniform sampler2D u1;varying vec2 vv0;vec4 f(vec3 d){vec3 b=d/65536.,a=clamp(ceil(log2(b)),-128.,127.);float c=max(max(a.r,a.g),a.b),g=exp2(c);vec3 h=clamp(b/g,0.,1.);return vec4(h,(c+128.)/256.);}void main(){vec3 a=texture2D(u1,vv0).rgb;gl_FragColor=f(a);}",i:Ie,j:Ce,u:!0},s14:{g:"uniform sampler2D u1;varying vec2 vv0;vec3 f(vec4 a){float b=a.a*256.-128.;vec3 c=a.rgb;return exp2(b)*c*65536.;}void main(){vec4 a=texture2D(u1,vv0);gl_FragColor=vec4(f(a),1.);}",i:Ie,j:Ce,u:!0},s15:{g:"uniform sampler2D u1;uniform vec4 u15;varying vec2 vv0;float g(float a,float b){a=floor(a)+.5;return floor(a/exp2(b));}float h(float a,float b){return floor(a*exp2(b)+.5);}float i(float a,float b){return mod(a,h(1.,b));}float e(float c,float a,float b){a=floor(a+.5),b=floor(b+.5);return i(g(c,a),b-a);}vec4 j(float a){if(a==0.)return vec4(0.,0.,0.,0.);float k=128.*step(a,0.);a=abs(a);float c=floor(log2(a)),l=c+127.,b=(a/exp2(c)-1.)*8388608.,d=l/2.,m=fract(d)*2.,n=floor(d),o=e(b,0.,8.),p=e(b,8.,16.),q=m*128.+e(b,16.,23.),r=k+n;return vec4(o,p,q,r)/255.;}void main(){float a=dot(texture2D(u1,vv0),u15);gl_FragColor=j(a);}",i:["u1","u15"],j:Ce},s16:{g:"uniform sampler2D u0;varying vec2 vv0;const vec4 e=vec4(1.);void main(){vec4 a=texture2D(u0,vv0),b=e/(e+exp(-a));gl_FragColor=b;}",i:xe,j:N,u:!0},s17:{g:"uniform sampler2D u0;varying vec2 vv0;const vec4 f=vec4(0.);void main(){vec4 a=texture2D(u0,vv0);gl_FragColor=max(f,a);}",i:xe,j:N,u:!0},s18:{g:"uniform sampler2D u0;varying vec2 vv0;const vec4 e=vec4(1.);const float g=.797885,h=.044715;vec4 i(vec4 a){vec4 b=exp(-abs(a)),c=b*b,d=sign(a)*(e-c)/(e+c);return d;}void main(){vec4 a=texture2D(u0,vv0),b=a+h*a*a*a,c=i(g*b);gl_FragColor=.5*a*(e+c);}",i:xe,j:N,u:!0},s19:{g:"uniform sampler2D u0;varying vec2 vv0;const vec4 f=vec4(1.);void main(){vec4 a=texture2D(u0,vv0);gl_FragColor=mix(exp(-abs(a))-f,a,step(0.,a));}",i:xe,j:N,u:!0},s20:{g:"uniform sampler2D u0;varying vec2 vv0;const vec4 f=vec4(1.);void main(){vec4 a=texture2D(u0,vv0),b=exp(a)-f;gl_FragColor=mix(.1*b,a,step(0.,a));}",i:xe,j:N},s21:{g:"uniform sampler2D u0;const float e=3.141593;varying vec2 vv0;void main(){gl_FragColor=atan(e*texture2D(u0,vv0))/e;}",i:xe,j:N},s22:{g:"uniform sampler2D u0;const float e=3.141593;varying vec2 vv0;void main(){gl_FragColor=2.*atan(e*texture2D(u0,vv0))/e;}",i:xe,j:N,u:!0},s23:{g:"uniform sampler2D u0,u16;uniform float u17;const vec2 e=vec2(.5);const float f=1e-5;const vec4 g=vec4(1.),i=vec4(0.);varying vec2 vv0;void main(){vec4 a=texture2D(u16,e);float b=u17*u17;vec4 c=max(b*a,f*g);gl_FragColor=texture2D(u0,vv0)/c;}",i:["u0","u16","u17"],j:{u0:0,u16:1},u:!0},s24:{g:"uniform sampler2D u1;uniform vec2 u18;varying vec2 vv0;void main(){float a=u18.x*u18.y;vec2 b=floor(vv0*a)/a,c=fract(vv0*a),d=floor(b*u18.y),f=floor(u18.x*fract(b*u18.y)),g=(f*u18.y+d)/a;gl_FragColor=texture2D(u1,g+c/a);}",i:["u1","u18"],j:Ce},s25:{g:"uniform sampler2D u7,u6,u19;varying vec2 vv0;void main(){vec4 a=texture2D(u19,vv0);vec2 b=a.rg,c=a.ba;vec4 d=texture2D(u7,b),f=texture2D(u6,c);gl_FragColor=d*f;}",i:["u7","u6","u19"],j:Object.assign({u19:2},B),u:!0},s26:{g:"uniform float u8,u9;uniform sampler2D u7,u6;varying vec2 vv0;void main(){vec2 b=fract(vv0*u8);float a=u8*u9;vec2 c=(vec2(.5)+floor(a*vv0))/a;vec4 d=texture2D(u7,c),f=texture2D(u6,b);gl_FragColor=d*f;}",i:z,j:B},s27:{g:"uniform float u8,u9;uniform vec2 u20;uniform sampler2D u7,u6;varying vec2 vv0;void main(){float a=u8*u9;vec2 b=mod(vv0*u20,vec2(1.)),c=floor(vv0*u20)/u20,d=c+fract(b*u8)/u20,f=(vec2(.5)+floor(a*b))/a;vec4 g=texture2D(u7,f),h=texture2D(u6,d);gl_FragColor=g*h;}",i:["u20"].concat(z),j:B,u:!0},s28:{g:"uniform float u8,u9;uniform sampler2D u7,u6,u22,u23,u24,u25;varying vec2 vv0;const vec4 e=vec4(1.,1.,1.,1.),g=vec4(1e-3,1e-3,1e-3,1e-3);void main(){vec2 c=fract(vv0*u8),d=vv0;float h=u8*u9;d=(.5+floor(h*vv0))/h;vec4 l=texture2D(u7,d),m=texture2D(u6,c),a=texture2D(u25,d);a=floor(.5+a*255.);vec4 n=texture2D(u22,c),o=texture2D(u23,c),p=texture2D(u24,c),i=step(-g,-a),b=e-i,j=b*step(-e-g,-a);b*=e-j;vec4 k=b*step(-2.*e-g,-a);b*=e-k;vec4 q=b,r=i*m+j*n+k*o+q*p;gl_FragColor=l*r;}",i:["u25","u22","u23","u24"].concat(z),j:Object.assign({u25:3,u22:4,u23:5,u24:6},B),u:!0},s29:{g:"uniform sampler2D u7,u6,u3;uniform float u8,u26,u27,u9;uniform vec2 u28;varying vec2 vv0;const vec2 f=vec2(1.),l=vec2(0.);void main(){vec2 c=floor(u26*vv0),d=u26*vv0-c;float g=u8/u26;vec2 h=floor(d*g),i=d*g-h,j=(c+i)/u26;float m=u26*u9/u8;vec2 b=m*h;b=floor(u28*b+.5*(u9-1.)*(f-u28));vec2 a=(b+i*u27)/u9;a+=.25/u9;vec2 k=step(a,f)*step(l,a);vec4 n=texture2D(u7,j),o=texture2D(u6,a),p=n*o,q=texture2D(u3,j);gl_FragColor=(p*u27*u27+q)*k.x*k.y;}",i:["u26","u27","u3","u28"].concat(z),j:Object.assign({u3:2},B)},s30:{g:"uniform sampler2D u7,u6;varying vec2 vv0;void main(){vec4 a=texture2D(u7,vv0),b=texture2D(u6,vv0);gl_FragColor=a*b;}",i:["u7","u6"],j:B,u:!0},s31:{g:"uniform sampler2D u1,u3;uniform float u4;varying vec2 vv0;void main(){gl_FragColor=texture2D(u3,vv0)+u4*texture2D(u1,vv0);}",i:V,j:ge},s32:{g:"uniform sampler2D u1,u3;uniform vec2 u20;uniform float u4;varying vec2 vv0;void main(){gl_FragColor=texture2D(u3,vv0*u20)+u4*texture2D(u1,vv0);}",i:["u20"].concat(V),j:ge,u:!0},s33:{g:"uniform sampler2D u1,u3;uniform float u4;varying vec2 vv0;const vec4 e=vec4(1.);void main(){vec4 a=texture2D(u3,vv0)+u4*texture2D(u1,vv0);vec2 h=mod(gl_FragCoord.xy,vec2(2.)),d=step(h,vec2(.75));float b=d.x+2.*d.y,c=step(2.5,b),g=(1.-c)*step(1.5,b),i=(1.-c)*(1.-g)*step(.5,b);a=mix(a,a.argb,i*e),a=mix(a,a.barg,g*e),a=mix(a,a.gbar,c*e),gl_FragColor=a;}",i:V,j:ge,u:!0},s34:{g:"uniform sampler2D u1,u3;uniform vec2 u20;uniform float u4;varying vec2 vv0;const vec4 e=vec4(1.);void main(){vec4 a=texture2D(u3,vv0*u20)+u4*texture2D(u1,vv0);vec2 h=mod(gl_FragCoord.xy,vec2(2.)),d=step(h,vec2(.75));float b=d.x+2.*d.y,c=step(2.5,b),g=(1.-c)*step(1.5,b),i=(1.-c)*(1.-g)*step(.5,b);a=mix(a,a.argb,i*e),a=mix(a,a.barg,g*e),a=mix(a,a.gbar,c*e),gl_FragColor=a;}",i:["u20"].concat(V),j:ge,u:!0},s35:{g:"uniform sampler2D u1,u3;uniform float u4;varying vec2 vv0;const vec4 h=vec4(1.);void main(){vec4 a=texture2D(u3,vv0)+u4*texture2D(u1,vv0);vec2 b=floor(gl_FragCoord.xy);vec3 d=b.x*vec3(1.)+vec3(0.,1.,2.);float c=mod(b.y,2.);vec4 f=vec4(c,(1.-c)*step(mod(d,vec3(3.)),vec3(.5)));mat4 g=mat4(a.rgba,a.gbar,a.barg,a.argb);gl_FragColor=g*f;}",i:V,j:ge,u:!0},s36:{g:"varying vec2 vv0;uniform sampler2D u1;const vec4 f=vec4(1.,1.,1.,1.),g=vec4(.299,.587,.114,0.);void main(){vec4 a=texture2D(u1,vv0);gl_FragColor=dot(a,g)*f;}",i:Ie,j:Ce,precision:"lowp"},s37:{g:"varying vec2 vv0;uniform sampler2D u1;uniform float u29;const vec3 f=vec3(.299,.587,.114);void main(){vec3 a=texture2D(u1,vv0).rgb,b=texture2D(u1,vv0+vec2(0.,u29)).rgb,c=texture2D(u1,vv0+vec2(u29,u29)).rgb,d=texture2D(u1,vv0+vec2(u29,0.)).rgb;gl_FragColor=vec4(dot(a,f),dot(b,f),dot(c,f),dot(d,f));}",i:["u1","u29"],j:Ce,precision:"lowp"},s38:{g:"varying vec2 vv0;uniform sampler2D u1;uniform float u29;const vec3 f=vec3(.299,.587,.114);void main(){vec3 a=texture2D(u1,vv0).rgb,b=texture2D(u1,vv0+vec2(0.,u29)).rgb,c=texture2D(u1,vv0+vec2(u29,u29)).rgb,d=texture2D(u1,vv0+vec2(u29,0.)).rgb;gl_FragColor=vec4(a.r,b.g,c.b,dot(d,f));}",i:["u1","u29"],j:Ce,precision:"lowp"},s39:{g:"varying vec2 vv0;uniform sampler2D u1,u2;uniform float u30;const vec4 f=vec4(1.,1.,1.,1.);void main(){vec4 a=vec4(0.);a-=texture2D(u1,vec2(vv0.x-u30,vv0.y-u30))*1.,a-=texture2D(u1,vec2(vv0.x-u30,vv0.y))*2.,a-=texture2D(u1,vec2(vv0.x-u30,vv0.y+u30))*1.,a+=texture2D(u1,vec2(vv0.x+u30,vv0.y-u30))*1.,a+=texture2D(u1,vec2(vv0.x+u30,vv0.y))*2.,a+=texture2D(u1,vec2(vv0.x+u30,vv0.y+u30))*1.;vec4 b=vec4(0.);b-=texture2D(u1,vec2(vv0.x-u30,vv0.y-u30))*1.,b-=texture2D(u1,vec2(vv0.x,vv0.y-u30))*2.,b-=texture2D(u1,vec2(vv0.x+u30,vv0.y-u30))*1.,b+=texture2D(u1,vec2(vv0.x-u30,vv0.y+u30))*1.,b+=texture2D(u1,vec2(vv0.x,vv0.y+u30))*2.,b+=texture2D(u1,vec2(vv0.x+u30,vv0.y+u30))*1.;vec3 c=sqrt(a.rgb*a.rgb+b.rgb*b.rgb);vec4 e=vec4(c,texture2D(u1,vv0).a),g=texture2D(u2,vv0);gl_FragColor=g.a*e.r*f;}",i:["u1","u2","u30"],j,u:!0},s40:{g:"varying vec2 vv0;uniform sampler2D u1,u2;uniform float u30;const vec4 j=vec4(1.,1.,1.,1.);const vec2 k=vec2(1.,1.);void main(){float h=0.;vec2 l=k*u30,a,b;float c,d,i=0.;for(float e=-4.;e<=4.;e+=1.)for(float f=-4.;f<=4.;f+=1.)a=vec2(e,f),c=length(a)/2.,d=exp(-c*c),b=vv0+l*a,h+=d*texture2D(u1,b).r,i+=d;vec4 m=texture2D(u2,vv0);gl_FragColor=m.a*(texture2D(u1,b).r-h/i)*j;}",i:["u1","u2","u30"],j,u:!0},s41:{g:"uniform sampler2D u5;uniform vec2 u14;varying vec2 vv0;vec4 e(vec4 a,vec4 b){vec4 c=step(a,b);return mix(a,b,c);}const vec2 g=vec2(.5,.5),h=vec2(1.,0.),i=vec2(0.,1.);void main(){vec2 a=vv0-u14*g;vec4 b=texture2D(u5,a),c=texture2D(u5,a+u14*h),d=texture2D(u5,a+u14*i),j=texture2D(u5,a+u14),k=e(b,c),l=e(d,j);gl_FragColor=e(k,l);}",i:["u5","u14"],j:Q},s42:{g:"uniform sampler2D u5;uniform vec2 u14;varying vec2 vv0;const vec2 k=vec2(1.,0.),l=vec2(0.,1.),m=vec2(2.,0.),n=vec2(0.,2.);vec4 e(vec4 a,vec4 b){vec4 c=step(a,b);return mix(a,b,c);}vec4 f(vec2 a){vec4 b=texture2D(u5,a),c=texture2D(u5,a+u14*k),d=texture2D(u5,a+u14*l),g=texture2D(u5,a+u14),h=e(b,c),i=e(d,g);return e(h,i);}void main(){vec2 a=vv0+u14*vec2(-.55,-1.05);vec4 b=f(a),c=f(a+u14*m),d=f(a+u14*2.),g=f(a+u14*n),h=e(b,c),i=e(d,g);gl_FragColor=e(h,i);}",i:["u5","u14"],j:Q,u:!0},s43:{g:"uniform sampler2D u1;varying vec2 vv0;void main(){vec4 a=texture2D(u1,vv0);gl_FragColor=a*a;}",i:["u1"],j:Ce,precision:"lowp",u:!0},s44:{g:"uniform sampler2D u1;uniform vec2 u14;varying vec2 vv0;const float e=15444.;void main(){vec4 a=1001./e*texture2D(u1,vv0-3.*u14)+2002./e*texture2D(u1,vv0-2.*u14)+3003./e*texture2D(u1,vv0-u14)+3432./e*texture2D(u1,vv0)+3003./e*texture2D(u1,vv0+u14)+2002./e*texture2D(u1,vv0+2.*u14)+1001./e*texture2D(u1,vv0+3.*u14);gl_FragColor=a;}",i:["u14","u1"],j:Ce,precision:"lowp",u:!0},s45:{g:"uniform sampler2D u1,u16,u31;varying vec2 vv0;const vec4 f=vec4(1.,1.,1.,1.);const float g=.1;void main(){vec4 a=texture2D(u16,vv0),b=texture2D(u31,vv0),c=texture2D(u1,vv0),d=max(f*g,b-a*a),h=sqrt(d);gl_FragColor=(c-a)/h;}",i:["u1","u16","u31"],j:{u1:0,u16:1,u31:2},u:!0}},Fe={s46:{g:"uniform float u8,u32;uniform sampler2D u7,u6,u3;varying vec2 vv0;const vec2 ZERO2=vec2(0.,0.),ONE2=vec2(1.,1.),HALF2=vec2(.5,.5),EPS2=vec2(1e-5,1e-5);void main(){vec4 sum=texture2D(u3,vv0);float toSparsity=1.1111;vec2 uvFrom,uvWeight,xyPatch=ZERO2,eps2=EPS2/u8,xyTo=floor(vv0*u8+eps2);float weightSize=toSparsity*u8;vec2 halfFromSparsity=ONE2*(toSparsity-1.)/2.;for(float patch_x=0.;patch_x<1.1111;patch_x+=1.){xyPatch.x=patch_x;for(float patch_y=0.;patch_y<1.1111;patch_y+=1.)xyPatch.y=patch_y,uvFrom=(xyTo+HALF2+u32*(xyPatch-halfFromSparsity))/u8,uvFrom+=step(uvFrom,-eps2),uvFrom-=step(ONE2-eps2,uvFrom),uvWeight=(xyTo*toSparsity+xyPatch+HALF2)/weightSize,sum+=texture2D(u7,uvWeight)*texture2D(u6,uvFrom);}gl_FragColor=sum,gl_FragColor*=2.2222;}",i:["u8","u7","u6","u3","u32"],Ub:["1.1111","gl_FragColor\\*=2.2222;"]},s47:{g:"uniform float u8,u32,u9;uniform sampler2D u7,u6,u3;varying vec2 vv0;const vec2 ZERO2=vec2(0.,0.),ONE2=vec2(1.,1.),HALF2=vec2(.5,.5),EPS2=vec2(1e-4,1e-4);void main(){vec4 sum=texture2D(u3,vv0);float fromSparsity=1.1111,shrinkFactor=3.3333;vec2 uvFrom,uvWeight,xyFrom,xyPatchTo,xyPatch=ZERO2,xyShrink=ZERO2,eps2=EPS2/u9,xyTo=floor(vv0*u8+eps2);float weightSize=fromSparsity*u9;vec2 halfFromSparsity=ONE2*(fromSparsity-1.)/2.;float toSparsity=weightSize/u8;vec2 xyFrom0=xyTo*shrinkFactor;for(float patch_x=0.;patch_x<1.1111;patch_x+=1.){xyPatch.x=patch_x;for(float patch_y=0.;patch_y<1.1111;patch_y+=1.){xyPatch.y=patch_y;for(float shrink_x=0.;shrink_x<3.3333;shrink_x+=1.){xyShrink.x=shrink_x;for(float shrink_y=0.;shrink_y<3.3333;shrink_y+=1.)xyShrink.y=shrink_y,xyFrom=xyFrom0+xyShrink+shrinkFactor*u32*(xyPatch-halfFromSparsity),uvFrom=(xyFrom+HALF2)/u9,uvFrom+=step(uvFrom,-eps2),uvFrom-=step(ONE2-eps2,uvFrom),xyPatchTo=xyPatch*shrinkFactor+xyShrink,uvWeight=(xyTo*toSparsity+xyPatchTo+HALF2)/weightSize,sum+=texture2D(u7,uvWeight)*texture2D(u6,uvFrom);}}}gl_FragColor=sum,gl_FragColor*=2.2222;}",i:"u8 u9 u7 u6 u3 u32".split(" "),Ub:["1.1111","gl_FragColor\\*=2.2222;","3.3333"]}},te=null,He=null,rt={Hb:function(){return Be},B:function(){if(!Be){for(var I in te=Se.kc(Te,2),He=Se.kc(Fe,2),we="highp",w.getShaderPrecisionFormat&&(w.getShaderPrecisionFormat(w.FRAGMENT_SHADER,w.MEDIUM_FLOAT),w.getShaderPrecisionFormat(w.FRAGMENT_SHADER,w.LOW_FLOAT)),te)U(w,te[I]);se.set("s0"),w.enableVertexAttribArray(0),Be=!0}},mb:function(I){I.forEach(function(oe){rt.td(oe)})},td:function(I){te[I.id]=I,U(w,I)},Qf:function(I,oe,Ze){oe||(oe=I),te[oe]=Object.create(He[I]),te[oe].Vf=!0,He[I].Ub&&He[I].Ub.forEach(function(Et,Ht){te[oe].g=te[oe].g.replace(new RegExp(Et,"g"),Ze[Ht])}),U(w,te[oe])},set:function(I){var oe=te[I];oe.u&&(oe.u=!1,U(w,oe)),function le(I){xn.vg(rt),K!==I.id&&(rt.O(),K=I.id,me=I,w.useProgram(I.Ea),I.Ra.forEach(function(oe){0!==oe&&w.enableVertexAttribArray(oe)}))}(oe)},ib:function(I){return _e(I,{g:"uniform sampler2D u1;varying vec2 vv0;void main(){gl_FragColor=texture2D(u1,vv0);}",i:["u1"],j:{u1:0}})},dd:function(I){return _e(I,{g:"void main(){gl_FragColor=vec4(.5,.5,.5,.5);}",i:[],precision:we})},uf:function(I){return!(typeof te[I]>"u")&&te[I].Ba},O:function(){-1!==K&&(K=-1,me.Ra.forEach(function(I){0!==I&&w.disableVertexAttribArray(I)}))},ed:function(){var I=0;me.Ra.forEach(function(oe,Ze){w.vertexAttribPointer(oe,Ze=me.Qa[Ze],w.FLOAT,!1,me.od,I),I+=4*Ze})},Fd:function(){w.enableVertexAttribArray(0)},La:function(){rt.Vb(w)},Vb:function(I){I.vertexAttribPointer(me.Ra[0],2,I.FLOAT,!1,8,0)},zi:function(I,oe){w.uniform1i(me.C[I],oe)},J:function(I,oe){w.uniform1f(me.C[I],oe)},S:function(I,oe,Ze){w.uniform2f(me.C[I],oe,Ze)},xg:function(I,oe){w.uniform2fv(me.C[I],oe)},yg:function(I,oe){w.uniform3fv(me.C[I],oe)},Ai:function(I,oe,Ze,Et){w.uniform3f(me.C[I],oe,Ze,Et)},zg:function(I,oe,Ze,Et,Ht){w.uniform4f(me.C[I],oe,Ze,Et,Ht)},Fe:function(I,oe){w.uniform4fv(me.C[I],oe)},Ge:function(I,oe){w.uniformMatrix2fv(me.C[I],!1,oe)},Bi:function(I,oe){w.uniformMatrix3fv(me.C[I],!1,oe)},Ci:function(I,oe){w.uniformMatrix4fv(me.C[I],!1,oe)},K:function(I,oe){rt.set(I),oe.forEach(function(Ze){switch(Ze.type){case"4f":w.uniform4fv(me.C[Ze.name],Ze.value);break;case"3f":w.uniform3fv(me.C[Ze.name],Ze.value);break;case"2f":w.uniform2fv(me.C[Ze.name],Ze.value);break;case"1f":w.uniform1f(me.C[Ze.name],Ze.value);break;case"1i":w.uniform1i(me.C[Ze.name],Ze.value);break;case"mat2":w.uniformMatrix2fv(me.C[Ze.name],!1,Ze.value);break;case"mat3":w.uniformMatrix3fv(me.C[Ze.name],!1,Ze.value);break;case"mat4":w.uniformMatrix4fv(me.C[Ze.name],!1,Ze.value)}})},Nh:function(){return"lowp"},m:function(){for(var I in rt.O(),w.disableVertexAttribArray(0),te){var oe=te[I];oe.Ba&&(oe.Ba=!1,w.deleteProgram(oe.Ea)),oe.Vf&&delete te[I]}ae.forEach(function(Ze){w.deleteShader(Ze)}),ae.splice(0),Ee=0,Be=!1,me=null,K=-1}};return rt}(),w=null,Yt=function(){function d(xe){return console.log("ERROR in ContextFF: ",xe),!1}function S(){return navigator.userAgent&&-1!==navigator.userAgent.indexOf("forceWebGL1")}function C(xe,Ce,N){xe.setAttribute("width",Ce),xe.setAttribute("height",N)}function U(xe){function Ce(){H.m(),Ne.reset(),j.getExtension("WEBGL_lose_context").loseContext()}if(S())return!1;var N=document.createElement("canvas");C(N,5,5);var j=null;try{j=N.getContext("webgl2",xe)}catch{return!1}return!!j&&(le(j),Ne.Gd(j),(xe=Ne.lc(j)).ka||xe.ma?(xe=H.ud(j,xe),Ce(),!!xe):(Ce(),!1))}function le(xe){xe.clearColor(0,0,0,0),xe.disable(xe.DEPTH_TEST),xe.disable(xe.BLEND),xe.disable(xe.DITHER),xe.disable(xe.STENCIL_TEST),xe.disable(xe.CULL_FACE),xe.GENERATE_MIPMAP_HINT&&xe.FASTEST&&xe.hint(xe.GENERATE_MIPMAP_HINT,xe.FASTEST),xe.disable(xe.SAMPLE_ALPHA_TO_COVERAGE),xe.disable(xe.SAMPLE_COVERAGE),xe.depthFunc(xe.LEQUAL),xe.clearDepth(1)}var _e=null,ye=null,ae=null,K=null,me=!0,Ee=null,Be=null,we=[],Ie={I:function(){return _e.width},Z:function(){return _e.height},Fh:function(){return _e},Dh:function(){return w},na:function(){return me},flush:function(){w.flush()},Ac:function(){P.ga(),Ie.xe()},xe:function(){W.reset(),A.reset(),se.O(),se.Fd(),w.disable(w.DEPTH_TEST),w.disable(w.BLEND),A.Ga(),se.La()},Af:function(){return Ee||(Ee=new Uint8Array(_e.width*_e.height*4)),w.readPixels(0,0,_e.width,_e.height,w.RGBA,w.UNSIGNED_BYTE,Ee),Ee},Gh:function(){return _e.toDataURL("image/jpeg")},Hh:function(){P.U(),ye||(ye=document.createElement("canvas"),ae=ye.getContext("2d")),C(ye,_e.width,_e.height);for(var xe=Ie.Af(),Ce=ae.createImageData(ye.width,ye.height),N=ye.width,j=ye.height,ge=Ce.data,V=0;V<j;++V)for(var Q=j-V-1,z=0;z<N;++z){var B=4*(V*N+z),Te=4*(Q*N+z);ge[B]=xe[Te],ge[B+1]=xe[Te+1],ge[B+2]=xe[Te+2],ge[B+3]=xe[Te+3]}return ae.putImageData(Ce,0,0),ye.toDataURL("image/png")},zf:function(xe){!ye&&xe&&(ye=document.createElement("canvas"),ae=ye.getContext("2d"));var Ce=xe?ye:document.createElement("canvas");return C(Ce,_e.width,_e.height),(xe?ae:Ce.getContext("2d")).drawImage(_e,0,0),Ce},B:function(xe){if((xe=Object.assign({la:null,Uc:null,rb:null,Ad:null,width:512,height:512,premultipliedAlpha:!1,Zd:!0,antialias:!1,debug:!1,fh:!1},xe)).la?(w=xe.la,_e=xe.la.canvas):xe.Ad&&!xe.rb?_e=document.getElementById(xe.Ad):xe.rb&&(_e=xe.rb),_e||(_e=document.createElement("canvas")),_e.width=xe.width,_e.height=xe.height,w)me=w instanceof WebGL2RenderingContext;else{me=!0;var Ce={antialias:xe.antialias,alpha:!0,preserveDrawingBuffer:!0,premultipliedAlpha:xe.premultipliedAlpha,stencil:!1,depth:xe.Zd,failIfMajorPerformanceCaveat:!0,powerPreference:"high-performance"};navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("noAntialiasing")&&(Ce.antialias=!1);var N=U(Ce);N||!Ce.antialias||S()||(Ce.antialias=!1,N=U(Ce)),N&&(w=_e.getContext("webgl2",Ce)),w?me=!0:((w=_e.getContext("webgl",Ce))||(w=_e.getContext("experimental-webgl",Ce)),me=!1)}return w?(xe.Uc&&_e.addEventListener&&(K=w.getExtension("WEBGL_lose_context"))&&_e.addEventListener("webglcontextlost",Be=xe.Uc,!1),Ne.B()?(le(w),se.B(),A.B(),H.ud(w,Ne.yf()),we.forEach(function(j){j(w)}),we.splice(0),!0):d("Not enough GL capabilities")):d("WebGL1 and 2 are not enabled")},Tg:function(){return new Promise(function(xe){w?xe(w):we.push(xe)})},m:function(){w&&(Ne.m(),se.m(),H.m()),K&&Be&&(_e.removeEventListener("webglcontextlost",Be,!1),K=Be=null),w=Ee=ae=ye=_e=null,we.splice(0)}};return Ie}(),xn=function(){function d(){null===S&&(typeof se<"u"?S=se:typeof JEShaders<"u"&&(S=JEShaders))}var S=null;return{reset:function(){S=null},vg:function(C){S!==C&&(S&&S.O(),S=C)},Hb:function(){return S.Hb()},La:function(){return S.La()},Vb:function(C){return S.Vb(C)},ed:function(){return S.ed()},O:function(){return S.O()},set:function(C){return d(),S.set(C)},ib:function(C){return d(),S.ib(C)},dd:function(C){return d(),S.dd(C)}}}(),bn=function(){function d(I){w.bindTexture(w.TEXTURE_2D,I)}function C(I){var oe=new Uint16Array(I.length);return I.forEach(function(Ze,Et){oe[Et]=function S(I){Fe[0]=I;var oe=(I=te[0])>>16&32768,Ze=I>>12&2047,Et=I>>23&255;return 103>Et?oe:142<Et?31744|oe|((255==Et?0:1)&&8388607&I):113>Et?oe|((Ze|=2048)>>114-Et)+(Ze>>113-Et&1):oe=(oe|Et-112<<10|Ze>>1)+(1&Ze)}(Ze)}),oe}function _e(I,oe){if(!xn.Hb()||!Ce)return null;var Ze=null,Et=Math.sqrt(I.length/4);try{var Ht=w.getError();if("FUCKING_BIG_ERROR"===Ht||(Ze=rt.instance({isFloat:!1,V:oe,array:I,width:Et}),(Ht=w.getError())!==w.NO_ERROR))return!1}catch{return!1}for(Nn.U(),w.viewport(0,0,Et,Et),w.clearColor(0,0,0,0),w.clear(w.COLOR_BUFFER_BIT),xn.set("s0"),Ze.wa(0),gn.l(!0,!0),I=4*Et*Et,oe=new Uint8Array(I),w.readPixels(0,0,Et,Et,w.RGBA,w.UNSIGNED_BYTE,oe),Et=!0,Ht=0;Ht<I;++Ht)Et=Et&&3>Math.abs(oe[Ht]-127);return Ze.remove(),Nn.ga(),Et}var ye=0,ae=null,K=0,me=null,Ee=null,Be=null,we=null,Ie=null,xe=null,Ce=!1,N=[],j={isFloat:!1,isPot:!0,isLinear:!1,isMipmap:!1,ee:!1,isAnisotropicFiltering:!1,isMirrorX:!1,isMirrorY:!1,isSrgb:!1,isKeepArray:!1,isFlipY:null,width:0,height:0,url:null,array:null,data:null,L:null,xc:null,Uf:!1,V:!1,G:null,Mb:4,Oc:0},ge=!1,V=null,Q=null,z=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],B=!1,Te=!1,Fe=new Float32Array(1),te=new Int32Array(Fe.buffer),He={yc:null,zc:null},rt={B:function(){Ce||(Ie=[w.RGBA,null,w.RGBA,w.RGBA],xe=[w.RGBA,null,w.RGBA,w.RGBA],ae=[w.TEXTURE0,w.TEXTURE1,w.TEXTURE2,w.TEXTURE3,w.TEXTURE4,w.TEXTURE5,w.TEXTURE6,w.TEXTURE7],B=typeof JEContext<"u",Te=typeof Ne<"u",B&&JEContext.gi()&&ae.push(w.TEXTURE8,w.TEXTURE9),me=[-1,-1,-1,-1,-1,-1,-1,-1],we=[w.UNSIGNED_BYTE,w.FLOAT,w.FLOAT],Ce=!0)},Pf:function(){if(!Ee){for(var I=new Float32Array(16384),oe=0;16384>oe;++oe)I[oe]=2*Math.random()-1;Ee={random:rt.instance({isFloat:!0,isPot:!0,array:I,width:64}),Oe:rt.instance({isFloat:!1,isPot:!0,width:1,array:new Uint8Array([0,0,0,0])})}}rt.Mg()},De:function(I){w.framebufferTexture2D(Nn.vc(),w.COLOR_ATTACHMENT0,w.TEXTURE_2D,I,0)},Wh:function(){return Ee.Oe},Mg:function(){we[1]=Ne.uc(w)},tg:function(){xe=Ie=[w.RGBA,w.RGBA,w.RGBA,w.RGBA]},we:function(I){se.set("s1"),Nn.U();var oe=I.I(),Ze=I.Z();w.viewport(0,0,oe,Ze),I.h(0),gn.l(!1,!1)},pi:function(I,oe){rt.we(I),w.readPixels(0,0,I.I(),I.Z(),w.RGBA,w.UNSIGNED_BYTE,oe)},ri:function(I,oe){return rt.we(I),Ne.Tb(0,0,I.I(),I.Z(),oe)},Nd:function(I,oe,Ze,Et,Ht,Kn,hi){I.activeTexture(I.TEXTURE0);var Zt=I.createTexture();I.bindTexture(I.TEXTURE_2D,Zt),Ht=Ht instanceof Float32Array?Ht:new Float32Array(Ht),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_WRAP_S,I.CLAMP_TO_EDGE),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_WRAP_T,I.CLAMP_TO_EDGE),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_MAG_FILTER,I.NEAREST),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_MIN_FILTER,I.NEAREST),I.pixelStorei(I.UNPACK_FLIP_Y_WEBGL,Kn),I.texImage2D(I.TEXTURE_2D,0,I.RGBA,Ze,Et,0,I.RGBA,I.FLOAT,Ht),I.bindTexture(I.TEXTURE_2D,null),I.pixelStorei(I.UNPACK_FLIP_Y_WEBGL,!1),hi&&(Nn.ga(),se.ib(I)),I.viewport(0,0,Ze,Et),I.framebufferTexture2D(I.FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.TEXTURE_2D,oe,0),I.bindTexture(I.TEXTURE_2D,Zt),hi?gn.l(!0,!0):A.xb(I),I.deleteTexture(Zt),Ce&&(me[0]=-1,Be=null,ye=0)},ec:function(I){I!==ye&&(w.activeTexture(ae[I]),ye=I)},instance:function(I){var oe;function Ze(){Fn=void 0!==tt.L.videoWidth?tt.L.videoWidth:tt.L.width,k=void 0!==tt.L.videoHeight?tt.L.videoHeight:tt.L.height}function Et(lt){var hn=w.getError();return"FUCKING_BIG_ERROR"!==hn&&(w.texImage2D(w.TEXTURE_2D,0,re,et,Ke,lt),(hn=w.getError())!==w.NO_ERROR&&et!==w.RGBA&&w.texImage2D(w.TEXTURE_2D,0,re,et=w.RGBA,Ke,lt),!0)}function Ht(){if(!u){d(Zi),yt&&w.pixelStorei(w.UNPACK_FLIP_Y_WEBGL,yt),tt.isPot?(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,tt.isMirrorX?w.MIRRORED_REPEAT:w.REPEAT),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,tt.isMirrorY?w.MIRRORED_REPEAT:w.REPEAT)):(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,w.CLAMP_TO_EDGE),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,w.CLAMP_TO_EDGE)),tt.isAnisotropicFiltering&&typeof JESETTINGS<"u"&&w.texParameterf(w.TEXTURE_2D,JEContext.Ih().TEXTURE_MAX_ANISOTROPY_EXT,JESETTINGS.Pg),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,tt.isLinear?w.LINEAR:w.NEAREST);var lt=tt.isMipmap&&!_t;if(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,tt.ee?w.LINEAR_MIPMAP_LINEAR:tt.isLinear?lt?w.NEAREST_MIPMAP_LINEAR:w.LINEAR:lt?w.NEAREST_MIPMAP_NEAREST:w.NEAREST),et=Ie[tt.Mb-1],re=xe[tt.Mb-1],Ke=we[Os],Ne.na()&&(lt=Ne.Cf(),et===w.RGBA&&Ke===w.FLOAT?tt.isMipmap||tt.isLinear?re=H.Ef(w):Ne.vd()?lt&&(re=lt):re=w.RGBA16F||w.RGBA:et===w.RGB&&Ke===w.FLOAT&&lt&&(re=lt,et=w.RGBA)),(tt.V&&!tt.isFloat||tt.isFloat&&tt.isMipmap&&H.Zf())&&(re=Ne.Df(),Ke=Ne.uc(w)),tt.Oc&&(It=tt.Oc),tt.isSrgb&&4===tt.Mb&&(et=JEContext.Uh()),tt.L)Et(tt.L);else if(tt.url)Et(zr);else if(lr){lt=lr;try{"FUCKING_BIG_ERROR"!==w.getError()&&(w.texImage2D(w.TEXTURE_2D,0,re,Fn,k,0,et,Ke,lt),w.getError()!==w.NO_ERROR&&(w.texImage2D(w.TEXTURE_2D,0,re,Fn,k,0,et,Ke,null),w.getError()!==w.NO_ERROR&&w.texImage2D(w.TEXTURE_2D,0,w.RGBA,Fn,k,0,w.RGBA,w.UNSIGNED_BYTE,null)))}catch{w.texImage2D(w.TEXTURE_2D,0,re,Fn,k,0,et,Ke,null)}tt.isKeepArray||(lr=null)}else"FUCKING_BIG_ERROR"!==(lt=w.getError())&&(w.texImage2D(w.TEXTURE_2D,0,re,Fn,k,0,et,Ke,null),(lt=w.getError())!==w.NO_ERROR&&(et=w.RGBA,tt.V&&Ke!==w.FLOAT&&w.texImage2D(w.TEXTURE_2D,0,re,Fn,k,0,et,Ke=w.FLOAT,null)));if(tt.isMipmap)if(!_t&&Gn)Gn.zb(),An=!0;else if(_t){lt=Math.log2(Math.min(Fn,k)),(Pt=Array(1+lt))[0]=Zi;for(var hn=1;hn<=lt;++hn){var ii=Math.pow(2,hn),wn=Fn/ii;ii=k/ii;var Qi=w.createTexture();d(Qi),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,w.NEAREST),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,w.NEAREST),w.texImage2D(w.TEXTURE_2D,0,re,wn,ii,0,et,Ke,null),d(null),Pt[hn]=Qi}An=!0}d(null),me[ye]=-1,yt&&w.pixelStorei(w.UNPACK_FLIP_Y_WEBGL,!1),y=!0,tt.G&&Gn&&(tt.G(Gn),tt.G=null)}}function Kn(){for(var lt=Fn*k,hn=2*lt,ii=3*lt,wn=0;wn<lt;++wn)M[0][wn]=he[wn],M[1][wn]=he[wn+lt],M[2][wn]=he[wn+hn],M[3][wn]=he[wn+ii]}function hi(){var lt=Fn*k*4;F=[new Uint8Array(lt),new Uint8Array(lt),new Uint8Array(lt),new Uint8Array(lt)],M=[new Float32Array(F[0].buffer),new Float32Array(F[1].buffer),new Float32Array(F[2].buffer),new Float32Array(F[3].buffer)],de=new Uint8Array(4*lt),he=new Float32Array(de.buffer),f=!0}function Zt(){oe=new Uint8Array(Fn*k*4),Ai=new Float32Array(oe.buffer),ct=!0}var tt=Object.assign({},j,I),pn=K++;null===tt.isFlipY&&(tt.isFlipY=!!tt.url),tt.data&&(tt.array="string"==typeof tt.data?function Ge(d){if(typeof mt(d).nb>"u"){var S=mt(d);d=S.ne;var C=S.nf,U=S.n;S=nt(S);for(var le=new Float32Array(U),_e=new Float32Array(C),ye=d+C+1,ae=0;ae<U;++ae){for(var K=ye*ae,me=0===Rt(S,K)?1:-1,Ee=ue(S,K+1,d),Be=_e.length,we=0,Ie=K=K+1+d;Ie<K+Be;++Ie)_e[we]=Rt(S,Ie),++we;for(Be=K=0;Be<C;++Be)K+=_e[Be]*Math.pow(2,-Be-1);le[ae]=0===K&&0===Ee?0:me*(1+K)*Math.pow(2,1+Ee-Math.pow(2,d-1))}d=le}else if(0===(d=(U=mt(d)).nb))d=new Uint8Array(U.nb);else{for(C=U.n,U=nt(U),S=new Uint32Array(C),le=0;le<C;++le)S[le]=ue(U,le*d,d);d=S}return d}(tt.data):tt.isFloat?new Float32Array(tt.data):new Uint8Array(tt.data),tt.isFlipY=!1);var Os=0,Ir=!!tt.L,Hr=null,Hs=null,Ts=!1;tt.V=tt.V||tt.isFloat,tt.V&&(Os=1),!tt.Uf&&tt.isFloat&&Te&&!Ne.vd()&&(tt.isFloat=!1),tt.isFloat&&(Os=2),tt.isAnisotropicFiltering&&B&&!JEContext.$h()&&(tt.isAnisotropicFiltering=!1);var Zi=tt.xc||w.createTexture(),zr=null,lr=!1,Fn=0,k=0,y=!1,u=!1,f=!1,M=null,F=null,de=null,he=null,re=null,et=null,Ke=null,yt=tt.isFlipY,Tt=(I=tt.V&&tt.isMipmap)&&H.Ze(),_t=!(!I||Tt),Pt=null,It=-1,Bt=-1,An=!1,ct=!1,Ai=oe=null;tt.width&&(Fn=tt.width,k=tt.height?tt.height:Fn);var Gn={get:function(){return Zi},I:function(){return Fn},Z:function(){return k},Xh:function(){return tt.url},ai:function(){return tt.isFloat},ci:function(){return tt.V},yi:function(lt){Zi=lt},di:function(){return tt.isLinear},zb:function(){w.generateMipmap(w.TEXTURE_2D)},We:function(lt,hn){_t?(lt||(lt=Gn.Rd()),rt.ec(hn),d(Pt[lt]),me[hn]=-1):Gn.h(hn)},Rd:function(){return-1===It&&(It=Math.log2(Fn)),It},Ee:function(lt){w.TEXTURE_MAX_LEVEL&&w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAX_LEVEL,lt)},wf:function(lt){if(lt||(lt=Gn.Rd()),_t){se.set("s12"),rt.ec(0);for(var hn=Fn,ii=k,wn=1;wn<=lt;++wn)se.S("u14",.25/(hn/=2),.25/(ii/=2)),w.viewport(0,0,hn,ii),d(Pt[wn-1]),w.framebufferTexture2D(Nn.vc(),w.COLOR_ATTACHMENT0,w.TEXTURE_2D,Pt[wn],0),gn.l(!1,1===wn);me[0]=-1}else lt!==Bt&&(Bt=lt,Gn.Ee(lt)),Gn.zb()},wg:function(lt){(Ir=!function(d){return Array.isArray(d)||d.constructor===Float32Array||d.constructor===Uint8Array}(lt))?(lr=null,tt.L=lt,Ze()):lr=lt},h:function(lt){return!(!y||(rt.ec(lt),me[lt]===pn)||(d(Zi),me[lt]=pn,0))},wa:function(lt){w.activeTexture(ae[lt]),ye=lt,d(Zi),me[lt]=pn},v:function(){Be=Gn,rt.De(Zi)},N:function(){w.viewport(0,0,Fn,k),Be=Gn,rt.De(Zi)},md:rt.md,Ce:function(lt,hn){Fn=lt,k=hn},resize:function(lt,hn){Gn.Ce(lt,hn),Ht()},clone:function(lt){return lt=rt.instance({width:Fn,height:k,V:tt.V,isFloat:tt.isFloat,isLinear:tt.isLinear,isMirrorY:tt.isMirrorY,isFlipY:lt?!yt:yt,isPot:tt.isPot}),xn.set("s0"),Nn.ga(),lt.N(),Gn.h(0),gn.l(!0,!0),lt},Ag:function(){w.viewport(0,0,Fn,k)},remove:function(){w.deleteTexture(Zi),u=!0,N.splice(N.indexOf(Gn),1),Gn=null},refresh:function(){Gn.wa(0),yt&&w.pixelStorei(w.UNPACK_FLIP_Y_WEBGL,!0),Ir?w.texImage2D(w.TEXTURE_2D,0,re,et,Ke,tt.L):w.texImage2D(w.TEXTURE_2D,0,re,Fn,k,0,et,Ke,lr),yt&&w.pixelStorei(w.UNPACK_FLIP_Y_WEBGL,!1)},ue:function(){return f||hi(),w.readPixels(0,0,Fn,4*k,w.RGBA,w.UNSIGNED_BYTE,de),Kn(),M},ng:function(){return f||hi(),Ne.Tb(0,0,Fn,4*k,de).then(function(){return Kn(),M})},pg:function(){return ct||Zt(),w.readPixels(0,0,Fn,k,w.RGBA,w.UNSIGNED_BYTE,oe),Ai},og:function(){return ct||Zt(),Ne.Tb(0,0,Fn,k,oe)},Cd:function(lt){if(Nn.U(),se.set("s15"),Gn.h(0),lt)w.viewport(0,0,Fn,k),se.zg("u15",.25,.25,.25,.25),gn.l(!1,!0);else for(lt=0;4>lt;++lt)w.viewport(0,k*lt,Fn,k),se.Fe("u15",z[lt]),gn.l(!1,0===lt)},Na:function(lt){var hn=Ke===we[0]&&!function le(){if(null!==He.zc)return He.zc;var I=_e(new Uint8Array([127,127,127,127]),!1);return null===I||(He.zc=I)}();d(Zi),yt&&w.pixelStorei(w.UNPACK_FLIP_Y_WEBGL,!0),hn?(Ts||((Hr=document.createElement("canvas")).width=Fn,Hr.height=k,(Hs=Hr.getContext("2d")).createImageData(Fn,k),Ts=!0),null.data.set(lt),Hs.putImageData(null,0,0),w.texImage2D(w.TEXTURE_2D,0,re,et,Ke,Hr)):w.texImage2D(w.TEXTURE_2D,0,re,Fn,k,0,et,Ke,lt),me[ye]=pn,yt&&w.pixelStorei(w.UNPACK_FLIP_Y_WEBGL,!1)},Ii:function(lt,hn){d(Zi),hn&&w.pixelStorei(w.UNPACK_FLIP_Y_WEBGL,!0),w.texImage2D(w.TEXTURE_2D,0,re,et,Ke,lt),me[ye]=pn,hn&&w.pixelStorei(w.UNPACK_FLIP_Y_WEBGL,!1)},xi:function(lt,hn){var ii=Fn*k,wn=4*ii;lt=tt.V?lt?"RGBE":"JSON":"RGBA",hn&&(lt=hn),hn=Ne.na()&&!1;var Qi=null;switch(lt){case"RGBE":Qi="s13";break;case"JSON":Qi=hn?"s0":"s15";break;case"RGBA":case"RGBAARRAY":Qi="s7"}if(f||("RGBA"===lt||"RGBE"===lt||"RGBAARRAY"===lt?(F=new Uint8Array(wn),f=!0):"JSON"!==lt||hn||hi()),Nn.U(),se.set(Qi),Gn.h(0),wn=null,"RGBA"===lt||"RGBE"===lt||"RGBAARRAY"===lt){if(w.viewport(0,0,Fn,k),gn.l(!0,!0),w.readPixels(0,0,Fn,k,w.RGBA,w.UNSIGNED_BYTE,F),"RGBAARRAY"===lt)return{data:F};ge||(V=document.createElement("canvas"),Q=V.getContext("2d"),ge=!0),V.width=Fn,V.height=k,(ii=Q.createImageData(Fn,k)).data.set(F),Q.putImageData(ii,0,0),wn=V.toDataURL("image/png")}else if("JSON"===lt)if(hn)wn=new Float32Array(ii),w.viewport(0,0,Fn,k),gn.l(!0,!0),w.readPixels(0,0,Fn,k,w.RGBA,w.FLOAT,wn);else{for(wn=0;4>wn;++wn)w.viewport(0,k*wn,Fn,k),se.Fe("u15",z[wn]),gn.l(!wn,!wn);for(Gn.ue(),wn=Array(ii),hn=0;hn<ii;++hn)wn[4*hn]=M[0][hn],wn[4*hn+1]=M[1][hn],wn[4*hn+2]=M[2][hn],wn[4*hn+3]=M[3][hn]}return{format:lt,data:wn,width:Fn,height:k,isMirrorY:tt.isMirrorY,isFlipY:"RGBA"===lt?tt.isFlipY:!tt.isFlipY}}};if(tt.isMipmap&&!_t&&y&&!An&&(Gn.zb(),An=!0),tt.url)d(Zi),w.texImage2D(w.TEXTURE_2D,0,w.RGBA,1,1,0,w.RGBA,w.UNSIGNED_BYTE,null),(zr=new Image).eh="Anonymous",zr.crossOrigin="Anonymous",zr.src=tt.url,zr.onload=function(){Fn=zr.width,k=zr.height,Ht()};else if(tt.L){var ir=function(){Ze(),Fn?Ht():setTimeout(ir,1)};ir()}else tt.array?(tt.V&&!tt.isFloat?tt.array instanceof Uint16Array?(lr=tt.array,Ht()):function U(){if(null!==He.yc)return He.yc;var I=_e(C([.5,.5,.5,.5]),!0);return null===I||(He.yc=I)}()?(lr=C(tt.array),Ht()):(Ht(),rt.Nd(w,Zi,Gn.I(),Gn.Z(),tt.array,yt,!0)):(lr=tt.isFloat?tt.array instanceof Float32Array?tt.array:new Float32Array(tt.array):tt.array instanceof Uint8Array?tt.array:new Uint8Array(tt.array),Ht()),tt.isKeepArray||(lr&&lr!==tt.array&&(lr=null),delete tt.array)):tt.xc?y=!0:Ht();return Gn.Sh=Gn.I,tt.G&&y&&(tt.G(Gn),tt.G=null),N.push(Gn),Gn},U:function(I){I!==ye&&(w.activeTexture(ae[I]),ye=I),me[I]=-1,d(null)},Sg:function(I){Ee.random.h(I)},md:function(){Be=null,w.framebufferTexture2D(Nn.vc(),w.COLOR_ATTACHMENT0,w.TEXTURE_2D,null,0)},reset:function(){0!==ye&&w.activeTexture(ae[0]);for(var I=0;I<ae.length;++I)me[I]=-1;ye=-1},ui:function(){ye=-1},Jg:function(){for(var I=0;I<ae.length;++I)rt.U(I)},Od:function(){Ee&&(Ee.random.remove(),Ee.Oe.remove())},Hi:function(I,oe){if("RGBA"===I.format||"RGBE"===I.format){var Ze=new Image;Ze.src=I.data,Ze.onload=function(){rt.instance({isMirrorY:I.isMirrorY,isFlipY:I.isFlipY,isFloat:!1,L:Ze,G:function(Et){if("RGBA"===I.format)oe(Et);else{var Ht=I.width,Kn=I.height,hi=rt.instance({isMirrorY:I.isMirrorY,isFloat:!0,width:Ht,height:Kn,isFlipY:I.isFlipY});Nn.ga(),w.viewport(0,0,Ht,Kn),se.set("s14"),hi.v(),Et.h(0),gn.l(!0,!0),rt.U(0),oe(hi),Ne.flush(),Et.remove()}}})}}else oe("JSON"===I.format&&rt.instance({isFloat:!0,isFlipY:I.isFlipY,width:I.width,height:I.height,array:new Float32Array(I.data)}))},ff:C,m:function(){Be&&(P.ga(),rt.md(),P.U()),rt.Jg(),N.slice(0).forEach(function(I){I.remove()}),N.splice(0),Ce=!1,K=0,typeof H<"u"&&H.m(),Ee=null}};return rt}(),Zn={instance:function(d){var S=[bn.instance(d),bn.instance(d)],C=[S[1],S[0]],U=C,le={rg:function(_e){U[1].v(),U[0].h(_e),le.Je()},sg:function(_e){U[1].N(),U[0].h(_e),le.Je()},Je:function(){U=U===S?C:S},refresh:function(){U[0].refresh(),U[1].refresh()},h:function(_e){U[0].h(_e)},wa:function(_e){U[0].wa(_e)},Rg:function(_e){U[1].h(_e)},Mh:function(){return U[0]},Qh:function(){return U[1]},Na:function(_e){U[0].Na(_e),U[1].Na(_e)},remove:function(){U[0].remove(),U[1].remove(),U=null},sync:function(){le.sg(0),se.set("s0"),A.l(!1,!1)}};return le}},gn=function(){function d(K){var me={fa:null,indices:null};return me.fa=K.createBuffer(),K.bindBuffer(K.ARRAY_BUFFER,me.fa),K.bufferData(K.ARRAY_BUFFER,new Float32Array([-1,-1,3,-1,-1,3]),K.STATIC_DRAW),me.indices=K.createBuffer(),K.bindBuffer(K.ELEMENT_ARRAY_BUFFER,me.indices),K.bufferData(K.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2]),K.STATIC_DRAW),me}var S=null,C=0,U=!1,le=[],_e=-2,ye=-2,ae={reset:function(){ye=_e=-2},B:function(){U||(S=d(w),ae.Ga(),U=!0)},instance:function(K){var me=C++,Ee=K.indices?K.indices.length:0,Be=typeof K.mode>"u"?w.STATIC_DRAW:K.mode,we=w.createBuffer();w.bindBuffer(w.ARRAY_BUFFER,we),w.bufferData(w.ARRAY_BUFFER,K.fa instanceof Float32Array?K.fa:new Float32Array(K.fa),Be),_e=me;var Ie=null,xe=null,Ce=null;if(K.indices){Ie=w.createBuffer(),w.bindBuffer(w.ELEMENT_ARRAY_BUFFER,Ie);var N=null;65536>K.indices.length?(N=Uint16Array,xe=w.UNSIGNED_SHORT,Ce=2):(N=Uint32Array,xe=w.UNSIGNED_INT,Ce=4),N=K.indices instanceof N?K.indices:new N(K.indices),w.bufferData(w.ELEMENT_ARRAY_BUFFER,N,Be),ye=me}var j={Xe:function(ge){_e!==me&&(w.bindBuffer(w.ARRAY_BUFFER,we),_e=me),ge&&xn.ed()},Ue:function(){ye!==me&&(w.bindBuffer(w.ELEMENT_ARRAY_BUFFER,Ie),ye=me)},bind:function(ge){j.Xe(ge),j.Ue()},ih:function(){w.drawElements(w.TRIANGLES,Ee,xe,0)},jh:function(ge,V){w.drawElements(w.TRIANGLES,ge,xe,V*Ce)},remove:function(){w.deleteBuffer(we),K.indices&&w.deleteBuffer(Ie),j=null}};return le.push(j),j},Ga:function(){-1!==_e&&(w.bindBuffer(w.ARRAY_BUFFER,S.fa),_e=-1),-1!==ye&&(w.bindBuffer(w.ELEMENT_ARRAY_BUFFER,S.indices),ye=-1)},l:function(K,me){K&&gn.Ga(),me&&xn.La(),w.drawElements(w.TRIANGLES,3,w.UNSIGNED_SHORT,0)},xb:function(K){var me=d(K=K||w);K.bindBuffer(K.ARRAY_BUFFER,me.fa),K.bindBuffer(K.ELEMENT_ARRAY_BUFFER,me.indices),xn.Vb(K),K.clear(K.COLOR_BUFFER_BIT),K.drawElements(K.TRIANGLES,3,K.UNSIGNED_SHORT,0),K.flush(),K.bindBuffer(K.ARRAY_BUFFER,null),K.bindBuffer(K.ELEMENT_ARRAY_BUFFER,null),K.deleteBuffer(me.fa),K.deleteBuffer(me.indices),ae.reset(),U&&(ae.Ga(),xn.La())},Od:function(){var K=w,me=S;K.deleteBuffer(me.fa),K.deleteBuffer(me.indices)},m:function(){ae.Od(),le.forEach(function(K){K.remove()}),w.bindBuffer(w.ARRAY_BUFFER,null),w.bindBuffer(w.ELEMENT_ARRAY_BUFFER,null),ae.reset(),U=!1,le.splice(0),C=0}};return ae}(),Nn=(d=null,S=null,C=null,U=!1,le=[],_e={M:-2,Md:1},ye={Hb:function(){return U},B:function(){if(!U){d=w.createFramebuffer();var ae=Ne.na();S=ae&&w.DRAW_FRAMEBUFFER?w.DRAW_FRAMEBUFFER:w.FRAMEBUFFER,C=ae&&w.READ_FRAMEBUFFER?w.READ_FRAMEBUFFER:w.FRAMEBUFFER,U=!0}},Jh:function(){return S},Ff:function(){return C},vc:function(){return w.FRAMEBUFFER},Rh:function(){return _e},Ch:function(){return d},instance:function(ae){void 0===ae.Yd&&(ae.Yd=!1);var K=ae.D?ae.D:null,me=ae.width,Ee=void 0!==ae.height?ae.height:ae.width,Be=d,we=null,Ie=!1,xe=!1,Ce=0;K&&(me=me||K.I(),Ee=Ee||K.Z());var N={Be:function(){Ie||(Be=w.createFramebuffer(),Ie=!0,Ce=_e.Md++)},Qe:function(){N.Be(),N.v(),we=w.createRenderbuffer(),w.bindRenderbuffer(w.RENDERBUFFER,we),w.renderbufferStorage(w.RENDERBUFFER,w.DEPTH_COMPONENT16,me,Ee),w.framebufferRenderbuffer(S,w.DEPTH_ATTACHMENT,w.RENDERBUFFER,we),w.clearDepth(1)},bind:function(j,ge){Ce!==_e.M&&(w.bindFramebuffer(S,Be),_e.M=Ce),K&&K.v(),ge&&w.viewport(0,0,me,Ee),j&&w.clear(w.COLOR_BUFFER_BIT|w.DEPTH_BUFFER_BIT)},Qg:function(){Ce!==_e.M&&(w.bindFramebuffer(S,Be),_e.M=Ce)},clear:function(){w.clear(w.COLOR_BUFFER_BIT|w.DEPTH_BUFFER_BIT)},$g:function(){w.clear(w.COLOR_BUFFER_BIT)},ah:function(){w.clear(w.DEPTH_BUFFER_BIT)},Ag:function(){w.viewport(0,0,me,Ee)},v:function(){Ce!==_e.M&&(w.bindFramebuffer(S,Be),_e.M=Ce)},rtt:function(j){K=j,_e.M!==Ce&&(w.bindFramebuffer(w.FRAMEBUFFER,Be),_e.M=Ce),j.v()},U:function(){w.bindFramebuffer(S,null),_e.M=-1},resize:function(j,ge){me=j,Ee=ge,we&&(w.bindRenderbuffer(w.RENDERBUFFER,we),w.renderbufferStorage(w.RENDERBUFFER,w.DEPTH_COMPONENT16,me,Ee))},remove:function(){Be===d||xe||(w.bindFramebuffer(S,Be),w.framebufferTexture2D(S,w.COLOR_ATTACHMENT0,w.TEXTURE_2D,null,0),we&&w.framebufferRenderbuffer(S,w.DEPTH_ATTACHMENT,w.RENDERBUFFER,null),w.bindFramebuffer(S,null),w.deleteFramebuffer(Be),we&&w.deleteRenderbuffer(we)),xe=!0}};return ae.Yd&&N.Qe(),le.push(N),N},U:function(){w.bindFramebuffer(S,null),_e.M=-1},Kg:function(){w.bindFramebuffer(S,null),w.clear(w.COLOR_BUFFER_BIT|w.DEPTH_BUFFER_BIT),Ne.He(),_e.M=-1},reset:function(){_e.M=-2},ga:function(){0!==_e.M&&(w.bindFramebuffer(S,d),_e.M=0)},clear:function(){Ne.He(),w.clear(w.COLOR_BUFFER_BIT)},m:function(){ye.U(),le.forEach(function(ae){ae.remove()}),null!==d&&(w.deleteFramebuffer(d),d=null),ye.reset(),U=!1,le.splice(0),_e.Md=1}}),Ne=function(){function d(){ae=typeof Yt>"u"?JEContext:Yt,K=!0}function S(z,B,Te){for(var Fe=0;Fe<B.length;++Fe){var te=Te.getExtension(B[Fe]+"_"+z);if(te)return te}return null}function C(){null!==N.$b&&(clearTimeout(N.$b),N.$b=null),N.Ia=!1}function le(){w.bindBuffer(N.$,null)}function _e(){N.Ha.forEach(function(z){w.deleteSync(z)}),N.Ha.splice(0)}function ye(){N.ja=(N.ja+1)%N.Ua,++N.Sc}var ae=null,K=!1,me={be:!1,hd:null,jd:null,fe:!1,Yf:!1,kd:null,ge:!1,ld:null,ce:!1,ic:null,Rf:!1,jc:null,Sf:!1},Ee=null,Be={ka:!0,ma:!0,sc:!0,te:!1},we=null,Ie=!0,xe=null,Ce=null,N={gf:1,Ua:-1,ja:0,Sc:0,Ia:!1,Aa:[],Ha:[],Bb:[],$:null,$b:null},j="EXT WEBGL OES MOZ_OES WEBKIT_OES KHR".split(" "),ge=["OES","MOZ_OES","WEBKIT_OES"],V=typeof window>"u"?{}:window,Q={B:function(){if(K)return!0;Q.reset(),K||d();var z=w;return Ee.be||(Ee.hd=Q.Jd(z),V.GL_EXT_FLOAT=Ee.hd,Ee.fe=!!Ee.hd,(Ee.fe||Q.na())&&(Ee.jd=Q.Kd(z),Ee.Yf=!!Ee.jd,V.GL_EXT_FLOATLINEAR=Ee.jd),Ee.be=!0),Ee.ce||(Ee.kd=Q.vb(z),Ee.kd&&(Ee.ge=!0,V.GL_EXT_HALFFLOAT=Ee.kd),(Ee.ge||Q.na())&&(Ee.ld=Q.Ld(z),V.GL_EXT_HALFFLOATLINEAR=Ee.ld),Ee.Zh=!!Ee.ld,Ee.ce=!0),Ee.ic=Q.Hd(z),Ee.Rf=!!Ee.ic,V.GL_EXT_COLORBUFFERFLOAT=Ee.ic,Ee.jc=Q.Id(z),Ee.Sf=!!Ee.jc,V.GL_EXT_COLORBUFFERHALFFLOAT=Ee.jc,Nn.B(),bn.B(),!!Q.jf()&&(gn.B(),bn.Pf(),!0)},reset:function(){Ee=Object.assign({},me),we=Object.assign({},Be)},I:function(){return K||d(),ae.I()},Z:function(){return K||d(),ae.Z()},na:function(){return K||d(),ae.na()},Gd:function(z){Q.Hd(z),Q.Id(z),Q.Jd(z),Q.Kd(z),Q.vb(z),Q.Ld(z)},Hd:S.bind(null,"color_buffer_float",j),Id:S.bind(null,"color_buffer_half_float",j),Jd:S.bind(null,"texture_float",ge),Kd:S.bind(null,"texture_float_linear",ge),vb:S.bind(null,"texture_half_float",ge),Ld:S.bind(null,"texture_half_float_linear",ge),uc:function(z){var B=Q.vb(z);return B&&B.HALF_FLOAT_OES?B.HALF_FLOAT_OES:z.HALF_FLOAT||z.FLOAT},Cf:function(){return Ce||w.RGBA32F||w.RGBA},Df:function(){return xe||w.RGBA16F||w.RGBA},yf:function(){return we},vd:function(){return we.ka},Vg:function(){return we.ma},Ug:function(){return we.sc},$e:function(){return we.te&&Ie},Me:function(z){Ie=z,!z&&N.Ia&&(_e(),w.bindBuffer(N.$,null),N.Ia=!1)},ei:function(){return N.Ia},Yb:function(z,B,Te){function Fe(){z.bindTexture(z.TEXTURE_2D,null),z.bindFramebuffer(te,null),z.deleteTexture(I),z.deleteFramebuffer(rt)}var te=z.FRAMEBUFFER,He=z.NEAREST,rt=z.createFramebuffer();z.bindFramebuffer(te,rt);var I=z.createTexture();if(z.activeTexture(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,I),z.pixelStorei(z.UNPACK_FLIP_Y_WEBGL,!1),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_WRAP_S,z.CLAMP_TO_EDGE),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_WRAP_T,z.CLAMP_TO_EDGE),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MAG_FILTER,He),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MIN_FILTER,He),z.texImage2D(z.TEXTURE_2D,0,B,3,3,0,z.RGBA,Te,null),z.framebufferTexture2D(z.FRAMEBUFFER,z.COLOR_ATTACHMENT0,z.TEXTURE_2D,I,0),z.checkFramebufferStatus(z.READ_FRAMEBUFFER||z.FRAMEBUFFER)!==z.FRAMEBUFFER_COMPLETE)return Fe(),!1;for(xn.dd(z),z.clearColor(0,0,0,0),z.viewport(0,0,3,3),z.disable(z.DEPTH_TEST),z.clear(z.COLOR_BUFFER_BIT),gn.xb(z),z.bindFramebuffer(te,null),xn.ib(z),z.activeTexture(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,I),gn.xb(z),B=new Uint8Array(36),z.readPixels(0,0,3,3,z.RGBA,z.UNSIGNED_BYTE,B),Fe(),Te=0;36>Te;++Te)if(Te%4!=3&&3<Math.abs(B[Te]-127))return!1;return!0},lc:function(z){var B={ka:!1,ma:!1};z.disable(z.BLEND),z.clearColor(0,0,0,0),z.clear(z.COLOR_BUFFER_BIT),z.RGBA32F&&Q.Yb(z,z.RGBA32F,z.FLOAT)&&(B.ka=!0,Ce=z.RGBA32F),!B.ka&&Q.Yb(z,z.RGBA,z.FLOAT)&&(B.ka=!0,Ce=z.RGBA);var Te=Q.uc(z);return xe=null,z.RGBA16F&&Q.Yb(z,z.RGBA16F,Te)&&(B.ma=!0,xe=z.RGBA16F),!B.ma&&Q.Yb(z,z.RGBA,Te)&&(B.ma=!0,xe=z.RGBA),B},kf:function(){var z=Nn.instance({width:2});z.Be();var B=bn.instance({width:2,isFloat:!0,Mb:3});z.v(),B.v(),Q.flush(),w.checkFramebufferStatus(Nn.Ff())!==w.FRAMEBUFFER_COMPLETE?(bn.tg(),we.sc=!1):we.sc=!0,z.remove(),B.remove()},lf:function(){var z=!1;Q.na()&&(z="PIXEL_PACK_BUFFER STREAM_READ SYNC_GPU_COMMANDS_COMPLETE WAIT_FAILED fenceSync deleteSync createBuffer".split(" ").every(function(B){return typeof w[B]<"u"})),we.te=z},jf:function(){var z=Q.lc(w);return Object.assign(we,z),!(!we.ka&&!we.ma||(Q.kf(),Q.lf(),0))},ve:function(z,B,Te,Fe,te){return w.readPixels(z,B,Te,Fe,w.RGBA,w.UNSIGNED_BYTE,te),Promise.resolve(te,!1)},Tb:function(z,B,Te,Fe,te,He,rt){if(!Q.$e())return Q.ve(z,B,Te,Fe,te);N.Ua=rt||N.gf,function U(z){if(0===N.Aa.length){N.$=w.PIXEL_PACK_BUFFER,N.Aa.splice(0),N.Bb.splice(0);for(var B=0;B<N.Ua;++B)N.Aa.push(w.createBuffer()),N.Bb.push(-1);N.ja=0,N.Sc=0}w.bindBuffer(N.$,N.Aa[N.ja]),z.byteLength!==N.Bb[N.ja]&&(w.bufferData(N.$,z.byteLength,w.STREAM_READ),N.Bb[N.ja]=z.byteLength),N.Yh=!0}(te),w.readPixels(z,B,Te,Fe,w.RGBA,w.UNSIGNED_BYTE,0),N.Ha[N.ja]=w.fenceSync(w.SYNC_GPU_COMMANDS_COMPLETE,0),Q.flush();var I=!1;return new Promise(function(oe,Ze){C(),N.Sc+1<N.Ua?(le(),ye(),oe(te,!1)):(N.Ia=!0,function Et(){if(!N.Ia)return C(),le(),ye(),Ze(),!1;var Ht=(N.ja+1)%N.Ua;switch(w.clientWaitSync(N.Ha[Ht],0,0)){case w.TIMEOUT_EXPIRED:case w.WAIT_FAILED:break;default:return C(),w.deleteSync(N.Ha[Ht]),N.Ha[Ht]=null,w.bindBuffer(N.$,N.Aa[Ht]),w.getBufferSubData(N.$,0,te),le(),ye(),oe(te,I),!0}return N.$b=setTimeout(Et,0),!1}()||!He||I||(I=!0,He()))})},He:function(){w.viewport(0,0,Q.I(),Q.Z())},flush:function(){w.flush()},m:function(){C(),_e(),bn.m(),Nn.m(),gn.m(),N.Aa.forEach(function(z){w.deleteBuffer(z)}),N.Aa.splice(0),xn.reset(),K=!1}};return Q}(),A=gn,P=Nn,W=bn,H=function(){function d(z,B,Te,Fe){N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MIN_FILTER,Fe?N.NEAREST_MIPMAP_NEAREST:N.LINEAR);var te=null;if(null!==Te)try{if("FUCKING_BIG_ERROR"===(te=N.getError())||(N.texImage2D(N.TEXTURE_2D,0,z,4,4,0,N.RGBA,B,Te),(te=N.getError())!==N.NO_ERROR))return!1}catch{return!1}if(Fe&&N.generateMipmap(N.TEXTURE_2D),N.clear(N.COLOR_BUFFER_BIT),A.xb(N),"FUCKING_BIG_ERROR"===(te=N.getError())||(N.readPixels(0,0,2,2,N.RGBA,N.UNSIGNED_BYTE,Ee),(te=N.getError())===N.INVALID_OPERATION&&typeof N.PIXEL_PACK_BUFFER<"u"&&(N.bindBuffer(N.PIXEL_PACK_BUFFER,null),N.readPixels(0,0,2,2,N.RGBA,N.UNSIGNED_BYTE,Ee),te=N.getError()),te!==N.NO_ERROR))return!1;for(Te=!0,Fe=0;16>Fe;++Fe)Te=Te&&4>Math.abs(Ee[Fe]-127);return Te&&(K.re=B,K.Xd=z),Te}function S(z,B){return!(!j.ka||!d(z,N.FLOAT,new Float32Array(Be),B)||(ae=ye.rd,0))}function C(z,B,Te){if(!j.ma)return!1;var Fe=bn.ff(Be),te=Ne.vb(N);return te&&te.HALF_FLOAT_OES&&d(z,te.HALF_FLOAT_OES,Fe,B)||N.HALF_FLOAT&&d(z,N.HALF_FLOAT,Fe,B)||(Fe=new Float32Array(Be),d(z,N.FLOAT,Fe,B))?(ae=ye.Pa,!0):(N.bindTexture(N.TEXTURE_2D,Te),N.texImage2D(N.TEXTURE_2D,0,N.RGBA,2,2,0,N.RGBA,N.UNSIGNED_BYTE,null),N.bindFramebuffer(K.sb,Q),bn.Nd(N,Te,2,2,Fe,!1,!1),N.bindFramebuffer(K.sb,null),N.bindTexture(N.TEXTURE_2D,Te),!!d(z,null,null,B)&&(ae=ye.Pa,!0))}function U(z,B,Te){return me=!0,!!(C(z,!0,Te)||S(B,!0)||(me=!1,C(z,!1,Te)||S(B,!1)))}function le(z){if(ae===ye.O){ae=ye.RGBA8,me=!0,Ne.Gd(N=z||w),j||(j=Ne.lc(N)),P.reset(),Q=N.createFramebuffer(),K.sb=N.DRAW_FRAMEBUFFER||N.FRAMEBUFFER,N.bindFramebuffer(K.sb,null),N.clearColor(0,0,0,0),N.viewport(0,0,2,2),se.O(),ge=se.ib(N),z=N.createTexture(),N.activeTexture(N.TEXTURE0),N.bindTexture(N.TEXTURE_2D,z),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_S,N.REPEAT),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_T,N.REPEAT),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MAG_FILTER,N.NEAREST),V=z;var B=z=N.RGBA,Te=N.RGBA16F,Fe=N.RGBA32F;return Fe&&(z=Fe),Te&&(B=Te),(Te||Fe)&&U(B,z,V)||(z=B=N.RGBA,U(B,z,V))?(_e(),!0):(ae=ye.RGBA8,_e(),!1)}}function _e(){N.deleteProgram(ge.Ea),N.deleteTexture(V),V=ge=null}for(var ye={O:-1,rd:3,Pa:2,RGBA8:0},ae=ye.O,K={re:null,Xd:null,sb:null},me=!0,Ee=new Uint8Array(16),Be=Array(64),we=0;4>we;++we)for(var Ie=0;4>Ie;++Ie){var xe=(Ie+we)%2==0?1:0,Ce=4*we+Ie;Be[4*Ce]=xe,Be[4*Ce+1]=xe,Be[4*Ce+2]=xe,Be[4*Ce+3]=xe}var N=null,j=null,ge=null,V=null,Q=null;return{Ze:function(z){return le(z),me},ud:function(z,B){return ae===ye.O&&(typeof("undefined"!==B)&&(j=B),le(z)),ae!==ye.RGBA8},bi:function(z){return le(z),ae===ye.rd},Zf:function(z){return le(z),ae===ye.Pa},Kh:function(z){return le(z),K.re},Ef:function(z){return le(z),K.Xd},m:function(){N=null,me=!0,ae=ye.O,j=null}}}(),ee={instance:function(d){function S(){we&&we.remove(),we=W.instance({isFloat:!1,isPot:!1,width:d.size*d.aa[0],height:d.size*d.aa[1]})}var C=null,U=!1,le=!1,_e=null,ye=!1,ae=!1,K=null,me=!(typeof d.preprocessing>"u")&&d.preprocessing,Ee=typeof d.preprocessingSize>"u"?d.size:d.preprocessingSize;d.mask&&(U=!0,Si&&void 0!==Si.Te&&(d.mask=Si.Te+d.mask),C=W.instance({isFloat:!1,url:d.mask}));var Be=!1;switch(d.customInputShader&&(se.td({name:"_",id:Be="s50",g:d.customInputShader,Gi:["uSource"],precision:"lowp"}),se.K(Be,[{type:"1i",name:"_",value:0}])),me){case"sobel":K="s39",ye=!0;break;case"meanNormalization":K="s40",ye=!0;break;case"grayScale":K="s36",ye=!1;break;case"grayScaleTilt":K="s37",ae=!0,ye=!1;break;case"rgbGrayTilt":K="s38",ae=!0,ye=!1;break;case"copy":K=Be||"s0";break;case"inputLightRegulation":K=Be||"s36",_e=Dt.instance({Wd:Ee,qe:d.size,oe:d.nBlurPass,ba:!1}),le=!0;break;case"inputMix0":K="none",_e=zt.instance({o:Ee,ra:d.varianceMin,ha:d.blurKernelSizePx,gain:d.gain||1,ba:!1}),le=!0;break;case"inputMix1":K="none",_e=Yn.instance({o:Ee,ra:d.varianceMin,ha:d.blurKernelSizePx,gain:d.gain||1,ba:!1}),le=!0;break;case"inputCut4":K="none",_e=ni.instance({o:Ee,ra:d.varianceMin,ha:d.blurKernelSizePx,gain:d.gain||1,bb:d.isNormalized||!1,Zc:d.overlap||0,ba:!1}),Ee*=_e.Gf(),le=!0;break;case"direct":case"none":case"abort":K="abort";break;default:K="s4"}Ee=Math.ceil(Ee),ae&&se.K(K,[{name:"u29",type:"1f",value:d.tilt}]),U&&(K+="Mask");var we=null;S();var Ie={I:function(){return d.size},Hf:function(){return Ee},wc:function(){return Ie.I()},Lf:function(){return le?_e.Ya():we},ac:function(xe){d.aa=xe,S()},W:function(xe){if(P.ga(),"abort"===K)return xe.h(0),xe;"none"!==K&&(se.set(K),ye&&se.J("u30",1/d.size),we.N(),U&&C.h(1),A.l(!1,!1),we.h(0),xe=we),le&&_e.process(xe)},m:function(){we.remove(),U&&C.remove()}};return Ie}},ie={instance:function(d){function S(){if(Q.Ma){le.input&&(le.input.remove(),le.Eb.remove());var B=d.size*d.sparsity;V=Math.log(B/d.size)/Math.log(2),le.input=W.instance({isMipmap:!0,isFloat:!0,isPot:!0,width:B*d.aa[0],height:B*d.aa[1],Oc:V}),le.Eb=W.instance({isFloat:!0,isPot:!0,width:d.size*d.aa[0],height:d.size*d.aa[1]})}}function C(){le.Da&&le.Da.remove(),le.Da=W.instance({isFloat:!0,isPot:!ye,isLinear:!ye&&ae.isLinear,width:d.size*d.aa[0],height:d.size*d.aa[1]})}function U(B){return ae.buffer.forEach(function(Te,Fe){ae.results[Fe][0]=B[0][Te],ae.results[Fe][1]=B[1][Te],ae.results[Fe][2]=B[2][Te],ae.results[Fe][3]=B[3][Te]}),ae.results}d.normalize=d.normalize||!1;var le={input:null,bias:null,Eb:null,Da:null,Yc:null,Wc:null,Xc:null},_e=null,ye=!0,ae={type:"undef",G:null,isLinear:!1,buffer:[],results:[],Fb:!1},K=-1,me=!!d.isReorganize&&d.isReorganize,Ee=!!d.kernelsCount,Be=[d.$a?"s32":"s31",d.$a?"s34":"s33","s35"][d.shiftRGBAMode||0],we={isEnabled:!1},Ie=1/d.size;d.Wf?(d.sparsity=typeof d.sparsity<"u"?d.sparsity:d.Rb.wc(),ye=!1):"full"===d.connectivityUp&&(d.sparsity=d.Rb.wc());var xe={elu:"s19",elu01:"s20",relu:"s17",gelu:"s18",arctan:"s21",arctan2:"s22",sigmoid:"s16",copy:"s0"}[d.activation],Ce=d.sparsity*d.sparsity,N=!1,j=d.size,ge="";if(d.maxPooling){switch(d.maxPooling.size){case 2:ge="s41";break;case 4:ge="s42"}N=!0,le.Wc=W.instance({isFloat:!0,isPot:!1,width:j/=d.maxPooling.size})}var V=-1,Q=null;ye&&C(),le.bias=W.instance(d.bias);var z={I:function(){return d.size},wc:function(){return j},Pd:function(){return d.classesCount},Ve:function(B){_e.h(B)},kg:function(){d.remap&&d.remap.isEnabled&&(we={isEnabled:!0,dg:W.instance(d.remap.maskTexture),fb:d.remap.layers.map(function(B){return d.parent.Jf(B)}),depth:d.remap.depth})},ug:function(){switch(d.connectivityUp){case"direct":Q=ve.instance(d.connectivity);break;case"square":Q=Re.instance(d.connectivity);break;case"squareFast":Q=Oe.instance(d.connectivity,d.activation);break;case"full":Q=ce.instance(Object.assign({$a:d.$a},d.connectivity));break;case"conv":K=d.kernelsCount,Q=pt.instance(d.connectivity),me&&(le.Yc=W.instance({width:j,isFloat:!0,isFlipY:!1,isPot:!1}))}S()},W:function(B,Te){if(_e=B,Q.Ma?(le.input.N(),Ee&&le.bias.h(2),Q.W(we),le.input.h(0),le.input.wf(V),le.Eb.N(),Ee?se.set("s0"):(se.set(Be),se.J("u4",Ce),le.bias.h(1)),le.input.We(V,0),A.l(!1,!1),se.set(xe),le.Da.v(),le.Eb.h(0),A.l(!1,!1)):(le.Da.N(),le.bias.h(1),Q.W()),ye)return Te=le.Da,N&&(le.Wc.N(),Te.h(0),se.set(ge),se.S("u14",Ie,Ie),A.l(!1,!1),Te=le.Wc),me&&(le.Yc.v(),se.set("s24"),se.S("u18",K,j/K),Te.h(0),A.l(!1,!1),Te=le.Yc),Te.h(0),Te;var Fe=le.Da;switch((d.normalize||ae.Fb)&&(B=d.normalize,se.set(ae.Fb?"s9":"s8"),se.J("u10",B?Ie:1),le.Xc.N(),Fe.h(0),A.l(!1,!1),Fe=le.Xc),B=null,ae.type){case"cpuRGBA2Float":Fe.Cd(!1),Te?B=z.lg(Fe).then(ae.G):(Fe=z.mg(Fe),ae.G(Fe));break;case"cpuMeanFloat":if(Fe.Cd(!0),Te)B=Fe.og().then(ae.G);else{Fe=Fe.pg();for(var te=0;te<Fe.length;++te);ae.G(Fe)}break;case"gpuRawAvg":case"gpuRaw":Fe.h(0);case"none":null!==ae.G&&ae.G(Fe)}return Te&&null===B&&(B=Promise.resolve()),B},ac:function(B){d.aa=B,S(),C()},Cg:function(B){B&&(ae.type=B.Pb||"none",ae.G=B.Ob||null,ae.isLinear=!!B.Vc),C(),B=typeof d.classesCount<"u"&&d.classesCount?d.classesCount:d.size*d.size;for(var Te=0,Fe=0,te=0;Te<B;++Te)ae.buffer.push(Fe+(d.size-1-te)*d.size),ae.results.push([-1,-1,-1,-1]),++Fe===d.size&&(Fe=0,++te);ae.Fb="gpuRawAvg"===ae.type||"cpuMeanFloat"===ae.type,(d.normalize||ae.Fb)&&(le.Xc=W.instance({isFloat:!0,isPot:!0,width:d.size}))},lg:function(B){return B.ng().then(U)},mg:function(B){return U(B=B.ue()),ae.results},m:function(){for(var B in le){var Te=le[B];Te&&Te.remove()}Q&&(Q.m(),Q=null)}};return d.Rb&&z.ug(d.Rb),z}},ve={instance:function(d){var S=W.instance(d.weights);return{Ma:!0,Ab:function(){return 1},m:function(){S.remove()},Of:function(){return S},W:function(){se.set("s30"),S.h(1),A.l(!1,!1)}}}},ce={instance:function(d){var S=d.fromLayerSize,C=W.instance(d.weights),U=d.$a?"s27":"s26";return{Ma:!0,Ab:function(){return S},m:function(){C.remove()},W:function(le){if(le.isEnabled){se.set("s28"),le.dg.h(3);for(var _e=Math.min(le.fb.length,le.depth),ye=0;ye<_e;++ye)le.fb[ye].Ve(4+ye)}else se.set(U);se.J("u8",d.toLayerSize),se.J("u9",d.fromLayerSize),C.h(1),A.l(!1,!1)}}}},Re={instance:function(d){for(var S=d.fromLayerSize,C=d.toLayerSize,U=d.toSparsity,le=U*C,_e=le/S,ye=S/C,ae=0,K=0,Ee=Array(U*C*U*C*4),Be=Array(U*C*U*C*4),we=Array(S*S),Ie=0;Ie<we.length;++Ie)we[Ie]=0;Ie=Math.floor(U/2);for(var xe=.5/C,Ce=.5/S,N=.5/le,j=0;j<C;++j)for(var ge=Math.round(j*ye),V=0;V<C;++V){var Q=Math.round(V*ye),z=j/C,B=V/C;z+=xe,B+=xe;for(var Te=0;Te<U;++Te){var Fe=ge+Te-Ie;0>Fe&&(Fe+=S),Fe>=S&&(Fe-=S);for(var te=0;te<U;++te){var He=ae/le,rt=K/le,I=Q+te-Ie;0>I&&(I+=S),I>=S&&(I-=S);var oe=Fe/S,Ze=I/S;rt=1-rt-1/le,oe+=Ce,Ze+=Ce,rt+=N;var Et=j*U+Te,Ht=V*U+te;Ee[4*(Et=(Ht=C*U-Ht-1)*C*U+Et)]=He+=N,Ee[4*Et+1]=rt,Ee[4*Et+2]=oe,Ee[4*Et+3]=Ze,Ze=we[I*S+Fe]++,Be[4*(I=(I=S*_e-1-(I=I*_e+(Ze-(Et=Ze%_e))/_e))*S*_e+(oe=Fe*_e+Et))]=He,Be[4*I+1]=rt,Be[4*I+2]=z,Be[4*I+3]=B,++ae>=le&&(ae=0,++K)}}}we=null;var Kn=W.instance(d.weights);delete d.weights.data;var hi=W.instance({width:le,isFloat:!0,array:new Float32Array(Be),isPot:!0});Be=null;var Zt=W.instance({width:le,isFloat:!0,array:new Float32Array(Ee),isPot:!0});return Ee=null,{Ma:!0,Ab:function(){return _e},m:function(){hi.remove(),Zt.remove(),Kn.remove()},W:function(){se.set("s25"),Kn.h(1),Zt.h(2),A.l(!1,!1)}}}},pt={instance:function(d){var S=d.kernelsCount,C=d.toSparsity,U=C*d.toLayerSize/d.fromLayerSize,le=d.inputScale||[1,1],_e=W.instance(d.weights);return{Ma:!0,Ab:function(){return U},Vh:function(){return C},Of:function(){return _e},m:function(){_e.remove()},W:function(){se.set("s29"),se.xg("u28",le),se.J("u26",S),se.J("u27",C),se.J("u8",d.toLayerSize),se.J("u9",d.fromLayerSize),_e.h(1),A.l(!1,!1)}}}},Oe={instance:function(d,S){var C=d.fromLayerSize,U=d.toLayerSize,le=d.toSparsity,_e=d.stride?d.stride:1,ye=le*U/C,ae=U<C,K=C/U,me=W.instance(d.weights),Ee="s51"+[C.toString(),U.toString(),le.toString(),_e.toString(),S].join("_");return se.uf(Ee)||(d=function(d,S,C){switch(d){case"relu":return C+"=max(vec4(0.),"+S+");";case"elu":return C+"=mix(exp(-abs("+S+"))-vec4(1.),"+S+",step(0.,"+S+"));";case"elu01":return C+"=mix(0.1*exp(-abs("+S+"))-vec4(0.1),"+S+",step(0.,"+S+"));";case"arctan":return C+"=atan(3.14159265359*texture2D(u0,vUV))/3.14159265359;";case"copy":return"";default:return!1}}(S,"gl_FragColor","gl_FragColor"),U=[{type:"1f",name:"u8",value:U},{type:"1f",name:"u32",value:_e}],ae&&U.push({type:"1f",name:"u9",value:C}),C=[(ae?ye:le).toFixed(1),d],ae&&C.push(K.toFixed(1)),se.Qf(ae?"s47":"s46",Ee,C),se.K(Ee,U.concat([{type:"1i",name:"u6",value:0},{type:"1i",name:"u3",value:1},{type:"1i",name:"u7",value:3}]))),{Ma:!1,Ab:function(){return ye},m:function(){me.remove()},W:function(){se.set(Ee),me.h(3),A.l(!1,!1)}}}},Dt={instance:function(d){var S=d.oe?d.oe:3,C=d.Wd?d.Wd:64,U=d.qe?d.qe:64,le=!!d.ba,_e=W.instance(d={isFloat:!1,width:C,isPot:!1,isFlipY:!1}),ye=W.instance(d),ae=W.instance(d),K=W.instance(d),me=W.instance({isFloat:!0,width:U,isPot:!1,isFlipY:!1}),Ee=1/C;return{process:function(Be){se.set("s43"),K.v(),A.l(le,!1),se.set("s44");for(var we=0;we<S;++we)_e.v(),se.S("u14",Ee,0),A.l(le,!1),ae.v(),K.h(0),A.l(le,!1),ye.v(),_e.h(0),se.S("u14",0,Ee),A.l(le,!1),K.v(),ae.h(0),A.l(le,!1),we!==S-1&&ye.h(0);se.set("s45"),me.v(),Be.h(0),ye.h(1),K.h(2),A.l(le,!1),me.h(0)},Ya:function(){return me}}}},zt={instance:function(d){function S(Ee){return W.instance({isFloat:Ee,width:C.o,isPot:!1,isFlipY:!1})}var C=Object.assign({ra:.1,ha:9,o:128,gain:1,ba:!1},d),U=S(!1),le=[S(!1),S(!1),S(!1)],_e=[S(!1),S(!1),S(!1)],ye=S(!0),ae=[U,_e[0],_e[1]];d="uniform sampler2D u1;const float e=1.1111,g=2.2222;uniform vec2 u33;varying vec2 vv0;void main(){float b=0.,c=0.;for(float a=-e;a<=e;a+=1.){vec2 i=u33*a,j=vv0+i*g;float d=1.2*a/e,f=exp(-d*d);b+=f*texture2D(u1,j).r,c+=f;}b/=c,gl_FragColor=vec4(b,0.,0.,1.);}".replace("1.1111",Math.round((C.ha-1)/2).toFixed(2)).replace("2.2222",(1/C.o).toFixed(6));var K="uniform sampler2D u34,u35,u36,u37;const float f=1.1111;const vec3 g=vec3(1.);const float h=2.2222;varying vec2 vv0;void main(){vec3 a=texture2D(u34,vv0).rgb;float c=texture2D(u35,vv0).r,d=texture2D(u36,vv0).r,i=texture2D(u37,vv0).r,j=a.r*a.r;vec3 b=vec3(c,d,i),k=max(g*f,abs(vec3(j)-b*b)),l=sqrt(k);gl_FragColor=vec4(a.r,h*(a-b)/l);}".replace("1.1111",C.ra.toFixed(4)).replace("2.2222",C.gain.toFixed(4)),me={u1:0};return se.mb([{id:"s53",name:"_",g:"uniform sampler2D u1;varying vec2 vv0;const vec3 f=vec3(.2126,.7152,.0722),g=vec3(1.);void main(){vec3 b=texture2D(u1,vv0).rgb;float a=dot(b,f);gl_FragColor=vec4(a,a,a,a);}",j:me,i:["u1"],precision:"lowp"},{id:"s54",name:"_",g:d,j:me,i:["u1","u33"],precision:"lowp"},{id:"s55",name:"_",g:K,j:{u34:0,u35:1,u36:2,u37:3},i:["u34","u35","u36","u37"],precision:"highp"}]),{process:function(){se.set("s53"),U.N(),A.l(C.ba,!1),se.set("s54");for(var Ee=0;3>Ee;++Ee)se.S("u33",1,0),le[Ee].v(),ae[Ee].h(0),A.l(!1,!1),se.S("u33",0,1),_e[Ee].v(),le[Ee].h(0),A.l(!1,!1);se.set("s55"),ye.v(),U.h(0),_e[0].h(1),_e[1].h(2),_e[2].h(3),A.l(!1,!1),ye.h(0)},Ya:function(){return ye}}}},Yn={instance:function(d){function S(me){return W.instance({isFloat:me,width:C.o,isPot:!1,isFlipY:!1})}var C=Object.assign({ra:.1,ha:9,o:128,gain:1,ba:!1},d),U=S(!1),le=S(!1),_e=S(!1),ye=S(!0);d="uniform sampler2D u1;const float e=1.1111,g=2.2222;uniform vec2 u33;varying vec2 vv0;void main(){vec3 b=vec3(0.);float c=0.;for(float a=-e;a<=e;a+=1.){vec2 i=u33*a,j=vv0+i*g;float d=1.2*a/e,f=exp(-d*d);b+=f*texture2D(u1,j).rgb,c+=f;}b/=c,gl_FragColor=vec4(b,1.);}".replace("1.1111",Math.round((C.ha-1)/2).toFixed(2)).replace("2.2222",(1/C.o).toFixed(6));var ae="uniform sampler2D u0,u38;const float f=1.1111;const vec3 g=vec3(1.);const float h=2.2222;varying vec2 vv0;void main(){vec4 a=texture2D(u0,vv0);vec3 c=texture2D(u38,vv0).rgb;float d=a.a*a.a;vec3 b=c.rgb,i=max(g*f,abs(vec3(d)-b*b)),j=sqrt(i);gl_FragColor=vec4(a.a,h*(a.rgb-b)/j);}".replace("1.1111",C.ra.toFixed(4)).replace("2.2222",C.gain.toFixed(4)),K={u1:0};return se.mb([{id:"s56",name:"_",g:"uniform sampler2D u1;varying vec2 vv0;const vec3 f=vec3(.2126,.7152,.0722),g=vec3(1.);void main(){vec3 a=texture2D(u1,vv0).rgb;float b=dot(a,f);gl_FragColor=vec4(a.rgb,b);}",j:K,i:["u1"],precision:"lowp"},{id:"s57",name:"_",g:d,j:K,i:["u1","u33"],precision:"lowp"},{id:"s58",name:"_",g:ae,j:{u0:0,u38:1},i:["u0","u38"],precision:"highp"}]),{process:function(){se.set("s56"),U.N(),A.l(C.ba,!1),se.set("s57"),se.S("u33",1,0),le.v(),U.h(0),A.l(!1,!1),se.S("u33",0,1),_e.v(),le.h(0),A.l(!1,!1),se.set("s58"),ye.v(),U.h(0),_e.h(1),A.l(!1,!1),ye.h(0)},Ya:function(){return ye}}}},ni={instance:function(d){function S(Ee){return W.instance({isFloat:Ee,width:C.o,isPot:!1,isFlipY:!1})}var C=Object.assign({ra:.1,ha:9,o:128,gain:1,Zc:0,bb:!1,ba:!1},d),U=S(!1),le=null,_e=null,ye=null;C.bb&&(le=S(!1),_e=S(!1),ye=S(!0)),d={u1:0};var ae=[{id:"s59",name:"_",g:"uniform sampler2D u1;const float f=1.1111;varying vec2 vv0;const vec3 e=vec3(.2126,.7152,.0722);void main(){vec2 a=vv0*.5*(f+1.);float b=.5*(1.-f),c=dot(texture2D(u1,a).rgb,e),d=dot(texture2D(u1,a+vec2(0.,b)).rgb,e),h=dot(texture2D(u1,a+vec2(b,0.)).rgb,e),i=dot(texture2D(u1,a+vec2(b,b)).rgb,e);gl_FragColor=vec4(c,d,h,i);}".replace("1.1111",C.Zc.toFixed(4)),j:d,i:["u1"],precision:"lowp"}];if(C.bb){var K="uniform sampler2D u1;const float e=1.1111,g=2.2222;uniform vec2 u33;varying vec2 vv0;void main(){vec4 b=vec4(0.);float c=0.;for(float a=-e;a<=e;a+=1.){vec2 i=u33*a,j=vv0+i*g;float d=1.2*a/e,f=exp(-d*d);b+=f*texture2D(u1,j),c+=f;}gl_FragColor=b/c;}".replace("1.1111",Math.round((C.ha-1)/2).toFixed(2)).replace("2.2222",(1/C.o).toFixed(6)),me="uniform sampler2D u0,u38;const float f=1.1111;const vec4 g=vec4(1.);const float h=2.2222;varying vec2 vv0;void main(){vec4 a=texture2D(u0,vv0),c=texture2D(u38,vv0),d=a*a,b=c,i=max(g*f,abs(d-b*b)),j=sqrt(i);gl_FragColor=h*(a-b)/j;}".replace("1.1111",C.ra.toFixed(4)).replace("2.2222",C.gain.toFixed(4));ae.push({id:"s60",name:"_",g:K,j:d,i:["u1","u33"],precision:"lowp"},{id:"s61",name:"_",g:me,j:{u0:0,u38:1},i:["u0","u38"],precision:"highp"})}return se.mb(ae),{process:function(){se.set("s59"),U.N(),A.l(C.ba,!1),C.bb?(se.set("s60"),se.S("u33",1,0),le.v(),U.h(0),A.l(!1,!1),se.S("u33",0,1),_e.v(),le.h(0),A.l(!1,!1),se.set("s61"),ye.v(),U.h(0),_e.h(1),A.l(!1,!1),ye.h(0)):U.h(0)},Gf:function(){return 2-C.Zc},Ya:function(){return C.bb?ye:U}}}},St={Ud:function(){return!!St.zd()&&document.createElement("video")},Xa:function(d,S){d[S]=!0,d.setAttribute(S,"true")},cf:function(){var d=!1,S=navigator.userAgent||navigator.vendor||window.opera;return(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(S)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(S.substr(0,4)))&&(d=!0),d},bf:function(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream},$f:function(){try{return!!window.matchMedia("(orientation: portrait)").matches}catch{return window.innerHeight>window.innerWidth}},Xg:function(){return St.xd()||St.bf()},xd:function(){var d=navigator.userAgent.toLowerCase();return-1!==d.indexOf("safari")&&-1===d.indexOf("chrome")},yh:function(){return St.cf()&&St.$f()?window.innerHeight/window.innerWidth*45:45},zd:function(){return!(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)},pause:function(d){d.pause()},vi:function(d){d.play()},release:function(d){d.pause(),d.videoStream&&d.videoStream.stop(),d.videoStream=null},yd:function(d){if(!d)return d;var S=null;if(d.video){var C=function(U){return U&&"object"==typeof U?Object.assign({},U):U};S={},typeof d.video.width<"u"&&(S.width=C(d.video.width)),typeof d.video.height<"u"&&(S.height=C(d.video.height)),typeof d.video.facingMode<"u"&&(S.facingMode=C(d.video.facingMode))}return S={audio:d.audio,video:S},typeof d.deviceId<"u"&&St.sd(S,d.deviceId),S},sd:function(d,S){S&&(d.video=d.video||{},d.video.deviceId={exact:S},d.video.facingMode&&delete d.video.facingMode)},Ke:function(d){var S=d.video.width;return d.video.width=d.video.height,d.video.height=S,d},hf:function(d){function S(we){return[480,576,640,648,720,768,800,960,1080,1152,1280,1366,1920].sort(function(Ie,xe){return Math.abs(Ie-we)-Math.abs(xe-we)})}function C(we){we=we(St.yd(d)),le.push(we),U(we)}function U(we){if(we.video&&we.video.facingMode&&we.video.facingMode.exact){var Ie=we.video.facingMode.exact;delete(we=St.yd(we)).video.facingMode.exact,we.video.facingMode.ideal=Ie,le.push(we)}}var le=[];if(!d||!d.video)return le;if(U(d),d.video.width&&d.video.height){if(d.video.width.ideal&&d.video.height.ideal){var _e=S(d.video.width.ideal).slice(0,3),ye=S(d.video.height.ideal).slice(0,3),ae={},K=0;for(ae.ua=void 0;K<_e.length;ae={ua:ae.ua},++K){ae.ua=_e[K];var me={},Ee=0;for(me.ta=void 0;Ee<ye.length;me={ta:me.ta},++Ee)if(me.ta=ye[Ee],ae.ua!==d.video.width.ideal||me.ta!==d.video.height.ideal){var Be=Math.max(ae.ua,me.ta)/Math.min(ae.ua,me.ta);Be<4/3-.1||Be>16/9+.1||C(function(we,Ie){return function(xe){return xe.video.width.ideal=we.ua,xe.video.height.ideal=Ie.ta,xe}}(ae,me))}}}C(function(we){return St.Ke(we)})}return d.video.width&&d.video.height&&(d.video.width.ideal&&d.video.height.ideal&&C(function(we){return delete we.video.width.ideal,delete we.video.height.ideal,we}),C(function(we){return delete we.video.width,delete we.video.height,we})),d.video.facingMode&&(C(function(we){return delete we.video.facingMode,we}),d.video.width&&d.video.height&&C(function(we){return St.Ke(we),delete we.video.facingMode,we})),le.push({audio:d.audio,video:!0}),le},me:function(d){if(d.volume=0,St.Xa(d,"muted"),St.xd()){if(1===d.volume){var S=function(){d.volume=0,window.removeEventListener("mousemove",S,!1),window.removeEventListener("touchstart",S,!1)};window.addEventListener("mousemove",S,!1),window.addEventListener("touchstart",S,!1)}setTimeout(function(){d.volume=0,St.Xa(d,"muted")},5)}},Ne:function(d,S,C){return null===d?Promise.resolve():new Promise(function(U,le){if(d.srcObject&&d.srcObject.getVideoTracks){var _e=d.srcObject.getVideoTracks();1!==_e.length?le("INVALID_TRACKNUMBER"):(_e=_e[0],S?St.get(d,U,le,C):(_e.stop(),U()))}else le("BAD_IMPLEMENTATION")})},Sd:function(d,S,C,U){function le(ye){_e||(_e=!0,C(ye))}var _e=!1;return navigator.mediaDevices.getUserMedia(U).then(function(ye){function ae(){setTimeout(function(){if(d.currentTime){var me=d.videoHeight;if(0===d.videoWidth||0===me)le("VIDEO_NULLSIZE");else{me={af:null,Bg:null,eg:null};try{var Ee=ye.getVideoTracks()[0];Ee&&(me.eg=Ee,me.af=Ee.getCapabilities(),me.Bg=Ee.getSettings())}catch{}_e||S(d,ye,me)}}else le("VIDEO_NOTSTARTED")},700)}typeof d.srcObject<"u"?d.srcObject=ye:(d.src=window.URL.createObjectURL(ye),d.videoStream=ye),St.me(d),d.addEventListener("loadeddata",function K(){d.removeEventListener("loadeddata",K,!1);var me=d.play();St.me(d),typeof me>"u"?ae():me.then(function(){ae()}).catch(function(){le("VIDEO_PLAYPROMISEREJECTED")})},!1)}).catch(function(ye){le(ye)})},Nf:function(d,S){var C=S||St.Ud();return new Promise(function(U,le){St.get(C,U,le,d)})},get:function(d,S,C,U){return d?St.zd()?(St.Xa(d,"autoplay"),St.Xa(d,"playsinline"),U&&U.audio?d.volume=0:St.Xa(d,"muted"),void St.ef(U).then(function(){St.Sd(d,S,function(){!function le(ye){if(0===ye.length)C("NO_VALID_MEDIASTREAM_FALLBACK_CONSTRAINTS");else{var ae=ye.shift();St.Sd(d,S,function(){le(ye)},ae)}}(St.hf(U))},U)})):(C&&C("MEDIASTREAMAPI_NOT_FOUND"),!1):(C&&C("VIDEO_NOT_PROVIDED"),!1)},ef:function(d){if(!d||!d.video||!d.video.facingMode)return Promise.resolve("NO_VIDEO_CONSTRAINTS");if(d.video.deviceId)return Promise.resolve("DEVICEID_ALREADY_SET");var S=d.video.facingMode;if(!(S=S.exact||S.ideal))return Promise.resolve("NO_FACINGMODE");var C={user:[],environment:["camera2 0"]}[S];return C&&0!==C.length?new Promise(function(U){St.Td(function(le){le?(le=le.find(function(_e){var ye=_e.label;return!!ye&&C.some(function(ae){return ye.includes(ae)})}))?(d.video.deviceId={exact:le.deviceId},U("SUCCESS")):U("NO_PREFERRED_DEVICE_FOUND"):U("NO_DEVICES_FOUND")})}):Promise.resolve("NO_PREFERRED_CAMERAS")},Td:function(d){if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return d(!1,"NOTSUPPORTED"),!1;navigator.mediaDevices.enumerateDevices().then(function(S){(S=S.filter(function(C){return C.kind&&-1!==C.kind.toLowerCase().indexOf("video")&&C.label&&C.deviceId}))&&S.length&&0<S.length?d(S,!1):d(!1,"NODEVICESFOUND")}).catch(function(){d(!1,"PROMISEREJECTED")})},Wg:function(d,S,C){var U={};U[S]=C,(S=[]).push(U),d.applyConstraints({advanced:S}).catch(function(){})}},un=function(){function d(Ce,N,j,ge,V,Q,z){if(!Ie)if(z===Q.length)V();else{switch(Q[z]){case"A":j();break;case"D":Ce();break;case"S":return void N().then(function(B,Te){xe.Zb(),d(Ce,N,j,Te?null:ge,V,Q,++z)}).catch(function(B){console.log("An error occurred in the WebAR loop: ",B),V()});case"R":ge&&ge()}d(Ce,N,j,ge,V,Q,++z)}}var S={n:5,Rc:1,je:0,yb:[35,49],tb:[2,200],k:.7,Lg:200,jg:.05},C=-1,U=null,le=-1,_e=-1,ye=0,ae=-1,K=-1,me=0,Ee=0,Be=S.tb[1],we=Math.log(2),Ie=!0,xe={Kf:function(){switch(C){case-1:return-1;case 0:return K+U.je;case 1:return me}},Eh:function(Ce){return Math.pow(Math.min(Math.max(ae,0),U.n-1)/(U.n-1),Ce||1)},B:function(Ce){U=Object.assign({},S,Ce),ae=K=U.Rc,C=0,xe.reset()},Zb:function(Ce){Ce=(typeof Ce>"u"?Date.now():Ce)||0;var N=Math.min(Math.max(Ce-Ee,U.tb[0]),U.tb[1]);Be=N,Ee=Ce;var j=-1===le?0:U.k;le=Math.min(Math.max(1e3/N,5),120)*(1-j)+le*j,Ce-_e>U.Lg&&5<++ye&&(ae=ae*(1-(N=U.k))+(le<U.yb[0]?K-1:le>U.yb[1]?K+1:K)*N,Math.abs(ae-K)>1-U.jg&&(N=Math.min(Math.max(Math.round(ae),0),U.n-1))!==K&&(ae=K=N,le=(U.yb[1]-U.yb[0])/2),_e=Ce)},$c:function(Ce,N,j,ge,V,Q){Ie=!1,d(Ce,N,j,ge,V,Q,0)},stop:function(){Ie=!0},bd:function(Ce){me=Ce,C=1},nd:function(){C=0,xe.reset()},reset:function(){Be=S.tb[1],_e=le=-1,ye=0},Xb:function(Ce,N,j){return(1-(j=Math.exp(-we*Be/j)))*Ce+j*N},Bf:function(){return Be}};return xe}(),Dn=function(){function d(){C(Ce+Ie.Pc),N.port.postMessage("DONE")}function S(){Q.pb=ge(0===Ie.ob?C:U)}function C(te){V.Ja&&null!==xe&&(te-=Ce,te=Math.min(Math.max(te,Ie.Dd[0]),Ie.Dd[1]),Ce+=te,_e(),z.isEnabled&&z.cb&&V.ca&&Ce-z.Lc>Ie.qd&&(function me(){z.cb=!1;var te=z.la,He=z.Cb,rt=z.Db,I=z.$;te.uniform1f(z.Vd,Math.random()),z.Ka?He.beginQueryEXT(I,rt):te.beginQuery(I,rt),te.drawElements(te.POINTS,1,te.UNSIGNED_SHORT,0),z.Ka?He.endQueryEXT(I):te.endQuery(I),Ne.flush(),function Be(){return new Promise(function(te,He){Ee(function(rt){if(rt){rt=z.la;var I=z.Cb,oe=z.Db;rt=z.Ka?I.getQueryObjectEXT(oe,I.QUERY_RESULT_EXT):rt.getQueryParameter(oe,rt.QUERY_RESULT),te(rt)}else He()})})}().then(function(oe){0===oe||isNaN(oe)?(z.isEnabled=!1,console.log("WARNING in benchmark_GPUClock: WebGL timer queries is not working properly. timeElapsedNs =",oe)):(oe=Ie.Pe*Ie.pd*1e3/oe,z.bc=(z.bc+1)%Ie.Oa,z.Mc[z.bc]=oe,++z.ie>Ie.Oa&&(z.Ib.set(z.Mc),z.Ib.sort(function(Ze,Et){return Ze-Et}),oe=z.Ib[Math.floor(Ie.Oa/2)],z.wb=Math.max(z.wb,oe),Ie.cc(oe/z.wb)),z.cb=!0)}).catch(function(){z.cb=!0})}(),z.Lc=Ce),xe(Ce))}function U(te){V.Ja&&(Q.timeout=setTimeout(C.bind(null,te),Ie.ob))}function le(){xe=null,V.Ja=!1,_e()}function _e(){Q.pb&&(window.cancelAnimationFrame(Q.pb),Q.pb=null),Q.timeout&&(window.clearTimeout(Q.timeout),Q.timeout=null)}function ye(te){te&&!V.ca?(V.ca=!0,j&&un.nd(),N.port.postMessage("STOP"),Ne.Me(!0),S()):!te&&V.ca&&(V.ca=!1,j&&un.bd(1),Ne.Me(!1),N.port.postMessage("START"))}function ae(te){te.target.hidden?Te():B()}function K(te,He,rt){return He=te.createShader(He),te.shaderSource(He,rt),te.compileShader(He),He}function Ee(te){var He=z.la,rt=z.Cb,I=z.Db;I=z.Ka?rt.Bh(I,rt.QUERY_RESULT_AVAILABLE_EXT):He.getQueryParameter(I,He.QUERY_RESULT_AVAILABLE),He=He.getParameter(rt.GPU_DISJOINT_EXT),I?te(!He):setTimeout(Ee.bind(null,te),.1)}var we={de:!0,Dd:[1,200],Pc:20,ob:0,pd:50,Pe:240,qd:3e3,Oa:3,cc:null},Ie=null,xe=null,Ce=0,N=null,j=!1,ge=null,V={Ba:!1,ca:!0,Ec:!1,Cc:!1,Bc:!1,Ja:!1},Q={pb:null,timeout:null},z={isEnabled:!1,cb:!1,la:null,Cb:null,Db:null,$:null,Vd:null,Ka:!0,Lc:0,ie:0,Mc:null,Ib:null,bc:0,wb:0},B=ye.bind(null,!0),Te=ye.bind(null,!1),Fe={B:function(te){if(Ie=Object.assign(we,te),Object.assign(V,{ca:!0,Ba:!0,Ja:!1}),ge=window.requestPostAnimationFrame||window.requestAnimationFrame,null!==Ie.cc){(te=document.createElement("canvas")).setAttribute("width","1"),te.setAttribute("height","1");var He={antialias:!1};if(He=(te=te.getContext("webgl2",He)||te.getContext("webgl",He)).getExtension("EXT_disjoint_timer_query")||te.getExtension("EXT_disjoint_timer_query_webgl2")){z.la=te,z.Cb=He,z.isEnabled=!0,z.Ka=!!He.beginQueryEXT;var rt=K(te,te.VERTEX_SHADER,"attribute vec4 a0;void main(){gl_Position=a0;}"),I=K(te,te.FRAGMENT_SHADER,"precision lowp float;uniform float u39;void main(){vec4 a=u39*vec4(1.,2.,3.,4.);for(int b=0;b<666;b+=1)a=cos(a);gl_FragColor=a;}".replace("666",Ie.pd.toString())),oe=te.createProgram();te.attachShader(oe,rt),te.attachShader(oe,I),te.linkProgram(oe),rt=te.getAttribLocation(oe,"a0"),z.Vd=te.getUniformLocation(oe,"u39"),te.useProgram(oe),te.enableVertexAttribArray(rt),oe=te.createBuffer(),te.bindBuffer(te.ARRAY_BUFFER,oe),te.bufferData(te.ARRAY_BUFFER,new Float32Array([.5,.5,0,1]),te.STATIC_DRAW),te.vertexAttribPointer(rt,4,te.FLOAT,!1,16,0),oe=te.createBuffer(),te.bindBuffer(te.ELEMENT_ARRAY_BUFFER,oe),te.bufferData(te.ELEMENT_ARRAY_BUFFER,new Uint16Array([0]),te.STATIC_DRAW),te.disable(te.DEPTH_TEST),te.disable(te.DITHER),te.disable(te.STENCIL_TEST),te.viewport(0,0,1,1),oe=z.Ka?He.createQueryEXT():te.createQuery(),z.Db=oe,z.$=He.TIME_ELAPSED_EXT||te.TIME_ELAPSED,z.Lc=-Ie.qd,z.Mc=new Float32Array(Ie.Oa),z.Ib=new Float32Array(Ie.Oa),z.wb=0,z.bc=0,z.ie=0,z.cb=!0}}if(Ie.de){te=!1;try{if(typeof SharedWorker>"u"){var Ze=URL.createObjectURL(new Blob(["let handler = null;\n      self.addEventListener('message', function(e){\n        if (handler !== null){\n          clearTimeout(handler);\n          handler = null;\n        }\n        switch (e.data) {\n          case 'START':\n          case 'DONE':\n            handler = setTimeout(function(){\n              self.postMessage('TICK');\n            }, "+Ie.Pc.toString()+");\n            break;\n          case 'STOP':\n            break;\n        };\n      }, false);"],{type:"text/javascript"})),Et=new Worker(Ze);Et.addEventListener("message",d),N={se:Et,port:Et},V.Ec=!0}else{var Ht=URL.createObjectURL(new Blob(["let handler = null;\n      onconnect = function(e) {\n        const port = e.ports[0];\n        port.addEventListener('message', function(e) {\n          \n          if (handler !== null){\n            clearTimeout(handler);\n            handler = null;\n          }\n          switch (e.data) {\n            case 'START':\n            case 'DONE':\n              handler = setTimeout(function(){\n                port.postMessage('TICK');\n              }, "+Ie.Pc.toString()+");\n              break;\n            case 'STOP':\n              break;\n          };\n          \n        });\n        \n        port.start();\n      } // end onconnect()"],{type:"text/javascript"})),Kn=new SharedWorker(Ht);Kn.port.start(),Kn.port.addEventListener("message",d),N={se:Kn,port:Kn.port},V.Cc=!0}te=!0}catch{}te&&("onvisibilitychange"in document?document.addEventListener("visibilitychange",ae):(window.addEventListener("blur",Te),window.addEventListener("focus",B)),window.addEventListener("pagehide",Te),window.addEventListener("pageshow",B),V.Bc=!0)}j=typeof un<"u"},m:function(){le(),V.Bc&&("onvisibilitychange"in document?document.removeEventListener("visibilitychange",ae):(window.removeEventListener("blur",Te),window.removeEventListener("focus",B)),window.removeEventListener("pagehide",Te),window.removeEventListener("pageshow",B),V.Bc=!1),V.Cc?(N.port.close(),V.Cc=!1):V.Ec&&(N.se.terminate(),V.Ec=!1),Object.assign(V,{ca:!0,Ba:!1,Ja:!1}),xe=null},bg:function(){return V.ca},update:function(te){Object.assign(Ie,te)},$c:function(te){V.Ba||Fe.B({}),_e(),V.Ja=!0,xe=te,V.ca&&S()},stop:le};return Fe}(),vi=function(){function d(Be,we){var Ie=Be[0]-.5,xe=we[0]-.5;return Ie*Ie+(Be=Be[1]-.5)*Be-(xe*xe+(we=we[1]-.5)*we)}var S={pe:4,Qb:[1.5,1.5,2],X:[.1,.1,.1],ye:1,o:-1,F:-1,Gg:2,ig:1,ad:!0,qf:.8},C=null,U=[],le=[],_e=[],ye=[0],ae=[.5,.5,1],K=null,me=0,Ee=[0,0,0];return{B:function(Be){C=Object.assign({},S,Be),U.splice(0),le.splice(0),_e.splice(0),me=0,Be=C.Qb[0]*C.X[0];var we=C.Qb[1]*C.X[1],Ie=1/(1+C.Qb[2]*C.X[2]),xe=C.ye*Math.min(C.o,C.F),Ce=xe/C.o;xe/=C.F;var N=.5*C.qf;N*=N;for(var j=0;j<C.pe;++j){var ge=[];le.push(ge);var V=Math.pow(Ie,j),Q=Ce*V,z=xe*V;_e.push(V=Q*C.ig);for(var B=Q*Be,Te=z*we,Fe=1+(1-(Q/=2)-Q)/B,te=1+(1-(z/=2)-z)/Te,He=0;He<te;++He)for(var rt=z+He*Te,I=rt-.5,oe=0;oe<Fe;++oe){var Ze=Q+oe*B,Et=Ze-.5;Et*Et+I*I>N||(U.push(Ze=[Ze,rt,V]),ge.push(Ze))}C.ad&&ge.sort(d),K=U}C.ad&&U.sort(d)},get:function(Be){var we=K.length;if(0===we)return ae;for(;Be>=ye.length;)ye.push(0);ye[Be]>=we&&(ye[Be]=0);var Ie=K[Math.floor(ye[Be])%we];return ye[Be]=(ye[Be]+1/C.Gg)%we,0===me?Ie:(Ee[0]=Ie[0],Ee[1]=Ie[1],Ee[2]=me,Ee)},oi:function(Be){Be>=ye.length||(ye[Be]=Math.floor(Math.random()*K.length))},cd:function(Be){if(0===(me=Be))K=U;else{for(var we=_e.length,Ie=we-1,xe=0;xe<we;++xe)if(_e[xe]<=Be){Ie=xe;break}K=le[Ie]}},reset:function(){for(var Be=U.length/ye.length,we=0;we<ye.length;++we)ye[we]=Math.floor(we*Be);me=0,K=U}}}(),yi=function(){function d(N,j,ge,V){return Math.max(0,ge>N?N+j/2-(ge-V/2):ge+V/2-(N-j/2))}function S(N){return!ae.$d(N)}function U(N,j,ge){var V=Math.abs(-N.jb*(ge-N.ia[1])-N.Va*(j-N.ia[0]));return j=Math.abs(N.Va*(ge-N.ia[1])-N.jb*(j-N.ia[0])),1>=V*V/N.Jb[0]+j*j/N.Jb[1]}function _e(N){return N.isDetected}var ye={T:1,le:.3,Ed:[1,1],rf:6,ze:.3,$d:null,Xf:!0},ae=null,K=0,me=null,Ee=!1,Be=0,we=0,Ie=Math.sqrt(2),xe=[],Ce={B:function(N){ae=Object.assign({},ye,N),me=[0]},he:function(){return 1!==ae.T},Qd:function(){return K},Fc:function(){return Ee},za:function(){return ae.T},Th:function(){return me},ag:function(N){return me.includes(N)},update:function(N,j){var ge=me;if(ge.length>N)ge.splice(0,ge.length-N);else for(;ge.length<N;)ge.push(0);if(1!==ae.T)if(j.every(S)){j=Be;for(var V=0;V<N;++V)ge[V]=j,j=(j+1)%ae.T;Be=j}else{V=Math.round(ae.ze*N),V=Math.max(1,V);for(var Q=Be,z=0,B=0;z<N;++z){if(S(j[Q])&&++B>V)do{++Q===ae.T&&(Q=0)}while(S(j[Q]));ge[z]=Q,Q=(Q+1)%ae.T}Be=Q}},Zb:function(N){return we=(.5+(K=me[N]))/ae.T,Ee=me.lastIndexOf(K)===N,K},Dg:function(N,j,ge){return 1!==ae.T&&function le(N,j,ge,V){var Q=N[ge];!function C(N,j,ge){for(var V=N.length;xe.length<V;)xe.push({oa:[0,0],Jb:[0,0],ia:[0,0],Fa:0,scale:0,Va:0,jb:0});V=N.length;for(var Q=0;Q<V;++Q){var z=N[Q],B=xe[Q],Te=j[Q].rz,Fe=Math.cos(Te),te=Math.sin(Te);B.Fa=Te,B.Va=Fe,B.jb=te,B.ia[0]=z.x,B.ia[1]=z.y/ge,B.scale=z.P,B.oa[0]=z.P*ae.Ed[0],B.oa[1]=z.P*ae.Ed[1],B.Jb[0]=B.oa[0]*B.oa[0],B.Jb[1]=B.oa[1]*B.oa[1]}}(N,j,V);var z=xe[ge];return N.some(function(B,Te){if(!(B=Te===ge||Q.Ca>B.Ca||3>B.Ca||!(0<d(Q.x,Q.P*Ie,B.x,B.P*Ie))||!(0<d(Q.y,Q.P*V*Ie,B.y,B.P*V*Ie)))){z.scale>(B=xe[Te]).scale?Te=z:(Te=B,B=z);for(var Fe=0,te=0,He=ae.rf,rt=0;rt<He;++rt)for(var I=((rt+.5)/He*2-1)*B.oa[1],oe=0;oe<He;++oe){var Ze=((oe+.5)/He*2-1)*B.oa[0],Et=B.ia[0]+(-I*B.jb+Ze*B.Va);U(B,Et,Ze=B.ia[1]+(I*B.Va+Ze*B.jb))&&(++Fe,U(Te,Et,Ze)&&++te)}B=te/Fe<ae.le}return!B})}(N,j,K,ge)},Le:function(N){ae.Xf&&1===ae.T||se.J(N,we)},vf:function(N){return N.find(_e)},zh:function(N){return N.findIndex(_e)},xh:function(N){var j=Ce.vf(N);return!j||N.every(_e)?(vi.cd(0),!1):(vi.cd(j.s),!0)},pf:function(N){for(var V,j=new Float32Array(N.length*ae.T),ge=0;ge<ae.T;++ge)for(V=0;V<N.length;++V)j[ge*N.length+V]=N[V];return j},qc:function(N){for(var j=[],ge=0;ge<ae.T;++ge){var V=j,Q=V.push,z=void 0,B=N,Te={};for(z in B){var Fe=z,te=B[z],He=typeof te;te=["string","boolean","number"].includes(He)?te:"object"!==He?null:ArrayBuffer.isView(te)?te.slice():JSON.parse(JSON.stringify(te)),Te[Fe]=te}Q.call(V,Te)}return j}};return Ce}(),xr=function(){var d={Tf:!0,isLinear:!0,Qc:[4,11]};return{tf:function(S,C,U){return C.isDetected?Math.floor(C.s*S):(S=Math.floor(Math.log2(S/4)),S=Math.min(Math.max(S,4),9),Math.max(U,Math.pow(2,S)))},instance:function(S){var C=Object.assign({},d,S),U=[],le=null,_e=-1,ye=null,ae=!1;for(S=C.Qc[0];S<=C.Qc[1];++S)U[S]=null;return{N:function(K,me){if(me!==_e&&(le&&le.remove(),le=W.instance({isLinear:C.isLinear,isPot:!0,width:me})),ae=C.Tf&&me<.5*K){K=Math.floor(Math.log2(K));var Ee=C.Qc;if(K=Math.min(Math.max(K,Ee[0]),Ee[1]),!U[Ee=K]){var Be=W.instance({isPot:!0,isMipmap:!0,ee:!0,width:Math.pow(2,Ee)});U[Ee]={D:Be,ke:-1}}ye=(K=U[K]).D,K.ke!==me&&(ye.Ee(Math.log2(me)),K.ke=me)}else ye=le;_e=me,ye.N()},h:function(K){ye.h(K),ae&&ye.zb()},wa:function(K){ye.wa(K)},remove:function(){le&&le.remove(),U.forEach(function(K){K&&K.D.remove()})}}}}}(),Si={neuralNetworkPath:"NN_FACE_3.json",va:0,qg:{threshold:.75,nDetectsPerLoop:0,nDetectsPerLoopRange:[1,5],nScaleLevels:3,scale0Factor:.8,overlapFactors:[2,2,4],scanCenterFirst:!0,translationScalingFactors:[.07,.07,.15],antialias:!1,isCleanGLStateAtEachIteration:!0,enableAsyncReadPixels:!1,readPixelsAsyncDelay:1,animateProcessOrder:"SADR"},Ig:50,gg:.4,fg:8,hg:.25,Fg:{translationFactorRange:[.0015,.005],rotationFactorRange:[.12,.25],qualityFactorRange:[.85,.95],alphaRange:[.05,.9],followZRotAlphaFactor:.01,lightingRelaxationTime:1e3},Re:.2,Se:2,Ng:20,Eg:8},Cn={facingMode:"user",idealWidth:800,idealHeight:600,minWidth:480,maxWidth:1920,minHeight:480,maxHeight:1920,rotate:0},Jn={gb:-1,error:-2,hb:0,Ie:1,play:2,pause:3,Kb:4},ui=Jn.hb,Dr=!1,Kr=!1,Qe=null,Er={eb:!1,ae:!1,gd:null,element:null,D:null,H:[0,0],A:[.5,0,0,.5],ea:[.5,0,0,.5],Sb:0,Ta:null,Gb:!1},Pn=null,cr={Sa:null,hc:null,dc:"./",lb:null,Y:null,va:Si.va,ni:Si.va,ya:!0,Dc:!0},Zr=null,hr=[-1,-1],ki=null,_i=null,fr=null,Un=null,cc={o:0,F:0,fc:1,H:[0,0],Za:null},Jr=0,Tn={size:0,da:null,kb:null,buffer:null,qa:null,X:null,fd:null,ab:!1},br=null,pi=null,Ia=null,Ar=-1,Pi={labels:[],Nb:0,Tc:0,rc:1,wd:!1},Fi={Lb:{ki:3,Wb:1,Ki:0},mode:3,Bd:0,xa:{ub:1,tc:0}},Bs={VERSION:"1.10.0",init:function(d){function S(){Kr||ui===Jn.hb||ui===Jn.error||2!=++U||(nn(),null!==Qe.element&&(Ln(),In()),Dr=!0,Pn.Sa&&Pn.Sa(!1,{GL:w,canvasElement:Pn.Y,video:Qe.element,videoTexture:Qe.D?Qe.D.get():null,videoTransformMat2:Qe.A,maxFacesDetected:yi.za(),landmarksLabels:Pi.labels}),J())}if(ui!==Jn.hb)return d.callbackReady&&d.callbackReady("ALREADY_INITIALIZED"),!1;ui=Jn.gb,Qe=Object.assign({},Er),Pn=Object.assign({},cr),Un=Object.assign({},cc),Tn.qa=[0,0,0],function(le){(typeof window<"u"?window:typeof self<"u"?self:this).zyp=function le(_e,ye,ae){function K(Be,we){if(!ye[Be]){if(!_e[Be]){if(me)return me(Be,!0);var xe=new Error("Cannot find module '"+Be+"'");throw xe.code="MODULE_NOT_FOUND",xe}var Ce=ye[Be]={exports:{}};_e[Be][0].call(Ce.exports,function(N){return K(_e[Be][1][N]||N)},Ce,Ce.exports,le,_e,ye,ae)}return ye[Be].exports}for(var me=!1,Ee=0;Ee<ae.length;Ee++)K(ae[Ee]);return K}({1:[function(le,_e,ye){Object.defineProperty(ye,"zzB",{value:!0}),ye.default=ye.zzZ3=void 0;var ae=le("./zzz3/zz04"),K=le("zz14");function me(Ie,xe){for(var Ce=0;Ce<xe.length;Ce++){var N=xe[Ce];N.enumerable=N.enumerable||!1,N.configurable=!0,"value"in N&&(N.writable=!0),Object.defineProperty(Ie,N.key,N)}}var Ee=function Ie(xe){var Ce=xe.shift();if(0===xe.length)return new Float32Array(Ce);for(var N=Array(Ce),j=0;j<Ce;++j)N[j]=Ie(xe.slice(0));return N},Be=function(Ie,xe){var Ce=Ie[0][0]+Ie[1][1]+Ie[2][2],N=Ie[0][0],j=Ie[1][0],ge=Ie[2][0],V=Ie[0][1],Q=Ie[1][1],z=Ie[2][1],B=Ie[0][2],Te=Ie[1][2],Fe=Ie[2][2],te=0,He=0,rt=0,I=0;if(Ce>0){var oe=.5/Math.sqrt(Ce+1);te=.25/oe,He=(Te-z)*oe,rt=(ge-B)*oe,I=(V-j)*oe}else if(N>Q&&N>Fe){var Ze=2*Math.sqrt(1+N-Q-Fe);te=(Te-z)/Ze,He=.25*Ze,rt=(j+V)/Ze,I=(ge+B)/Ze}else if(Q>Fe){var Et=2*Math.sqrt(1+Q-N-Fe);te=(ge-B)/Et,He=(j+V)/Et,rt=.25*Et,I=(z+Te)/Et}else{var Ht=2*Math.sqrt(1+Fe-N-Q);te=(V-j)/Ht,He=(ge+B)/Ht,rt=(z+Te)/Ht,I=.25*Ht}xe[0]=He,xe[1]=rt,xe[2]=I,xe[3]=te};ye.zzZ3=Be;var we=function(){function Ie(j){var ge=j.cameraFocals,V=void 0===ge?[1,1]:ge,Q=j.zz32,z=void 0===Q?9:Q;(function(B,Te){if(!(B instanceof Te))throw new Error})(this,Ie),this.rMat=ae.Matrix.zzJ1(3,3),this.tVec=[0,0,0],this.zyp14(V),this.zz32=z,this.zz42=new Float32Array,this.us=new Float32Array,this.zz52=new Float32Array,this.zz62=new Float32Array,this.zz72=0,this.zz82=0,this.zz92=ae.Matrix.zzG1(4,3),this.zzA2=ae.Matrix.zzG1(4,3),this.zzk3=0,this.mem={dv:Ee([4,6,3]),v:new Uint8Array([11,10,9,8]),zzX3:Ee([4,4]),zzW3Dets:Ee([4,2]),Rs:Ee([4,3,3]),ts:Ee([4,3]),CC:ae.Matrix.zzG1(3,3),L6x4:ae.Matrix.zzG1(6,4),L6x3:ae.Matrix.zzG1(6,3),L6x5:ae.Matrix.zzG1(6,5),A:ae.Matrix.zzG1(6,4),B:ae.Matrix.zzG1(6,1),zzG141:ae.Matrix.zzG1(4,1),pc0:new Float32Array(3),pw0:new Float32Array(3),ABt:ae.Matrix.zzG1(3,3),L6x10:ae.Matrix.zzG1(6,10),zzY3:ae.Matrix.zzG1(6,1),zzm3:null,U3:ae.Matrix.zzG1(3,3),U12:ae.Matrix.zzG1(12,12)},this.zzB2={PW0:null,tPW0:null,M:null,tM:null},this.zzV3={zzl3:-1,zyp13:!1,R:null,t:null,repError:-1,q:new Float32Array(4)}}var xe,Ce;return xe=Ie,(Ce=[{key:"solve",value:function(j,ge){this.zzV3.zyp13=!1;var V=j.length;if(V!==ge.length||V<4)throw new Error;this.zzk1(V);for(var Q=0;Q<V;++Q)this.zzl1(j[Q],ge[Q],Q);return this.zzj1(),this.zzV3}},{key:"zyp14",value:function(j){this.fu=j[0],this.fv=j[1]}},{key:"zzk1",value:function(j){this.zz82!==j&&(this.zzB2.PW0=ae.Matrix.zzG1(j,3),this.zzB2.tPW0=ae.Matrix.zzG1(3,j),this.zzB2.M=ae.Matrix.zzG1(2*j,12),this.zzB2.tM=ae.Matrix.zzG1(12,2*j),this.zz82=j),this.zz72<j&&(this.zz42=new Float32Array(3*j),this.us=new Float32Array(2*j),this.zz52=new Float32Array(4*j),this.zz62=new Float32Array(3*j),this.zz72=j)}},{key:"zzl1",value:function(j,ge,V){var Q=this.zz42,z=this.us;Q[3*V]=j[0],Q[3*V+1]=j[1],Q[3*V+2]=j[2],z[2*V]=ge[0],z[2*V+1]=ge[1]}},{key:"zzm1",value:function(){var j=this.zz92,ge=this.zz82,V=this.zz42,Q=this.zzB2,z=Q.PW0,B=Q.tPW0,Te=this.mem.U3;j.set(0,0,0),j.set(0,1,0),j.set(0,2,0);for(var Fe=0;Fe<ge;++Fe)for(var te=0;te<3;++te)j.zzn3(0,te,V[3*Fe+te]);for(var He=0;He<3;++He)j.mulComponent(0,He,1/ge);for(var rt=0;rt<ge;++rt)for(var I=0;I<3;++I)z.set(rt,I,V[3*rt+I]-j.get(0,I));z.zz012(B),B.zzr2(z,Te);var Ze=(0,ae.zz92)(Te,{zzZ2:!1,zzj3:0});Ze.U.zz012(Te);for(var Et=Te,Ht=Ze.s,Kn=1;Kn<4;++Kn)for(var hi=(0,K.zzr3)(Ht[Kn-1]/ge),Zt=0;Zt<3;++Zt)j.set(Kn,Zt,j.get(0,Zt)+hi*Et.get(Kn-1,Zt))}},{key:"zzn1",value:function(){for(var j=this.zz42,ge=this.zz52,V=this.zz92,Q=this.zz82,z=this.mem.CC,B=0;B<3;++B)for(var Te=1;Te<4;++Te)z.set(B,Te-1,V.get(Te,B)-V.get(0,B));for(var Fe=(0,ae.inverse2)(z,!0,20),te=0;te<Q;++te){for(var He=3*te,rt=4*te,I=0;I<3;++I)ge[rt+1+I]=Fe.get(I,0)*(j[He]-V.get(0,0))+Fe.get(I,1)*(j[He+1]-V.get(0,1))+Fe.get(I,2)*(j[He+2]-V.get(0,2));ge[rt]=1-ge[rt+1]-ge[rt+2]-ge[rt+3]}}},{key:"zzLM",value:function(j,ge,V,Q,z){for(var B=this.zz52,Te=this.fu,Fe=this.fv,te=0;te<4;++te){var He=B[V+te];j.set(ge,3*te,He*Te),j.set(ge,3*te+1,0),j.set(ge,3*te+2,-Q*He),j.set(ge+1,3*te,0),j.set(ge+1,3*te+1,He*Fe),j.set(ge+1,3*te+2,-z*He)}}},{key:"zzp1",value:function(j,ge){for(var V=this.mem,Q=V.dv,z=V.v,B=0;B<4;++B)for(var Te=0,Fe=1,te=0;te<6;++te)Q[B][te][0]=j.get(z[B],3*Te)-j.get(z[B],3*Fe),Q[B][te][1]=j.get(z[B],3*Te+1)-j.get(z[B],3*Fe+1),Q[B][te][2]=j.get(z[B],3*Te+2)-j.get(z[B],3*Fe+2),++Fe>3&&(Fe=1+ ++Te);for(var He=0;He<6;++He)ge.set(He,0,(0,K.zzs3)(Q[0][He],Q[0][He])),ge.set(He,1,2*(0,K.zzs3)(Q[0][He],Q[1][He])),ge.set(He,2,(0,K.zzs3)(Q[1][He],Q[1][He])),ge.set(He,3,2*(0,K.zzs3)(Q[0][He],Q[2][He])),ge.set(He,4,2*(0,K.zzs3)(Q[1][He],Q[2][He])),ge.set(He,5,(0,K.zzs3)(Q[2][He],Q[2][He])),ge.set(He,6,2*(0,K.zzs3)(Q[0][He],Q[3][He])),ge.set(He,7,2*(0,K.zzs3)(Q[1][He],Q[3][He])),ge.set(He,8,2*(0,K.zzs3)(Q[2][He],Q[3][He])),ge.set(He,9,(0,K.zzs3)(Q[3][He],Q[3][He]))}},{key:"zzq1",value:function(j){var ge=this.zz92;j.set(0,0,(0,K.zzq3)(ge,0,1)),j.set(1,0,(0,K.zzq3)(ge,0,2)),j.set(2,0,(0,K.zzq3)(ge,0,3)),j.set(3,0,(0,K.zzq3)(ge,1,2)),j.set(4,0,(0,K.zzq3)(ge,1,3)),j.set(5,0,(0,K.zzq3)(ge,2,3))}},{key:"zzr1",value:function(j,ge,V){for(var Q=this.mem.L6x4,z=0;z<6;++z)Q.set(z,0,j.get(z,0)),Q.set(z,1,j.get(z,1)),Q.set(z,2,j.get(z,3)),Q.set(z,3,j.get(z,6));var B=(0,ae.zzp3)(Q,ge,!0,10),Te=(0,K.SIGN)(B.get(0,0));V[0]=(0,K.zzr3)(Te*B.get(0,0)),V[1]=Te*B.get(1,0)/V[0],V[2]=Te*B.get(2,0)/V[0],V[3]=Te*B.get(3,0)/V[0]}},{key:"zzs1",value:function(j,ge,V){for(var Q=this.mem.L6x3,z=0;z<6;++z)Q.set(z,0,j.get(z,0)),Q.set(z,1,j.get(z,1)),Q.set(z,2,j.get(z,2));var B=(0,ae.zzp3)(Q,ge,!0,11),Te=(0,K.SIGN)(B.get(0,0));V[0]=(0,K.zzr3)(Te*B.get(0,0)),V[1]=Te*B.get(2,0)>0?(0,K.zzr3)(Te*B.get(2,0)):0,V[0]*=(0,K.SIGN)(B.get(1,0)),V[2]=0,V[3]=0}},{key:"zzt1",value:function(j,ge,V){for(var Q=this.mem.L6x5,z=0;z<6;++z)Q.set(z,0,j.get(z,0)),Q.set(z,1,j.get(z,1)),Q.set(z,2,j.get(z,2)),Q.set(z,3,j.get(z,3)),Q.set(z,4,j.get(z,4));var B=(0,ae.zzp3)(Q,ge,!0,12),Te=(0,K.SIGN)(B.get(0,0));V[0]=(0,K.zzr3)(Te*B.get(0,0)),V[1]=Te*B.get(2,0)>0?(0,K.zzr3)(Te*B.get(2,0)):0,B.get(1,0)<0&&(V[0]*=-1),V[2]=B.get(3,0)/V[0],V[3]=0}},{key:"zzu1",value:function(j,ge,V){for(var Q=this.mem,z=Q.A,B=Q.B,Te=0;Te<this.zz32;++Te){this.zzv1(j,ge,V,z,B);for(var Fe=this.zzw1(z,B),te=0;te<4;++te)V[te]+=Fe.get(te,0)}}},{key:"zzv1",value:function(j,ge,V,Q,z){for(var B=0;B<6;++B)Q.set(B,0,2*j.get(B,0)*V[0]+j.get(B,1)*V[1]+j.get(B,3)*V[2]+j.get(B,6)*V[3]),Q.set(B,1,j.get(B,1)*V[0]+2*j.get(B,2)*V[1]+j.get(B,4)*V[2]+j.get(B,7)*V[3]),Q.set(B,2,j.get(B,3)*V[0]+j.get(B,4)*V[1]+2*j.get(B,5)*V[2]+j.get(B,8)*V[3]),Q.set(B,3,j.get(B,6)*V[0]+j.get(B,7)*V[1]+j.get(B,8)*V[2]+2*j.get(B,9)*V[3]),z.set(B,0,ge.get(B,0)-(j.get(B,0)*V[0]*V[0]+j.get(B,1)*V[0]*V[1]+j.get(B,2)*V[1]*V[1]+j.get(B,3)*V[0]*V[2]+j.get(B,4)*V[1]*V[2]+j.get(B,5)*V[2]*V[2]+j.get(B,6)*V[0]*V[3]+j.get(B,7)*V[1]*V[3]+j.get(B,8)*V[2]*V[3]+j.get(B,9)*V[3]*V[3]))}},{key:"zzw1",value:function(j,ge){var V=null;return this.mem.zzm3?(V=this.mem.zzm3).update(j):(V=new ae.zzT2(j),this.mem.zzm3=V),V.zzY1()?V.solve(ge):this.mem.zzG141}},{key:"zzx1",value:function(j,ge){for(var V=this.zzA2,Q=0;Q<4;++Q)V.set(Q,0,0),V.set(Q,1,0),V.set(Q,2,0);for(var z=0;z<4;++z)for(var B=0;B<4;++B)for(var Te=0;Te<3;++Te)V.zzn3(B,Te,j[z]*ge.get(11-z,3*B+Te))}},{key:"zzy1",value:function(){for(var j=this.zzA2,ge=this.zz82,V=this.zz52,Q=this.zz62,z=0;z<ge;++z)for(var B=4*z,Te=3*z,Fe=0;Fe<3;++Fe)Q[Te+Fe]=V[B]*j.get(0,Fe)+V[B+1]*j.get(1,Fe)+V[B+2]*j.get(2,Fe)+V[B+3]*j.get(3,Fe)}},{key:"zzz1",value:function(){var j=this.zz62,ge=this.zz82,V=this.zzA2;if(j[2]<0){for(var Q=0;Q<4;++Q)for(var z=0;z<3;++z)V.mulComponent(Q,z,-1);for(var B=0;B<ge;++B)j[3*B]=-j[3*B],j[3*B+1]=-j[3*B+1],j[3*B+2]=-j[3*B+2]}}},{key:"zz02",value:function(j,ge){var V=this.zz62,Q=this.zz42,z=this.zz82,B=this.mem,Te=B.pc0,Fe=B.pw0,te=B.ABt;te.zzi3();for(var He=0;He<z;++He)for(var rt=0;rt<3;++rt)Te[rt]+=V[3*He+rt],Fe[rt]+=Q[3*He+rt];for(var I=0;I<3;++I)Te[I]/=z,Fe[I]/=z;for(var oe=0;oe<z;++oe)for(var Ze=0;Ze<3;++Ze)te.zzn3(Ze,0,(V[3*oe+Ze]-Te[Ze])*(Q[3*oe]-Fe[0])),te.zzn3(Ze,1,(V[3*oe+Ze]-Te[Ze])*(Q[3*oe+1]-Fe[1])),te.zzn3(Ze,2,(V[3*oe+Ze]-Te[Ze])*(Q[3*oe+2]-Fe[2]));for(var Et=(0,ae.zz92)(te,{zzj3:2}),Ht=Et.U,Kn=Et.V,hi=0;hi<3;++hi)for(var Zt=0;Zt<3;++Zt)j[hi][Zt]=(0,K.zzs3)(Ht.zzM(hi),Kn.zzM(Zt));var tt=new ae.Matrix(j),pn=(0,ae.zzU1)(tt);return pn<=0&&(j[2][0]*=-1,j[2][1]*=-1,j[2][2]*=-1),ge[0]=Te[0]-(0,K.zzs3)(j[0],Fe),ge[1]=Te[1]-(0,K.zzs3)(j[1],Fe),ge[2]=Te[2]-(0,K.zzs3)(j[2],Fe),pn}},{key:"zz12",value:function(j,ge){for(var V=0,Q=this.zz82,z=this.fu,B=this.fv,Te=this.zz42,Fe=this.us,te=0;te<Q;++te){var He=Te.slice(3*te,3*te+3),rt=(0,K.zzs3)(j[0],He)+ge[0],I=(0,K.zzs3)(j[1],He)+ge[1],oe=1/((0,K.zzs3)(j[2],He)+ge[2]),Ze=z*rt*oe,Et=B*I*oe,Ht=Fe[2*te],Kn=Fe[2*te+1];V+=(0,K.zzr3)((Ht-Ze)*(Ht-Ze)+(Kn-Et)*(Kn-Et))}return V/Q}},{key:"zz22",value:function(j,ge,V,Q,z){this.zzx1(ge,j),this.zzy1(),this.zzz1(),z[1]=this.zz02(V,Q),z[0]=this.zz12(V,Q)}},{key:"zzj1",value:function(){var j=this.zz82,ge=this.us,V=this.mem,Q=this.zzV3,z=this.zzk3,B=V.L6x10,Te=V.zzY3,Fe=V.zzX3,te=V.zzW3Dets,He=V.Rs,rt=V.ts,I=V.U12,oe=this.zzB2,Ze=oe.M,Et=oe.tM;this.zzm1(),this.zzn1();for(var Ht=0;Ht<j;++Ht)this.zzLM(Ze,2*Ht,4*Ht,ge[2*Ht],ge[2*Ht+1]);Ze.zz012(Et),Et.zzr2(Ze,I),(0,ae.zz92)(I,{zzZ2:!1,zzj3:1}).U.zz012(I);var hi=I;this.zzp1(hi,B),this.zzq1(Te),this.zzr1(B,Te,Fe[0]),this.zzu1(B,Te,Fe[0]),this.zz22(hi,Fe[0],He[0],rt[0],te[0]),this.zzs1(B,Te,Fe[1]),this.zzu1(B,Te,Fe[1]),this.zz22(hi,Fe[1],He[1],rt[1],te[1]),this.zzt1(B,Te,Fe[2]),this.zzu1(B,Te,Fe[2]),this.zz22(hi,Fe[2],He[2],rt[2],te[2]),this.zzu1(B,Te,Fe[3]),this.zz22(hi,Fe[3],He[3],rt[3],te[3]),te[3][0]/=1.02;var Zt=-1;te[0][1]*z>=0&&(Zt=0),(-1===Zt||te[1][0]<te[Zt][0])&&te[1][1]*z>=0&&(Zt=1),(-1===Zt||te[2][0]<te[Zt][0])&&te[2][1]*z>=0&&(Zt=2),(-1===Zt||te[3][0]<te[Zt][0])&&te[3][1]*z>=0&&(Zt=3),-1===Zt&&(te[1][0]<te[Zt=0][0]&&(Zt=1),te[2][0]<te[Zt][0]&&(Zt=2),te[3][0]<te[Zt][0]&&(Zt=3)),this.zzk3=te[Zt][1],Fe[3].set(Fe[Zt]);var tt=He[Zt];tt[0][2]*=-1,tt[1][2]*=-1,tt[2][0]*=-1,tt[2][1]*=-1,Be(tt,Q.q),Q.zzl3=Zt,Q.zyp13=!0,Q.repError=te[Zt][0],Q.R=tt,Q.t=rt[Zt]}}])&&me(xe.prototype,Ce),Ie}();ye.default=we},{zz14:3,"./zzz3/zz04":4}],2:[function(le,_e,ye){var ae,K=(ae=le("./zypSolver"))&&ae.zzB?ae:{default:ae};_e.exports={zypSolver:K.default}},{"./zypSolver":1}],3:[function(le,_e,ye){Object.defineProperty(ye,"zzB",{value:!0}),ye.zzq3=ye.zzs3=ye.SIGN=ye.zzr3=void 0;var ae=Math.sqrt;ye.zzr3=ae;var K=Math.sign;ye.SIGN=K,ye.zzs3=function(me,Ee){return me[0]*Ee[0]+me[1]*Ee[1]+me[2]*Ee[2]},ye.zzq3=function(me,Ee,Be){var we=me.get(Ee,0),Ie=me.get(Ee,1),xe=me.get(Ee,2),Ce=me.get(Be,0),N=me.get(Be,1),j=me.get(Be,2);return(we-Ce)*(we-Ce)+(Ie-N)*(Ie-N)+(xe-j)*(xe-j)}},{}],4:[function(le,_e,ye){function ae(ge,V){if("function"!=typeof V&&null!==V)throw new Error;ge.prototype=Object.create(V&&V.prototype,{constructor:{value:ge,writable:!0,configurable:!0}}),V&&K(ge,V)}function K(ge,V){return(K=Object.setPrototypeOf||function(Q,z){return Q.__proto__=z,Q})(ge,V)}function me(ge){var V=function(){if(typeof zzt3>"u"||!zzt3.construct||zzt3.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(zzt3.construct(Date,[],function(){})),!0}catch{return!1}}();return function(){var Q,z=Be(ge);if(V){var B=Be(this).constructor;Q=zzt3.construct(z,arguments,B)}else Q=z.apply(this,arguments);return Ee(this,Q)}}function Ee(ge,V){return!V||"object"!==Ce(V)&&"function"!=typeof V?function(Q){if(void 0===Q)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Q}(ge):V}function Be(ge){return(Be=Object.setPrototypeOf?Object.getPrototypeOf:function(V){return V.__proto__||Object.getPrototypeOf(V)})(ge)}function we(ge,V){if(!(ge instanceof V))throw new Error}function Ie(ge,V){for(var Q=0;Q<V.length;Q++){var z=V[Q];z.enumerable=z.enumerable||!1,z.configurable=!0,"value"in z&&(z.writable=!0),Object.defineProperty(ge,z.key,z)}}function xe(ge,V,Q){return V&&Ie(ge.prototype,V),Q&&Ie(ge,Q),ge}function Ce(ge){return(Ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(V){return typeof V}:function(V){return V&&"function"==typeof Symbol&&V.constructor===Symbol&&V!==Symbol.prototype?"symbol":typeof V})(ge)}var N,j;N=void 0,j=function(ge){var V=Object.prototype.toString;function Q(k){return V.call(k).endsWith("Array]")}function z(k){var y,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!Q(k))throw new Error;if(0===k.length)throw new Error;if(void 0!==u.output){if(!Q(u.output))throw new Error;y=u.output}else y=new Array(k.length);var f=function(yt){var Tt=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!Q(yt))throw new Error;if(0===yt.length)throw new Error;var _t=Tt.fromIndex,Pt=void 0===_t?0:_t,It=Tt.toIndex,Bt=void 0===It?yt.length:It;if(Pt<0||Pt>=yt.length||!Number.isInteger(Pt))throw new Error;if(Bt<=Pt||Bt>yt.length||!Number.isInteger(Bt))throw new Error;for(var An=yt[Pt],ct=Pt+1;ct<Bt;ct++)yt[ct]<An&&(An=yt[ct]);return An}(k),M=function(yt){var Tt=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!Q(yt))throw new Error;if(0===yt.length)throw new Error;var _t=Tt.fromIndex,Pt=void 0===_t?0:_t,It=Tt.toIndex,Bt=void 0===It?yt.length:It;if(Pt<0||Pt>=yt.length||!Number.isInteger(Pt))throw new Error;if(Bt<=Pt||Bt>yt.length||!Number.isInteger(Bt))throw new Error;for(var An=yt[Pt],ct=Pt+1;ct<Bt;ct++)yt[ct]>An&&(An=yt[ct]);return An}(k);if(f===M)throw new Error;var F=u.min,de=void 0===F?u.autoMinMax?f:0:F,he=u.max,re=void 0===he?u.autoMinMax?M:1:he;if(de>=re)throw new Error;for(var et=(re-de)/(M-f),Ke=0;Ke<k.length;Ke++)y[Ke]=(k[Ke]-f)*et+de;return y}var B=" ".repeat(2),Te=" ".repeat(4);function Fe(k){var y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},u=y.zzgs,f=void 0===u?15:u,M=y.zzks,F=void 0===M?10:M,de=y.zzo3,he=void 0===de?8:de;return"".concat(k.constructor.name," {\\n").concat(B,"[\\n").concat(Te).concat(function(re,et,Ke,yt){for(var Tt=re.zzk2,_t=re.zzj2,Pt=Math.min(Tt,et),It=Math.min(_t,Ke),Bt=[],An=0;An<Pt;An++){for(var ct=[],Ai=0;Ai<It;Ai++)ct.push(te(re.get(An,Ai),yt));Bt.push("".concat(ct.join(" ")))}return It!==_t&&(Bt[Bt.length-1]+=" ... ".concat(_t-Ke," more zzj2")),Pt!==Tt&&Bt.push("... ".concat(Tt-et," more zzk2")),Bt.join("\\n".concat(Te))}(k,f,F,he),"\\n").concat(B,"]\\n").concat(B,"zzk2: ").concat(k.zzk2,"\\n").concat(B,"zzj2: ").concat(k.zzj2,"\\n}")}function te(k,y){var u=String(k);if(u.length<=y)return u.padEnd(y," ");var f=k.toPrecision(y-2);if(f.length<=y)return f;var M=k.zzP3(y-2),F=M.indexOf("e"),de=M.slice(F);return M.slice(0,y-de.length)+de}function He(k,y,u){if(y<0||y>(u?k.zzk2:k.zzk2-1))throw new Error}function rt(k,y,u){if(y<0||y>(u?k.zzj2:k.zzj2-1))throw new Error}function I(k,y){if(y.zzC&&(y=y.zzC()),y.length!==k.zzj2)throw new Error;return y}function oe(k,y){if(y.zzC&&(y=y.zzC()),y.length!==k.zzk2)throw new Error;return y}function Ze(k,y,u){return{row:function(f,M){if("object"!=Ce(M))throw new Error;if(M.some(function(F){return F<0||F>=f.zzk2}))throw new Error;return Array.isArray(M)||(M=Array.from(M)),M}(k,y),zz23:function(f,M){if("object"!=Ce(M))throw new Error;if(M.some(function(F){return F<0||F>=f.zzj2}))throw new Error;return Array.isArray(M)||(M=Array.from(M)),M}(k,u)}}function Et(k,y,u,f,M){if(5!==arguments.length)throw new Error;if(Kn("zz0",y),Kn("zz1",u),Kn("zz2",f),Kn("zz3",M),y>u||f>M||y<0||y>=k.zzk2||u<0||u>=k.zzk2||f<0||f>=k.zzj2||M<0||M>=k.zzj2)throw new Error}function Ht(k){for(var y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,u=[],f=0;f<k;f++)u.push(y);return u}function Kn(k,y){if("number"!=typeof y)throw new Error("".concat(k," must be a number"))}function hi(k){if(k.zzu3())throw new Error}var Zt=function(){function k(){we(this,k)}return xe(k,[{key:"apply",value:function(y){if("function"!=typeof y)throw new Error;for(var u=0;u<this.zzk2;u++)for(var f=0;f<this.zzj2;f++)y.call(this,u,f);return this}},{key:"zzC",value:function(){for(var y=[],u=0;u<this.zzk2;u++)for(var f=0;f<this.zzj2;f++)y.push(this.get(u,f));return y}},{key:"zzD",value:function(){for(var y=[],u=0;u<this.zzk2;u++){y.push([]);for(var f=0;f<this.zzj2;f++)y[u].push(this.get(u,f))}return y}},{key:"toJSON",value:function(){return this.zzD()}},{key:"zzE",value:function(){return 1===this.zzk2}},{key:"zzF",value:function(){return 1===this.zzj2}},{key:"zzG",value:function(){return 1===this.zzk2||1===this.zzj2}},{key:"zzH",value:function(){return this.zzk2===this.zzj2}},{key:"zzu3",value:function(){return 0===this.zzk2||0===this.zzj2}},{key:"zzI",value:function(){if(this.zzH()){for(var y=0;y<this.zzk2;y++)for(var u=0;u<=y;u++)if(this.get(y,u)!==this.get(u,y))return!1;return!0}return!1}},{key:"zzJ",value:function(){for(var y=0,u=0,f=-1,M=!0,F=!1;y<this.zzk2&&M;){for(u=0,F=!1;u<this.zzj2&&!1===F;)0===this.get(y,u)?u++:1===this.get(y,u)&&u>f?(F=!0,f=u):(M=!1,F=!0);y++}return M}},{key:"zzK",value:function(){for(var y=0,u=0,f=-1,M=!0,F=!1;y<this.zzk2&&M;){for(u=0,F=!1;u<this.zzj2&&!1===F;)0===this.get(y,u)?u++:1===this.get(y,u)&&u>f?(F=!0,f=u):(M=!1,F=!0);for(var de=u+1;de<this.zzk2;de++)0!==this.get(y,de)&&(M=!1);y++}return M}},{key:"zzv3",value:function(){for(var y=this.clone(),u=0,f=0;u<y.zzk2&&f<y.zzj2;){for(var M=u,F=u;F<y.zzk2;F++)y.get(F,f)>y.get(M,f)&&(M=F);if(0===y.get(M,f))f++;else{y.zzP(u,M);for(var de=y.get(u,f),he=f;he<y.zzj2;he++)y.set(u,he,y.get(u,he)/de);for(var re=u+1;re<y.zzk2;re++){var et=y.get(re,f)/y.get(u,f);y.set(re,f,0);for(var Ke=f+1;Ke<y.zzj2;Ke++)y.set(re,Ke,y.get(re,Ke)-y.get(u,Ke)*et)}u++,f++}}return y}},{key:"reducedEchelonForm",value:function(){for(var y=this.zzv3(),u=y.zzj2,f=y.zzk2,M=f-1;M>=0;)if(0===y.zzg(M))M--;else{for(var F=0,de=!1;F<f&&!1===de;)1===y.get(M,F)?de=!0:F++;for(var he=0;he<M;he++)for(var re=y.get(he,F),et=F;et<u;et++){var Ke=y.get(he,et)-re*y.get(M,et);y.set(he,et,Ke)}M--}return y}},{key:"set",value:function(){throw new Error}},{key:"get",value:function(){throw new Error}},{key:"repeat",value:function(){var y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("object"!=Ce(y))throw new Error;var u=y.zzk2,f=void 0===u?1:u,M=y.zzj2,F=void 0===M?1:M;if(!Number.isInteger(f)||f<=0)throw new Error;if(!Number.isInteger(F)||F<=0)throw new Error;for(var de=new pn(this.zzk2*f,this.zzj2*F),he=0;he<f;he++)for(var re=0;re<F;re++)de.zz61(this,this.zzk2*he,this.zzj2*re);return de}},{key:"zzL",value:function(y){for(var u=0;u<this.zzk2;u++)for(var f=0;f<this.zzj2;f++)this.set(u,f,y);return this}},{key:"neg",value:function(){return this.mulS(-1)}},{key:"zzM",value:function(y){He(this,y);for(var u=[],f=0;f<this.zzj2;f++)u.push(this.get(y,f));return u}},{key:"zzMVector",value:function(y){return pn.zzE1(this.zzM(y))}},{key:"zzO",value:function(y,u){He(this,y),u=I(this,u);for(var f=0;f<this.zzj2;f++)this.set(y,f,u[f]);return this}},{key:"zzP",value:function(y,u){He(this,y),He(this,u);for(var f=0;f<this.zzj2;f++){var M=this.get(y,f);this.set(y,f,this.get(u,f)),this.set(u,f,M)}return this}},{key:"zzQ",value:function(y){rt(this,y);for(var u=[],f=0;f<this.zzk2;f++)u.push(this.get(f,y));return u}},{key:"zzQVector",value:function(y){return pn.zzF1(this.zzQ(y))}},{key:"zzS",value:function(y,u){rt(this,y),u=oe(this,u);for(var f=0;f<this.zzk2;f++)this.set(f,y,u[f]);return this}},{key:"zzT",value:function(y,u){rt(this,y),rt(this,u);for(var f=0;f<this.zzk2;f++){var M=this.get(f,y);this.set(f,y,this.get(f,u)),this.set(f,u,M)}return this}},{key:"zzU",value:function(y){y=I(this,y);for(var u=0;u<this.zzk2;u++)for(var f=0;f<this.zzj2;f++)this.set(u,f,this.get(u,f)+y[f]);return this}},{key:"zzV",value:function(y){y=I(this,y);for(var u=0;u<this.zzk2;u++)for(var f=0;f<this.zzj2;f++)this.set(u,f,this.get(u,f)-y[f]);return this}},{key:"zzW",value:function(y){y=I(this,y);for(var u=0;u<this.zzk2;u++)for(var f=0;f<this.zzj2;f++)this.set(u,f,this.get(u,f)*y[f]);return this}},{key:"zzX",value:function(y){y=I(this,y);for(var u=0;u<this.zzk2;u++)for(var f=0;f<this.zzj2;f++)this.set(u,f,this.get(u,f)/y[f]);return this}},{key:"zzY",value:function(y){y=oe(this,y);for(var u=0;u<this.zzk2;u++)for(var f=0;f<this.zzj2;f++)this.set(u,f,this.get(u,f)+y[u]);return this}},{key:"zzZ",value:function(y){y=oe(this,y);for(var u=0;u<this.zzk2;u++)for(var f=0;f<this.zzj2;f++)this.set(u,f,this.get(u,f)-y[u]);return this}},{key:"zza",value:function(y){y=oe(this,y);for(var u=0;u<this.zzk2;u++)for(var f=0;f<this.zzj2;f++)this.set(u,f,this.get(u,f)*y[u]);return this}},{key:"zzb",value:function(y){y=oe(this,y);for(var u=0;u<this.zzk2;u++)for(var f=0;f<this.zzj2;f++)this.set(u,f,this.get(u,f)/y[u]);return this}},{key:"zzc",value:function(y,u){He(this,y);for(var f=0;f<this.zzj2;f++)this.set(y,f,this.get(y,f)*u);return this}},{key:"zzd",value:function(y,u){rt(this,y);for(var f=0;f<this.zzk2;f++)this.set(f,y,this.get(f,y)*u);return this}},{key:"max",value:function(){if(this.zzu3())return NaN;for(var y=this.get(0,0),u=0;u<this.zzk2;u++)for(var f=0;f<this.zzj2;f++)this.get(u,f)>y&&(y=this.get(u,f));return y}},{key:"zze",value:function(){hi(this);for(var y=this.get(0,0),u=[0,0],f=0;f<this.zzk2;f++)for(var M=0;M<this.zzj2;M++)this.get(f,M)>y&&(y=this.get(f,M),u[0]=f,u[1]=M);return u}},{key:"min",value:function(){if(this.zzu3())return NaN;for(var y=this.get(0,0),u=0;u<this.zzk2;u++)for(var f=0;f<this.zzj2;f++)this.get(u,f)<y&&(y=this.get(u,f));return y}},{key:"zzf",value:function(){hi(this);for(var y=this.get(0,0),u=[0,0],f=0;f<this.zzk2;f++)for(var M=0;M<this.zzj2;M++)this.get(f,M)<y&&(y=this.get(f,M),u[0]=f,u[1]=M);return u}},{key:"zzg",value:function(y){if(He(this,y),this.zzu3())return NaN;for(var u=this.get(y,0),f=1;f<this.zzj2;f++)this.get(y,f)>u&&(u=this.get(y,f));return u}},{key:"zzgIndex",value:function(y){He(this,y),hi(this);for(var u=this.get(y,0),f=[y,0],M=1;M<this.zzj2;M++)this.get(y,M)>u&&(u=this.get(y,M),f[1]=M);return f}},{key:"zzi",value:function(y){if(He(this,y),this.zzu3())return NaN;for(var u=this.get(y,0),f=1;f<this.zzj2;f++)this.get(y,f)<u&&(u=this.get(y,f));return u}},{key:"zziIndex",value:function(y){He(this,y),hi(this);for(var u=this.get(y,0),f=[y,0],M=1;M<this.zzj2;M++)this.get(y,M)<u&&(u=this.get(y,M),f[1]=M);return f}},{key:"zzk",value:function(y){if(rt(this,y),this.zzu3())return NaN;for(var u=this.get(0,y),f=1;f<this.zzk2;f++)this.get(f,y)>u&&(u=this.get(f,y));return u}},{key:"zzkIndex",value:function(y){rt(this,y),hi(this);for(var u=this.get(0,y),f=[0,y],M=1;M<this.zzk2;M++)this.get(M,y)>u&&(u=this.get(M,y),f[0]=M);return f}},{key:"zzm",value:function(y){if(rt(this,y),this.zzu3())return NaN;for(var u=this.get(0,y),f=1;f<this.zzk2;f++)this.get(f,y)<u&&(u=this.get(f,y));return u}},{key:"zzmIndex",value:function(y){rt(this,y),hi(this);for(var u=this.get(0,y),f=[0,y],M=1;M<this.zzk2;M++)this.get(M,y)<u&&(u=this.get(M,y),f[0]=M);return f}},{key:"zzo",value:function(){for(var y=Math.min(this.zzk2,this.zzj2),u=[],f=0;f<y;f++)u.push(this.get(f,f));return u}},{key:"zzp",value:function(){var y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"zzw3",u=0;if("max"===y)return this.max();if("zzw3"===y){for(var f=0;f<this.zzk2;f++)for(var M=0;M<this.zzj2;M++)u+=this.get(f,M)*this.get(f,M);return Math.sqrt(u)}throw new Error("unknown zzp type: ".concat(y))}},{key:"zzq",value:function(){for(var y=0,u=0;u<this.zzk2;u++)for(var f=0;f<this.zzj2;f++)y+=this.get(u,f),this.set(u,f,y);return this}},{key:"dot",value:function(y){k.zzM1(y)&&(y=y.zzC());var u=this.zzC();if(u.length!==y.length)throw new Error;for(var f=0,M=0;M<u.length;M++)f+=u[M]*y[M];return f}},{key:"zzr",value:function(y){y=pn.zzL1(y);var u=new pn(this.zzk2,y.zzj2);return this.zzr2(y,u),u}},{key:"zzr2",value:function(y,u){var f=this.zzk2,M=this.zzj2,F=y.zzj2;this.Bcolj=this.Bcolj||new Float32Array(M);for(var de=this.Bcolj,he=0;he<F;he++){for(var re=0;re<M;re++)de[re]=y.get(re,he);for(var et=0;et<f;et++){for(var Ke=0,yt=0;yt<M;yt++)Ke+=this.get(et,yt)*de[yt];u.set(et,he,Ke)}}}},{key:"zzs",value:function(y){y=pn.zzL1(y);var u=new pn(2,2),f=this.get(0,0),M=y.get(0,0),F=this.get(0,1),de=y.get(0,1),he=this.get(1,0),re=y.get(1,0),et=this.get(1,1),Ke=y.get(1,1),yt=(f+et)*(M+Ke),Tt=(he+et)*M,_t=f*(de-Ke),Pt=et*(re-M),It=(f+F)*Ke,An=_t+It,ct=Tt+Pt,Ai=yt-Tt+_t+(he-f)*(M+de);return u.set(0,0,yt+Pt-It+(F-et)*(re+Ke)),u.set(0,1,An),u.set(1,0,ct),u.set(1,1,Ai),u}},{key:"zzt",value:function(y){y=pn.zzL1(y);var u=new pn(3,3),f=this.get(0,0),M=this.get(0,1),F=this.get(0,2),de=this.get(1,0),he=this.get(1,1),re=this.get(1,2),et=this.get(2,0),Ke=this.get(2,1),yt=this.get(2,2),Tt=y.get(0,0),_t=y.get(0,1),Pt=y.get(0,2),It=y.get(1,0),Bt=y.get(1,1),An=y.get(1,2),ct=y.get(2,0),Ai=y.get(2,1),Gn=y.get(2,2),ir=(f-de)*(-_t+Bt),lt=(-f+de+he)*(Tt-_t+Bt),hn=(de+he)*(-Tt+_t),ii=f*Tt,wn=(-f+et+Ke)*(Tt-Pt+An),Qi=(-f+et)*(Pt-An),kr=(et+Ke)*(-Tt+Pt),Gr=(-F+Ke+yt)*(Bt+ct-Ai),Vr=(F-yt)*(Bt-Ai),dr=F*ct,Wr=(Ke+yt)*(-ct+Ai),ur=(-F+he+re)*(An+ct-Gn),Nr=(F-re)*(An-Gn),pr=(he+re)*(-ct+Gn),Mr=(f+M+F-de-he-Ke-yt)*Bt+lt+hn+ii+Gr+dr+Wr,ca=ii+wn+kr+(f+M+F-he-re-et-Ke)*An+dr+ur+pr,Di=ir+he*(-Tt+_t+It-Bt-An-ct+Gn)+lt+ii+dr+ur+Nr,ws=ir+lt+hn+ii+re*Ai,ks=dr+ur+Nr+pr+de*Pt,Gs=ii+wn+Qi+Ke*(-Tt+Pt+It-Bt-An-ct+Ai)+Gr+Vr+dr,Ss=Gr+Vr+dr+Wr+et*_t,Vs=ii+wn+Qi+kr+yt*Gn;return u.set(0,0,ii+dr+M*It),u.set(0,1,Mr),u.set(0,2,ca),u.set(1,0,Di),u.set(1,1,ws),u.set(1,2,ks),u.set(2,0,Gs),u.set(2,1,Ss),u.set(2,2,Vs),u}},{key:"zzrStrassen",value:function(y){y=pn.zzL1(y);var u=this.clone(),M=u.zzj2,de=y.zzj2;function he(Ke,yt,Tt){return Ke.zzk2===yt&&Ke.zzj2===Tt?Ke:k.zzG1(yt,Tt).zz61(Ke,0,0)}var re=Math.max(u.zzk2,y.zzk2),et=Math.max(M,de);return function Ke(yt,Tt,_t,Pt){if(_t<=512||Pt<=512)return yt.zzr(Tt);_t%2==1&&Pt%2==1?(yt=he(yt,_t+1,Pt+1),Tt=he(Tt,_t+1,Pt+1)):_t%2==1?(yt=he(yt,_t+1,Pt),Tt=he(Tt,_t+1,Pt)):Pt%2==1&&(yt=he(yt,_t,Pt+1),Tt=he(Tt,_t,Pt+1));var It=parseInt(yt.zzk2/2,10),Bt=parseInt(yt.zzj2/2,10),An=yt.zz31(0,It-1,0,Bt-1),ct=Tt.zz31(0,It-1,0,Bt-1),Ai=yt.zz31(0,It-1,Bt,yt.zzj2-1),Gn=Tt.zz31(0,It-1,Bt,Tt.zzj2-1),ir=yt.zz31(It,yt.zzk2-1,0,Bt-1),lt=Tt.zz31(It,Tt.zzk2-1,0,Bt-1),hn=yt.zz31(It,yt.zzk2-1,Bt,yt.zzj2-1),ii=Tt.zz31(It,Tt.zzk2-1,Bt,Tt.zzj2-1),wn=Ke(k.add(An,hn),k.add(ct,ii),It,Bt),Qi=Ke(k.add(ir,hn),ct,It,Bt),kr=Ke(An,k.sub(Gn,ii),It,Bt),Gr=Ke(hn,k.sub(lt,ct),It,Bt),Vr=Ke(k.add(An,Ai),ii,It,Bt),dr=Ke(k.sub(ir,An),k.add(ct,Gn),It,Bt),Wr=Ke(k.sub(Ai,hn),k.add(lt,ii),It,Bt),ur=k.add(wn,Gr);ur.sub(Vr),ur.add(Wr);var Nr=k.add(kr,Vr),pr=k.add(Qi,Gr),$n=k.sub(wn,Qi);$n.add(kr),$n.add(dr);var Mr=k.zzG1(2*ur.zzk2,2*ur.zzj2);return(Mr=(Mr=(Mr=(Mr=Mr.zz61(ur,0,0)).zz61(Nr,ur.zzk2,0)).zz61(pr,0,ur.zzj2)).zz61($n,ur.zzk2,ur.zzj2)).zz31(0,_t-1,0,Pt-1)}(u=he(u,re,et),y=he(y,re,et),re,et)}},{key:"zzv",value:function(){var y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("object"!=Ce(y))throw new Error;var u=y.min,f=void 0===u?0:u,M=y.max,F=void 0===M?1:M;if(!Number.isFinite(f))throw new Error;if(!Number.isFinite(F))throw new Error;if(f>=F)throw new Error;for(var de=new pn(this.zzk2,this.zzj2),he=0;he<this.zzk2;he++){var re=this.zzM(he);re.length>0&&z(re,{min:f,max:F,output:re}),de.zzO(he,re)}return de}},{key:"zzw",value:function(){var y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("object"!=Ce(y))throw new Error;var u=y.min,f=void 0===u?0:u,M=y.max,F=void 0===M?1:M;if(!Number.isFinite(f))throw new Error;if(!Number.isFinite(F))throw new Error;if(f>=F)throw new Error;for(var de=new pn(this.zzk2,this.zzj2),he=0;he<this.zzj2;he++){var re=this.zzQ(he);re.length&&z(re,{min:f,max:F,output:re}),de.zzS(he,re)}return de}},{key:"zzx",value:function(){for(var y=Math.ceil(this.zzj2/2),u=0;u<this.zzk2;u++)for(var f=0;f<y;f++){var M=this.get(u,f),F=this.get(u,this.zzj2-1-f);this.set(u,f,F),this.set(u,this.zzj2-1-f,M)}return this}},{key:"zzy",value:function(){for(var y=Math.ceil(this.zzk2/2),u=0;u<this.zzj2;u++)for(var f=0;f<y;f++){var M=this.get(f,u),F=this.get(this.zzk2-1-f,u);this.set(f,u,F),this.set(this.zzk2-1-f,u,M)}return this}},{key:"zzz",value:function(y){y=pn.zzL1(y);for(var u=this.zzk2,f=this.zzj2,M=y.zzk2,F=y.zzj2,de=new pn(u*M,f*F),he=0;he<u;he++)for(var re=0;re<f;re++)for(var et=0;et<M;et++)for(var Ke=0;Ke<F;Ke++)de.set(M*he+et,F*re+Ke,this.get(he,re)*y.get(et,Ke));return de}},{key:"kroneckerSum",value:function(y){if(y=pn.zzL1(y),!this.zzH()||!y.zzH())throw new Error;var u=this.zzk2,f=y.zzk2,M=this.zzz(pn.zzJ1(f,f)),F=pn.zzJ1(u,u).zzz(y);return M.add(F)}},{key:"zz01",value:function(){var y=new pn(this.zzj2,this.zzk2);return this.zz012(y),y}},{key:"zz012",value:function(y){for(var u=0;u<this.zzk2;u++)for(var f=0;f<this.zzj2;f++)y.set(f,u,this.get(u,f))}},{key:"zz11",value:function(){for(var y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:tt,u=0;u<this.zzk2;u++)this.zzO(u,this.zzM(u).sort(y));return this}},{key:"zz21",value:function(){for(var y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:tt,u=0;u<this.zzj2;u++)this.zzS(u,this.zzQ(u).sort(y));return this}},{key:"zz31",value:function(y,u,f,M){Et(this,y,u,f,M);for(var F=new pn(u-y+1,M-f+1),de=y;de<=u;de++)for(var he=f;he<=M;he++)F.set(de-y,he-f,this.get(de,he));return F}},{key:"zz31Row",value:function(y,u,f){if(void 0===u&&(u=0),void 0===f&&(f=this.zzj2-1),u>f||u<0||u>=this.zzj2||f<0||f>=this.zzj2)throw new Error;for(var M=new pn(y.length,f-u+1),F=0;F<y.length;F++)for(var de=u;de<=f;de++){if(y[F]<0||y[F]>=this.zzk2)throw new Error("Row index out of range: ".concat(y[F]));M.set(F,de-u,this.get(y[F],de))}return M}},{key:"zz31Column",value:function(y,u,f){if(void 0===u&&(u=0),void 0===f&&(f=this.zzk2-1),u>f||u<0||u>=this.zzk2||f<0||f>=this.zzk2)throw new Error;for(var M=new pn(f-u+1,y.length),F=0;F<y.length;F++)for(var de=u;de<=f;de++){if(y[F]<0||y[F]>=this.zzj2)throw new Error("Column index out of range: ".concat(y[F]));M.set(de-u,F,this.get(de,y[F]))}return M}},{key:"zz61",value:function(y,u,f){if((y=pn.zzL1(y)).zzu3())return this;Et(this,u,u+y.zzk2-1,f,f+y.zzj2-1);for(var M=0;M<y.zzk2;M++)for(var F=0;F<y.zzj2;F++)this.set(u+M,f+F,y.get(M,F));return this}},{key:"zz71",value:function(y,u){for(var f=Ze(this,y,u),M=new pn(y.length,u.length),F=0;F<f.row.length;F++)for(var de=f.row[F],he=0;he<f.zz23.length;he++)M.set(F,he,this.get(de,f.zz23[he]));return M}},{key:"trace",value:function(){for(var y=Math.min(this.zzk2,this.zzj2),u=0,f=0;f<y;f++)u+=this.get(f,f);return u}},{key:"copy",value:function(y){for(var u=0;u<this.zzk2;u++)for(var f=0;f<this.zzj2;f++)this.set(u,f,y.get(u,f))}},{key:"reset",value:function(){for(var y=0;y<this.zzk2;y++)for(var u=0;u<this.zzj2;u++)this.set(y,u,0)}},{key:"clone",value:function(){var y=new pn(this.zzk2,this.zzj2);return y.copy(this),y}},{key:"sum",value:function(y){switch(y){case"row":return function(u){for(var f=Ht(u.zzk2),M=0;M<u.zzk2;++M)for(var F=0;F<u.zzj2;++F)f[M]+=u.get(M,F);return f}(this);case"zz23":return function(u){for(var f=Ht(u.zzj2),M=0;M<u.zzk2;++M)for(var F=0;F<u.zzj2;++F)f[F]+=u.get(M,F);return f}(this);case void 0:return function(u){for(var f=0,M=0;M<u.zzk2;M++)for(var F=0;F<u.zzj2;F++)f+=u.get(M,F);return f}(this);default:throw new Error("inzyp13 option: ".concat(y))}}},{key:"zz81",value:function(y){switch(y){case"row":return function(u){for(var f=Ht(u.zzk2,1),M=0;M<u.zzk2;++M)for(var F=0;F<u.zzj2;++F)f[M]*=u.get(M,F);return f}(this);case"zz23":return function(u){for(var f=Ht(u.zzj2,1),M=0;M<u.zzk2;++M)for(var F=0;F<u.zzj2;++F)f[F]*=u.get(M,F);return f}(this);case void 0:return function(u){for(var f=1,M=0;M<u.zzk2;M++)for(var F=0;F<u.zzj2;F++)f*=u.get(M,F);return f}(this);default:throw new Error("inzyp13 option: ".concat(y))}}},{key:"zz91",value:function(y){var u=this.sum(y);switch(y){case"row":for(var f=0;f<this.zzk2;f++)u[f]/=this.zzj2;return u;case"zz23":for(var M=0;M<this.zzj2;M++)u[M]/=this.zzk2;return u;case void 0:return u/this.zzC1;default:throw new Error("inzyp13 option: ".concat(y))}}},{key:"zzA1",value:function(y){var u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("object"==Ce(y)&&(u=y,y=void 0),"object"!=Ce(u))throw new Error;var M=u.unbiased,F=void 0===M||M,de=u.zz91,he=void 0===de?this.zz91(y):de;if("boolean"!=typeof F)throw new Error;switch(y){case"row":if(!Array.isArray(he))throw new Error;return function(re,et,Ke){for(var yt=re.zzk2,Tt=re.zzj2,_t=[],Pt=0;Pt<yt;Pt++){for(var It=0,Bt=0,An=0,ct=0;ct<Tt;ct++)It+=An=re.get(Pt,ct)-Ke[Pt],Bt+=An*An;_t.push(et?(Bt-It*It/Tt)/(Tt-1):(Bt-It*It/Tt)/Tt)}return _t}(this,F,he);case"zz23":if(!Array.isArray(he))throw new Error;return function(re,et,Ke){for(var yt=re.zzk2,Tt=re.zzj2,_t=[],Pt=0;Pt<Tt;Pt++){for(var It=0,Bt=0,An=0,ct=0;ct<yt;ct++)It+=An=re.get(ct,Pt)-Ke[Pt],Bt+=An*An;_t.push(et?(Bt-It*It/yt)/(yt-1):(Bt-It*It/yt)/yt)}return _t}(this,F,he);case void 0:if("number"!=typeof he)throw new Error;return function(re,et,Ke){for(var yt=re.zzk2,Tt=re.zzj2,_t=yt*Tt,Pt=0,It=0,Bt=0,An=0;An<yt;An++)for(var ct=0;ct<Tt;ct++)Pt+=Bt=re.get(An,ct)-Ke,It+=Bt*Bt;return et?(It-Pt*Pt/_t)/(_t-1):(It-Pt*Pt/_t)/_t}(this,F,he);default:throw new Error("inzyp13 option: ".concat(y))}}},{key:"zzB1",value:function(y,u){"object"==Ce(y)&&(u=y,y=void 0);var f=this.zzA1(y,u);if(void 0===y)return Math.sqrt(f);for(var M=0;M<f.length;M++)f[M]=Math.sqrt(f[M]);return f}},{key:"center",value:function(y){var u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("object"==Ce(y)&&(u=y,y=void 0),"object"!=Ce(u))throw new Error;var f=u.center,M=void 0===f?this.zz91(y):f;switch(y){case"row":if(!Array.isArray(M))throw new Error;return function(F,de){for(var he=0;he<F.zzk2;he++)for(var re=0;re<F.zzj2;re++)F.set(he,re,F.get(he,re)-de[he])}(this,M),this;case"zz23":if(!Array.isArray(M))throw new Error;return function(F,de){for(var he=0;he<F.zzk2;he++)for(var re=0;re<F.zzj2;re++)F.set(he,re,F.get(he,re)-de[re])}(this,M),this;case void 0:if("number"!=typeof M)throw new Error;return function(F,de){for(var he=0;he<F.zzk2;he++)for(var re=0;re<F.zzj2;re++)F.set(he,re,F.get(he,re)-de)}(this,M),this;default:throw new Error("inzyp13 option: ".concat(y))}}},{key:"scale",value:function(y){var u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("object"==Ce(y)&&(u=y,y=void 0),"object"!=Ce(u))throw new Error;var f=u.scale;switch(y){case"row":if(void 0===f)f=function(M){for(var F=[],de=0;de<M.zzk2;de++){for(var he=0,re=0;re<M.zzj2;re++)he+=Math.pow(M.get(de,re),2)/(M.zzj2-1);F.push(Math.sqrt(he))}return F}(this);else if(!Array.isArray(f))throw new Error;return function(M,F){for(var de=0;de<M.zzk2;de++)for(var he=0;he<M.zzj2;he++)M.set(de,he,M.get(de,he)/F[de])}(this,f),this;case"zz23":if(void 0===f)f=function(M){for(var F=[],de=0;de<M.zzj2;de++){for(var he=0,re=0;re<M.zzk2;re++)he+=Math.pow(M.get(re,de),2)/(M.zzk2-1);F.push(Math.sqrt(he))}return F}(this);else if(!Array.isArray(f))throw new Error;return function(M,F){for(var de=0;de<M.zzk2;de++)for(var he=0;he<M.zzj2;he++)M.set(de,he,M.get(de,he)/F[he])}(this,f),this;case void 0:if(void 0===f)f=function(M){for(var F=M.zzC1-1,de=0,he=0;he<M.zzj2;he++)for(var re=0;re<M.zzk2;re++)de+=Math.pow(M.get(re,he),2)/F;return Math.sqrt(de)}(this);else if("number"!=typeof f)throw new Error;return function(M,F){for(var de=0;de<M.zzk2;de++)for(var he=0;he<M.zzj2;he++)M.set(de,he,M.get(de,he)/F)}(this,f),this;default:throw new Error("inzyp13 option: ".concat(y))}}},{key:"toString",value:function(y){return Fe(this,y)}},{key:"zzC1",get:function(){return this.zzk2*this.zzj2}}],[{key:"zzD1",value:function(y,u,f){if(y*u!==f.length)throw new Error;for(var M=new pn(y,u),F=0;F<y;F++)for(var de=0;de<u;de++)M.set(F,de,f[F*u+de]);return M}},{key:"zzE1",value:function(y){for(var u=new pn(1,y.length),f=0;f<y.length;f++)u.set(0,f,y[f]);return u}},{key:"zzF1",value:function(y){for(var u=new pn(y.length,1),f=0;f<y.length;f++)u.set(f,0,y[f]);return u}},{key:"zzG1",value:function(y,u){return new pn(y,u)}},{key:"zzH1",value:function(y,u){return new pn(y,u).zzL(1)}},{key:"rand",value:function(y,u){var f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("object"!=Ce(f))throw new Error;for(var M=f.random,F=void 0===M?Math.random:M,de=new pn(y,u),he=0;he<y;he++)for(var re=0;re<u;re++)de.set(he,re,F());return de}},{key:"zzI1",value:function(y,u){var f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("object"!=Ce(f))throw new Error;var M=f.min,F=void 0===M?0:M,de=f.max,he=void 0===de?1e3:de,re=f.random,et=void 0===re?Math.random:re;if(!Number.isInteger(F))throw new Error;if(!Number.isInteger(he))throw new Error;if(F>=he)throw new Error;for(var Ke=he-F,yt=new pn(y,u),Tt=0;Tt<y;Tt++)for(var _t=0;_t<u;_t++){var Pt=F+Math.round(et()*Ke);yt.set(Tt,_t,Pt)}return yt}},{key:"zzJ1",value:function(y,u,f){void 0===u&&(u=y),void 0===f&&(f=1);for(var M=Math.min(y,u),F=this.zzG1(y,u),de=0;de<M;de++)F.set(de,de,f);return F}},{key:"zzo",value:function(y,u,f){var M=y.length;void 0===u&&(u=M),void 0===f&&(f=u);for(var F=Math.min(M,u,f),de=this.zzG1(u,f),he=0;he<F;he++)de.set(he,he,y[he]);return de}},{key:"min",value:function(y,u){y=this.zzL1(y),u=this.zzL1(u);for(var f=y.zzk2,M=y.zzj2,F=new pn(f,M),de=0;de<f;de++)for(var he=0;he<M;he++)F.set(de,he,Math.min(y.get(de,he),u.get(de,he)));return F}},{key:"max",value:function(y,u){y=this.zzL1(y),u=this.zzL1(u);for(var f=y.zzk2,M=y.zzj2,F=new this(f,M),de=0;de<f;de++)for(var he=0;he<M;he++)F.set(de,he,Math.max(y.get(de,he),u.get(de,he)));return F}},{key:"zzL1",value:function(y){return k.zzM1(y)?y:new pn(y)}},{key:"zzM1",value:function(y){return null!=y&&"Matrix"===y.klass}}]),k}();function tt(k,y){return k-y}Zt.prototype.klass="Matrix",typeof Symbol<"u"&&(Zt.prototype[Symbol.for("zze3")]=function(){return Fe(this)}),Zt.random=Zt.rand,Zt.randomInt=Zt.zzI1,Zt.zzoonal=Zt.zzo,Zt.prototype.zzoonal=Zt.prototype.zzo,Zt.zzo2=Zt.zzJ1,Zt.prototype.negate=Zt.prototype.neg,Zt.prototype.zzI3=Zt.prototype.zzz;var k,y,pn=function(k){ae(u,Zt);var y=me(u);function u(f,M){var F;if(we(this,u),F=y.call(this),u.zzM1(f))return Ee(F,f.clone());if(Number.isInteger(f)&&f>=0)F.dataFlatten=new Float32Array(M*f);else{if(!Array.isArray(f))throw new Error;var de=f;if("number"!=typeof(M=(f=de.length)?de[0].length:0))F.dataFlatten=new Float32Array(de);else{F.dataFlatten=new Float32Array(M*f);for(var he=0;he<f;he++)for(var re=0;re<M;re++)F.dataFlatten[he*M+re]=de[he][re]}}return F.zzk2=f,F.zzj2=M,Ee(F)}return xe(u,[{key:"set",value:function(f,M,F){return this.dataFlatten[f*this.zzj2+M]=F,this}},{key:"get",value:function(f,M){return this.dataFlatten[f*this.zzj2+M]}},{key:"zzn3",value:function(f,M,F){this.dataFlatten[f*this.zzj2+M]+=F}},{key:"mulComponent",value:function(f,M,F){this.dataFlatten[f*this.zzj2+M]*=F}}]),u}();y=pn,(k=Zt).prototype.add=function(u){return"number"==typeof u?this.addS(u):this.addM(u)},k.prototype.addS=function(u){for(var f=0;f<this.zzk2;f++)for(var M=0;M<this.zzj2;M++)this.set(f,M,this.get(f,M)+u);return this},k.prototype.addM=function(u){if(u=y.zzL1(u),this.zzk2!==u.zzk2||this.zzj2!==u.zzj2)throw new Error;for(var f=0;f<this.zzk2;f++)for(var M=0;M<this.zzj2;M++)this.set(f,M,this.get(f,M)+u.get(f,M));return this},k.add=function(u,f){return new y(u).add(f)},k.prototype.sub=function(u){return"number"==typeof u?this.subS(u):this.subM(u)},k.prototype.subS=function(u){for(var f=0;f<this.zzk2;f++)for(var M=0;M<this.zzj2;M++)this.set(f,M,this.get(f,M)-u);return this},k.prototype.subM=function(u){if(u=y.zzL1(u),this.zzk2!==u.zzk2||this.zzj2!==u.zzj2)throw new Error;for(var f=0;f<this.zzk2;f++)for(var M=0;M<this.zzj2;M++)this.set(f,M,this.get(f,M)-u.get(f,M));return this},k.sub=function(u,f){return new y(u).sub(f)},k.prototype.subtract=k.prototype.sub,k.prototype.subtractS=k.prototype.subS,k.prototype.subtractM=k.prototype.subM,k.subtract=k.sub,k.prototype.zzi3=function(){for(var u=0;u<this.zzk2;u++)for(var f=0;f<this.zzj2;f++)this.set(u,f,0)},k.prototype.mul=function(u){return"number"==typeof u?this.mulS(u):this.mulM(u)},k.prototype.mulS=function(u){for(var f=0;f<this.zzk2;f++)for(var M=0;M<this.zzj2;M++)this.set(f,M,this.get(f,M)*u);return this},k.prototype.mulM=function(u){if(u=y.zzL1(u),this.zzk2!==u.zzk2||this.zzj2!==u.zzj2)throw new Error;for(var f=0;f<this.zzk2;f++)for(var M=0;M<this.zzj2;M++)this.set(f,M,this.get(f,M)*u.get(f,M));return this},k.mul=function(u,f){return new y(u).mul(f)},k.prototype.multiply=k.prototype.mul,k.prototype.multiplyS=k.prototype.mulS,k.prototype.multiplyM=k.prototype.mulM,k.multiply=k.mul,k.prototype.div=function(u){return"number"==typeof u?this.divS(u):this.divM(u)},k.prototype.divS=function(u){for(var f=0;f<this.zzk2;f++)for(var M=0;M<this.zzj2;M++)this.set(f,M,this.get(f,M)/u);return this},k.prototype.divM=function(u){if(u=y.zzL1(u),this.zzk2!==u.zzk2||this.zzj2!==u.zzj2)throw new Error;for(var f=0;f<this.zzk2;f++)for(var M=0;M<this.zzj2;M++)this.set(f,M,this.get(f,M)/u.get(f,M));return this},k.div=function(u,f){return new y(u).div(f)},k.prototype.divide=k.prototype.div,k.prototype.divideS=k.prototype.divS,k.prototype.divideM=k.prototype.divM,k.divide=k.div,k.prototype.mod=function(u){return"number"==typeof u?this.modS(u):this.modM(u)},k.prototype.modS=function(u){for(var f=0;f<this.zzk2;f++)for(var M=0;M<this.zzj2;M++)this.set(f,M,this.get(f,M)%u);return this},k.prototype.modM=function(u){if(u=y.zzL1(u),this.zzk2!==u.zzk2||this.zzj2!==u.zzj2)throw new Error;for(var f=0;f<this.zzk2;f++)for(var M=0;M<this.zzj2;M++)this.set(f,M,this.get(f,M)%u.get(f,M));return this},k.mod=function(u,f){return new y(u).mod(f)},k.prototype.zzO3=k.prototype.mod,k.prototype.zzO3S=k.prototype.modS,k.prototype.zzO3M=k.prototype.modM,k.zzO3=k.mod,k.prototype.and=function(u){return"number"==typeof u?this.andS(u):this.andM(u)},k.prototype.andS=function(u){for(var f=0;f<this.zzk2;f++)for(var M=0;M<this.zzj2;M++)this.set(f,M,this.get(f,M)&u);return this},k.prototype.andM=function(u){if(u=y.zzL1(u),this.zzk2!==u.zzk2||this.zzj2!==u.zzj2)throw new Error;for(var f=0;f<this.zzk2;f++)for(var M=0;M<this.zzj2;M++)this.set(f,M,this.get(f,M)&u.get(f,M));return this},k.and=function(u,f){return new y(u).and(f)},k.prototype.or=function(u){return"number"==typeof u?this.orS(u):this.orM(u)},k.prototype.orS=function(u){for(var f=0;f<this.zzk2;f++)for(var M=0;M<this.zzj2;M++)this.set(f,M,this.get(f,M)|u);return this},k.prototype.orM=function(u){if(u=y.zzL1(u),this.zzk2!==u.zzk2||this.zzj2!==u.zzj2)throw new Error;for(var f=0;f<this.zzk2;f++)for(var M=0;M<this.zzj2;M++)this.set(f,M,this.get(f,M)|u.get(f,M));return this},k.or=function(u,f){return new y(u).or(f)},k.prototype.xor=function(u){return"number"==typeof u?this.xorS(u):this.xorM(u)},k.prototype.xorS=function(u){for(var f=0;f<this.zzk2;f++)for(var M=0;M<this.zzj2;M++)this.set(f,M,this.get(f,M)^u);return this},k.prototype.xorM=function(u){if(u=y.zzL1(u),this.zzk2!==u.zzk2||this.zzj2!==u.zzj2)throw new Error;for(var f=0;f<this.zzk2;f++)for(var M=0;M<this.zzj2;M++)this.set(f,M,this.get(f,M)^u.get(f,M));return this},k.xor=function(u,f){return new y(u).xor(f)},k.prototype.zzQ3=function(u){return"number"==typeof u?this.zzQ3S(u):this.zzQ3M(u)},k.prototype.zzQ3S=function(u){for(var f=0;f<this.zzk2;f++)for(var M=0;M<this.zzj2;M++)this.set(f,M,this.get(f,M)<<u);return this},k.prototype.zzQ3M=function(u){if(u=y.zzL1(u),this.zzk2!==u.zzk2||this.zzj2!==u.zzj2)throw new Error;for(var f=0;f<this.zzk2;f++)for(var M=0;M<this.zzj2;M++)this.set(f,M,this.get(f,M)<<u.get(f,M));return this},k.zzQ3=function(u,f){return new y(u).zzQ3(f)},k.prototype.zzJ3=function(u){return"number"==typeof u?this.zzJ3S(u):this.zzJ3M(u)},k.prototype.zzJ3S=function(u){for(var f=0;f<this.zzk2;f++)for(var M=0;M<this.zzj2;M++)this.set(f,M,this.get(f,M)>>u);return this},k.prototype.zzJ3M=function(u){if(u=y.zzL1(u),this.zzk2!==u.zzk2||this.zzj2!==u.zzj2)throw new Error;for(var f=0;f<this.zzk2;f++)for(var M=0;M<this.zzj2;M++)this.set(f,M,this.get(f,M)>>u.get(f,M));return this},k.zzJ3=function(u,f){return new y(u).zzJ3(f)},k.prototype.zzL3=function(u){return"number"==typeof u?this.zzL3S(u):this.zzL3M(u)},k.prototype.zzL3S=function(u){for(var f=0;f<this.zzk2;f++)for(var M=0;M<this.zzj2;M++)this.set(f,M,this.get(f,M)>>>u);return this},k.prototype.zzL3M=function(u){if(u=y.zzL1(u),this.zzk2!==u.zzk2||this.zzj2!==u.zzj2)throw new Error;for(var f=0;f<this.zzk2;f++)for(var M=0;M<this.zzj2;M++)this.set(f,M,this.get(f,M)>>>u.get(f,M));return this},k.zzL3=function(u,f){return new y(u).zzL3(f)},k.prototype.zzK3=k.prototype.zzL3,k.prototype.zzK3S=k.prototype.zzL3S,k.prototype.zzK3M=k.prototype.zzL3M,k.zzK3=k.zzL3,k.prototype.not=function(){for(var u=0;u<this.zzk2;u++)for(var f=0;f<this.zzj2;f++)this.set(u,f,~this.get(u,f));return this},k.not=function(u){return new y(u).not()},k.prototype.abs=function(){for(var u=0;u<this.zzk2;u++)for(var f=0;f<this.zzj2;f++)this.set(u,f,Math.abs(this.get(u,f)));return this},k.abs=function(u){return new y(u).abs()},k.prototype.acos=function(){for(var u=0;u<this.zzk2;u++)for(var f=0;f<this.zzj2;f++)this.set(u,f,Math.acos(this.get(u,f)));return this},k.acos=function(u){return new y(u).acos()},k.prototype.zzM3=function(){for(var u=0;u<this.zzk2;u++)for(var f=0;f<this.zzj2;f++)this.set(u,f,Math.zzM3(this.get(u,f)));return this},k.zzM3=function(u){return new y(u).zzM3()},k.prototype.asin=function(){for(var u=0;u<this.zzk2;u++)for(var f=0;f<this.zzj2;f++)this.set(u,f,Math.asin(this.get(u,f)));return this},k.asin=function(u){return new y(u).asin()},k.prototype.zzN3=function(){for(var u=0;u<this.zzk2;u++)for(var f=0;f<this.zzj2;f++)this.set(u,f,Math.zzN3(this.get(u,f)));return this},k.zzN3=function(u){return new y(u).zzN3()},k.prototype.atan=function(){for(var u=0;u<this.zzk2;u++)for(var f=0;f<this.zzj2;f++)this.set(u,f,Math.atan(this.get(u,f)));return this},k.atan=function(u){return new y(u).atan()},k.prototype.atanh=function(){for(var u=0;u<this.zzk2;u++)for(var f=0;f<this.zzj2;f++)this.set(u,f,Math.atanh(this.get(u,f)));return this},k.atanh=function(u){return new y(u).atanh()},k.prototype.cbrt=function(){for(var u=0;u<this.zzk2;u++)for(var f=0;f<this.zzj2;f++)this.set(u,f,Math.cbrt(this.get(u,f)));return this},k.cbrt=function(u){return new y(u).cbrt()},k.prototype.ceil=function(){for(var u=0;u<this.zzk2;u++)for(var f=0;f<this.zzj2;f++)this.set(u,f,Math.ceil(this.get(u,f)));return this},k.ceil=function(u){return new y(u).ceil()},k.prototype.clz32=function(){for(var u=0;u<this.zzk2;u++)for(var f=0;f<this.zzj2;f++)this.set(u,f,Math.clz32(this.get(u,f)));return this},k.clz32=function(u){return new y(u).clz32()},k.prototype.cos=function(){for(var u=0;u<this.zzk2;u++)for(var f=0;f<this.zzj2;f++)this.set(u,f,Math.cos(this.get(u,f)));return this},k.cos=function(u){return new y(u).cos()},k.prototype.cosh=function(){for(var u=0;u<this.zzk2;u++)for(var f=0;f<this.zzj2;f++)this.set(u,f,Math.cosh(this.get(u,f)));return this},k.cosh=function(u){return new y(u).cosh()},k.prototype.exp=function(){for(var u=0;u<this.zzk2;u++)for(var f=0;f<this.zzj2;f++)this.set(u,f,Math.exp(this.get(u,f)));return this},k.exp=function(u){return new y(u).exp()},k.prototype.expm1=function(){for(var u=0;u<this.zzk2;u++)for(var f=0;f<this.zzj2;f++)this.set(u,f,Math.expm1(this.get(u,f)));return this},k.expm1=function(u){return new y(u).expm1()},k.prototype.floor=function(){for(var u=0;u<this.zzk2;u++)for(var f=0;f<this.zzj2;f++)this.set(u,f,Math.floor(this.get(u,f)));return this},k.floor=function(u){return new y(u).floor()},k.prototype.fround=function(){for(var u=0;u<this.zzk2;u++)for(var f=0;f<this.zzj2;f++)this.set(u,f,Math.fround(this.get(u,f)));return this},k.fround=function(u){return new y(u).fround()},k.prototype.log=function(){for(var u=0;u<this.zzk2;u++)for(var f=0;f<this.zzj2;f++)this.set(u,f,Math.log(this.get(u,f)));return this},k.log=function(u){return new y(u).log()},k.prototype.log1p=function(){for(var u=0;u<this.zzk2;u++)for(var f=0;f<this.zzj2;f++)this.set(u,f,Math.log1p(this.get(u,f)));return this},k.log1p=function(u){return new y(u).log1p()},k.prototype.log10=function(){for(var u=0;u<this.zzk2;u++)for(var f=0;f<this.zzj2;f++)this.set(u,f,Math.log10(this.get(u,f)));return this},k.log10=function(u){return new y(u).log10()},k.prototype.log2=function(){for(var u=0;u<this.zzk2;u++)for(var f=0;f<this.zzj2;f++)this.set(u,f,Math.log2(this.get(u,f)));return this},k.log2=function(u){return new y(u).log2()},k.prototype.round=function(){for(var u=0;u<this.zzk2;u++)for(var f=0;f<this.zzj2;f++)this.set(u,f,Math.round(this.get(u,f)));return this},k.round=function(u){return new y(u).round()},k.prototype.sign=function(){for(var u=0;u<this.zzk2;u++)for(var f=0;f<this.zzj2;f++)this.set(u,f,Math.sign(this.get(u,f)));return this},k.sign=function(u){return new y(u).sign()},k.prototype.sin=function(){for(var u=0;u<this.zzk2;u++)for(var f=0;f<this.zzj2;f++)this.set(u,f,Math.sin(this.get(u,f)));return this},k.sin=function(u){return new y(u).sin()},k.prototype.sinh=function(){for(var u=0;u<this.zzk2;u++)for(var f=0;f<this.zzj2;f++)this.set(u,f,Math.sinh(this.get(u,f)));return this},k.sinh=function(u){return new y(u).sinh()},k.prototype.sqrt=function(){for(var u=0;u<this.zzk2;u++)for(var f=0;f<this.zzj2;f++)this.set(u,f,Math.sqrt(this.get(u,f)));return this},k.sqrt=function(u){return new y(u).sqrt()},k.prototype.tan=function(){for(var u=0;u<this.zzk2;u++)for(var f=0;f<this.zzj2;f++)this.set(u,f,Math.tan(this.get(u,f)));return this},k.tan=function(u){return new y(u).tan()},k.prototype.tanh=function(){for(var u=0;u<this.zzk2;u++)for(var f=0;f<this.zzj2;f++)this.set(u,f,Math.tanh(this.get(u,f)));return this},k.tanh=function(u){return new y(u).tanh()},k.prototype.trunc=function(){for(var u=0;u<this.zzk2;u++)for(var f=0;f<this.zzj2;f++)this.set(u,f,Math.trunc(this.get(u,f)));return this},k.trunc=function(u){return new y(u).trunc()},k.pow=function(u,f){return new y(u).pow(f)},k.prototype.pow=function(u){return"number"==typeof u?this.powS(u):this.powM(u)},k.prototype.powS=function(u){for(var f=0;f<this.zzk2;f++)for(var M=0;M<this.zzj2;M++)this.set(f,M,Math.pow(this.get(f,M),u));return this},k.prototype.powM=function(u){if(u=y.zzL1(u),this.zzk2!==u.zzk2||this.zzj2!==u.zzj2)throw new Error;for(var f=0;f<this.zzk2;f++)for(var M=0;M<this.zzj2;M++)this.set(f,M,Math.pow(this.get(f,M),u.get(f,M)));return this};var Os=function(k){ae(u,Zt);var y=me(u);function u(f){var M;we(this,u),(M=y.call(this)).zzk2=f.length,M.zzj2=f[0].length,M.dataFlatten=new Float32Array(M.zzk2*M.zzj2);for(var F=0;F<M.zzk2;F++)for(var de=0;de<M.zzj2;de++)M.dataFlatten[F*M.zzj2+de]=f[F][de];return M}return xe(u,[{key:"set",value:function(f,M,F){return this.dataFlatten[f*this.zzj2+M]=F,this}},{key:"get",value:function(f,M){return this.dataFlatten[f*this.zzj2+M]}}]),u}();function Ir(k,y){var u=0;return Math.abs(k)>Math.abs(y)?(u=y/k,Math.abs(k)*Math.sqrt(1+u*u)):0!==y?(u=k/y,Math.abs(y)*Math.sqrt(1+u*u)):0}var Hr=function(){function k(y){we(this,k);var u=(y=Os.zzL1(y)).zzk2,f=y.zzj2;this.QR=y.clone(),this.X=y.clone(),this.Rzzo=new Float32Array(f),this.m=u,this.n=f,this.update(y)}return xe(k,[{key:"update",value:function(y){var u,f,M,F,de=this.QR,he=this.m,re=this.n,et=this.Rzzo;for(de.copy(y),M=0;M<re;M++){var Ke=0;for(u=M;u<he;u++)Ke=Ir(Ke,de.get(u,M));if(0!==Ke){for(de.get(M,M)<0&&(Ke=-Ke),u=M;u<he;u++)de.set(u,M,de.get(u,M)/Ke);for(de.set(M,M,de.get(M,M)+1),f=M+1;f<re;f++){for(F=0,u=M;u<he;u++)F+=de.get(u,M)*de.get(u,f);for(F=-F/de.get(M,M),u=M;u<he;u++)de.set(u,f,de.get(u,f)+F*de.get(u,M))}}et[M]=-Ke}}},{key:"solve",value:function(y){var u=this.QR,f=u.zzk2,M=y.zzj2,F=this.X;F.copy(y);var de,he,re,et,Ke=u.zzj2;for(re=0;re<Ke;re++)for(he=0;he<M;he++){for(et=0,de=re;de<f;de++)et+=u.get(de,re)*F.get(de,he);for(et=-et/u.get(re,re),de=re;de<f;de++)F.set(de,he,F.get(de,he)+et*u.get(de,re))}for(re=Ke-1;re>=0;re--){for(he=0;he<M;he++)F.set(re,he,F.get(re,he)/this.Rzzo[re]);for(de=0;de<re;de++)for(he=0;he<M;he++)F.set(de,he,F.get(de,he)-F.get(re,he)*u.get(de,re))}return F.zz31(0,Ke-1,0,M-1)}},{key:"zzY1",value:function(){for(var y=this.QR.zzj2,u=0;u<y;u++)if(0===this.Rzzo[u])return!1;return!0}},{key:"zzW1",get:function(){var y,u,f=this.QR,M=f.zzj2,F=new pn(M,M);for(y=0;y<M;y++)for(u=0;u<M;u++)F.set(y,u,y<u?f.get(y,u):y===u?this.Rzzo[y]:0);return F}},{key:"zzZ1",get:function(){var y,u,f,M,F=this.QR,de=F.zzk2,he=F.zzj2,re=new pn(de,he);for(f=he-1;f>=0;f--){for(y=0;y<de;y++)re.set(y,f,0);for(re.set(f,f,1),u=f;u<he;u++)if(0!==F.get(f,f)){for(M=0,y=f;y<de;y++)M+=F.get(y,f)*re.get(y,u);for(M=-M/F.get(f,f),y=f;y<de;y++)re.set(y,u,re.get(y,u)+M*F.get(y,f))}}return re}}]),k}(),Hs=function(){function k(y,u){we(this,k);var f=y.zzk2,M=y.zzj2,F=Boolean(u.zzx3),de=Boolean(u.zzZ2),he=y.clone(),re=Math.min(f+1,M),et=Math.min(f,M),Ke=new Float32Array(re),yt=new pn(f,et),Tt=new pn(M,M),_t=new Float32Array(M),Pt=new Float32Array(f),It=new Float32Array(re),Bt=pn.zzG1(re,re),An=pn.zzG1(Tt.zzk2,yt.zzk2),ct=new pn(Tt.zzk2,re),Ai=new pn(Tt.zzk2,yt.zzk2);this.m=f,this.n=M,this.ni=re,this.nu=et,this.s=Ke,this.si=It,this.work=Pt,this.e=_t,this.U=yt,this.V=Tt,this.wantu=F,this.wantv=de,this.a=he,this.Ls=Bt,this.VLU=An,this.X=ct,this.Y=Ai,this.compute()}return xe(k,[{key:"zz24",value:function(y){this.a.copy(y),this.U.reset(),this.V.reset(),this.compute()}},{key:"compute",value:function(){for(var y=this.m,u=this.n,f=this.ni,M=this.nu,F=this.s,de=this.si,he=this.work,re=this.e,et=this.U,Ke=this.V,yt=this.wantu,Tt=this.wantv,_t=this.a,Pt=0;Pt<f;Pt++)de[Pt]=Pt;for(var It=Math.min(y-1,u),Bt=Math.max(0,Math.min(u-2,y)),An=Math.max(It,Bt),ct=0;ct<An;ct++){if(ct<It){F[ct]=0;for(var Ai=ct;Ai<y;Ai++)F[ct]=Ir(F[ct],_t.get(Ai,ct));if(0!==F[ct]){_t.get(ct,ct)<0&&(F[ct]=-F[ct]);for(var Gn=ct;Gn<y;Gn++)_t.set(Gn,ct,_t.get(Gn,ct)/F[ct]);_t.set(ct,ct,_t.get(ct,ct)+1)}F[ct]=-F[ct]}for(var ir=ct+1;ir<u;ir++){if(ct<It&&0!==F[ct]){for(var lt=0,hn=ct;hn<y;hn++)lt+=_t.get(hn,ct)*_t.get(hn,ir);lt=-lt/_t.get(ct,ct);for(var ii=ct;ii<y;ii++)_t.set(ii,ir,_t.get(ii,ir)+lt*_t.get(ii,ct))}re[ir]=_t.get(ct,ir)}if(yt&&ct<It)for(var wn=ct;wn<y;wn++)et.set(wn,ct,_t.get(wn,ct));if(ct<Bt){re[ct]=0;for(var Qi=ct+1;Qi<u;Qi++)re[ct]=Ir(re[ct],re[Qi]);if(0!==re[ct]){re[ct+1]<0&&(re[ct]=0-re[ct]);for(var kr=ct+1;kr<u;kr++)re[kr]/=re[ct];re[ct+1]+=1}if(re[ct]=-re[ct],ct+1<y&&0!==re[ct]){for(var Gr=ct+1;Gr<y;Gr++)he[Gr]=0;for(var Vr=ct+1;Vr<y;Vr++)for(var dr=ct+1;dr<u;dr++)he[Vr]+=re[dr]*_t.get(Vr,dr);for(var Wr=ct+1;Wr<u;Wr++)for(var ur=-re[Wr]/re[ct+1],Nr=ct+1;Nr<y;Nr++)_t.set(Nr,Wr,_t.get(Nr,Wr)+ur*he[Nr])}if(Tt)for(var pr=ct+1;pr<u;pr++)Ke.set(pr,ct,re[pr])}}var $n=Math.min(u,y+1);if(It<u&&(F[It]=_t.get(It,It)),y<$n&&(F[$n-1]=0),Bt+1<$n&&(re[Bt]=_t.get(Bt,$n-1)),re[$n-1]=0,yt){for(var Mr=It;Mr<M;Mr++){for(var ca=0;ca<y;ca++)et.set(ca,Mr,0);et.set(Mr,Mr,1)}for(var Di=It-1;Di>=0;Di--)if(0!==F[Di]){for(var ws=Di+1;ws<M;ws++){for(var ks=0,Gs=Di;Gs<y;Gs++)ks+=et.get(Gs,Di)*et.get(Gs,ws);ks=-ks/et.get(Di,Di);for(var Ss=Di;Ss<y;Ss++)et.set(Ss,ws,et.get(Ss,ws)+ks*et.get(Ss,Di))}for(var Vs=Di;Vs<y;Vs++)et.set(Vs,Di,-et.get(Vs,Di));et.set(Di,Di,1+et.get(Di,Di));for(var la=0;la<Di-1;la++)et.set(la,Di,0)}else{for(var Xr=0;Xr<y;Xr++)et.set(Xr,Di,0);et.set(Di,Di,1)}}if(Tt)for(var Mi=u-1;Mi>=0;Mi--){if(Mi<Bt&&0!==re[Mi])for(var os=Mi+1;os<u;os++){for(var jr=0,cs=Mi+1;cs<u;cs++)jr+=Ke.get(cs,Mi)*Ke.get(cs,os);jr=-jr/Ke.get(Mi+1,Mi);for(var er=Mi+1;er<u;er++)Ke.set(er,os,Ke.get(er,os)+jr*Ke.get(er,Mi))}for(var ji=0;ji<u;ji++)Ke.set(ji,Mi,0);Ke.set(Mi,Mi,1)}for(var Na=$n-1,lc=Number.EPSILON;$n>0;){var yn=void 0,$r=void 0;for(yn=$n-2;yn>=-1&&-1!==yn;yn--){var Tl=Number.MIN_VALUE+lc*Math.abs(F[yn]+Math.abs(F[yn+1]));if(Math.abs(re[yn])<=Tl||Number.isNaN(re[yn])){re[yn]=0;break}}if(yn===$n-2)$r=4;else{var Tr=void 0;for(Tr=$n-1;Tr>=yn&&Tr!==yn;Tr--){var wl=(Tr!==$n?Math.abs(re[Tr]):0)+(Tr!==yn+1?Math.abs(re[Tr-1]):0);if(Math.abs(F[Tr])<=lc*wl){F[Tr]=0;break}}Tr===yn?$r=3:Tr===$n-1?$r=1:($r=2,yn=Tr)}switch(yn++,$r){case 1:var To=re[$n-2];re[$n-2]=0;for(var Lr=$n-2;Lr>=yn;Lr--){var ua=Ir(F[Lr],To),wo=F[Lr]/ua,So=To/ua;if(F[Lr]=ua,Lr!==yn&&(To=-So*re[Lr-1],re[Lr-1]=wo*re[Lr-1]),Tt)for(var ls=0;ls<u;ls++)ua=wo*Ke.get(ls,Lr)+So*Ke.get(ls,$n-1),Ke.set(ls,$n-1,-So*Ke.get(ls,Lr)+wo*Ke.get(ls,$n-1)),Ke.set(ls,Lr,ua)}break;case 2:var Ro=re[yn-1];re[yn-1]=0;for(var wr=yn;wr<$n;wr++){var Ws=Ir(F[wr],Ro),Ua=F[wr]/Ws,Ao=Ro/Ws;if(F[wr]=Ws,Ro=-Ao*re[wr],re[wr]=Ua*re[wr],yt)for(var Qr=0;Qr<y;Qr++)Ws=Ua*et.get(Qr,wr)+Ao*et.get(Qr,yn-1),et.set(Qr,yn-1,-Ao*et.get(Qr,wr)+Ua*et.get(Qr,yn-1)),et.set(Qr,wr,Ws)}break;case 3:var st=Math.max(Math.abs(F[$n-1]),Math.abs(F[$n-2]),Math.abs(re[$n-2]),Math.abs(F[yn]),Math.abs(re[yn])),Ii=F[$n-1]/st,zo=F[$n-2]/st,Ba=re[$n-2]/st,us=F[yn]/st,Oa=re[yn]/st,Cr=((zo+Ii)*(zo-Ii)+Ba*Ba)/2,qr=Ii*Ba*(Ii*Ba),Lo=0;0===Cr&&0===qr||(Lo=qr/(Cr+(Lo=Cr<0?0-Math.sqrt(Cr*Cr+qr):Math.sqrt(Cr*Cr+qr))));for(var zi=(us+Ii)*(us-Ii)+Lo,hs=us*Oa,rn=yn;rn<$n-1;rn++){var Li=Ir(zi,hs);0===Li&&(Li=Number.MIN_VALUE);var Pr=zi/Li,mr=hs/Li;if(rn!==yn&&(re[rn-1]=Li),zi=Pr*F[rn]+mr*re[rn],re[rn]=Pr*re[rn]-mr*F[rn],hs=mr*F[rn+1],F[rn+1]=Pr*F[rn+1],Tt)for(var Ni=0;Ni<u;Ni++)Li=Pr*Ke.get(Ni,rn)+mr*Ke.get(Ni,rn+1),Ke.set(Ni,rn+1,-mr*Ke.get(Ni,rn)+Pr*Ke.get(Ni,rn+1)),Ke.set(Ni,rn,Li);if(0===(Li=Ir(zi,hs))&&(Li=Number.MIN_VALUE),Pr=zi/Li,mr=hs/Li,F[rn]=Li,zi=Pr*re[rn]+mr*F[rn+1],F[rn+1]=-mr*re[rn]+Pr*F[rn+1],hs=mr*re[rn+1],re[rn+1]=Pr*re[rn+1],yt&&rn<y-1)for(var O=0;O<y;O++)Li=Pr*et.get(O,rn)+mr*et.get(O,rn+1),et.set(O,rn+1,-mr*et.get(O,rn)+Pr*et.get(O,rn+1)),et.set(O,rn,Li)}re[$n-2]=zi;break;case 4:if(F[yn]<=0&&(F[yn]=F[yn]<0?-F[yn]:0,Tt))for(var Xs=0;Xs<=Na;Xs++)Ke.set(Xs,yn,-Ke.get(Xs,yn));for(;yn<Na&&!(F[yn]>=F[yn+1]);){var js=F[yn];if(F[yn]=F[yn+1],F[yn+1]=js,Tt&&yn<u-1)for(var Ji=0;Ji<u;Ji++)js=Ke.get(Ji,yn+1),Ke.set(Ji,yn+1,Ke.get(Ji,yn)),Ke.set(Ji,yn,js);if(yt&&yn<y-1)for(var gr=0;gr<y;gr++)js=et.get(gr,yn+1),et.set(gr,yn+1,et.get(gr,yn)),et.set(gr,yn,js);yn++}$n--}}}},{key:"solve",value:function(y){for(var u=y,f=this.zzf1,M=this.s.length,F=this.Ls,de=this.VLU,he=0;he<M;he++)Math.abs(this.s[he])<=f?F.set(he,he,0):F.set(he,he,1/this.s[he]);for(var re=this.U,et=this.zzh1,Ke=et.zzr(F),yt=et.zzk2,Tt=re.zzk2,_t=0;_t<yt;_t++)for(var Pt=0;Pt<Tt;Pt++){for(var It=0,Bt=0;Bt<M;Bt++)It+=Ke.get(_t,Bt)*re.get(Pt,Bt);de.set(_t,Pt,It)}return de.zzr(u)}},{key:"zza1",value:function(y){return this.solve(pn.zzo(y))}},{key:"inverse",value:function(){for(var y=this.V,u=this.zzf1,f=y.zzk2,M=y.zzj2,F=this.X,de=this.Y,he=0;he<f;he++)for(var re=0;re<M;re++)Math.abs(this.s[re])>u&&F.set(he,re,y.get(he,re)/this.s[re]);for(var et=this.U,Ke=et.zzk2,yt=et.zzj2,Tt=0;Tt<f;Tt++)for(var _t=0;_t<Ke;_t++){for(var Pt=0,It=0;It<yt;It++)Pt+=F.get(Tt,It)*et.get(_t,It);de.set(Tt,_t,Pt)}return de}},{key:"zzb1",get:function(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}},{key:"zzp2",get:function(){return this.s[0]}},{key:"zzd1",get:function(){for(var y=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,u=0,f=this.s,M=0,F=f.length;M<F;M++)f[M]>y&&u++;return u}},{key:"zzoonal",get:function(){return Array.from(this.s)}},{key:"zzf1",get:function(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}},{key:"zzg1",get:function(){return this.U}},{key:"zzh1",get:function(){return this.V}},{key:"zzoonalMatrix",get:function(){return pn.zzo(this.s)}}]),k}(),Ts=[],Zi=function(k){var y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{zzj3:-1},u=y.zzj3;if(-1!==u&&Ts[u]){var f=Ts[u];return f.zz24(k),f}var M=new Hs(k,Object.assign({zzx3:!0,zzZ2:!0},y));return-1!==u&&(Ts[u]=M),M};function zr(k,y){return arguments.length>2&&void 0!==arguments[2]&&arguments[2]?Zi(k,{zzj3:arguments.length>3?arguments[3]:void 0}).solve(y):new Hr(k).solve(y)}var lr=function(k){ae(u,Zt);var y=me(u);function u(f,M,F){var de;return we(this,u),(de=y.call(this)).matrix=f,de.zzk2=M,de.zzj2=F,de}return u}(),Fn=function(k){ae(u,lr);var y=me(u);function u(f,M,F){var de;we(this,u);var he=Ze(f,M,F);return(de=y.call(this,f,he.row.length,he.zz23.length)).zzy3=he.row,de.zzl2=he.zz23,de}return xe(u,[{key:"set",value:function(f,M,F){return this.matrix.set(this.zzy3[f],this.zzl2[M],F),this}},{key:"get",value:function(f,M){return this.matrix.get(this.zzy3[f],this.zzl2[M])}}]),u}();ge.Matrix=pn,ge.QR=Hr,ge.zzT2=Hr,ge.zz92=Zi,ge.default=pn,ge.zzU1=function k(y){if(0===y.zzj2)return 1;var u,f,M,F,de,he;if(2===y.zzj2)return u=y.get(0,0),f=y.get(0,1),M=y.get(1,0),u*y.get(1,1)-f*M;if(3===y.zzj2)return F=new Fn(y,[1,2],[1,2]),de=new Fn(y,[1,2],[0,2]),he=new Fn(y,[1,2],[0,1]),u=y.get(0,0),f=y.get(0,1),M=y.get(0,2),u*k(F)-f*k(de)+M*k(he);throw new Error},ge.inverse2=function(k){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?Zi(k,{zzj3:arguments.length>2?arguments[2]:void 0}).inverse():zr(k,pn.zzJ1(k.zzk2))},ge.zzp3=zr,Object.defineProperty(ge,"zzB",{value:!0})},"object"==(void 0===ye?"undefined":Ce(ye))&&void 0!==_e?j(ye):j((N=falseThis?globalThis:N||self).mlMatrix={})},{}]},{},[2])(2)}(),qe=window.zyp,d.callbackReady&&(Pn.Sa=d.callbackReady),d.callbackTrack&&(Pn.hc=d.callbackTrack),typeof d.animateDelay<"u"&&(Pn.va=d.animateDelay),typeof d.NNCPath<"u"&&(Pn.dc=d.NNCPath),typeof d.NN<"u"&&(Pn.lb=d.NN),typeof d.followZRot<"u"&&(Pn.ya=!!d.followZRot),typeof d.isTrackingEnabled<"u"&&(Pn.Dc=!!d.isTrackingEnabled),_i=Object.create(Si.qg),d.scanSettings&&Object.assign(_i,d.scanSettings),Tn.X=_i.translationScalingFactors.slice(0),fr=Object.create(Si.Fg),d.stabilizationSettings&&Object.assign(fr,d.stabilizationSettings);var C=1;if(typeof d.maxFacesDetected<"u"&&(C=Math.max(1,d.maxFacesDetected)),C>Si.fg)return at("MAXFACES_TOOHIGH"),!1;if(yi.B({T:C,le:Si.gg,ze:Si.hg,$d:function(le){return le.isDetected}}),d.canvas)Pn.Y=d.canvas;else{if(!d.canvasId)return at("NO_CANVASID"),!1;if(Pn.Y=document.getElementById(d.canvasId),!Pn.Y)return at("INVALID_CANVASID"),!1}if(Un.o=Pn.Y.width,Un.F=Pn.Y.height,!Un.o||!Un.F)return at("INVALID_CANVASDIMENSIONS"),!1;Un.fc=Un.o/Un.F,Dn.B({de:d.isKeepRunningOnWinFocusLost||!1,cc:d.GPUBenchmarkerCallback||null,ob:Pn.va}),un.B({Rc:0,n:_i.nDetectsPerLoopRange[1]-_i.nDetectsPerLoopRange[0]+1,je:_i.nDetectsPerLoopRange[0]}),0!==_i.nDetectsPerLoop?un.bd(_i.nDetectsPerLoop):un.nd();var U=0;return d.videoSettings&&d.videoSettings.videoElement?nr(d.videoSettings.videoElement,S):null===d.videoSettings?S():(d.videoSettings&&Object.assign(Cn,d.videoSettings),Xi(d.onWebcamAsk,d.onWebcamGet,function(le){nr(le,S)})),Un.Za=xr.instance({}),en(function(le){if(!function qn(){return!!Yt.B({rb:Pn.Y,width:Un.o,height:Un.F,Zd:!1,debug:!1,Uc:function(){at("GLCONTEXT_LOST")},antialias:_i.antialias,premultipliedAlpha:!0})||(at("GL_INCOMPATIBLE"),!1)}())return!1;se.mb([{id:"s66",name:"_",sa:"attribute vec2 a0;uniform mat2 u46;varying vec2 vv0;void main(){gl_Position=vec4(a0,0.,1.),vv0=vec2(.5,.5)+u46*a0*vec2(1.,-1.);}",qb:["a0"],Qa:[2],g:"uniform sampler2D u1;varying vec2 vv0;void main(){gl_FragColor=texture2D(u1,vv0);}",i:["u1","u46"],precision:"lowp"},{id:"s64",name:"_",g:"uniform sampler2D u1;varying vec2 vv0;void main(){gl_FragColor=texture2D(u1,vv0);}",sa:"attribute vec2 a0;uniform sampler2D u47;uniform mat2 u46;uniform vec2 u48;uniform float u49,u40,u50,u51;varying vec2 vv0;void main(){vec2 f=a0;vec4 a=texture2D(u47,vec2(u40,u49));vec2 g=a.gb,b=a.a*u48;b.x*=u51;float c=cos(u50),d=sin(u50);vec2 h=mat2(c,d,-d,c)*f,i=g+.5*h*b;vv0=.5+2.*u46*(i-.5),gl_Position=vec4(a0,0.,1.);}",qb:["a0"],Qa:[2],i:"u1 u47 u48 u49 u40 u50 u51 u46".split(" "),precision:"lowp"},{id:"s63",name:"_",g:"uniform sampler2D u52,u47;uniform vec3 u53,u54;uniform float u55,u56,u49,u40,u57,u58,u50,u59;const vec4 e=vec4(.25,.25,.25,.25);void main(){float b=(u58-.5)/u58;vec4 f=texture2D(u52,vec2(3.5/u58,b));bool g=dot(f,e)>u56;vec4 a=texture2D(u47,vec2(u40,u49));a.r<-.5?a.r+=1.:g?a.r=2.:a.r>u55?a.r=0.:a.r>1.9?a.r+=1.:0.,a.r=mix(-2.,a.r,u57);if(a.r<.9)a=vec4(1.,u53);else{a.r*=step(1.9,a.r);float h=dot(e,texture2D(u52,vec2(.5/u58,b))),i=dot(e,texture2D(u52,vec2(1.5/u58,b))),j=dot(e,texture2D(u52,vec2(2.5/u58,b))),c=cos(u50),d=sin(u50);vec2 k=mat2(c,d*u59,-d/u59,c)*vec2(h,i);a.gba+=vec3(k,j)*u54*a.a;}gl_FragColor=a;}",sa:"attribute vec2 a0;void main(){gl_Position=vec4(a0,0.,1.);}",i:"u52 u47 u53 u55 u54 u57 u56 u49 u40 u58 u50 u59".split(" ")},{id:"s67",name:"_",sa:"attribute vec2 a0;void main(){gl_Position=vec4(a0,0.,1.);}",g:"uniform sampler2D u52;uniform float u58,u57;const vec4 e=vec4(.25,.25,.25,.25);void main(){float a=(u58-.5)/u58,b=dot(e,texture2D(u52,vec2(5.5/u58,a))),c=dot(e,texture2D(u52,vec2(6.5/u58,a))),d=dot(e,texture2D(u52,vec2(7.5/u58,a))),f=dot(e,texture2D(u52,vec2(3.5/u58,a)));vec3 g=vec3(b,c,d);gl_FragColor=vec4(g,f*u57);}",i:["u52","u58","u57"]},{id:"s68",name:"_",sa:"attribute vec2 a0;void main(){gl_Position=vec4(a0,0.,1.);}",g:"uniform sampler2D u52;uniform float u58;const vec4 e=vec4(.25,.25,.25,.25),h=vec4(.5,.5,.5,.5);vec2 f(float a){float b=floor(a/u58),c=a-b*u58;return vec2(c,u58-.5-b)/u58;}vec2 g(float a){vec2 b=f(a*2.),c=f(a*2.+1.);float d=dot(e,texture2D(u52,b)),i=dot(e,texture2D(u52,c));return vec2(d,i);}void main(){float a=2.*gl_FragCoord.x-2.;vec2 b=g(a-1.),c=g(a);gl_FragColor=h+.5*vec4(b,c)/1.2;}",i:["u52","u58"]},{id:"s65",name:"_",sa:"attribute vec2 a0;void main(){gl_Position=vec4(a0,0.,1.);}",g:"uniform sampler2D u52;uniform vec2 u41,u42,u43,u44,u45;const vec4 e=vec4(.25,.25,.25,.25);const float f=3.141593,g=1e-7;void main(){float b=dot(e,texture2D(u52,u41)),c=dot(e,texture2D(u52,u42))/2.,a=dot(e,texture2D(u52,u43)),d=dot(e,texture2D(u52,u44));a+=(step(0.,a)-.5)*g;float h=.5+.5*atan(d,a)/f,i=dot(e,texture2D(u52,u45));gl_FragColor=vec4(b,c,h,i);}",i:"u52 u41 u42 u43 u44 u45".split(" ")},{id:"s62",name:"_",g:"uniform sampler2D u47,u60;uniform vec2 u61;uniform float u62,u40;varying vec2 vv0;void main(){float f=step(.5,mod(gl_FragCoord.y+1.5,2.)),a=step(u40,vv0.x);vec2 d=vv0+u61;vec4 b=mix(texture2D(u60,d),texture2D(u47,d),vec4(1.,a,a,a));b.a*=mix(u62,1.,a);vec4 g=floor(255.*b),h=255.*fract(255.*b),c=mix(g,h,f)/255.;c.x=mix(step(b.x,1.5),c.x,a),gl_FragColor=c;}",i:["u47","u60","u62","u61","u40"]}]),Kt(le),S()}),!0},update:function(d){if(!Dr)return Promise.reject("NOT_READY");d.scanSettings&&Bs.set_scanSettings(d.scanSettings),d.stabilizationSettings&&Bs.set_stabilizationSettings(d.stabilizationSettings);var S=Promise.resolve();if(d.NNCPath||d.NN){for(dt(),ui=Jn.gb,ki&&ki.m(),ki=null,S=0;S<yi.za();++S)pi[S].detected=0,pi.isDetected=!1,pi[S].detectedRaw=0,br[S].Wa=0;d.NNCPath?Pn.dc=d.NNCPath:d.NN&&(Pn.lb=d.NN),S=new Promise(function(C){en(function(U){Kt(U),J(),C()})})}return S},destroy:function(){return Kr?Promise.reject("ALREADY_DESTROYING"):(Zr=null,Dr=!1,Kr=!0,Dn.m(),new Promise(function(d){Bs.toggle_pause(!0,!0).finally(function(){ki&&ki.m(),Yt.m(),ki=Ia=pi=br=null,Un.Za=null,Tn.da=null,Tn.kb=null,Qe.D=null,ui=Jn.hb,Kr=!1,d()}).catch(function(){})}))},toggle_videoStream:function(d){return Qe.Gb||!Qe.element?Promise.resolve():St.Ne(Qe.element,d,Qe.Ta)},toggle_pause:function(d,S){return ui===Jn.gb||ui===Jn.Kb?(ui=d?Jn.Kb:Jn.gb,Promise.resolve()):-1===[Jn.play,Jn.pause].indexOf(ui)?Promise.reject("NOT_READY"):(S=S?Bs.toggle_videoStream(!d):Promise.resolve(),d?dt():S.then(function(){J()}),S)},toggle_tracking:function(d){-1!==[Jn.play,Jn.pause].indexOf(ui)&&(Pn.Dc=d)},reset_GLState:function(){Yt.xe()},update_videoSettings:function(d){return ui===Jn.gb||ui===Jn.Kb||ui===Jn.hb?Promise.reject("NOT_READY"):(dt(),null===d&&null===Qe.element?Promise.resolve(null):new Promise(function(S,C){St.Ne(Qe.element,!1,Qe.Ta).then(function(){null===d?S(null):(Object.assign(Cn,d),Xi(null,null,function(U){nr(U,function(){Qe.D.wg(U),Ln(),In(),J(),S(Qe.element)})}))}).catch(C)}))},set_animateDelay:function(d){Pn.va=d,Dn.update({ob:Pn.va})},resize:function(){if(!(Qe&&Qe.element&&Pn&&Pn.Y))return!1;var d=Pn.Y.width,S=Pn.Y.height;return!(!Ti()&&d===Un.o&&S===Un.F||(Un.o=d,Un.F=S,Un.fc=Un.o/Un.F,se.O(),gt(),sn(),Ln(),In(),0))},set_inputTexture:function(d,S,C,U){Qe.H[0]=S,Qe.H[1]=C,Qe.ae=U||!1,Qe.D=W.instance({width:S,height:C,xc:d}),Qe.eb=!0,Ln(),Yt.Ac(),In()},reset_inputTexture:function(){Qe.eb=!1,Qe.D=Qe.gd,Ti(),Ln(),In()},render_video:function(){P.U(),se.O(),se.set("s66"),se.Ge("u46",Qe.ea),w.viewport(0,0,Un.o,Un.F),Qe.D.h(0),A.l(!0,!0),se.Ge("u46",Qe.A)},get_videoDevices:function(d){return St.Td(d)},get_videoUVScaleMat2:function(){return Qe.A},is_winFocus:function(){return Dn.bg()},set_scanSettings:function(d){Object.assign(_i,d),0!==_i.nDetectsPerLoop?un.bd(_i.nDetectsPerLoop):un.nd(),gt(),sn()},set_stabilizationSettings:function(d){Object.assign(fr,d)},update_videoElement:function(d,S){nr(d,function(){nn(),Ln(),In(),S&&S(Qe.D.get()),ui===Jn.Ie&&J()})},bind_croppedTextureToSampler:function(d){Un.Za.wa(d)},capture_image:function(d){return Yt.zf(d)},get_LMLabels:function(){return Pi.labels},get_widthPx:function(){return Un?Un.o:-1},get_heightPx:function(){return Un?Un.F:-1},force_animate:function(){Yt.Ac(),_n(),tn(),ti(),Qt()},reset:function(){pi.forEach(function(d){Object.assign(d,{detected:0,detectedRaw:0,isDetected:!1,x:0,y:0,s:1,rx:0,ry:0,rz:0,lAmb:0,lDir:0,lTheta:0,lPhi:0})}),Tn.da.Na(Tn.fd),Tn.kb.Na(Tn.fd),vi.reset()},is_outputLighting:function(){return Tn.ab},compute_pose:function(d,S,C,U){return null===Zr&&(hr[0]=C,hr[1]=U,Zr=new qe.zypSolver({cameraFocals:hr,zyp15:Si.Eg})),(hr[0]!==C||hr[1]!==U)&&(hr[0]=C,hr[1]=U,Zr.zyp14(hr)),{ok:(d=Zr.solve(d,S,!1)).zyp13,repError:d.repError,rotation:d.R,translation:d.t}}};return Bs}(),WEBARROCKSFACE||window.WEBARROCKSFACE);const WebARRocksFaceShape2DHelper=function(){const b={NNCPath:null,canvasVideo:null,canvasAR:null,shapes:[],videoURL:null};let Rt=null,ue=null,nt={},mt=null,Ge=-1,J=null,dt=null,$e=null,tn=null,di=null,Rn=null;const _n={};function Qt(at){if(function kn(){$e.viewport(0,0,Rt.canvasVideo.width,Rt.canvasVideo.height),$e.useProgram(_n.drawVideo.program),$e.uniformMatrix2fv(_n.drawVideo.uniforms.transformMat2,!1,di),$e.activeTexture($e.TEXTURE0),$e.bindTexture($e.TEXTURE_2D,tn),$e.drawElements($e.TRIANGLES,3,$e.UNSIGNED_SHORT,0),$e.flush()}(),J.viewport(0,0,Rt.canvasAR.width,Rt.canvasAR.height),J.clear(J.COLOR_BUFFER_BIT),mt.isFakeVideo?mt.needsUpdate&&dn():mt.currenTime===Ge?J.bindTexture(J.TEXTURE_2D,dt):dn(),at.isDetected){const qe=Rn.update(at.landmarks,Xi.get_viewWidth(),Xi.get_viewHeight(),at.s);ue.forEach(nn.bind(null,qe))}else Rn.reset();J.flush(),mt.isFakeVideo&&mt.pendingBuffer&&(mt.arrayBuffer=mt.pendingBuffer.slice(),mt.needsUpdate=!0)}function dn(){null!==dt&&(J.bindTexture(J.TEXTURE_2D,dt),mt.isFakeVideo?J.texImage2D(J.TEXTURE_2D,0,J.RGBA,mt.videoWidth,mt.videoHeight,0,J.RGBA,J.UNSIGNED_BYTE,mt.arrayBuffer):J.texImage2D(J.TEXTURE_2D,0,J.RGBA,J.RGBA,J.UNSIGNED_BYTE,mt))}function xt(at,qe,Ct,ut){const Ut=at.createShader(Ct);return at.shaderSource(Ut,qe),at.compileShader(Ut),at.getShaderParameter(Ut,at.COMPILE_STATUS)?Ut:(alert("ERROR IN "+ut+" SHADER: "+at.getShaderInfoLog(Ut)),console.log("Buggy shader source: \n",qe),null)}function sn(at,qe,Ct,ut){const Se=xt(at,qe,at.VERTEX_SHADER,"VERTEX "+ut),De=xt(at,"precision lowp float;"+Ct,at.FRAGMENT_SHADER,"FRAGMENT "+ut),Ue=at.createProgram();at.attachShader(Ue,Se),at.attachShader(Ue,De),at.linkProgram(Ue);const se=at.getAttribLocation(Ue,"position");return at.enableVertexAttribArray(se),{program:Ue,uniforms:{},attributes:{position:se}}}function en(at,qe,Ct){const ut=Object.assign({textures:[],uniforms:[]},qe);return new Promise(function(Ut,Se){const Ue=ut.iVals&&ut.iVals.length,se={vertexPars:"",vertex:"",fragmentPars:""};let w=0;if(Ue){w=ut.iVals[0].length;const Oe=["float","vec2","vec3","vec4"][w-1];se.vertexPars="attribute "+Oe+" aiVal;\n",se.vertexPars+="varying "+Oe+" iVal;\n",se.vertex="iVal = aiVal;\n",se.fragmentPars+="varying "+Oe+" iVal;\n"}const Yt=ut.textures.map(function(Oe){return function At(at){return new Promise(function(qe,Ct){const ut=new Image;ut.onload=function(){const Ut=J.createTexture();J.bindTexture(J.TEXTURE_2D,Ut),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MAG_FILTER,J.LINEAR),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MIN_FILTER,J.NEAREST_MIPMAP_LINEAR),J.pixelStorei(J.UNPACK_FLIP_Y_WEBGL,!0),J.texImage2D(J.TEXTURE_2D,0,J.RGBA,J.RGBA,J.UNSIGNED_BYTE,ut),J.generateMipmap(J.TEXTURE_2D),J.bindTexture(J.TEXTURE_2D,null),J.pixelStorei(J.UNPACK_FLIP_Y_WEBGL,!1),qe(Ut)},ut.src=at})}(Oe.src)}),xn=0===Yt.length?Promise.resolve([]):Promise.all(Yt),bn="attribute vec2 position;\n        varying vec2 vUV;\n        uniform mat2 videoUVScale;\n        "+se.vertexPars+"\n        void main(void){\n          gl_Position = vec4(position, 0., 1.);\n          vec2 uvCentered = videoUVScale * position;\n          vUV = 0.5 + uvCentered;\n          "+se.vertex+"\n        }",Zn=ut.textures.map(function(Oe){return"uniform sampler2D "+Oe.id+";"}),gn=ut.uniforms.map(function(Oe){return"uniform "+["float","vec2","vec3","vec4"][Oe.value.length-1]+" "+Oe.name+";"}),Nn=se.fragmentPars+"\n"+Zn.join("\n")+"\n"+gn.join("\n")+"\nvarying vec2 vUV;\nuniform sampler2D samplerVideo;\n"+ut.GLSLFragmentSource,Ne=sn(J,bn,Nn,"SHAPE_"+Ct.toString());Ne.attributes.position=J.getAttribLocation(Ne.program,"position"),Ue&&(Ne.attributes.aiVal=J.getAttribLocation(Ne.program,"aiVal")),Ne.uniforms.samplerVideo=J.getUniformLocation(Ne.program,"samplerVideo"),Ne.uniforms.videoUVScale=J.getUniformLocation(Ne.program,"videoUVScale"),Ne.uniforms.texturesSamplers=ut.textures.map(function(Oe){return J.getUniformLocation(Ne.program,Oe.id)}),ut.uniforms.forEach(function(Oe){Ne.uniforms[Oe.name]=J.getUniformLocation(Ne.program,Oe.name)});const A={},P=ut.uniforms.map(function(Oe){return uniform={name:Oe.name,i:Oe.value.length-1,value:Oe.value,previousValue:null},A[Oe.name]=uniform,uniform});let W=[],H=0;if(ut.interpolations){const Oe=function Kt(at){const qe=[],Ct=function(ut,Ut){return Math.abs(ut)-Math.abs(Ut)};return at.forEach(function(ut){const Ut=ut.ks,Se=Ut.filter(function(Ue){return Ue>0}).sort(Ct),De=Ut.filter(function(Ue){return Ue<0}).sort(Ct);Se.length>0&&qe.push(Object.assign({},ut,{ks:Se})),De.length>0&&qe.push(Object.assign({},ut,{ks:De}))}),qe}(ut.interpolations);let Dt=0;for(let zt=0;zt<Oe.length;++zt){const Yn=qn(ut,Oe[zt],Dt);W=W.concat(Yn),Dt+=Yn.length}H=Dt}const ee=ut.points.length,ie=new Float32Array(2*(ee+H)),ve=J.createBuffer(),ce=new Uint8Array(ee);ut.points.forEach(function(Oe,Dt){const zt=at.indexOf(Oe);if(-1===zt)throw new Error("The neural network does not outputs this landmark"+Oe);ce[Dt]=zt});const Re=J.createBuffer();J.bindBuffer(J.ELEMENT_ARRAY_BUFFER,Re),J.bufferData(J.ELEMENT_ARRAY_BUFFER,new Uint16Array(ut.tesselation),J.STATIC_DRAW);let pt=null;if(Ue){const Oe=[].concat.apply([],ut.iVals);pt=J.createBuffer(),J.bindBuffer(J.ARRAY_BUFFER,pt),J.bufferData(J.ARRAY_BUFFER,new Float32Array(Oe),J.STATIC_DRAW)}xn.then(function(Oe){const Dt={outlines:ut.outlines?ut.outlines.map(cn):[],interpolatedPoints:W,frontFacing:ut.frontFacing?ut.frontFacing:"",textures:Oe,uniforms:P,uniformsByName:A,pointsCount:ee,interpolatedPointsCount:H,points:ie,glvVBOPoints:ve,iValCCount:w,glVBOIVals:pt,glVBOFaces:Re,mapPointIndexToNNLandmark:ce,trianglesCount:ut.tesselation.length/3,shp:Ne};ut.name&&(nt[ut.name]=Dt),Ut(Dt)})})}function cn(at){const qe=at.points.length,Ct=[],ut=[],Ut=[];for(let Se=0;Se<qe;++Se)Ct.push([0,0]),ut.push([0,0]),Ut.push([0,0]);return{pointsCount:qe,bisectors:Ct,sides:ut,points:Ut,pointsInd:new Uint8Array(at.points),displacements:new Float32Array(at.displacements)}}function qn(at,qe,Ct){const ut=at.points.length+Ct,Ut=qe.points,Se=qe.ks,De=Ut[1],Ue=Se[0]>=0?Ut[2]:Ut[0];let se=null,w=null,Yt=null;at.iVals&&(Yt=at.iVals,se=Yt[Ut[1]],w=Se[0]>=0?Yt[Ut[2]]:Yt[Ut[0]]);const xn=at.tesselation;for(let Zn=0;Zn<xn.length;Zn+=3){const gn=[xn[Zn],xn[Zn+1],xn[Zn+2]];if(-1===gn.indexOf(De)||-1===gn.indexOf(Ue))continue;let Nn=-1;Nn=gn[0]!==De&&gn[0]!==Ue?gn[0]:gn[1]!==De&&gn[1]!==Ue?gn[1]:gn[2],xn[Zn+gn.indexOf(Ue)]=ut;for(let A=0;A<Se.length;++A){const P=A===Se.length-1?Ue:ut+A+1;Se[A]>0?xn.push(ut+A,Nn,P):xn.push(ut+A,P,Nn)}}const bn=[];for(let Zn=0;Zn<Se.length;++Zn)if(bn.push(Object.assign({ind:at.points.length+Ct+Zn,m0:[1,0],m1:[1,0],k:Se[Zn]},qe)),at.iVals){const Nn=se.map(function(Ne,A){const P=w[A],W=Math.abs(Se[Zn]);return Ne*(1-W)+P*W});Yt.push(Nn)}return bn}function nn(at,qe){J.useProgram(qe.shp.program),qe.uniforms.forEach(function(Ct){if(Ct.previousValue===Ct.value)return;const ut=qe.shp.uniforms[Ct.name];switch(Ct.i){case 0:J.uniform1f(ut,Ct.value[0]);break;case 1:J.uniform2fv(ut,Ct.value);break;case 2:J.uniform3fv(ut,Ct.value);break;case 3:J.uniform4fv(ut,Ct.value)}Ct.previousValue=Ct.value}),J.uniformMatrix2fv(qe.shp.uniforms.videoUVScale,!1,WEBARROCKSFACE.get_videoUVScaleMat2());for(let Ct=0;Ct<qe.pointsCount;++Ct){const ut=qe.mapPointIndexToNNLandmark[Ct];qe.points[2*Ct]=at[ut][0],qe.points[2*Ct+1]=at[ut][1]}qe.outlines.forEach(Ln.bind(null,qe.points)),qe.interpolatedPoints.forEach(Ti.bind(null,qe.points)),J.bindBuffer(J.ARRAY_BUFFER,qe.glvVBOPoints),J.bufferData(J.ARRAY_BUFFER,qe.points,J.DYNAMIC_DRAW),J.vertexAttribPointer(qe.shp.attributes.position,2,J.FLOAT,!1,8,0),qe.glVBOIVals&&(J.enableVertexAttribArray(qe.shp.attributes.aiVal),J.bindBuffer(J.ARRAY_BUFFER,qe.glVBOIVals),J.vertexAttribPointer(qe.shp.attributes.aiVal,qe.iValCCount,J.FLOAT,!1,4*qe.iValCCount,0)),qe.frontFacing&&(J.enable(J.CULL_FACE),J.cullFace(J.BACK),J.frontFace("CW"===qe.frontFacing?J.CW:J.CCW)),qe.textures.forEach(function(Ct,ut){J.uniform1i(qe.shp.uniforms.texturesSamplers[ut],ut+1),J.activeTexture([J.TEXTURE1,J.TEXTURE2,J.TEXTURE3,J.TEXTURE4][ut]),J.bindTexture(J.TEXTURE_2D,Ct)}),J.bindBuffer(J.ELEMENT_ARRAY_BUFFER,qe.glVBOFaces),J.drawElements(J.TRIANGLES,3*qe.trianglesCount,J.UNSIGNED_SHORT,0),qe.glVBOIVals&&J.disableVertexAttribArray(qe.shp.attributes.aiVal),qe.frontFacing&&J.disable(J.CULL_FACE),J.activeTexture(J.TEXTURE0)}function In(at,qe){let Ct=0,ut=qe[0];const Ut=qe.length;for(let Se=1;Se<=Ut;Se++){const De=qe[Se%Ut];at[1]>Math.min(ut[1],De[1])&&at[1]<=Math.max(ut[1],De[1])&&at[0]<=Math.max(ut[0],De[0])&&ut[1]!==De[1]&&(ut.x===De[0]||at[0]<=(at[1]-ut[1])*(De[0]-ut[0])/(De[1]-ut[1])+ut[0])&&++Ct,ut=De}return Ct%2!=0}function Ln(at,qe){const Ct=Rt.canvasAR.width,ut=Rt.canvasAR.height;for(let Se=0;Se<qe.pointsCount;++Se){const De=qe.pointsInd[Se],Ue=qe.points[Se];Ue[0]=Ct*at[2*De],Ue[1]=ut*at[2*De+1]}let Ut=0;for(let Se=0;Se<qe.pointsCount;++Se){const De=(Se+1)%qe.pointsCount,Ue=qe.points[De][0]-qe.points[Se][0],se=qe.points[De][1]-qe.points[Se][1],w=Math.sqrt(Ue*Ue+se*se);Ut+=w,qe.sides[Se][0]=Ue/w,qe.sides[Se][1]=se/w}for(let Se=0;Se<qe.pointsCount;++Se){const De=qe.sides[Se],Ue=qe.sides[0===Se?qe.pointsCount-1:Se-1];let se=-De[0]+Ue[0],w=-De[1]+Ue[1];const Yt=Math.sqrt(se*se+w*w);se/=Yt,w/=Yt;const xn=qe.bisectors[Se];xn[0]=se,xn[1]=w}for(let Se=0;Se<qe.pointsCount;++Se){const De=qe.points[Se],Ue=qe.bisectors[Se];In([De[0]+1e-6*Ue[0],De[1]+1e-6*Ue[1]],qe.points)&&(Ue[0]*=-1,Ue[1]*=-1)}for(let Se=0;Se<qe.pointsCount;++Se){const De=qe.displacements[Se]*Ut,Ue=qe.bisectors[Se],w=De*Ue[1]/ut,Yt=qe.pointsInd[Se];at[2*Yt]+=De*Ue[0]/Ct,at[2*Yt+1]+=w}}function Ti(at,qe){const Ct=qe.points[1],ut=qe.k>=0?2:0,Ut=qe.points[ut],Se=at[2*Ct],De=at[2*Ct+1],Ue=qe.m0,se=qe.m1;Ue[0]=at[2*qe.points[2]]-at[2*qe.points[0]],Ue[1]=at[2*qe.points[2]+1]-at[2*qe.points[0]+1],se[0]=at[2*Ut]-at[2*Ct],se[1]=at[2*Ut+1]-at[2*Ct+1];const w=Math.sqrt(Ue[0]*Ue[0]+Ue[1]*Ue[1]),Yt=Math.sqrt(se[0]*se[0]+se[1]*se[1]);if(0===w||0===Yt)return at[2*qe.ind]=Se,void(at[2*qe.ind+1]=De);const xn=Yt,bn=Math.sign(qe.k)*xn*qe.tangentInfluences[1]/w,Zn=xn*qe.tangentInfluences[ut]/Yt;Ue[0]*=bn,Ue[1]*=bn,se[0]*=Zn,se[1]*=Zn;const gn=Math.abs(qe.k),Nn=gn*gn,Ne=Nn*gn,P=at[2*Ut+1],H=Ue[1],ie=se[1],ve=2*Ne-3*Nn+1,ce=Ne-2*Nn+gn,Re=Ne-Nn,pt=-2*Ne+3*Nn;at[2*qe.ind]=ve*Se+ce*Ue[0]+Re*se[0]+pt*at[2*Ut],at[2*qe.ind+1]=ve*De+ce*H+Re*ie+pt*P}function nr(at){return new Promise(function(qe,Ct){const ut={canvas:Rt.canvasVideo,NNCPath:Rt.NNCPath,scanSettings:{threshold:.7},callbackReady:function(Ut,Se){Ut?Ct(Ut):(console.log("INFO in WebARRocksFaceShape2DHelper: WEBARROCKSFACE is initialized"),$e=Se.GL,tn=Se.videoTexture,di=Se.videoTransformMat2,mt=Se.video,dt=function We(){const at=J.createTexture();return J.activeTexture(J.TEXTURE0),J.bindTexture(J.TEXTURE_2D,at),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MAG_FILTER,J.LINEAR),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MIN_FILTER,J.LINEAR),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE),dn(),J.bindTexture(J.TEXTURE_2D,null),at}(),function gt(){_n.drawVideo=sn($e,"attribute vec2 position;\n      uniform mat2 transform;\n      varying vec2 vUV;\n      void main(void){\n        vUV = 0.5 + transform * position;\n        gl_Position = vec4(position, 0., 1.);\n      }","uniform sampler2D uun_source;\n      varying vec2 vUV;\n      void main(void){\n        gl_FragColor = texture2D(uun_source, vUV);\n      }","DRAW VIDEO"),_n.drawVideo.uniforms.transformMat2=$e.getUniformLocation(_n.drawVideo.program,"transform")}(),Promise.all(Rt.shapes.map(en.bind(null,Se.landmarksLabels))).then(function(De){ue=De,qe()}))},callbackTrack:Qt};at&&(ut.videoSettings={videoElement:at}),WEBARROCKSFACE.init(ut)})}const Xi={init:function(at){if(Rt=Object.assign({},b,at),Rn=WebARRocksLMStabilizer.instance({}),function ti(){J=Rt.canvasAR.getContext("webgl",{antialias:!0,depth:!1,alpha:!0,stencil:!1}),J.enable(J.BLEND),J.clearColor(0,0,0,0),J.blendFunc(J.SRC_ALPHA,J.ONE_MINUS_SRC_ALPHA)}(),Rt.videoURL){const qe=document.createElement("video");return qe.setAttribute("src",Rt.videoURL),qe.setAttribute("autoplay",!0),qe.setAttribute("loop",!0),qe.setAttribute("playsinline",!0),document.body.appendChild(qe),new Promise(function(Ct,ut){qe.oncanplay=function(Ut){qe.oncanplay=null;let Se=!1;const De=function(){Se||(qe.style.display="none",qe.play(),Ct(),Se=!0)};nr(qe).then(function(){window.addEventListener("click",De),window.addEventListener("touchstart",De)}).catch(ut)}})}return nr(null)},set_uniformValue(at,qe,Ct){nt[at].uniformsByName[qe].value=Ct},get_viewWidth:function(){return Rt.canvasVideo.width},get_viewHeight:function(){return Rt.canvasVideo.height}};return Xi}();try{module.exports=WebARRocksFaceShape2DHelper}catch{console.log("ES6 Module not exported")}const WebARRocksFaceThreeHelper=function(){const b={cameraMinVideoDimFov:38,debugObjPoints:0},Rt={leftEyeCtr:[33.7,37.9,45.9],rightEyeCtr:[-33.7,37.9,45.9],leftEyeInt:[16,36,40],rightEyeInt:[-16,36,40],leftEyeExt:[42,34,38],rightEyeExt:[-42,34,38],leftEyeBot:[33,31,45],rightEyeBot:[-33,31,45],leftEarBottom:[70,-18.6,-18],rightEarBottom:[-70,-18.6,-18],leftEarEarring:[75,-37,-24.8],rightEarEarring:[-75,-37,-24.8],noseLeft:[21,-.1,67],noseRight:[-21,-.1,67],noseBottom:[0,-.6,82],noseOuter:[0,16,93],mouthLeft:[27,-29.9,70.8],mouthRight:[-27,-29.9,70.8],upperLipBot:[0,-24,83.5],upperLipTop:[0,-17.2,86.3],lowerLipTop:[0,-26,84.3],lowerLipBot:[0,-34,89.6],leftEyeBrowInt:[15,55.4,51.2],rightEyeBrowInt:[-15,55.4,51.2],templeTopRight:[-66,39,11.5],templeTopLeft:[66,39,11.5],templeBotRight:[-69.5,7,21],templeBotLeft:[69.5,7,21],chin:[0,-71,91],chinTop:[0,-60,95],chinLeft:[31,-60,76],chinRight:[-31,-60,76]},ue=["chin","leftEarBottom","rightEarBottom","noseOuter","leftEyeExt","rightEyeExt"],nt=Math.PI/180;let mt=-1,Ge=null,J=null;const dt={copy:null};let $e=null,tn=null,di=null,Rn=null,_n=null;const Qt=[0,0],ti={labels:null,indices:{}},At={objPoints:[],objPointsMean:null,imgPointsLMIndices:[],imgPointsPx:[]},We={isPostProcessing:!1,taaLevel:0,canvas:null,renderer:null,composer:null,scene:null,camera:null,faceSlots:[],matMov:null,matMov2:null,euler:null,vec3:null,preMatrix:null,ambLight:null,dirLight:null};let dn=!0;const xt=window.devicePixelRatio||1;function sn(Se,De,Ue){const se=$e.createShader(De);return $e.shaderSource(se,Se),$e.compileShader(se),$e.getShaderParameter(se,$e.COMPILE_STATUS)?se:(alert("ERROR IN "+Ue+" SHADER: "+$e.getShaderInfoLog(se)),console.log("Buggy shader source: \n",Se),null)}function en(){const Se=.5*mt*nt,De=.5*Ut.get_viewHeight()/Math.tan(Se);console.log("INFO in WebARRocksFaceThreeHelper - focal_y =",De),Qt[0]=De,Qt[1]=De}function cn(Se,De){const Ue=[];for(let se=0;se<Se.length;++se)Ue.push([0,0]);if(At.imgPointsPx=Ue,At.imgPointsLMIndices=Se.map(function(se){const w=ti.labels.indexOf(se);if(-1===w)throw new Error("This neuron network model does not have any point with label="+se);return w}),At.objPoints=Se.map(function(se){return De[se].slice(0)}),Ge.isCenterObjPoints){const se=[0,0,0];At.objPoints.forEach(function(Yt){se[0]+=Yt[0],se[1]+=Yt[1],se[2]+=Yt[2]});const w=At.objPoints.length;se[0]/=w,se[1]/=w,se[2]/=w,At.objPointsMean=se,At.objPoints.forEach(function(Yt){Yt[0]-=se[0],Yt[1]-=se[1],Yt[2]-=se[2]})}}function nn(Se,De){if(Se)return console.log("ERROR in WebARRocksFaceThreeHelper. ERR =",Se),void(Ge.callbackReady&&Ge.callbackReady(Se,null));window.addEventListener("focus",Ut.reset_landmarksStabilizers),console.log("INFO in WebARRocksFaceThreeHelper: WebAR.Rocks.face is ready. spec =",De),$e=De.GL,tn=De.canvasElement,di=De.videoTexture,Rn=De.videoTransformMat2,ti.labels=De.landmarksLabels,_n=De.video,console.log("INFO in WebARRocksFaceThreeHelper: video resolution =",_n.videoWidth,"x",_n.videoHeight),ti.labels.forEach(function(Ue,se){ti.indices[Ue]=se}),typeof WebARRocksLMStabilizer>"u"?(J=null,console.warn("WARNING in WebARRocksFaceThreeHelper: cannot find WebARRocksLMStabilizer. Points won't be stabilized")):J=[],function qe(){dt.copyCrop=function gt(Se,De,Ue){const w=sn(Se,$e.VERTEX_SHADER,"VERTEX "+Ue),Yt=sn("precision lowp float;"+De,$e.FRAGMENT_SHADER,"FRAGMENT "+Ue),xn=$e.createProgram();$e.attachShader(xn,w),$e.attachShader(xn,Yt),$e.linkProgram(xn);const bn=$e.getAttribLocation(xn,"position");return $e.enableVertexAttribArray(bn),{program:xn,uniforms:{}}}("attribute vec2 position;\n      uniform mat2 transform;\n      varying vec2 vUV;\n      void main(void){\n        vUV = 0.5 + transform * position;\n        gl_Position = vec4(position, 0., 1.);\n      }","uniform sampler2D uun_source;\n      varying vec2 vUV;\n      void main(void){\n        gl_FragColor = texture2D(uun_source, vUV);\n      }","COPY CROP"),dt.copyCrop.uniforms.transformMat2=$e.getUniformLocation(dt.copyCrop.program,"transform")}(),function Kt(Se){if(console.log("INFO in WebARRocksFaceThreeHelper - init_three(). Max faces detected = ",Se),We.canvas=Ge.canvasThree,We.isPostProcessing=Ge.isPostProcessing,We.taaLevel=Ge.taaLevel,We.taaLevel>0&&(We.isPostProcessing=!0),We.renderer=new THREE.WebGLRenderer({canvas:We.canvas,alpha:!0,antialias:!0,preserveDrawingBuffer:!0}),We.renderer.setClearAlpha(0),We.scene=new THREE.Scene,We.camera=new THREE.PerspectiveCamera(mt,Ut.get_viewAspectRatio(),10,5e3),We.isPostProcessing){We.composer=new THREE.EffectComposer(We.renderer);const De=new THREE.RenderPass(We.scene,We.camera);if(We.taaLevel>0){const Ue=new THREE.TAARenderPass(We.scene,We.camera);Ue.unbiased=!1,We.composer.addPass(Ue),Ue.sampleLevel=We.taaLevel}if(We.composer.addPass(De),We.taaLevel>0){De.enabled=!1;const Ue=new THREE.ShaderPass(THREE.CopyShader);We.composer.addPass(Ue)}}We.faceSlots=[];for(let De=0;De<Se;++De){const Ue=new THREE.Object3D,se=new THREE.Object3D;Ue.frustumCulled=!1,Ue.visible=!1,Ue.matrixAutoUpdate=!1,Ue.add(se);let w=null;Ge.isComputeTorsoPose&&(w=new THREE.Object3D,w.frustumCulled=!1,w.matrixAutoUpdate=!1,Ue.add(w)),We.faceSlots.push({faceFollower:se,faceFollowerParent:Ue,torsoFollower:w}),We.scene.add(Ue)}if(b.debugObjPoints){const De=Ge.solvePnPObjPointsPositions;Object.keys(De).forEach(function(Ue){const se=De[Ue],Yt=new THREE.Mesh(new THREE.BoxGeometry(3,3,3),new THREE.MeshBasicMaterial({color:16711680}));Yt.position.fromArray(se),We.faceSlots[0].faceFollower.add(Yt)})}We.matMov=new THREE.Matrix4,We.matMov2=new THREE.Matrix4,We.euler=new THREE.Euler,We.vec3=new THREE.Vector3,We.preMatrix=(new THREE.Matrix4).makeRotationX(Ge.rxOffset),We.preMatrix.setPosition(0,Ge.translationYZ[0],Ge.translationYZ[1]),We.preMatrix.scale(new THREE.Vector3(1,1,1).multiplyScalar(Ge.scale)),function qn(){Ge.isLightReconstructionEnabled&&(We.ambLight=new THREE.AmbientLight(16777215,1),We.scene.add(We.ambLight),We.dirLight=new THREE.DirectionalLight(16777215,1),We.scene.add(We.dirLight))}(),Ut.update_threeCamera()}(De.maxFacesDetected),en(),cn(Ge.solvePnPImgPointsLabels,Ge.solvePnPObjPointsPositions),Ge.callbackReady&&(De.threeFaceFollowers=We.faceSlots.map(function(Ue){return Ue.faceFollower}),De.threeTorsoFollowers=We.faceSlots.map(function(Ue){return Ue.torsoFollower}),De.threeScene=We.scene,De.threeRenderer=We.renderer,De.threeComposer=We.composer,De.threeCamera=We.camera,De.threeAmbLight=We.ambLight,De.threeDirLight=We.dirLight,Ge.callbackReady(Se,De))}function In(Se){Ut.render_video();const De=Ut.render_AR(Se);Ge.callbackTrack&&Ge.callbackTrack(Se,De)}function Ti(Se,De){let Ue=null;const se=We.faceSlots[De];return Se.isDetected?(null===J?Ue=Se.landmarks:(J[De]||(J[De]=WebARRocksLMStabilizer.instance(Ge.landmarksStabilizerSpec)),Ue=J[De].update(Se.landmarks,Ut.get_viewWidthCSSPx(),Ut.get_viewHeightCSSPx(),Se.s)),function nr(Se,De){const Ue=Ut.get_viewWidth()/2,se=Ut.get_viewHeight()/2,w=At.imgPointsPx;At.imgPointsLMIndices.forEach(function(bn,Zn){const gn=w[Zn];gn[0]=-Se[bn][0]*Ue,gn[1]=-Se[bn][1]*se});const xn=WEBARROCKSFACE.compute_pose(At.objPoints,w,Qt[0],Qt[1]);if(xn){const bn=We.matMov.elements,Zn=xn.rotation,gn=xn.translation;bn[12]=-gn[0],bn[13]=-gn[1],bn[14]=-gn[2],bn[0]=-Zn[0][0],bn[4]=-Zn[0][1],bn[8]=Zn[0][2],bn[1]=-Zn[1][0],bn[5]=-Zn[1][1],bn[9]=Zn[1][2],bn[2]=-Zn[2][0],bn[6]=-Zn[2][1],bn[10]=Zn[2][2],Ge.rotationContraints&&function Xi(Se,De){We.euler.setFromRotationMatrix(Se,De.order),We.euler.set(De.rotXFactor*We.euler.x,De.rotYFactor*We.euler.y,De.rotZFactor*We.euler.z,De.order),We.matMov2.makeRotationFromEuler(We.euler),We.matMov2.copyPosition(Se),Se.copy(We.matMov2)}(We.matMov,Ge.rotationContraints),We.matMov.multiply(We.preMatrix),De.faceFollowerParent.matrix.copy(We.matMov),Ge.isCenterObjPoints&&De.faceFollower.position.fromArray(At.objPointsMean).multiplyScalar(-1)}}(Ue,se),se.faceFollowerParent.visible=!0):se.faceFollowerParent.visible&&(se.faceFollowerParent.visible=!1,J&&J[De]&&J[De].reset()),Ge.isComputeTorsoPose&&function Ct(Se,De){const Ue=Se.matrixWorld,se=We.euler;se.setFromRotationMatrix(Ue,"YZX"),se._x=Ge.torsoRotX,se._y*=Ge.torsoRotYFactor,se._z=0,De.matrixWorld.makeRotationFromEuler(se);const w=We.vec3;w.fromArray(Ge.torsoBaseNeck),w.applyMatrix4(Ue),w.setY(w.y+Ge.torsoTranslateY),De.matrixWorld.setPosition(w),De.matrix.copy(De.parent.matrixWorld).invert().multiply(De.matrixWorld),De.updateWorldMatrix(!1,!0)}(se.faceFollowerParent,se.torsoFollower),Ue}function ut(Se){Se&&(Ge.spec.videoSettings={videoElement:Se}),WEBARROCKSFACE.init(Ge.spec)}const Ut={init:function(Se){if(Ge=Object.assign({spec:{},isLightReconstructionEnabled:!1,lightReconstructionIntensityPow:3,lightReconstructionAmbIntensityFactor:30,lightReconstructionDirIntensityFactor:30,lightReconstructionTotalIntensityMin:.1,rxOffset:0,translationYZ:[0,0],scale:1,isComputeTorsoPose:!1,torsoRotX:0,torsoRotYFactor:.5,torsoBaseNeck:[0,-58,-18],torsoTranslateY:70,solvePnPObjPointsPositions:Rt,solvePnPImgPointsLabels:ue,isCenterObjPoints:!0,rotationContraints:null,landmarksStabilizerSpec:{},canvasThree:null,isPostProcessing:!1,taaLevel:0,callbackReady:null,callbackTrack:null,videoURL:null},Se),Ge.spec=Object.assign({},{canvas:null,canvasId:"WebARRocksFaceCanvas",NNCPath:"../../neuralNets/",callbackReady:nn,callbackTrack:In},Se.spec),null===Ge.spec.canvas&&(Ge.spec.canvas=document.getElementById(Ge.spec.canvasId)),Ge.videoURL){const Ue=document.createElement("video");return Ue.setAttribute("src",Ge.videoURL),Ue.setAttribute("autoplay",!0),Ue.setAttribute("loop",!0),Ue.setAttribute("preload",!0),Ue.setAttribute("muted","muted"),Ue.setAttribute("playsinline",!0),document.body.appendChild(Ue),Ue.style.maxWidth="50vw",Ue.style.border="1px solid red",new Promise(function(se,w){Ue.oncanplay=function(Yt){console.log("INFO in WebARRocksFaceThreeHelper: video file can play"),Ue.oncanplay=null;let xn=!1;const bn=function(){Ue.play(),!xn&&(Ue.style.display="none",xn=!0,ut(Ue),se())};window.addEventListener("click",bn),window.addEventListener("touchstart",bn)}})}return ut(null)},render_video:function(){$e.viewport(0,0,Ut.get_viewWidth(),Ut.get_viewHeight()),dn&&function Ln(){$e.useProgram(dt.copyCrop.program),$e.uniformMatrix2fv(dt.copyCrop.uniforms.transformMat2,!1,Rn),$e.activeTexture($e.TEXTURE0),$e.bindTexture($e.TEXTURE_2D,di),$e.drawElements($e.TRIANGLES,3,$e.UNSIGNED_SHORT,0)}()},render_AR:function(Se){let De=null,Ue=null;return Se.length?(De=Se.map(Ti),Ue=Se[0]):(De=Ti(Se,0),Ue=Se),function at(){We.isPostProcessing?We.composer.render():We.renderer.render(We.scene,We.camera)}(),Ge.isLightReconstructionEnabled&&Ue.isDetected&&function kn(Se){let De=Se.lAmb,Ue=Se.lDir;const se=De+Ue;se<Ge.lightReconstructionTotalIntensityMin&&(s=Ge.lightReconstructionTotalIntensityMin/se,De*=s,Ue*=s),De=Math.pow(De,Ge.lightReconstructionIntensityPow),Ue=Math.pow(Ue,Ge.lightReconstructionIntensityPow),We.ambLight.intensity=De*Ge.lightReconstructionAmbIntensityFactor,We.dirLight.intensity=Ue*Ge.lightReconstructionDirIntensityFactor;const w=Se.lTheta,Yt=Se.lPhi,xn=Math.cos(w),bn=Math.sin(w),Zn=Math.cos(Yt),gn=Math.sin(Yt);We.dirLight.position.set(bn*Zn,xn*Zn,gn)}(Ue),De},get_facePointPositions:function(){return Ge.solvePnPObjPointsPositions},resize:function(Se,De){$e&&$e.bindFramebuffer($e.FRAMEBUFFER,null),tn.width=Se,tn.height=De,We.canvas.width=Se,We.canvas.height=De,WEBARROCKSFACE.resize(),Ut.update_threeCamera(),We.composer&&We.composer.setSize(Se,De),en()},add_occluder:function(Se,De,Ue){Ue||(Ue=new THREE.Mesh);let se=null;if("BufferGeometry"===Se.type)se=Se;else{if(!Se.scene)throw new Error("Wrong occluder data format");Se.scene.traverse(function(Yt){if("Mesh"===Yt.type){if(null!==se&&se!==Yt.geometry)throw new Error("The occluder should contain only one Geometry");se=Yt.geometry}})}let w=new THREE.ShaderMaterial({vertexShader:THREE.ShaderLib.basic.vertexShader,fragmentShader:"precision lowp float;\n void main(void){\n gl_FragColor = vec4(1.,0.,0.,1.);\n }",uniforms:THREE.ShaderLib.basic.uniforms,side:THREE.DoubleSide,colorWrite:!1});De&&(se.computeVertexNormals(),w=new THREE.MeshNormalMaterial({side:THREE.DoubleSide})),Ue.renderOrder=-1e12,Ue.material=w,Ue.geometry=se,Ue.userData.isOccluder=!0,We.faceSlots.forEach(function(Yt){Yt.faceFollower.add(Ue.clone())})},add_occluderFromFile:function(Se,De,Ue,se){const w=new THREE.Mesh,Yt=Se.split(".").pop().toUpperCase();return new(0,{GLB:THREE.GLTFLoader,GLTF:THREE.GLTFLoader,JSON:THREE.BufferGeometryLoader}[Yt])(Ue).load(Se,function(bn){typeof De<"u"&&De&&De(w),Ut.add_occluder(bn,se,w)}),w},get_sourceWidth:function(){return _n.videoWidth},get_sourceHeight:function(){return _n.videoHeight},get_viewWidthCSSPx:function(){return tn.width/xt},get_viewHeightCSSPx:function(){return tn.height/xt},get_viewWidth:function(){return tn.width},get_viewHeight:function(){return tn.height},get_viewAspectRatio:function(){return Ut.get_viewWidth()/Ut.get_viewHeight()},set_isDrawVideo:function(Se){dn=Se},update_solvePnP:function(Se,De){Se&&(Ge.solvePnPObjPointsPositions=Object.assign(Ge.solvePnPObjPointsPositions,Se)),Ge.solvePnPImgPointsLabels=De||Ge.solvePnPImgPointsLabels,cn(Ge.solvePnPImgPointsLabels,Ge.solvePnPObjPointsPositions)},update_threeCamera:function(){const Se=We.camera,De=We.renderer,Ue=Ut.get_viewWidth(),se=Ut.get_viewHeight(),w=Ue/se,Yt=Ut.get_sourceWidth(),xn=Ut.get_sourceHeight(),bn=Yt/xn;let gn=b.cameraMinVideoDimFov*(xn>Yt?1/bn:1);w>bn&&(gn=2*Math.atan(se/(xn*(Ue/Yt))*Math.tan(.5*gn*nt))/nt),mt=gn,Se.aspect=w,Se.fov=gn,Se.updateProjectionMatrix(),console.log("INFO in WebARRocksFaceThreeHelper.update_threeCamera(): vFoV=",gn,"deg, canvasAspectRatio=",w),De.setSize(Ue,se,!1),De.setViewport(0,0,Ue,se)},change_NN:function(Se){return WEBARROCKSFACE.update({NNCPath:Se}).then(function(){ti.labels=WEBARROCKSFACE.get_LMLabels()})},reset_landmarksStabilizers:function(){console.log("INFO in WebARRocksFaceThreeHelper: reset stabilizers"),J&&J.length&&J.forEach(function(Se){Se.reset()})},update_video:function(Se){return new Promise(function(De,Ue){WEBARROCKSFACE.update_videoElement(Se,function(se){di=se,WEBARROCKSFACE.resize(),De()})})}};return Ut}();try{module.exports=WebARRocksFaceThreeHelper}catch{console.log("ES6 Module not exported")}const WebARRocksResizer=function(){let b=null,Rt=null,ue=0,nt=1,mt=!1,Ge=!1,J=null;const dt=[[640,480],[768,480],[800,600],[960,640],[960,720],[1024,768],[1280,720]];let $e=!1,tn=[];function Rn(xt,sn){let cn=-1,Kt=-1;xt[0]/xt[1]>sn[0]/sn[1]?(cn=xt,Kt=sn):(cn=sn,Kt=xt);const qn=Math.min(cn[0],Kt[0])*Math.min(cn[1],Kt[1]);let kn=-1;return cn[0]>=Kt[0]&&cn[1]>=Kt[1]?kn=cn[0]*cn[1]:Kt[0]>cn[0]&&Kt[1]>cn[1]?kn=Kt[0]*Kt[1]:(kn=cn[0]*cn[1],kn+=(Kt[1]-cn[1])*Kt[0]),qn/kn}function _n(){const xt=b.getBoundingClientRect();Rt=[Math.round(nt*xt.width),Math.round(nt*xt.height)],At()}function Qt(){Ge&&clearTimeout(Ge),Ge=setTimeout(We,50)}function ti(){const xt=window.devicePixelRatio?window.devicePixelRatio:1;Rt=[xt*window.innerWidth,xt*window.innerHeight],$e&&Rt.reverse(),At()}function At(){tn.forEach(function(xt){xt.setAttribute("width",Rt[0]),xt.setAttribute("height",Rt[1])})}function We(){ti(),WEBARROCKSFACE.resize(),Ge=!1,J&&J(Rt[0],Rt[1])}const dn={is_portrait:function(){try{return!!window.matchMedia("(orientation: portrait)").matches}catch{return window.innerHeight>window.innerWidth}},size_canvas:function(xt){if(xt.canvasId)b=document.getElementById(xt.canvasId);else{if(!xt.canvas)throw new Error("Please specify a canvas");b=xt.canvas}if(tn=[b],xt.overlayCanvas&&(tn=tn.concat(xt.overlayCanvas)),mt=typeof xt.isFullScreen<"u"&&xt.isFullScreen,$e=typeof xt.isInvWH<"u"&&xt.isInvWH,mt)typeof xt.onResize<"u"&&(J=xt.onResize),ti(),window.addEventListener("resize",Qt,!1);else{const en=b.getBoundingClientRect();if(0===en.width||0===en.height)return console.log("WARNING in WebARRocksResizer.size_canvas() : the canvas has its width or its height null, Retry a bit later..."),++ue>20?void xt.callback("CANNOT_RESIZECANVAS"):void setTimeout(dn.size_canvas.bind(null,xt),50);ue=0,nt=typeof xt.overSamplingFactor>"u"?1:xt.overSamplingFactor,_n()}typeof xt.isFlipY<"u"&&xt.isFlipY&&function di(xt,sn){const gt=xt.style.transform;-1===gt.indexOf(sn)&&(xt.style.transform=sn+" "+gt)}(b,"rotateY(180deg)");const sn=dt.slice(0);dn.is_portrait()&&sn.forEach(function(en){en.reverse()}),sn.sort(function(en,cn){return Rn(cn,Rt)-Rn(en,Rt)}),setTimeout(xt.callback.bind(null,!1,{idealWidth:sn[0][0],idealHeight:sn[0][1]}),1)},resize_canvas:function(){mt||_n()},get_aspectRatio:function(){return b.width/b.height},get_width:function(){return b.width},get_height:function(){return b.height}};return dn}();try{module.exports=WebARRocksResizer}catch{console.log("ES6 Module not exported")}(function(b,Rt){"object"==typeof exports&&typeof module<"u"?Rt(exports):"function"==typeof define&&define.amd?define(["exports"],Rt):Rt((b=typeof globalThis<"u"?globalThis:b||self).THREE={})})(this,function(b){"use strict";const Rt="136",mt=0,Ge=1,J=2,tn=1,di=2,Rn=3,_n=0,Qt=1,ti=2,dn=0,xt=1,sn=2,gt=3,en=4,cn=5,Kt=100,qn=101,kn=102,nn=103,In=104,Ln=200,Ti=201,nr=202,Xi=203,at=204,qe=205,Ct=206,ut=207,Ut=208,Se=209,De=210,Ue=0,se=1,w=2,Yt=3,xn=4,bn=5,Zn=6,gn=7,Nn=0,Ne=1,A=2,P=0,W=1,H=2,ee=3,ie=4,ve=5,Re=301,pt=302,Oe=303,Dt=304,zt=306,Yn=307,ni=1e3,St=1001,un=1002,Dn=1003,vi=1004,xr=1005,Cn=1006,Jn=1007,Dr=1008,Qe=1009,Er=1010,Pn=1011,cr=1012,Zr=1013,hr=1014,ki=1015,_i=1016,fr=1017,Un=1018,cc=1019,Jr=1020,Tn=1021,br=1022,pi=1023,Ia=1024,Ar=1025,Pi=1026,Fi=1027,Bs=1028,d=1029,S=1030,C=1031,U=1032,le=1033,_e=33776,ye=33777,ae=33778,K=33779,me=35840,Ee=35841,Be=35842,we=35843,Ie=36196,xe=37492,Ce=37496,N=37808,j=37809,ge=37810,V=37811,Q=37812,z=37813,B=37814,Te=37815,Fe=37816,te=37817,He=37818,rt=37819,I=37820,oe=37821,Ze=36492,Et=37840,Ht=37841,Kn=37842,hi=37843,Zt=37844,tt=37845,pn=37846,Os=37847,Ir=37848,Hr=37849,Hs=37850,Ts=37851,Zi=37852,zr=37853,y=2300,u=2301,f=2302,M=2400,F=2401,de=2402,Tt=3e3,_t=3001,It=3201,Bt=0,An=1,pr=35044,$n=35048,la="300 es";class Xr{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const i=this._listeners[e];if(void 0!==i){const a=i.indexOf(t);-1!==a&&i.splice(a,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const n=this._listeners[e.type];if(void 0!==n){e.target=this;const i=n.slice(0);for(let a=0,o=i.length;a<o;a++)i[a].call(this,e);e.target=null}}}const Mi=[];for(let r=0;r<256;r++)Mi[r]=(r<16?"0":"")+r.toString(16);let os=1234567;const jr=Math.PI/180,cs=180/Math.PI;function er(){const r=4294967295*Math.random()|0,e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(Mi[255&r]+Mi[r>>8&255]+Mi[r>>16&255]+Mi[r>>24&255]+"-"+Mi[255&e]+Mi[e>>8&255]+"-"+Mi[e>>16&15|64]+Mi[e>>24&255]+"-"+Mi[63&t|128]+Mi[t>>8&255]+"-"+Mi[t>>16&255]+Mi[t>>24&255]+Mi[255&n]+Mi[n>>8&255]+Mi[n>>16&255]+Mi[n>>24&255]).toUpperCase()}function ji(r,e,t){return Math.max(e,Math.min(t,r))}function Na(r,e){return(r%e+e)%e}function $r(r,e,t){return(1-t)*r+t*e}function wr(r){return 0==(r&r-1)&&0!==r}function Ws(r){return Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function Ua(r){return Math.pow(2,Math.floor(Math.log(r)/Math.LN2))}var Qr=Object.freeze({__proto__:null,DEG2RAD:jr,RAD2DEG:cs,generateUUID:er,clamp:ji,euclideanModulo:Na,mapLinear:function lc(r,e,t,n,i){return n+(r-e)*(i-n)/(t-e)},inverseLerp:function yn(r,e,t){return r!==e?(t-r)/(e-r):0},lerp:$r,damp:function Tl(r,e,t,n){return $r(r,e,1-Math.exp(-t*n))},pingpong:function Tr(r,e=1){return e-Math.abs(Na(r,2*e)-e)},smoothstep:function wl(r,e,t){return r<=e?0:r>=t?1:(r=(r-e)/(t-e))*r*(3-2*r)},smootherstep:function To(r,e,t){return r<=e?0:r>=t?1:(r=(r-e)/(t-e))*r*r*(r*(6*r-15)+10)},randInt:function Lr(r,e){return r+Math.floor(Math.random()*(e-r+1))},randFloat:function ua(r,e){return r+Math.random()*(e-r)},randFloatSpread:function wo(r){return r*(.5-Math.random())},seededRandom:function So(r){return void 0!==r&&(os=r%2147483647),os=16807*os%2147483647,(os-1)/2147483646},degToRad:function ls(r){return r*jr},radToDeg:function Ro(r){return r*cs},isPowerOfTwo:wr,ceilPowerOfTwo:Ws,floorPowerOfTwo:Ua,setQuaternionFromProperEuler:function Ao(r,e,t,n,i){const a=Math.cos,o=Math.sin,c=a(t/2),l=o(t/2),h=a((e+n)/2),p=o((e+n)/2),m=a((e-n)/2),g=o((e-n)/2),v=a((n-e)/2),x=o((n-e)/2);switch(i){case"XYX":r.set(c*p,l*m,l*g,c*h);break;case"YZY":r.set(l*g,c*p,l*m,c*h);break;case"ZXZ":r.set(l*m,l*g,c*p,c*h);break;case"XZX":r.set(c*p,l*x,l*v,c*h);break;case"YXY":r.set(l*v,c*p,l*x,c*h);break;case"ZYZ":r.set(l*x,l*v,c*p,c*h);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}});class st{constructor(e=0,t=0){this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),i=Math.sin(t),a=this.x-e.x,o=this.y-e.y;return this.x=a*n-o*i+e.x,this.y=a*i+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}st.prototype.isVector2=!0;class Ii{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,i,a,o,c,l,h){const p=this.elements;return p[0]=e,p[1]=i,p[2]=c,p[3]=t,p[4]=a,p[5]=l,p[6]=n,p[7]=o,p[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,a=this.elements,o=n[0],c=n[3],l=n[6],h=n[1],p=n[4],m=n[7],g=n[2],v=n[5],x=n[8],T=i[0],L=i[3],E=i[6],_=i[1],D=i[4],R=i[7],G=i[2],$=i[5],fe=i[8];return a[0]=o*T+c*_+l*G,a[3]=o*L+c*D+l*$,a[6]=o*E+c*R+l*fe,a[1]=h*T+p*_+m*G,a[4]=h*L+p*D+m*$,a[7]=h*E+p*R+m*fe,a[2]=g*T+v*_+x*G,a[5]=g*L+v*D+x*$,a[8]=g*E+v*R+x*fe,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],i=e[2],a=e[3],o=e[4],c=e[5],l=e[6],h=e[7],p=e[8];return t*o*p-t*c*h-n*a*p+n*c*l+i*a*h-i*o*l}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],a=e[3],o=e[4],c=e[5],l=e[6],h=e[7],p=e[8],m=p*o-c*h,g=c*l-p*a,v=h*a-o*l,x=t*m+n*g+i*v;if(0===x)return this.set(0,0,0,0,0,0,0,0,0);const T=1/x;return e[0]=m*T,e[1]=(i*h-p*n)*T,e[2]=(c*n-i*o)*T,e[3]=g*T,e[4]=(p*t-i*l)*T,e[5]=(i*a-c*t)*T,e[6]=v*T,e[7]=(n*l-h*t)*T,e[8]=(o*t-n*a)*T,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,a,o,c){const l=Math.cos(a),h=Math.sin(a);return this.set(n*l,n*h,-n*(l*o+h*c)+o+e,-i*h,i*l,-i*(-h*o+l*c)+c+t,0,0,1),this}scale(e,t){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}rotate(e){const t=Math.cos(e),n=Math.sin(e),i=this.elements,a=i[0],o=i[3],c=i[6],l=i[1],h=i[4],p=i[7];return i[0]=t*a+n*l,i[3]=t*o+n*h,i[6]=t*c+n*p,i[1]=-n*a+t*l,i[4]=-n*o+t*h,i[7]=-n*c+t*p,this}translate(e,t){const n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}function zo(r){if(0===r.length)return-1/0;let e=r[0];for(let t=1,n=r.length;t<n;++t)r[t]>e&&(e=r[t]);return e}Ii.prototype.isMatrix3=!0;const Ba={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function us(r,e){return new Ba[r](e)}function Oa(r){return document.createElementNS("http://www.w3.org/1999/xhtml",r)}let Cr;class qr{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===Cr&&(Cr=Oa("canvas")),Cr.width=e.width,Cr.height=e.height;const n=Cr.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=Cr}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}}let Lo=0;class zi extends Xr{constructor(e=zi.DEFAULT_IMAGE,t=zi.DEFAULT_MAPPING,n=St,i=St,a=Cn,o=Dr,c=pi,l=Qe,h=1,p=Tt){super(),Object.defineProperty(this,"id",{value:Lo++}),this.uuid=er(),this.name="",this.image=e,this.mipmaps=[],this.mapping=t,this.wrapS=n,this.wrapT=i,this.magFilter=a,this.minFilter=o,this.anisotropy=h,this.format=c,this.internalFormat=null,this.type=l,this.offset=new st(0,0),this.repeat=new st(1,1),this.center=new st(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ii,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=p,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const i=this.image;if(void 0===i.uuid&&(i.uuid=er()),!t&&void 0===e.images[i.uuid]){let a;if(Array.isArray(i)){a=[];for(let o=0,c=i.length;o<c;o++)a.push(hs(i[o].isDataTexture?i[o].image:i[o]))}else a=hs(i);e.images[i.uuid]={uuid:i.uuid,url:a}}n.image=i.uuid}return"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case ni:e.x=e.x-Math.floor(e.x);break;case St:e.x=e.x<0?0:1;break;case un:e.x=1===Math.abs(Math.floor(e.x)%2)?Math.ceil(e.x)-e.x:e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case ni:e.y=e.y-Math.floor(e.y);break;case St:e.y=e.y<0?0:1;break;case un:e.y=1===Math.abs(Math.floor(e.y)%2)?Math.ceil(e.y)-e.y:e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&this.version++}}function hs(r){return typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&r instanceof ImageBitmap?qr.getDataURL(r):r.data?{data:Array.prototype.slice.call(r.data),width:r.width,height:r.height,type:r.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}zi.DEFAULT_IMAGE=void 0,zi.DEFAULT_MAPPING=300,zi.prototype.isTexture=!0;class rn{constructor(e=0,t=0,n=0,i=1){this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,a=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*i+o[12]*a,this.y=o[1]*t+o[5]*n+o[9]*i+o[13]*a,this.z=o[2]*t+o[6]*n+o[10]*i+o[14]*a,this.w=o[3]*t+o[7]*n+o[11]*i+o[15]*a,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,a;const l=e.elements,h=l[0],p=l[4],m=l[8],g=l[1],v=l[5],x=l[9],T=l[2],L=l[6],E=l[10];if(Math.abs(p-g)<.01&&Math.abs(m-T)<.01&&Math.abs(x-L)<.01){if(Math.abs(p+g)<.1&&Math.abs(m+T)<.1&&Math.abs(x+L)<.1&&Math.abs(h+v+E-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const D=(h+1)/2,R=(v+1)/2,G=(E+1)/2,$=(p+g)/4,fe=(m+T)/4,Me=(x+L)/4;return D>R&&D>G?D<.01?(n=0,i=.707106781,a=.707106781):(n=Math.sqrt(D),i=$/n,a=fe/n):R>G?R<.01?(n=.707106781,i=0,a=.707106781):(i=Math.sqrt(R),n=$/i,a=Me/i):G<.01?(n=.707106781,i=.707106781,a=0):(a=Math.sqrt(G),n=fe/a,i=Me/a),this.set(n,i,a,t),this}let _=Math.sqrt((L-x)*(L-x)+(m-T)*(m-T)+(g-p)*(g-p));return Math.abs(_)<.001&&(_=1),this.x=(L-x)/_,this.y=(m-T)/_,this.z=(g-p)/_,this.w=Math.acos((h+v+E-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}rn.prototype.isVector4=!0;class Li extends Xr{constructor(e,t,n={}){super(),this.width=e,this.height=t,this.depth=1,this.scissor=new rn(0,0,e,t),this.scissorTest=!1,this.viewport=new rn(0,0,e,t),this.texture=new zi(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.isRenderTargetTexture=!0,this.texture.image={width:e,height:t,depth:1},this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.internalFormat=void 0!==n.internalFormat?n.internalFormat:null,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:Cn,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0!==n.stencilBuffer&&n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}setTexture(e){e.image={width:this.width,height:this.height,depth:this.depth},this.texture=e}setSize(e,t,n=1){(this.width!==e||this.height!==t||this.depth!==n)&&(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.image={...this.texture.image},this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}Li.prototype.isWebGLRenderTarget=!0;class Pr extends Li{constructor(e,t,n){super(e,t);const i=this.texture;this.texture=[];for(let a=0;a<n;a++)this.texture[a]=i.clone()}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let i=0,a=this.texture.length;i<a;i++)this.texture[i].image.width=e,this.texture[i].image.height=t,this.texture[i].image.depth=n;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this.texture.length=0;for(let t=0,n=e.texture.length;t<n;t++)this.texture[t]=e.texture[t].clone();return this}}Pr.prototype.isWebGLMultipleRenderTargets=!0;class mr extends Li{constructor(e,t,n={}){super(e,t,n),this.samples=4,this.ignoreDepthForMultisampleCopy=void 0===n.ignoreDepth||n.ignoreDepth,this.useRenderToTexture=void 0!==n.useRenderToTexture&&n.useRenderToTexture,this.useRenderbuffer=!1===this.useRenderToTexture}copy(e){return super.copy.call(this,e),this.samples=e.samples,this.useRenderToTexture=e.useRenderToTexture,this.useRenderbuffer=e.useRenderbuffer,this}}mr.prototype.isWebGLMultisampleRenderTarget=!0;class Ni{constructor(e=0,t=0,n=0,i=1){this._x=e,this._y=t,this._z=n,this._w=i}static slerp(e,t,n,i){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),n.slerpQuaternions(e,t,i)}static slerpFlat(e,t,n,i,a,o,c){let l=n[i+0],h=n[i+1],p=n[i+2],m=n[i+3];const g=a[o+0],v=a[o+1],x=a[o+2],T=a[o+3];if(0===c)return e[t+0]=l,e[t+1]=h,e[t+2]=p,void(e[t+3]=m);if(1===c)return e[t+0]=g,e[t+1]=v,e[t+2]=x,void(e[t+3]=T);if(m!==T||l!==g||h!==v||p!==x){let L=1-c;const E=l*g+h*v+p*x+m*T,_=E>=0?1:-1,D=1-E*E;if(D>Number.EPSILON){const G=Math.sqrt(D),$=Math.atan2(G,E*_);L=Math.sin(L*$)/G,c=Math.sin(c*$)/G}const R=c*_;if(l=l*L+g*R,h=h*L+v*R,p=p*L+x*R,m=m*L+T*R,L===1-c){const G=1/Math.sqrt(l*l+h*h+p*p+m*m);l*=G,h*=G,p*=G,m*=G}}e[t]=l,e[t+1]=h,e[t+2]=p,e[t+3]=m}static multiplyQuaternionsFlat(e,t,n,i,a,o){const c=n[i],l=n[i+1],h=n[i+2],p=n[i+3],m=a[o],g=a[o+1],v=a[o+2],x=a[o+3];return e[t]=c*x+p*m+l*v-h*g,e[t+1]=l*x+p*g+h*m-c*v,e[t+2]=h*x+p*v+c*g-l*m,e[t+3]=p*x-c*m-l*g-h*v,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const n=e._x,i=e._y,a=e._z,o=e._order,c=Math.cos,l=Math.sin,h=c(n/2),p=c(i/2),m=c(a/2),g=l(n/2),v=l(i/2),x=l(a/2);switch(o){case"XYZ":this._x=g*p*m+h*v*x,this._y=h*v*m-g*p*x,this._z=h*p*x+g*v*m,this._w=h*p*m-g*v*x;break;case"YXZ":this._x=g*p*m+h*v*x,this._y=h*v*m-g*p*x,this._z=h*p*x-g*v*m,this._w=h*p*m+g*v*x;break;case"ZXY":this._x=g*p*m-h*v*x,this._y=h*v*m+g*p*x,this._z=h*p*x+g*v*m,this._w=h*p*m-g*v*x;break;case"ZYX":this._x=g*p*m-h*v*x,this._y=h*v*m+g*p*x,this._z=h*p*x-g*v*m,this._w=h*p*m+g*v*x;break;case"YZX":this._x=g*p*m+h*v*x,this._y=h*v*m+g*p*x,this._z=h*p*x-g*v*m,this._w=h*p*m-g*v*x;break;case"XZY":this._x=g*p*m-h*v*x,this._y=h*v*m-g*p*x,this._z=h*p*x+g*v*m,this._w=h*p*m+g*v*x;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],i=t[4],a=t[8],o=t[1],c=t[5],l=t[9],h=t[2],p=t[6],m=t[10],g=n+c+m;if(g>0){const v=.5/Math.sqrt(g+1);this._w=.25/v,this._x=(p-l)*v,this._y=(a-h)*v,this._z=(o-i)*v}else if(n>c&&n>m){const v=2*Math.sqrt(1+n-c-m);this._w=(p-l)/v,this._x=.25*v,this._y=(i+o)/v,this._z=(a+h)/v}else if(c>m){const v=2*Math.sqrt(1+c-n-m);this._w=(a-h)/v,this._x=(i+o)/v,this._y=.25*v,this._z=(l+p)/v}else{const v=2*Math.sqrt(1+m-n-c);this._w=(o-i)/v,this._x=(a+h)/v,this._y=(l+p)/v,this._z=.25*v}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(ji(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,i=e._y,a=e._z,o=e._w,c=t._x,l=t._y,h=t._z,p=t._w;return this._x=n*p+o*c+i*h-a*l,this._y=i*p+o*l+a*c-n*h,this._z=a*p+o*h+n*l-i*c,this._w=o*p-n*c-i*l-a*h,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,i=this._y,a=this._z,o=this._w;let c=o*e._w+n*e._x+i*e._y+a*e._z;if(c<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,c=-c):this.copy(e),c>=1)return this._w=o,this._x=n,this._y=i,this._z=a,this;const l=1-c*c;if(l<=Number.EPSILON){const v=1-t;return this._w=v*o+t*this._w,this._x=v*n+t*this._x,this._y=v*i+t*this._y,this._z=v*a+t*this._z,this.normalize(),this._onChangeCallback(),this}const h=Math.sqrt(l),p=Math.atan2(h,c),m=Math.sin((1-t)*p)/h,g=Math.sin(t*p)/h;return this._w=o*m+this._w*g,this._x=n*m+this._x*g,this._y=i*m+this._y*g,this._z=a*m+this._z*g,this._onChangeCallback(),this}slerpQuaternions(e,t,n){this.copy(e).slerp(t,n)}random(){const e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),i=2*Math.PI*Math.random(),a=2*Math.PI*Math.random();return this.set(t*Math.cos(i),n*Math.sin(a),n*Math.cos(a),t*Math.sin(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}Ni.prototype.isQuaternion=!0;class O{constructor(e=0,t=0,n=0){this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(js.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(js.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,i=this.z,a=e.elements;return this.x=a[0]*t+a[3]*n+a[6]*i,this.y=a[1]*t+a[4]*n+a[7]*i,this.z=a[2]*t+a[5]*n+a[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,a=e.elements,o=1/(a[3]*t+a[7]*n+a[11]*i+a[15]);return this.x=(a[0]*t+a[4]*n+a[8]*i+a[12])*o,this.y=(a[1]*t+a[5]*n+a[9]*i+a[13])*o,this.z=(a[2]*t+a[6]*n+a[10]*i+a[14])*o,this}applyQuaternion(e){const t=this.x,n=this.y,i=this.z,a=e.x,o=e.y,c=e.z,l=e.w,h=l*t+o*i-c*n,p=l*n+c*t-a*i,m=l*i+a*n-o*t,g=-a*t-o*n-c*i;return this.x=h*l+g*-a+p*-c-m*-o,this.y=p*l+g*-o+m*-a-h*-c,this.z=m*l+g*-c+h*-o-p*-a,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,i=this.z,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*i,this.y=a[1]*t+a[5]*n+a[9]*i,this.z=a[2]*t+a[6]*n+a[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,i=e.y,a=e.z,o=t.x,c=t.y,l=t.z;return this.x=i*l-a*c,this.y=a*o-n*l,this.z=n*c-i*o,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return Xs.copy(this).projectOnVector(e),this.sub(Xs)}reflect(e){return this.sub(Xs.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(ji(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}O.prototype.isVector3=!0;const Xs=new O,js=new Ni;class Ji{constructor(e=new O(1/0,1/0,1/0),t=new O(-1/0,-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,n=1/0,i=1/0,a=-1/0,o=-1/0,c=-1/0;for(let l=0,h=e.length;l<h;l+=3){const p=e[l],m=e[l+1],g=e[l+2];p<t&&(t=p),m<n&&(n=m),g<i&&(i=g),p>a&&(a=p),m>o&&(o=m),g>c&&(c=g)}return this.min.set(t,n,i),this.max.set(a,o,c),this}setFromBufferAttribute(e){let t=1/0,n=1/0,i=1/0,a=-1/0,o=-1/0,c=-1/0;for(let l=0,h=e.count;l<h;l++){const p=e.getX(l),m=e.getY(l),g=e.getZ(l);p<t&&(t=p),m<n&&(n=m),g<i&&(i=g),p>a&&(a=p),m>o&&(o=m),g>c&&(c=g)}return this.min.set(t,n,i),this.max.set(a,o,c),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Co.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e){return this.makeEmpty(),this.expandByObject(e)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){e.updateWorldMatrix(!1,!1);const t=e.geometry;void 0!==t&&(null===t.boundingBox&&t.computeBoundingBox(),Sl.copy(t.boundingBox),Sl.applyMatrix4(e.matrixWorld),this.union(Sl));const n=e.children;for(let i=0,a=n.length;i<a;i++)this.expandByObject(n[i]);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Co),Co.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Po),uc.subVectors(this.max,Po),Ha.subVectors(e.a,Po),ka.subVectors(e.b,Po),Ga.subVectors(e.c,Po),qs.subVectors(ka,Ha),Ys.subVectors(Ga,ka),ha.subVectors(Ha,Ga);let t=[0,-qs.z,qs.y,0,-Ys.z,Ys.y,0,-ha.z,ha.y,qs.z,0,-qs.x,Ys.z,0,-Ys.x,ha.z,0,-ha.x,-qs.y,qs.x,0,-Ys.y,Ys.x,0,-ha.y,ha.x,0];return!(!Rl(t,Ha,ka,Ga,uc)||(t=[1,0,0,0,1,0,0,0,1],!Rl(t,Ha,ka,Ga,uc)))&&(hc.crossVectors(qs,Ys),t=[hc.x,hc.y,hc.z],Rl(t,Ha,ka,Ga,uc))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Co.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=.5*this.getSize(Co).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(gr[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),gr[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),gr[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),gr[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),gr[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),gr[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),gr[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),gr[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(gr)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}Ji.prototype.isBox3=!0;const gr=[new O,new O,new O,new O,new O,new O,new O,new O],Co=new O,Sl=new Ji,Ha=new O,ka=new O,Ga=new O,qs=new O,Ys=new O,ha=new O,Po=new O,uc=new O,hc=new O,fa=new O;function Rl(r,e,t,n,i){for(let a=0,o=r.length-3;a<=o;a+=3){fa.fromArray(r,a);const c=i.x*Math.abs(fa.x)+i.y*Math.abs(fa.y)+i.z*Math.abs(fa.z),l=e.dot(fa),h=t.dot(fa),p=n.dot(fa);if(Math.max(-Math.max(l,h,p),Math.min(l,h,p))>c)return!1}return!0}const Ld=new Ji,Ku=new O,fc=new O,Al=new O;class Ks{constructor(e=new O,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):Ld.setFromPoints(e).getCenter(n);let i=0;for(let a=0,o=e.length;a<o;a++)i=Math.max(i,n.distanceToSquared(e[a]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){Al.subVectors(e,this.center);const t=Al.lengthSq();if(t>this.radius*this.radius){const n=Math.sqrt(t),i=.5*(n-this.radius);this.center.add(Al.multiplyScalar(i/n)),this.radius+=i}return this}union(e){return!0===this.center.equals(e.center)?fc.set(0,0,1).multiplyScalar(e.radius):fc.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(Ku.copy(e.center).add(fc)),this.expandByPoint(Ku.copy(e.center).sub(fc)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Rs=new O,zl=new O,dc=new O,Zs=new O,Ll=new O,pc=new O,Cl=new O;class Js{constructor(e=new O,t=new O(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Rs)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Rs.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Rs.copy(this.direction).multiplyScalar(t).add(this.origin),Rs.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){zl.copy(e).add(t).multiplyScalar(.5),dc.copy(t).sub(e).normalize(),Zs.copy(this.origin).sub(zl);const a=.5*e.distanceTo(t),o=-this.direction.dot(dc),c=Zs.dot(this.direction),l=-Zs.dot(dc),h=Zs.lengthSq(),p=Math.abs(1-o*o);let m,g,v,x;if(p>0)if(m=o*l-c,g=o*c-l,x=a*p,m>=0)if(g>=-x)if(g<=x){const T=1/p;m*=T,g*=T,v=m*(m+o*g+2*c)+g*(o*m+g+2*l)+h}else g=a,m=Math.max(0,-(o*g+c)),v=-m*m+g*(g+2*l)+h;else g=-a,m=Math.max(0,-(o*g+c)),v=-m*m+g*(g+2*l)+h;else g<=-x?(m=Math.max(0,-(-o*a+c)),g=m>0?-a:Math.min(Math.max(-a,-l),a),v=-m*m+g*(g+2*l)+h):g<=x?(m=0,g=Math.min(Math.max(-a,-l),a),v=g*(g+2*l)+h):(m=Math.max(0,-(o*a+c)),g=m>0?a:Math.min(Math.max(-a,-l),a),v=-m*m+g*(g+2*l)+h);else g=o>0?-a:a,m=Math.max(0,-(o*g+c)),v=-m*m+g*(g+2*l)+h;return n&&n.copy(this.direction).multiplyScalar(m).add(this.origin),i&&i.copy(dc).multiplyScalar(g).add(zl),v}intersectSphere(e,t){Rs.subVectors(e.center,this.origin);const n=Rs.dot(this.direction),i=Rs.dot(Rs)-n*n,a=e.radius*e.radius;if(i>a)return null;const o=Math.sqrt(a-i),c=n-o,l=n+o;return c<0&&l<0?null:this.at(c<0?l:c,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,a,o,c,l;const h=1/this.direction.x,p=1/this.direction.y,m=1/this.direction.z,g=this.origin;return h>=0?(n=(e.min.x-g.x)*h,i=(e.max.x-g.x)*h):(n=(e.max.x-g.x)*h,i=(e.min.x-g.x)*h),p>=0?(a=(e.min.y-g.y)*p,o=(e.max.y-g.y)*p):(a=(e.max.y-g.y)*p,o=(e.min.y-g.y)*p),n>o||a>i||((a>n||n!=n)&&(n=a),(o<i||i!=i)&&(i=o),m>=0?(c=(e.min.z-g.z)*m,l=(e.max.z-g.z)*m):(c=(e.max.z-g.z)*m,l=(e.min.z-g.z)*m),n>l||c>i)||((c>n||n!=n)&&(n=c),(l<i||i!=i)&&(i=l),i<0)?null:this.at(n>=0?n:i,t)}intersectsBox(e){return null!==this.intersectBox(e,Rs)}intersectTriangle(e,t,n,i,a){Ll.subVectors(t,e),pc.subVectors(n,e),Cl.crossVectors(Ll,pc);let c,o=this.direction.dot(Cl);if(o>0){if(i)return null;c=1}else{if(!(o<0))return null;c=-1,o=-o}Zs.subVectors(this.origin,e);const l=c*this.direction.dot(pc.crossVectors(Zs,pc));if(l<0)return null;const h=c*this.direction.dot(Ll.cross(Zs));if(h<0||l+h>o)return null;const p=-c*Zs.dot(Cl);return p<0?null:this.at(p/o,a)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class fn{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,i,a,o,c,l,h,p,m,g,v,x,T,L){const E=this.elements;return E[0]=e,E[4]=t,E[8]=n,E[12]=i,E[1]=a,E[5]=o,E[9]=c,E[13]=l,E[2]=h,E[6]=p,E[10]=m,E[14]=g,E[3]=v,E[7]=x,E[11]=T,E[15]=L,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new fn).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,i=1/Va.setFromMatrixColumn(e,0).length(),a=1/Va.setFromMatrixColumn(e,1).length(),o=1/Va.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*a,t[5]=n[5]*a,t[6]=n[6]*a,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const t=this.elements,n=e.x,i=e.y,a=e.z,o=Math.cos(n),c=Math.sin(n),l=Math.cos(i),h=Math.sin(i),p=Math.cos(a),m=Math.sin(a);if("XYZ"===e.order){const g=o*p,v=o*m,x=c*p,T=c*m;t[0]=l*p,t[4]=-l*m,t[8]=h,t[1]=v+x*h,t[5]=g-T*h,t[9]=-c*l,t[2]=T-g*h,t[6]=x+v*h,t[10]=o*l}else if("YXZ"===e.order){const g=l*p,v=l*m,x=h*p,T=h*m;t[0]=g+T*c,t[4]=x*c-v,t[8]=o*h,t[1]=o*m,t[5]=o*p,t[9]=-c,t[2]=v*c-x,t[6]=T+g*c,t[10]=o*l}else if("ZXY"===e.order){const g=l*p,v=l*m,x=h*p,T=h*m;t[0]=g-T*c,t[4]=-o*m,t[8]=x+v*c,t[1]=v+x*c,t[5]=o*p,t[9]=T-g*c,t[2]=-o*h,t[6]=c,t[10]=o*l}else if("ZYX"===e.order){const g=o*p,v=o*m,x=c*p,T=c*m;t[0]=l*p,t[4]=x*h-v,t[8]=g*h+T,t[1]=l*m,t[5]=T*h+g,t[9]=v*h-x,t[2]=-h,t[6]=c*l,t[10]=o*l}else if("YZX"===e.order){const g=o*l,v=o*h,x=c*l,T=c*h;t[0]=l*p,t[4]=T-g*m,t[8]=x*m+v,t[1]=m,t[5]=o*p,t[9]=-c*p,t[2]=-h*p,t[6]=v*m+x,t[10]=g-T*m}else if("XZY"===e.order){const g=o*l,v=o*h,x=c*l,T=c*h;t[0]=l*p,t[4]=-m,t[8]=h*p,t[1]=g*m+T,t[5]=o*p,t[9]=v*m-x,t[2]=x*m-v,t[6]=c*p,t[10]=T*m+g}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Cd,e,Pd)}lookAt(e,t,n){const i=this.elements;return Ur.subVectors(e,t),0===Ur.lengthSq()&&(Ur.z=1),Ur.normalize(),$s.crossVectors(n,Ur),0===$s.lengthSq()&&(1===Math.abs(n.z)?Ur.x+=1e-4:Ur.z+=1e-4,Ur.normalize(),$s.crossVectors(n,Ur)),$s.normalize(),mc.crossVectors(Ur,$s),i[0]=$s.x,i[4]=mc.x,i[8]=Ur.x,i[1]=$s.y,i[5]=mc.y,i[9]=Ur.y,i[2]=$s.z,i[6]=mc.z,i[10]=Ur.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,a=this.elements,o=n[0],c=n[4],l=n[8],h=n[12],p=n[1],m=n[5],g=n[9],v=n[13],x=n[2],T=n[6],L=n[10],E=n[14],_=n[3],D=n[7],R=n[11],G=n[15],$=i[0],fe=i[4],Me=i[8],Je=i[12],ke=i[1],be=i[5],X=i[9],Z=i[13],ze=i[2],Xe=i[6],Le=i[10],je=i[14],Gt=i[3],Jt=i[7],ot=i[11],ht=i[15];return a[0]=o*$+c*ke+l*ze+h*Gt,a[4]=o*fe+c*be+l*Xe+h*Jt,a[8]=o*Me+c*X+l*Le+h*ot,a[12]=o*Je+c*Z+l*je+h*ht,a[1]=p*$+m*ke+g*ze+v*Gt,a[5]=p*fe+m*be+g*Xe+v*Jt,a[9]=p*Me+m*X+g*Le+v*ot,a[13]=p*Je+m*Z+g*je+v*ht,a[2]=x*$+T*ke+L*ze+E*Gt,a[6]=x*fe+T*be+L*Xe+E*Jt,a[10]=x*Me+T*X+L*Le+E*ot,a[14]=x*Je+T*Z+L*je+E*ht,a[3]=_*$+D*ke+R*ze+G*Gt,a[7]=_*fe+D*be+R*Xe+G*Jt,a[11]=_*Me+D*X+R*Le+G*ot,a[15]=_*Je+D*Z+R*je+G*ht,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],i=e[8],a=e[12],o=e[1],c=e[5],l=e[9],h=e[13],p=e[2],m=e[6],g=e[10],v=e[14];return e[3]*(+a*l*m-i*h*m-a*c*g+n*h*g+i*c*v-n*l*v)+e[7]*(+t*l*v-t*h*g+a*o*g-i*o*v+i*h*p-a*l*p)+e[11]*(+t*h*m-t*c*v-a*o*m+n*o*v+a*c*p-n*h*p)+e[15]*(-i*c*p-t*l*m+t*c*g+i*o*m-n*o*g+n*l*p)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],a=e[3],o=e[4],c=e[5],l=e[6],h=e[7],p=e[8],m=e[9],g=e[10],v=e[11],x=e[12],T=e[13],L=e[14],E=e[15],_=m*L*h-T*g*h+T*l*v-c*L*v-m*l*E+c*g*E,D=x*g*h-p*L*h-x*l*v+o*L*v+p*l*E-o*g*E,R=p*T*h-x*m*h+x*c*v-o*T*v-p*c*E+o*m*E,G=x*m*l-p*T*l-x*c*g+o*T*g+p*c*L-o*m*L,$=t*_+n*D+i*R+a*G;if(0===$)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const fe=1/$;return e[0]=_*fe,e[1]=(T*g*a-m*L*a-T*i*v+n*L*v+m*i*E-n*g*E)*fe,e[2]=(c*L*a-T*l*a+T*i*h-n*L*h-c*i*E+n*l*E)*fe,e[3]=(m*l*a-c*g*a-m*i*h+n*g*h+c*i*v-n*l*v)*fe,e[4]=D*fe,e[5]=(p*L*a-x*g*a+x*i*v-t*L*v-p*i*E+t*g*E)*fe,e[6]=(x*l*a-o*L*a-x*i*h+t*L*h+o*i*E-t*l*E)*fe,e[7]=(o*g*a-p*l*a+p*i*h-t*g*h-o*i*v+t*l*v)*fe,e[8]=R*fe,e[9]=(x*m*a-p*T*a-x*n*v+t*T*v+p*n*E-t*m*E)*fe,e[10]=(o*T*a-x*c*a+x*n*h-t*T*h-o*n*E+t*c*E)*fe,e[11]=(p*c*a-o*m*a-p*n*h+t*m*h+o*n*v-t*c*v)*fe,e[12]=G*fe,e[13]=(p*T*i-x*m*i+x*n*g-t*T*g-p*n*L+t*m*L)*fe,e[14]=(x*c*i-o*T*i-x*n*l+t*T*l+o*n*L-t*c*L)*fe,e[15]=(o*m*i-p*c*i+p*n*l-t*m*l-o*n*g+t*c*g)*fe,this}scale(e){const t=this.elements,n=e.x,i=e.y,a=e.z;return t[0]*=n,t[4]*=i,t[8]*=a,t[1]*=n,t[5]*=i,t[9]*=a,t[2]*=n,t[6]*=i,t[10]*=a,t[3]*=n,t[7]*=i,t[11]*=a,this}getMaxScaleOnAxis(){const e=this.elements;return Math.sqrt(Math.max(e[0]*e[0]+e[1]*e[1]+e[2]*e[2],e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10]))}makeTranslation(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),i=Math.sin(t),a=1-n,o=e.x,c=e.y,l=e.z,h=a*o,p=a*c;return this.set(h*o+n,h*c-i*l,h*l+i*c,0,h*c+i*l,p*c+n,p*l-i*o,0,h*l-i*c,p*l+i*o,a*l*l+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,a,o){return this.set(1,n,a,0,e,1,o,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){const i=this.elements,a=t._x,o=t._y,c=t._z,l=t._w,h=a+a,p=o+o,m=c+c,g=a*h,v=a*p,x=a*m,T=o*p,L=o*m,E=c*m,_=l*h,D=l*p,R=l*m,G=n.x,$=n.y,fe=n.z;return i[0]=(1-(T+E))*G,i[1]=(v+R)*G,i[2]=(x-D)*G,i[3]=0,i[4]=(v-R)*$,i[5]=(1-(g+E))*$,i[6]=(L+_)*$,i[7]=0,i[8]=(x+D)*fe,i[9]=(L-_)*fe,i[10]=(1-(g+T))*fe,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){const i=this.elements;let a=Va.set(i[0],i[1],i[2]).length();const o=Va.set(i[4],i[5],i[6]).length(),c=Va.set(i[8],i[9],i[10]).length();this.determinant()<0&&(a=-a),e.x=i[12],e.y=i[13],e.z=i[14],es.copy(this);const h=1/a,p=1/o,m=1/c;return es.elements[0]*=h,es.elements[1]*=h,es.elements[2]*=h,es.elements[4]*=p,es.elements[5]*=p,es.elements[6]*=p,es.elements[8]*=m,es.elements[9]*=m,es.elements[10]*=m,t.setFromRotationMatrix(es),n.x=a,n.y=o,n.z=c,this}makePerspective(e,t,n,i,a,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const c=this.elements,h=2*a/(n-i),p=(t+e)/(t-e),m=(n+i)/(n-i),g=-(o+a)/(o-a),v=-2*o*a/(o-a);return c[0]=2*a/(t-e),c[4]=0,c[8]=p,c[12]=0,c[1]=0,c[5]=h,c[9]=m,c[13]=0,c[2]=0,c[6]=0,c[10]=g,c[14]=v,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,t,n,i,a,o){const c=this.elements,l=1/(t-e),h=1/(n-i),p=1/(o-a),m=(t+e)*l,g=(n+i)*h,v=(o+a)*p;return c[0]=2*l,c[4]=0,c[8]=0,c[12]=-m,c[1]=0,c[5]=2*h,c[9]=0,c[13]=-g,c[2]=0,c[6]=0,c[10]=-2*p,c[14]=-v,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}fn.prototype.isMatrix4=!0;const Va=new O,es=new fn,Cd=new O(0,0,0),Pd=new O(1,1,1),$s=new O,mc=new O,Ur=new O,Zu=new fn,Ju=new Ni;class da{constructor(e=0,t=0,n=0,i=da.DefaultOrder){this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,i=this._order){return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const i=e.elements,a=i[0],o=i[4],c=i[8],l=i[1],h=i[5],p=i[9],m=i[2],g=i[6],v=i[10];switch(t){case"XYZ":this._y=Math.asin(ji(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-p,v),this._z=Math.atan2(-o,a)):(this._x=Math.atan2(g,h),this._z=0);break;case"YXZ":this._x=Math.asin(-ji(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(c,v),this._z=Math.atan2(l,h)):(this._y=Math.atan2(-m,a),this._z=0);break;case"ZXY":this._x=Math.asin(ji(g,-1,1)),Math.abs(g)<.9999999?(this._y=Math.atan2(-m,v),this._z=Math.atan2(-o,h)):(this._y=0,this._z=Math.atan2(l,a));break;case"ZYX":this._y=Math.asin(-ji(m,-1,1)),Math.abs(m)<.9999999?(this._x=Math.atan2(g,v),this._z=Math.atan2(l,a)):(this._x=0,this._z=Math.atan2(-o,h));break;case"YZX":this._z=Math.asin(ji(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-p,h),this._y=Math.atan2(-m,a)):(this._x=0,this._y=Math.atan2(c,v));break;case"XZY":this._z=Math.asin(-ji(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(g,h),this._y=Math.atan2(c,a)):(this._x=Math.atan2(-p,v),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return Zu.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Zu,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return Ju.setFromEuler(this),this.setFromQuaternion(Ju,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new O(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}da.prototype.isEuler=!0,da.DefaultOrder="XYZ",da.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class gc{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}isEnabled(e){return 0!=(this.mask&(1<<e|0))}}let Fd=0;const $u=new O,Wa=new Ni,As=new fn,vc=new O,Fo=new O,Dd=new O,Id=new Ni,Qu=new O(1,0,0),eh=new O(0,1,0),th=new O(0,0,1),Nd={type:"added"},nh={type:"removed"};class li extends Xr{constructor(){super(),Object.defineProperty(this,"id",{value:Fd++}),this.uuid=er(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=li.DefaultUp.clone();const e=new O,t=new da,n=new Ni,i=new O(1,1,1);t._onChange(function a(){n.setFromEuler(t,!1)}),n._onChange(function o(){t.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new fn},normalMatrix:{value:new Ii}}),this.matrix=new fn,this.matrixWorld=new fn,this.matrixAutoUpdate=li.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new gc,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Wa.setFromAxisAngle(e,t),this.quaternion.multiply(Wa),this}rotateOnWorldAxis(e,t){return Wa.setFromAxisAngle(e,t),this.quaternion.premultiply(Wa),this}rotateX(e){return this.rotateOnAxis(Qu,e)}rotateY(e){return this.rotateOnAxis(eh,e)}rotateZ(e){return this.rotateOnAxis(th,e)}translateOnAxis(e,t){return $u.copy(e).applyQuaternion(this.quaternion),this.position.add($u.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Qu,e)}translateY(e){return this.translateOnAxis(eh,e)}translateZ(e){return this.translateOnAxis(th,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(As.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?vc.copy(e):vc.set(e,t,n);const i=this.parent;this.updateWorldMatrix(!0,!1),Fo.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?As.lookAt(Fo,vc,this.up):As.lookAt(vc,Fo,this.up),this.quaternion.setFromRotationMatrix(As),i&&(As.extractRotation(i.matrixWorld),Wa.setFromRotationMatrix(As),this.quaternion.premultiply(Wa.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Nd)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(nh)),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(nh)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),As.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),As.multiply(e.parent.matrixWorld)),e.applyMatrix4(As),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){const o=this.children[n].getObjectByProperty(e,t);if(void 0!==o)return o}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Fo,e,Dd),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Fo,Id,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const i=this.children;for(let a=0,o=i.length;a<o;a++)i[a].updateWorldMatrix(!1,!0)}}toJSON(e){const t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const i={};function a(c,l){return void 0===c[l.uuid]&&(c[l.uuid]=l.toJSON(e)),l.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=a(e.geometries,this.geometry);const c=this.geometry.parameters;if(void 0!==c&&void 0!==c.shapes){const l=c.shapes;if(Array.isArray(l))for(let h=0,p=l.length;h<p;h++)a(e.shapes,l[h]);else a(e.shapes,l)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(a(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const c=[];for(let l=0,h=this.material.length;l<h;l++)c.push(a(e.materials,this.material[l]));i.material=c}else i.material=a(e.materials,this.material);if(this.children.length>0){i.children=[];for(let c=0;c<this.children.length;c++)i.children.push(this.children[c].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let c=0;c<this.animations.length;c++)i.animations.push(a(e.animations,this.animations[c]))}if(t){const c=o(e.geometries),l=o(e.materials),h=o(e.textures),p=o(e.images),m=o(e.shapes),g=o(e.skeletons),v=o(e.animations);c.length>0&&(n.geometries=c),l.length>0&&(n.materials=l),h.length>0&&(n.textures=h),p.length>0&&(n.images=p),m.length>0&&(n.shapes=m),g.length>0&&(n.skeletons=g),v.length>0&&(n.animations=v)}return n.object=i,n;function o(c){const l=[];for(const h in c){const p=c[h];delete p.metadata,l.push(p)}return l}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let n=0;n<e.children.length;n++)this.add(e.children[n].clone());return this}}li.DefaultUp=new O(0,1,0),li.DefaultMatrixAutoUpdate=!0,li.prototype.isObject3D=!0;const ts=new O,zs=new O,Pl=new O,Ls=new O,Xa=new O,ja=new O,ih=new O,Fl=new O,Dl=new O,Il=new O;class qi{constructor(e=new O,t=new O,n=new O){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){i.subVectors(n,t),ts.subVectors(e,t),i.cross(ts);const a=i.lengthSq();return a>0?i.multiplyScalar(1/Math.sqrt(a)):i.set(0,0,0)}static getBarycoord(e,t,n,i,a){ts.subVectors(i,t),zs.subVectors(n,t),Pl.subVectors(e,t);const o=ts.dot(ts),c=ts.dot(zs),l=ts.dot(Pl),h=zs.dot(zs),p=zs.dot(Pl),m=o*h-c*c;if(0===m)return a.set(-2,-1,-1);const g=1/m,v=(h*l-c*p)*g,x=(o*p-c*l)*g;return a.set(1-v-x,x,v)}static containsPoint(e,t,n,i){return this.getBarycoord(e,t,n,i,Ls),Ls.x>=0&&Ls.y>=0&&Ls.x+Ls.y<=1}static getUV(e,t,n,i,a,o,c,l){return this.getBarycoord(e,t,n,i,Ls),l.set(0,0),l.addScaledVector(a,Ls.x),l.addScaledVector(o,Ls.y),l.addScaledVector(c,Ls.z),l}static isFrontFacing(e,t,n,i){return ts.subVectors(n,t),zs.subVectors(e,t),ts.cross(zs).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,n,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,i),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return ts.subVectors(this.c,this.b),zs.subVectors(this.a,this.b),.5*ts.cross(zs).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return qi.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return qi.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,i,a){return qi.getUV(e,this.a,this.b,this.c,t,n,i,a)}containsPoint(e){return qi.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return qi.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,i=this.b,a=this.c;let o,c;Xa.subVectors(i,n),ja.subVectors(a,n),Fl.subVectors(e,n);const l=Xa.dot(Fl),h=ja.dot(Fl);if(l<=0&&h<=0)return t.copy(n);Dl.subVectors(e,i);const p=Xa.dot(Dl),m=ja.dot(Dl);if(p>=0&&m<=p)return t.copy(i);const g=l*m-p*h;if(g<=0&&l>=0&&p<=0)return o=l/(l-p),t.copy(n).addScaledVector(Xa,o);Il.subVectors(e,a);const v=Xa.dot(Il),x=ja.dot(Il);if(x>=0&&v<=x)return t.copy(a);const T=v*h-l*x;if(T<=0&&h>=0&&x<=0)return c=h/(h-x),t.copy(n).addScaledVector(ja,c);const L=p*x-v*m;if(L<=0&&m-p>=0&&v-x>=0)return ih.subVectors(a,i),c=(m-p)/(m-p+(v-x)),t.copy(i).addScaledVector(ih,c);const E=1/(L+T+g);return o=T*E,c=g*E,t.copy(n).addScaledVector(Xa,o).addScaledVector(ja,c)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let Ud=0;class rr extends Xr{constructor(){super(),Object.defineProperty(this,"id",{value:Ud++}),this.uuid=er(),this.name="",this.type="Material",this.fog=!0,this.blending=xt,this.side=_n,this.vertexColors=!1,this.opacity=1,this.format=pi,this.transparent=!1,this.blendSrc=at,this.blendDst=qe,this.blendEquation=Kt,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Yt,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if("shading"===t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n;continue}const i=this[t];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function i(a){const o=[];for(const c in a){const l=a[c];delete l.metadata,o.push(l)}return o}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==xt&&(n.blending=this.blending),this.side!==_n&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.format!==pi&&(n.format=this.format),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t){const a=i(e.textures),o=i(e.images);a.length>0&&(n.textures=a),o.length>0&&(n.images=o)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.format=e.format,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const i=t.length;n=new Array(i);for(let a=0;a!==i;++a)n[a]=t[a].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}rr.prototype.isMaterial=!0;const rh={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ns={h:0,s:0,l:0},yc={h:0,s:0,l:0};function Nl(r,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?r+6*(e-r)*t:t<.5?e:t<2/3?r+6*(e-r)*(2/3-t):r}function Ul(r){return r<.04045?.0773993808*r:Math.pow(.9478672986*r+.0521327014,2.4)}function Bl(r){return r<.0031308?12.92*r:1.055*Math.pow(r,.41666)-.055}class Wt{constructor(e,t,n){return void 0===t&&void 0===n?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this}setRGB(e,t,n){return this.r=e,this.g=t,this.b=n,this}setHSL(e,t,n){if(e=Na(e,1),t=ji(t,0,1),n=ji(n,0,1),0===t)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+t):n+t-n*t,a=2*n-i;this.r=Nl(a,i,e+1/3),this.g=Nl(a,i,e),this.b=Nl(a,i,e-1/3)}return this}setStyle(e){function t(i){void 0!==i&&parseFloat(i)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let i;const o=n[2];switch(n[1]){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(i[1],10))/255,this.g=Math.min(255,parseInt(i[2],10))/255,this.b=Math.min(255,parseInt(i[3],10))/255,t(i[4]),this;if(i=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(i[1],10))/100,this.g=Math.min(100,parseInt(i[2],10))/100,this.b=Math.min(100,parseInt(i[3],10))/100,t(i[4]),this;break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o)){const c=parseFloat(i[1])/360,l=parseInt(i[2],10)/100,h=parseInt(i[3],10)/100;return t(i[4]),this.setHSL(c,l,h)}}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){const i=n[1],a=i.length;if(3===a)return this.r=parseInt(i.charAt(0)+i.charAt(0),16)/255,this.g=parseInt(i.charAt(1)+i.charAt(1),16)/255,this.b=parseInt(i.charAt(2)+i.charAt(2),16)/255,this;if(6===a)return this.r=parseInt(i.charAt(0)+i.charAt(1),16)/255,this.g=parseInt(i.charAt(2)+i.charAt(3),16)/255,this.b=parseInt(i.charAt(4)+i.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}setColorName(e){const t=rh[e.toLowerCase()];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Ul(e.r),this.g=Ul(e.g),this.b=Ul(e.b),this}copyLinearToSRGB(e){return this.r=Bl(e.r),this.g=Bl(e.g),this.b=Bl(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){const t=this.r,n=this.g,i=this.b,a=Math.max(t,n,i),o=Math.min(t,n,i);let c,l;const h=(o+a)/2;if(o===a)c=0,l=0;else{const p=a-o;switch(l=h<=.5?p/(a+o):p/(2-a-o),a){case t:c=(n-i)/p+(n<i?6:0);break;case n:c=(i-t)/p+2;break;case i:c=(t-n)/p+4}c/=6}return e.h=c,e.s=l,e.l=h,e}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(e,t,n){return this.getHSL(ns),ns.h+=e,ns.s+=t,ns.l+=n,this.setHSL(ns.h,ns.s,ns.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(ns),e.getHSL(yc);const n=$r(ns.h,yc.h,t),i=$r(ns.s,yc.s,t),a=$r(ns.l,yc.l,t);return this.setHSL(n,i,a),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}Wt.NAMES=rh,Wt.prototype.isColor=!0,Wt.prototype.r=1,Wt.prototype.g=1,Wt.prototype.b=1;class Cs extends rr{constructor(e){super(),this.type="MeshBasicMaterial",this.color=new Wt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Nn,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}Cs.prototype.isMeshBasicMaterial=!0;const Ui=new O,_c=new st;class mi{constructor(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===n,this.usage=pr,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,a=this.itemSize;i<a;i++)this.array[e+i]=t.array[n+i];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){const t=this.array;let n=0;for(let i=0,a=e.length;i<a;i++){let o=e[i];void 0===o&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),o=new Wt),t[n++]=o.r,t[n++]=o.g,t[n++]=o.b}return this}copyVector2sArray(e){const t=this.array;let n=0;for(let i=0,a=e.length;i<a;i++){let o=e[i];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),o=new st),t[n++]=o.x,t[n++]=o.y}return this}copyVector3sArray(e){const t=this.array;let n=0;for(let i=0,a=e.length;i<a;i++){let o=e[i];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),o=new O),t[n++]=o.x,t[n++]=o.y,t[n++]=o.z}return this}copyVector4sArray(e){const t=this.array;let n=0;for(let i=0,a=e.length;i<a;i++){let o=e[i];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),o=new rn),t[n++]=o.x,t[n++]=o.y,t[n++]=o.z,t[n++]=o.w}return this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)_c.fromBufferAttribute(this,t),_c.applyMatrix3(e),this.setXY(t,_c.x,_c.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)Ui.fromBufferAttribute(this,t),Ui.applyMatrix3(e),this.setXYZ(t,Ui.x,Ui.y,Ui.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)Ui.x=this.getX(t),Ui.y=this.getY(t),Ui.z=this.getZ(t),Ui.applyMatrix4(e),this.setXYZ(t,Ui.x,Ui.y,Ui.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Ui.x=this.getX(t),Ui.y=this.getY(t),Ui.z=this.getZ(t),Ui.applyNormalMatrix(e),this.setXYZ(t,Ui.x,Ui.y,Ui.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Ui.x=this.getX(t),Ui.y=this.getY(t),Ui.z=this.getZ(t),Ui.transformDirection(e),this.setXYZ(t,Ui.x,Ui.y,Ui.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){return this.array[e*this.itemSize]}setX(e,t){return this.array[e*this.itemSize]=t,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,t){return this.array[e*this.itemSize+1]=t,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,t){return this.array[e*this.itemSize+2]=t,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,t){return this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return this.array[0+(e*=this.itemSize)]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return this.array[0+(e*=this.itemSize)]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,a){return this.array[0+(e*=this.itemSize)]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=a,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==pr&&(e.usage=this.usage),(0!==this.updateRange.offset||-1!==this.updateRange.count)&&(e.updateRange=this.updateRange),e}}mi.prototype.isBufferAttribute=!0;class sh extends mi{constructor(e,t,n){super(new Int8Array(e),t,n)}}class ah extends mi{constructor(e,t,n){super(new Uint8Array(e),t,n)}}class oh extends mi{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}}class ch extends mi{constructor(e,t,n){super(new Int16Array(e),t,n)}}class xc extends mi{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class lh extends mi{constructor(e,t,n){super(new Int32Array(e),t,n)}}class Ec extends mi{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class uh extends mi{constructor(e,t,n){super(new Uint16Array(e),t,n)}}uh.prototype.isFloat16BufferAttribute=!0;class on extends mi{constructor(e,t,n){super(new Float32Array(e),t,n)}}class hh extends mi{constructor(e,t,n){super(new Float64Array(e),t,n)}}let Bd=0;const Yr=new fn,Ol=new li,qa=new O,Br=new Ji,Do=new Ji,sr=new O;class zn extends Xr{constructor(){super(),Object.defineProperty(this,"id",{value:Bd++}),this.uuid=er(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return this.index=Array.isArray(e)?new(zo(e)>65535?Ec:xc)(e,1):e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const a=(new Ii).getNormalMatrix(e);n.applyNormalMatrix(a),n.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return Yr.makeRotationFromQuaternion(e),this.applyMatrix4(Yr),this}rotateX(e){return Yr.makeRotationX(e),this.applyMatrix4(Yr),this}rotateY(e){return Yr.makeRotationY(e),this.applyMatrix4(Yr),this}rotateZ(e){return Yr.makeRotationZ(e),this.applyMatrix4(Yr),this}translate(e,t,n){return Yr.makeTranslation(e,t,n),this.applyMatrix4(Yr),this}scale(e,t,n){return Yr.makeScale(e,t,n),this.applyMatrix4(Yr),this}lookAt(e){return Ol.lookAt(e),Ol.updateMatrix(),this.applyMatrix4(Ol.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(qa).negate(),this.translate(qa.x,qa.y,qa.z),this}setFromPoints(e){const t=[];for(let n=0,i=e.length;n<i;n++){const a=e[n];t.push(a.x,a.y,a.z||0)}return this.setAttribute("position",new on(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Ji);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new O(-1/0,-1/0,-1/0),new O(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,i=t.length;n<i;n++)Br.setFromBufferAttribute(t[n]),this.morphTargetsRelative?(sr.addVectors(this.boundingBox.min,Br.min),this.boundingBox.expandByPoint(sr),sr.addVectors(this.boundingBox.max,Br.max),this.boundingBox.expandByPoint(sr)):(this.boundingBox.expandByPoint(Br.min),this.boundingBox.expandByPoint(Br.max))}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Ks);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new O,1/0);if(e){const n=this.boundingSphere.center;if(Br.setFromBufferAttribute(e),t)for(let a=0,o=t.length;a<o;a++)Do.setFromBufferAttribute(t[a]),this.morphTargetsRelative?(sr.addVectors(Br.min,Do.min),Br.expandByPoint(sr),sr.addVectors(Br.max,Do.max),Br.expandByPoint(sr)):(Br.expandByPoint(Do.min),Br.expandByPoint(Do.max));Br.getCenter(n);let i=0;for(let a=0,o=e.count;a<o;a++)sr.fromBufferAttribute(e,a),i=Math.max(i,n.distanceToSquared(sr));if(t)for(let a=0,o=t.length;a<o;a++){const c=t[a],l=this.morphTargetsRelative;for(let h=0,p=c.count;h<p;h++)sr.fromBufferAttribute(c,h),l&&(qa.fromBufferAttribute(e,h),sr.add(qa)),i=Math.max(i,n.distanceToSquared(sr))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=e.array,i=t.position.array,a=t.normal.array,o=t.uv.array,c=i.length/3;void 0===t.tangent&&this.setAttribute("tangent",new mi(new Float32Array(4*c),4));const l=t.tangent.array,h=[],p=[];for(let ke=0;ke<c;ke++)h[ke]=new O,p[ke]=new O;const m=new O,g=new O,v=new O,x=new st,T=new st,L=new st,E=new O,_=new O;function D(ke,be,X){m.fromArray(i,3*ke),g.fromArray(i,3*be),v.fromArray(i,3*X),x.fromArray(o,2*ke),T.fromArray(o,2*be),L.fromArray(o,2*X),g.sub(m),v.sub(m),T.sub(x),L.sub(x);const Z=1/(T.x*L.y-L.x*T.y);isFinite(Z)&&(E.copy(g).multiplyScalar(L.y).addScaledVector(v,-T.y).multiplyScalar(Z),_.copy(v).multiplyScalar(T.x).addScaledVector(g,-L.x).multiplyScalar(Z),h[ke].add(E),h[be].add(E),h[X].add(E),p[ke].add(_),p[be].add(_),p[X].add(_))}let R=this.groups;0===R.length&&(R=[{start:0,count:n.length}]);for(let ke=0,be=R.length;ke<be;++ke){const X=R[ke],Z=X.start;for(let Xe=Z,Le=Z+X.count;Xe<Le;Xe+=3)D(n[Xe+0],n[Xe+1],n[Xe+2])}const G=new O,$=new O,fe=new O,Me=new O;function Je(ke){fe.fromArray(a,3*ke),Me.copy(fe);const be=h[ke];G.copy(be),G.sub(fe.multiplyScalar(fe.dot(be))).normalize(),$.crossVectors(Me,be);const Z=$.dot(p[ke])<0?-1:1;l[4*ke]=G.x,l[4*ke+1]=G.y,l[4*ke+2]=G.z,l[4*ke+3]=Z}for(let ke=0,be=R.length;ke<be;++ke){const X=R[ke],Z=X.start;for(let Xe=Z,Le=Z+X.count;Xe<Le;Xe+=3)Je(n[Xe+0]),Je(n[Xe+1]),Je(n[Xe+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new mi(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let g=0,v=n.count;g<v;g++)n.setXYZ(g,0,0,0);const i=new O,a=new O,o=new O,c=new O,l=new O,h=new O,p=new O,m=new O;if(e)for(let g=0,v=e.count;g<v;g+=3){const x=e.getX(g+0),T=e.getX(g+1),L=e.getX(g+2);i.fromBufferAttribute(t,x),a.fromBufferAttribute(t,T),o.fromBufferAttribute(t,L),p.subVectors(o,a),m.subVectors(i,a),p.cross(m),c.fromBufferAttribute(n,x),l.fromBufferAttribute(n,T),h.fromBufferAttribute(n,L),c.add(p),l.add(p),h.add(p),n.setXYZ(x,c.x,c.y,c.z),n.setXYZ(T,l.x,l.y,l.z),n.setXYZ(L,h.x,h.y,h.z)}else for(let g=0,v=t.count;g<v;g+=3)i.fromBufferAttribute(t,g+0),a.fromBufferAttribute(t,g+1),o.fromBufferAttribute(t,g+2),p.subVectors(o,a),m.subVectors(i,a),p.cross(m),n.setXYZ(g+0,p.x,p.y,p.z),n.setXYZ(g+1,p.x,p.y,p.z),n.setXYZ(g+2,p.x,p.y,p.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(e,t){if(!e||!e.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const n=this.attributes;for(const i in n){if(void 0===e.attributes[i])continue;const o=n[i].array,c=e.attributes[i],l=c.array,h=c.itemSize*t,p=Math.min(l.length,o.length-h);for(let m=0,g=h;m<p;m++,g++)o[g]=l[m]}return this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)sr.fromBufferAttribute(e,t),sr.normalize(),e.setXYZ(t,sr.x,sr.y,sr.z)}toNonIndexed(){function e(c,l){const h=c.array,p=c.itemSize,m=c.normalized,g=new h.constructor(l.length*p);let v=0,x=0;for(let T=0,L=l.length;T<L;T++){v=c.isInterleavedBufferAttribute?l[T]*c.data.stride+c.offset:l[T]*p;for(let E=0;E<p;E++)g[x++]=h[v++]}return new mi(g,p,m)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new zn,n=this.index.array,i=this.attributes;for(const c in i){const h=e(i[c],n);t.setAttribute(c,h)}const a=this.morphAttributes;for(const c in a){const l=[],h=a[c];for(let p=0,m=h.length;p<m;p++){const v=e(h[p],n);l.push(v)}t.morphAttributes[c]=l}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let c=0,l=o.length;c<l;c++){const h=o[c];t.addGroup(h.start,h.count,h.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const l=this.parameters;for(const h in l)void 0!==l[h]&&(e[h]=l[h]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const l in n)e.data.attributes[l]=n[l].toJSON(e.data);const i={};let a=!1;for(const l in this.morphAttributes){const h=this.morphAttributes[l],p=[];for(let m=0,g=h.length;m<g;m++)p.push(h[m].toJSON(e.data));p.length>0&&(i[l]=p,a=!0)}a&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const c=this.boundingSphere;return null!==c&&(e.data.boundingSphere={center:c.center.toArray(),radius:c.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone(t));const i=e.attributes;for(const h in i)this.setAttribute(h,i[h].clone(t));const a=e.morphAttributes;for(const h in a){const p=[],m=a[h];for(let g=0,v=m.length;g<v;g++)p.push(m[g].clone(t));this.morphAttributes[h]=p}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let h=0,p=o.length;h<p;h++){const m=o[h];this.addGroup(m.start,m.count,m.materialIndex)}const c=e.boundingBox;null!==c&&(this.boundingBox=c.clone());const l=e.boundingSphere;return null!==l&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,void 0!==e.parameters&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}zn.prototype.isBufferGeometry=!0;const fh=new fn,Ya=new Js,Hl=new Ks,Qs=new O,ea=new O,ta=new O,kl=new O,Gl=new O,Vl=new O,bc=new O,Mc=new O,Tc=new O,wc=new st,Sc=new st,Rc=new st,Wl=new O,Ac=new O;class $i extends li{constructor(e=new zn,t=new Cs){super(),this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let a=0,o=i.length;a<o;a++){const c=i[a].name||String(a);this.morphTargetInfluences.push(0),this.morphTargetDictionary[c]=a}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(e,t){const n=this.geometry,i=this.material,a=this.matrixWorld;if(void 0===i||(null===n.boundingSphere&&n.computeBoundingSphere(),Hl.copy(n.boundingSphere),Hl.applyMatrix4(a),!1===e.ray.intersectsSphere(Hl))||(fh.copy(a).invert(),Ya.copy(e.ray).applyMatrix4(fh),null!==n.boundingBox&&!1===Ya.intersectsBox(n.boundingBox)))return;let o;if(n.isBufferGeometry){const c=n.index,l=n.attributes.position,h=n.morphAttributes.position,p=n.morphTargetsRelative,m=n.attributes.uv,g=n.attributes.uv2,v=n.groups,x=n.drawRange;if(null!==c)if(Array.isArray(i))for(let T=0,L=v.length;T<L;T++){const E=v[T],_=i[E.materialIndex];for(let G=Math.max(E.start,x.start),$=Math.min(c.count,Math.min(E.start+E.count,x.start+x.count));G<$;G+=3){const fe=c.getX(G),Me=c.getX(G+1),Je=c.getX(G+2);o=zc(this,_,e,Ya,l,h,p,m,g,fe,Me,Je),o&&(o.faceIndex=Math.floor(G/3),o.face.materialIndex=E.materialIndex,t.push(o))}}else for(let E=Math.max(0,x.start),_=Math.min(c.count,x.start+x.count);E<_;E+=3){const D=c.getX(E),R=c.getX(E+1),G=c.getX(E+2);o=zc(this,i,e,Ya,l,h,p,m,g,D,R,G),o&&(o.faceIndex=Math.floor(E/3),t.push(o))}else if(void 0!==l)if(Array.isArray(i))for(let T=0,L=v.length;T<L;T++){const E=v[T],_=i[E.materialIndex];for(let G=Math.max(E.start,x.start),$=Math.min(l.count,Math.min(E.start+E.count,x.start+x.count));G<$;G+=3)o=zc(this,_,e,Ya,l,h,p,m,g,G,G+1,G+2),o&&(o.faceIndex=Math.floor(G/3),o.face.materialIndex=E.materialIndex,t.push(o))}else for(let E=Math.max(0,x.start),_=Math.min(l.count,x.start+x.count);E<_;E+=3)o=zc(this,i,e,Ya,l,h,p,m,g,E,E+1,E+2),o&&(o.faceIndex=Math.floor(E/3),t.push(o))}else n.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}function zc(r,e,t,n,i,a,o,c,l,h,p,m){Qs.fromBufferAttribute(i,h),ea.fromBufferAttribute(i,p),ta.fromBufferAttribute(i,m);const g=r.morphTargetInfluences;if(a&&g){bc.set(0,0,0),Mc.set(0,0,0),Tc.set(0,0,0);for(let x=0,T=a.length;x<T;x++){const L=g[x],E=a[x];0!==L&&(kl.fromBufferAttribute(E,h),Gl.fromBufferAttribute(E,p),Vl.fromBufferAttribute(E,m),o?(bc.addScaledVector(kl,L),Mc.addScaledVector(Gl,L),Tc.addScaledVector(Vl,L)):(bc.addScaledVector(kl.sub(Qs),L),Mc.addScaledVector(Gl.sub(ea),L),Tc.addScaledVector(Vl.sub(ta),L)))}Qs.add(bc),ea.add(Mc),ta.add(Tc)}r.isSkinnedMesh&&(r.boneTransform(h,Qs),r.boneTransform(p,ea),r.boneTransform(m,ta));const v=function Od(r,e,t,n,i,a,o,c){let l;if(l=e.side===Qt?n.intersectTriangle(o,a,i,!0,c):n.intersectTriangle(i,a,o,e.side!==ti,c),null===l)return null;Ac.copy(c),Ac.applyMatrix4(r.matrixWorld);const h=t.ray.origin.distanceTo(Ac);return h<t.near||h>t.far?null:{distance:h,point:Ac.clone(),object:r}}(r,e,t,n,Qs,ea,ta,Wl);if(v){c&&(wc.fromBufferAttribute(c,h),Sc.fromBufferAttribute(c,p),Rc.fromBufferAttribute(c,m),v.uv=qi.getUV(Wl,Qs,ea,ta,wc,Sc,Rc,new st)),l&&(wc.fromBufferAttribute(l,h),Sc.fromBufferAttribute(l,p),Rc.fromBufferAttribute(l,m),v.uv2=qi.getUV(Wl,Qs,ea,ta,wc,Sc,Rc,new st));const x={a:h,b:p,c:m,normal:new O,materialIndex:0};qi.getNormal(Qs,ea,ta,x.normal),v.face=x}return v}$i.prototype.isMesh=!0;class Ps extends zn{constructor(e=1,t=1,n=1,i=1,a=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:a,depthSegments:o};const c=this;i=Math.floor(i),a=Math.floor(a),o=Math.floor(o);const l=[],h=[],p=[],m=[];let g=0,v=0;function x(T,L,E,_,D,R,G,$,fe,Me,Je){const ke=R/fe,be=G/Me,X=R/2,Z=G/2,ze=$/2,Xe=fe+1,Le=Me+1;let je=0,Gt=0;const Jt=new O;for(let ot=0;ot<Le;ot++){const ht=ot*be-Z;for(let $t=0;$t<Xe;$t++)Jt[T]=($t*ke-X)*_,Jt[L]=ht*D,Jt[E]=ze,h.push(Jt.x,Jt.y,Jt.z),Jt[T]=0,Jt[L]=0,Jt[E]=$>0?1:-1,p.push(Jt.x,Jt.y,Jt.z),m.push($t/fe),m.push(1-ot/Me),je+=1}for(let ot=0;ot<Me;ot++)for(let ht=0;ht<fe;ht++){const qt=g+ht+Xe*(ot+1),ln=g+(ht+1)+Xe*(ot+1),fi=g+(ht+1)+Xe*ot;l.push(g+ht+Xe*ot,qt,fi),l.push(qt,ln,fi),Gt+=6}c.addGroup(v,Gt,Je),v+=Gt,g+=je}x("z","y","x",-1,-1,n,t,e,o,a,0),x("z","y","x",1,-1,n,t,-e,o,a,1),x("x","z","y",1,1,e,n,t,i,o,2),x("x","z","y",1,-1,e,n,-t,i,o,3),x("x","y","z",1,-1,e,t,n,i,a,4),x("x","y","z",-1,-1,e,t,-n,i,a,5),this.setIndex(l),this.setAttribute("position",new on(h,3)),this.setAttribute("normal",new on(p,3)),this.setAttribute("uv",new on(m,2))}static fromJSON(e){return new Ps(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Ka(r){const e={};for(const t in r){e[t]={};for(const n in r[t]){const i=r[t][n];e[t][n]=i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.clone():Array.isArray(i)?i.slice():i}}return e}function vr(r){const e={};for(let t=0;t<r.length;t++){const n=Ka(r[t]);for(const i in n)e[i]=n[i]}return e}const dh={clone:Ka,merge:vr};class Fs extends rr{constructor(e){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Ka(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const o=this.uniforms[i].value;t.uniforms[i]=o&&o.isTexture?{type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?{type:"c",value:o.getHex()}:o&&o.isVector2?{type:"v2",value:o.toArray()}:o&&o.isVector3?{type:"v3",value:o.toArray()}:o&&o.isVector4?{type:"v4",value:o.toArray()}:o&&o.isMatrix3?{type:"m3",value:o.toArray()}:o&&o.isMatrix4?{type:"m4",value:o.toArray()}:{value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const n={};for(const i in this.extensions)!0===this.extensions[i]&&(n[i]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}Fs.prototype.isShaderMaterial=!0;class Io extends li{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new fn,this.projectionMatrix=new fn,this.projectionMatrixInverse=new fn}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}Io.prototype.isCamera=!0;class ar extends Io{constructor(e=50,t=1,n=.1,i=2e3){super(),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*cs*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*jr*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*cs*Math.atan(Math.tan(.5*jr*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,i,a,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=a,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*jr*this.fov)/this.zoom,n=2*t,i=this.aspect*n,a=-.5*i;const o=this.view;if(null!==this.view&&this.view.enabled){const l=o.fullWidth,h=o.fullHeight;a+=o.offsetX*i/l,t-=o.offsetY*n/h,i*=o.width/l,n*=o.height/h}const c=this.filmOffset;0!==c&&(a+=e*c/this.getFilmWidth()),this.projectionMatrix.makePerspective(a,a+i,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}ar.prototype.isPerspectiveCamera=!0;class Lc extends li{constructor(e,t,n){if(super(),this.type="CubeCamera",!0!==n.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=n;const i=new ar(90,1,e,t);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new O(1,0,0)),this.add(i);const a=new ar(90,1,e,t);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new O(-1,0,0)),this.add(a);const o=new ar(90,1,e,t);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(new O(0,1,0)),this.add(o);const c=new ar(90,1,e,t);c.layers=this.layers,c.up.set(0,0,-1),c.lookAt(new O(0,-1,0)),this.add(c);const l=new ar(90,1,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new O(0,0,1)),this.add(l);const h=new ar(90,1,e,t);h.layers=this.layers,h.up.set(0,-1,0),h.lookAt(new O(0,0,-1)),this.add(h)}update(e,t){null===this.parent&&this.updateMatrixWorld();const n=this.renderTarget,[i,a,o,c,l,h]=this.children,p=e.xr.enabled,m=e.getRenderTarget();e.xr.enabled=!1;const g=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,i),e.setRenderTarget(n,1),e.render(t,a),e.setRenderTarget(n,2),e.render(t,o),e.setRenderTarget(n,3),e.render(t,c),e.setRenderTarget(n,4),e.render(t,l),n.texture.generateMipmaps=g,e.setRenderTarget(n,5),e.render(t,h),e.setRenderTarget(m),e.xr.enabled=p}}class $a extends zi{constructor(e,t,n,i,a,o,c,l,h,p){super(e=void 0!==e?e:[],t=void 0!==t?t:Re,n,i,a,o,c,l,h,p),this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}$a.prototype.isCubeTexture=!0;class Cc extends Li{constructor(e,t,n){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=n),super(e,e,t),this.texture=new $a(void 0,(t=t||{}).mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:Cn,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.format=pi,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n_uniforms={tEquirect:{value:null}},n_vertexShader="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",n_fragmentShader="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",i=new Ps(5,5,5),a=new Fs({name:"CubemapFromEquirect",uniforms:Ka(n_uniforms),vertexShader:n_vertexShader,fragmentShader:n_fragmentShader,side:Qt,blending:dn});a.uniforms.tEquirect.value=t;const o=new $i(i,a),c=t.minFilter;return t.minFilter===Dr&&(t.minFilter=Cn),new Lc(1,10,this).update(e,o),t.minFilter=c,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,n,i){const a=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,n,i);e.setRenderTarget(a)}}Cc.prototype.isWebGLCubeRenderTarget=!0;const Xl=new O,Gd=new O,Vd=new Ii;class fs{constructor(e=new O(1,0,0),t=0){this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const i=Xl.subVectors(n,t).cross(Gd.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){const n=e.delta(Xl),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const a=-(e.start.dot(this.normal)+this.constant)/i;return a<0||a>1?null:t.copy(n).multiplyScalar(a).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||Vd.getNormalMatrix(e),i=this.coplanarPoint(Xl).applyMatrix4(e),a=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(a),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}fs.prototype.isPlane=!0;const Qa=new Ks,Pc=new O;class No{constructor(e=new fs,t=new fs,n=new fs,i=new fs,a=new fs,o=new fs){this.planes=[e,t,n,i,a,o]}set(e,t,n,i,a,o){const c=this.planes;return c[0].copy(e),c[1].copy(t),c[2].copy(n),c[3].copy(i),c[4].copy(a),c[5].copy(o),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){const t=this.planes,n=e.elements,i=n[0],a=n[1],o=n[2],c=n[3],l=n[4],h=n[5],p=n[6],m=n[7],g=n[8],v=n[9],x=n[10],T=n[11],L=n[12],E=n[13],_=n[14],D=n[15];return t[0].setComponents(c-i,m-l,T-g,D-L).normalize(),t[1].setComponents(c+i,m+l,T+g,D+L).normalize(),t[2].setComponents(c+a,m+h,T+v,D+E).normalize(),t[3].setComponents(c-a,m-h,T-v,D-E).normalize(),t[4].setComponents(c-o,m-p,T-x,D-_).normalize(),t[5].setComponents(c+o,m+p,T+x,D+_).normalize(),this}intersectsObject(e){const t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),Qa.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Qa)}intersectsSprite(e){return Qa.center.set(0,0,0),Qa.radius=.7071067811865476,Qa.applyMatrix4(e.matrixWorld),this.intersectsSphere(Qa)}intersectsSphere(e){const t=this.planes,n=e.center,i=-e.radius;for(let a=0;a<6;a++)if(t[a].distanceToPoint(n)<i)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const i=t[n];if(Pc.x=i.normal.x>0?e.max.x:e.min.x,Pc.y=i.normal.y>0?e.max.y:e.min.y,Pc.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(Pc)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function ph(){let r=null,e=!1,t=null,n=null;function i(a,o){t(a,o),n=r.requestAnimationFrame(i)}return{start:function(){!0!==e&&null!==t&&(n=r.requestAnimationFrame(i),e=!0)},stop:function(){r.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(a){t=a},setContext:function(a){r=a}}}function Wd(r,e){const t=e.isWebGL2,n=new WeakMap;return{get:function o(h){return h.isInterleavedBufferAttribute&&(h=h.data),n.get(h)},remove:function c(h){h.isInterleavedBufferAttribute&&(h=h.data);const p=n.get(h);p&&(r.deleteBuffer(p.buffer),n.delete(h))},update:function l(h,p){if(h.isGLBufferAttribute){const g=n.get(h);return void((!g||g.version<h.version)&&n.set(h,{buffer:h.buffer,type:h.type,bytesPerElement:h.elementSize,version:h.version}))}h.isInterleavedBufferAttribute&&(h=h.data);const m=n.get(h);void 0===m?n.set(h,function i(h,p){const m=h.array,g=h.usage,v=r.createBuffer();r.bindBuffer(p,v),r.bufferData(p,m,g),h.onUploadCallback();let x=r.FLOAT;return m instanceof Float32Array?x=r.FLOAT:m instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):m instanceof Uint16Array?h.isFloat16BufferAttribute?t?x=r.HALF_FLOAT:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):x=r.UNSIGNED_SHORT:m instanceof Int16Array?x=r.SHORT:m instanceof Uint32Array?x=r.UNSIGNED_INT:m instanceof Int32Array?x=r.INT:m instanceof Int8Array?x=r.BYTE:(m instanceof Uint8Array||m instanceof Uint8ClampedArray)&&(x=r.UNSIGNED_BYTE),{buffer:v,type:x,bytesPerElement:m.BYTES_PER_ELEMENT,version:h.version}}(h,p)):m.version<h.version&&(function a(h,p,m){const g=p.array,v=p.updateRange;r.bindBuffer(m,h),-1===v.count?r.bufferSubData(m,0,g):(t?r.bufferSubData(m,v.offset*g.BYTES_PER_ELEMENT,g,v.offset,v.count):r.bufferSubData(m,v.offset*g.BYTES_PER_ELEMENT,g.subarray(v.offset,v.offset+v.count)),v.count=-1)}(m.buffer,h,p),m.version=h.version)}}}class pa extends zn{constructor(e=1,t=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};const a=e/2,o=t/2,c=Math.floor(n),l=Math.floor(i),h=c+1,p=l+1,m=e/c,g=t/l,v=[],x=[],T=[],L=[];for(let E=0;E<p;E++){const _=E*g-o;for(let D=0;D<h;D++)x.push(D*m-a,-_,0),T.push(0,0,1),L.push(D/c),L.push(1-E/l)}for(let E=0;E<l;E++)for(let _=0;_<c;_++){const R=_+h*(E+1),G=_+1+h*(E+1),$=_+1+h*E;v.push(_+h*E,R,$),v.push(R,G,$)}this.setIndex(v),this.setAttribute("position",new on(x,3)),this.setAttribute("normal",new on(T,3)),this.setAttribute("uv",new on(L,2))}static fromJSON(e){return new pa(e.width,e.height,e.widthSegments,e.heightSegments)}}const si={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 ) + 0.5;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\treturn texture2D( envMap, uv ).rgb;\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec;\n\t\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\t\treflectVec = reflect( - viewDir, normal );\n\t\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\t#else\n\t\t\t\treflectVec = refract( - viewDir, normal, refractionRatio );\n\t\t\t#endif\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tlightMapIrradiance *= PI;\n\t#endif\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= specularColorMapTexelToLinear( texture2D( specularColorMap, vUv ) ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= sheenColorMapTexelToLinear( texture2D( sheenColorMap, vUv ) ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\tvec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(\t\t0, 1,\t\t0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] > 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1, 2 ) * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform vec2 morphTargetsTextureSize;\n\t\tvec3 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset, const in int stride ) {\n\t\t\tfloat texelIndex = float( vertexIndex * stride + offset );\n\t\t\tfloat y = floor( texelIndex / morphTargetsTextureSize.x );\n\t\t\tfloat x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tvec3 morphUV = vec3( ( x + 0.5 ) / morphTargetsTextureSize.x, y / morphTargetsTextureSize.y, morphTargetIndex );\n\t\t\treturn texture( morphTargetsTexture, morphUV ).xyz;\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\t#ifndef USE_MORPHNORMALS\n\t\t\t\tif ( morphTargetInfluences[ i ] > 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 1 ) * morphTargetInfluences[ i ];\n\t\t\t#else\n\t\t\t\tif ( morphTargetInfluences[ i ] > 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 2 ) * morphTargetInfluences[ i ];\n\t\t\t#endif\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t\tf.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t\tf.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(\t1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,\t1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,\t1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionAlpha = 1.0;\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationColor, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n\ttransmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( float roughness, float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( vec2 fragCoord, float roughness, float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 diffuseColor, vec3 specularColor, float specularF90,\n\t\tvec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness,\n\t\tvec3 attenuationColor, float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},kt={common:{diffuse:{value:new Wt(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Ii},uv2Transform:{value:new Ii},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new st(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Wt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Wt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Ii}},sprite:{diffuse:{value:new Wt(16777215)},opacity:{value:1},center:{value:new st(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Ii}}},is={basic:{uniforms:vr([kt.common,kt.specularmap,kt.envmap,kt.aomap,kt.lightmap,kt.fog]),vertexShader:si.meshbasic_vert,fragmentShader:si.meshbasic_frag},lambert:{uniforms:vr([kt.common,kt.specularmap,kt.envmap,kt.aomap,kt.lightmap,kt.emissivemap,kt.fog,kt.lights,{emissive:{value:new Wt(0)}}]),vertexShader:si.meshlambert_vert,fragmentShader:si.meshlambert_frag},phong:{uniforms:vr([kt.common,kt.specularmap,kt.envmap,kt.aomap,kt.lightmap,kt.emissivemap,kt.bumpmap,kt.normalmap,kt.displacementmap,kt.fog,kt.lights,{emissive:{value:new Wt(0)},specular:{value:new Wt(1118481)},shininess:{value:30}}]),vertexShader:si.meshphong_vert,fragmentShader:si.meshphong_frag},standard:{uniforms:vr([kt.common,kt.envmap,kt.aomap,kt.lightmap,kt.emissivemap,kt.bumpmap,kt.normalmap,kt.displacementmap,kt.roughnessmap,kt.metalnessmap,kt.fog,kt.lights,{emissive:{value:new Wt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:si.meshphysical_vert,fragmentShader:si.meshphysical_frag},toon:{uniforms:vr([kt.common,kt.aomap,kt.lightmap,kt.emissivemap,kt.bumpmap,kt.normalmap,kt.displacementmap,kt.gradientmap,kt.fog,kt.lights,{emissive:{value:new Wt(0)}}]),vertexShader:si.meshtoon_vert,fragmentShader:si.meshtoon_frag},matcap:{uniforms:vr([kt.common,kt.bumpmap,kt.normalmap,kt.displacementmap,kt.fog,{matcap:{value:null}}]),vertexShader:si.meshmatcap_vert,fragmentShader:si.meshmatcap_frag},points:{uniforms:vr([kt.points,kt.fog]),vertexShader:si.points_vert,fragmentShader:si.points_frag},dashed:{uniforms:vr([kt.common,kt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:si.linedashed_vert,fragmentShader:si.linedashed_frag},depth:{uniforms:vr([kt.common,kt.displacementmap]),vertexShader:si.depth_vert,fragmentShader:si.depth_frag},normal:{uniforms:vr([kt.common,kt.bumpmap,kt.normalmap,kt.displacementmap,{opacity:{value:1}}]),vertexShader:si.meshnormal_vert,fragmentShader:si.meshnormal_frag},sprite:{uniforms:vr([kt.sprite,kt.fog]),vertexShader:si.sprite_vert,fragmentShader:si.sprite_frag},background:{uniforms:{uvTransform:{value:new Ii},t2D:{value:null}},vertexShader:si.background_vert,fragmentShader:si.background_frag},cube:{uniforms:vr([kt.envmap,{opacity:{value:1}}]),vertexShader:si.cube_vert,fragmentShader:si.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:si.equirect_vert,fragmentShader:si.equirect_frag},distanceRGBA:{uniforms:vr([kt.common,kt.displacementmap,{referencePosition:{value:new O},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:si.distanceRGBA_vert,fragmentShader:si.distanceRGBA_frag},shadow:{uniforms:vr([kt.lights,kt.fog,{color:{value:new Wt(0)},opacity:{value:1}}]),vertexShader:si.shadow_vert,fragmentShader:si.shadow_frag}};function Om(r,e,t,n,i){const a=new Wt(0);let c,l,o=0,h=null,p=0,m=null;function v(x,T){t.buffers.color.setClear(x.r,x.g,x.b,T,i)}return{getClearColor:function(){return a},setClearColor:function(x,T=1){a.set(x),o=T,v(a,o)},getClearAlpha:function(){return o},setClearAlpha:function(x){o=x,v(a,o)},render:function g(x,T){let L=!1,E=!0===T.isScene?T.background:null;E&&E.isTexture&&(E=e.get(E));const _=r.xr,D=_.getSession&&_.getSession();D&&"additive"===D.environmentBlendMode&&(E=null),null===E?v(a,o):E&&E.isColor&&(v(E,1),L=!0),(r.autoClear||L)&&r.clear(r.autoClearColor,r.autoClearDepth,r.autoClearStencil),E&&(E.isCubeTexture||E.mapping===zt)?(void 0===l&&(l=new $i(new Ps(1,1,1),new Fs({name:"BackgroundCubeMaterial",uniforms:Ka(is.cube.uniforms),vertexShader:is.cube.vertexShader,fragmentShader:is.cube.fragmentShader,side:Qt,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),l.geometry.deleteAttribute("uv"),l.onBeforeRender=function(R,G,$){this.matrixWorld.copyPosition($.matrixWorld)},Object.defineProperty(l.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(l)),l.material.uniforms.envMap.value=E,l.material.uniforms.flipEnvMap.value=E.isCubeTexture&&!1===E.isRenderTargetTexture?-1:1,(h!==E||p!==E.version||m!==r.toneMapping)&&(l.material.needsUpdate=!0,h=E,p=E.version,m=r.toneMapping),x.unshift(l,l.geometry,l.material,0,0,null)):E&&E.isTexture&&(void 0===c&&(c=new $i(new pa(2,2),new Fs({name:"BackgroundMaterial",uniforms:Ka(is.background.uniforms),vertexShader:is.background.vertexShader,fragmentShader:is.background.fragmentShader,side:_n,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(c)),c.material.uniforms.t2D.value=E,!0===E.matrixAutoUpdate&&E.updateMatrix(),c.material.uniforms.uvTransform.value.copy(E.matrix),(h!==E||p!==E.version||m!==r.toneMapping)&&(c.material.needsUpdate=!0,h=E,p=E.version,m=r.toneMapping),x.unshift(c,c.geometry,c.material,0,0,null))}}}function Hm(r,e,t,n){const i=r.getParameter(r.MAX_VERTEX_ATTRIBS),a=n.isWebGL2?null:e.get("OES_vertex_array_object"),o=n.isWebGL2||null!==a,c={},l=T(null);let h=l;function g(Z){return n.isWebGL2?r.bindVertexArray(Z):a.bindVertexArrayOES(Z)}function v(Z){return n.isWebGL2?r.deleteVertexArray(Z):a.deleteVertexArrayOES(Z)}function T(Z){const ze=[],Xe=[],Le=[];for(let je=0;je<i;je++)ze[je]=0,Xe[je]=0,Le[je]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:ze,enabledAttributes:Xe,attributeDivisors:Le,object:Z,attributes:{},index:null}}function _(){const Z=h.newAttributes;for(let ze=0,Xe=Z.length;ze<Xe;ze++)Z[ze]=0}function D(Z){R(Z,0)}function R(Z,ze){const Le=h.enabledAttributes,je=h.attributeDivisors;h.newAttributes[Z]=1,0===Le[Z]&&(r.enableVertexAttribArray(Z),Le[Z]=1),je[Z]!==ze&&((n.isWebGL2?r:e.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](Z,ze),je[Z]=ze)}function G(){const Z=h.newAttributes,ze=h.enabledAttributes;for(let Xe=0,Le=ze.length;Xe<Le;Xe++)ze[Xe]!==Z[Xe]&&(r.disableVertexAttribArray(Xe),ze[Xe]=0)}function $(Z,ze,Xe,Le,je,Gt){!0!==n.isWebGL2||Xe!==r.INT&&Xe!==r.UNSIGNED_INT?r.vertexAttribPointer(Z,ze,Xe,Le,je,Gt):r.vertexAttribIPointer(Z,ze,Xe,je,Gt)}function be(){X(),h!==l&&(h=l,g(h.object))}function X(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function p(Z,ze,Xe,Le,je){let Gt=!1;if(o){const Jt=function x(Z,ze,Xe){const Le=!0===Xe.wireframe;let je=c[Z.id];void 0===je&&(je={},c[Z.id]=je);let Gt=je[ze.id];void 0===Gt&&(Gt={},je[ze.id]=Gt);let Jt=Gt[Le];return void 0===Jt&&(Jt=T(function m(){return n.isWebGL2?r.createVertexArray():a.createVertexArrayOES()}()),Gt[Le]=Jt),Jt}(Le,Xe,ze);h!==Jt&&(h=Jt,g(h.object)),Gt=function L(Z,ze){const Xe=h.attributes,Le=Z.attributes;let je=0;for(const Gt in Le){const Jt=Xe[Gt],ot=Le[Gt];if(void 0===Jt||Jt.attribute!==ot||Jt.data!==ot.data)return!0;je++}return h.attributesNum!==je||h.index!==ze}(Le,je),Gt&&function E(Z,ze){const Xe={},Le=Z.attributes;let je=0;for(const Gt in Le){const Jt=Le[Gt],ot={};ot.attribute=Jt,Jt.data&&(ot.data=Jt.data),Xe[Gt]=ot,je++}h.attributes=Xe,h.attributesNum=je,h.index=ze}(Le,je)}else{const Jt=!0===ze.wireframe;(h.geometry!==Le.id||h.program!==Xe.id||h.wireframe!==Jt)&&(h.geometry=Le.id,h.program=Xe.id,h.wireframe=Jt,Gt=!0)}!0===Z.isInstancedMesh&&(Gt=!0),null!==je&&t.update(je,r.ELEMENT_ARRAY_BUFFER),Gt&&(function fe(Z,ze,Xe,Le){if(!1===n.isWebGL2&&(Z.isInstancedMesh||Le.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;_();const je=Le.attributes,Gt=Xe.getAttributes(),Jt=ze.defaultAttributeValues;for(const ot in Gt){const ht=Gt[ot];if(ht.location>=0){let $t=je[ot];if(void 0===$t&&("instanceMatrix"===ot&&Z.instanceMatrix&&($t=Z.instanceMatrix),"instanceColor"===ot&&Z.instanceColor&&($t=Z.instanceColor)),void 0!==$t){const qt=$t.normalized,ln=$t.itemSize,fi=t.get($t);if(void 0===fi)continue;const Ae=fi.buffer,Qn=fi.type,Mn=fi.bytesPerElement;if($t.isInterleavedBufferAttribute){const vn=$t.data,En=vn.stride,Ei=$t.offset;if(vn&&vn.isInstancedInterleavedBuffer){for(let it=0;it<ht.locationSize;it++)R(ht.location+it,vn.meshPerAttribute);!0!==Z.isInstancedMesh&&void 0===Le._maxInstanceCount&&(Le._maxInstanceCount=vn.meshPerAttribute*vn.count)}else for(let it=0;it<ht.locationSize;it++)D(ht.location+it);r.bindBuffer(r.ARRAY_BUFFER,Ae);for(let it=0;it<ht.locationSize;it++)$(ht.location+it,ln/ht.locationSize,Qn,qt,En*Mn,(Ei+ln/ht.locationSize*it)*Mn)}else{if($t.isInstancedBufferAttribute){for(let vn=0;vn<ht.locationSize;vn++)R(ht.location+vn,$t.meshPerAttribute);!0!==Z.isInstancedMesh&&void 0===Le._maxInstanceCount&&(Le._maxInstanceCount=$t.meshPerAttribute*$t.count)}else for(let vn=0;vn<ht.locationSize;vn++)D(ht.location+vn);r.bindBuffer(r.ARRAY_BUFFER,Ae);for(let vn=0;vn<ht.locationSize;vn++)$(ht.location+vn,ln/ht.locationSize,Qn,qt,ln*Mn,ln/ht.locationSize*vn*Mn)}}else if(void 0!==Jt){const qt=Jt[ot];if(void 0!==qt)switch(qt.length){case 2:r.vertexAttrib2fv(ht.location,qt);break;case 3:r.vertexAttrib3fv(ht.location,qt);break;case 4:r.vertexAttrib4fv(ht.location,qt);break;default:r.vertexAttrib1fv(ht.location,qt)}}}}G()}(Z,ze,Xe,Le),null!==je&&r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t.get(je).buffer))},reset:be,resetDefaultState:X,dispose:function Me(){be();for(const Z in c){const ze=c[Z];for(const Xe in ze){const Le=ze[Xe];for(const je in Le)v(Le[je].object),delete Le[je];delete ze[Xe]}delete c[Z]}},releaseStatesOfGeometry:function Je(Z){if(void 0===c[Z.id])return;const ze=c[Z.id];for(const Xe in ze){const Le=ze[Xe];for(const je in Le)v(Le[je].object),delete Le[je];delete ze[Xe]}delete c[Z.id]},releaseStatesOfProgram:function ke(Z){for(const ze in c){const Xe=c[ze];if(void 0===Xe[Z.id])continue;const Le=Xe[Z.id];for(const je in Le)v(Le[je].object),delete Le[je];delete Xe[Z.id]}},initAttributes:_,enableAttribute:D,disableUnusedAttributes:G}}function km(r,e,t,n){const i=n.isWebGL2;let a;this.setMode=function o(h){a=h},this.render=function c(h,p){r.drawArrays(a,h,p),t.update(p,a,1)},this.renderInstances=function l(h,p,m){if(0===m)return;let g,v;if(i)g=r,v="drawArraysInstanced";else if(g=e.get("ANGLE_instanced_arrays"),v="drawArraysInstancedANGLE",null===g)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");g[v](a,h,p,m),t.update(p,a,m)}}function Gm(r,e,t){let n;function a(fe){if("highp"===fe){if(r.getShaderPrecisionFormat(r.VERTEX_SHADER,r.HIGH_FLOAT).precision>0&&r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT).precision>0)return"highp";fe="mediump"}return"mediump"===fe&&r.getShaderPrecisionFormat(r.VERTEX_SHADER,r.MEDIUM_FLOAT).precision>0&&r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const o=typeof WebGL2RenderingContext<"u"&&r instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&r instanceof WebGL2ComputeRenderingContext;let c=void 0!==t.precision?t.precision:"highp";const l=a(c);l!==c&&(console.warn("THREE.WebGLRenderer:",c,"not supported, using",l,"instead."),c=l);const h=o||e.has("WEBGL_draw_buffers"),p=!0===t.logarithmicDepthBuffer,m=r.getParameter(r.MAX_TEXTURE_IMAGE_UNITS),g=r.getParameter(r.MAX_VERTEX_TEXTURE_IMAGE_UNITS),v=r.getParameter(r.MAX_TEXTURE_SIZE),x=r.getParameter(r.MAX_CUBE_MAP_TEXTURE_SIZE),T=r.getParameter(r.MAX_VERTEX_ATTRIBS),L=r.getParameter(r.MAX_VERTEX_UNIFORM_VECTORS),E=r.getParameter(r.MAX_VARYING_VECTORS),_=r.getParameter(r.MAX_FRAGMENT_UNIFORM_VECTORS),D=g>0,R=o||e.has("OES_texture_float");return{isWebGL2:o,drawBuffers:h,getMaxAnisotropy:function i(){if(void 0!==n)return n;if(!0===e.has("EXT_texture_filter_anisotropic")){const fe=e.get("EXT_texture_filter_anisotropic");n=r.getParameter(fe.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n},getMaxPrecision:a,precision:c,logarithmicDepthBuffer:p,maxTextures:m,maxVertexTextures:g,maxTextureSize:v,maxCubemapSize:x,maxAttributes:T,maxVertexUniforms:L,maxVaryings:E,maxFragmentUniforms:_,vertexTextures:D,floatFragmentTextures:R,floatVertexTextures:D&&R,maxSamples:o?r.getParameter(r.MAX_SAMPLES):0}}function Vm(r){const e=this;let t=null,n=0,i=!1,a=!1;const o=new fs,c=new Ii,l={value:null,needsUpdate:!1};function h(){l.value!==t&&(l.value=t,l.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function p(m,g,v,x){const T=null!==m?m.length:0;let L=null;if(0!==T){if(L=l.value,!0!==x||null===L){const E=v+4*T,_=g.matrixWorldInverse;c.getNormalMatrix(_),(null===L||L.length<E)&&(L=new Float32Array(E));for(let D=0,R=v;D!==T;++D,R+=4)o.copy(m[D]).applyMatrix4(_,c),o.normal.toArray(L,R),L[R+3]=o.constant}l.value=L,l.needsUpdate=!0}return e.numPlanes=T,e.numIntersection=0,L}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(m,g,v){const x=0!==m.length||g||0!==n||i;return i=g,t=p(m,v,0),n=m.length,x},this.beginShadows=function(){a=!0,p(null)},this.endShadows=function(){a=!1,h()},this.setState=function(m,g,v){const x=m.clippingPlanes,T=m.clipIntersection,L=m.clipShadows,E=r.get(m);if(!i||null===x||0===x.length||a&&!L)a?p(null):h();else{const _=a?0:n,D=4*_;let R=E.clippingState||null;l.value=R,R=p(x,g,D,v);for(let G=0;G!==D;++G)R[G]=t[G];E.clippingState=R,this.numIntersection=T?this.numPlanes:0,this.numPlanes+=_}}}function Wm(r){let e=new WeakMap;function t(o,c){return c===Oe?o.mapping=Re:c===Dt&&(o.mapping=pt),o}function i(o){const c=o.target;c.removeEventListener("dispose",i);const l=e.get(c);void 0!==l&&(e.delete(c),l.dispose())}return{get:function n(o){if(o&&o.isTexture&&!1===o.isRenderTargetTexture){const c=o.mapping;if(c===Oe||c===Dt){if(e.has(o))return t(e.get(o).texture,o.mapping);{const l=o.image;if(l&&l.height>0){const h=r.getRenderTarget(),p=new Cc(l.height/2);return p.fromEquirectangularTexture(r,o),e.set(o,p),r.setRenderTarget(h),o.addEventListener("dispose",i),t(p.texture,o.mapping)}return null}}}return o},dispose:function a(){e=new WeakMap}}}is.physical={uniforms:vr([is.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new st(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new Wt(0)},sheenColorMap:{value:null},sheenRoughness:{value:0},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new st},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Wt(0)},specularIntensity:{value:0},specularIntensityMap:{value:null},specularColor:{value:new Wt(1,1,1)},specularColorMap:{value:null}}]),vertexShader:si.meshphysical_vert,fragmentShader:si.meshphysical_frag};class Uo extends Io{constructor(e=-1,t=1,n=1,i=-1,a=.1,o=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=a,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,a,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=a,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let a=n-e,o=n+e,c=i+t,l=i-t;if(null!==this.view&&this.view.enabled){const h=(this.right-this.left)/this.view.fullWidth/this.zoom,p=(this.top-this.bottom)/this.view.fullHeight/this.zoom;a+=h*this.view.offsetX,o=a+h*this.view.width,c-=p*this.view.offsetY,l=c-p*this.view.height}this.projectionMatrix.makeOrthographic(a,o,c,l,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}Uo.prototype.isOrthographicCamera=!0;class eo extends Fs{constructor(e){super(e),this.type="RawShaderMaterial"}}eo.prototype.isRawShaderMaterial=!0;const to=4,na=8,ds=Math.pow(2,na),mh=[.125,.215,.35,.446,.526,.582],gh=na-to+1+mh.length,Fc={[Tt]:0,[_t]:1},jl=new Uo,{_lodPlanes:Bo,_sizeLods:vh,_sigmas:Dc}=Xm(),yh=new Wt;let ql=null;const ma=(1+Math.sqrt(5))/2,io=1/ma,_h=[new O(1,1,1),new O(-1,1,1),new O(1,1,-1),new O(-1,1,-1),new O(0,ma,io),new O(0,ma,-io),new O(io,0,ma),new O(-io,0,ma),new O(ma,io,0),new O(-ma,io,0)];class xh{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._blurMaterial=function jm(r){const e=new Float32Array(r),t=new O(0,1,0);return new eo({name:"SphericalGaussianBlur",defines:{n:r},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:e},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:t}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:dn,depthTest:!1,depthWrite:!1})}(20),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,i=100){ql=this._renderer.getRenderTarget();const a=this._allocateTargets();return this._sceneToCubeUV(e,n,i,a),t>0&&this._blur(a,0,0,t),this._applyPMREM(a),this._cleanup(a),a}fromEquirectangular(e){return this._fromTexture(e)}fromCubemap(e){return this._fromTexture(e)}compileCubemapShader(){null===this._cubemapShader&&(this._cubemapShader=Mh(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){null===this._equirectShader&&(this._equirectShader=bh(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(let e=0;e<Bo.length;e++)Bo[e].dispose()}_cleanup(e){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(ql),e.scissorTest=!1,Ic(e,0,0,e.width,e.height)}_fromTexture(e){ql=this._renderer.getRenderTarget();const t=this._allocateTargets(e);return this._textureToCubeUV(e,t),this._applyPMREM(t),this._cleanup(t),t}_allocateTargets(e){const t={magFilter:Cn,minFilter:Cn,generateMipmaps:!1,type:_i,format:pi,encoding:Tt,depthBuffer:!1},n=Eh(t);return n.depthBuffer=!e,this._pingPongRenderTarget=Eh(t),n}_compileMaterial(e){const t=new $i(Bo[0],e);this._renderer.compile(t,jl)}_sceneToCubeUV(e,t,n,i){const c=new ar(90,1,t,n),l=[1,-1,1,1,1,1],h=[1,1,1,-1,-1,-1],p=this._renderer,m=p.autoClear,g=p.toneMapping;p.getClearColor(yh),p.toneMapping=P,p.autoClear=!1;const v=new Cs({name:"PMREM.Background",side:Qt,depthWrite:!1,depthTest:!1}),x=new $i(new Ps,v);let T=!1;const L=e.background;L?L.isColor&&(v.color.copy(L),e.background=null,T=!0):(v.color.copy(yh),T=!0);for(let E=0;E<6;E++){const _=E%3;0==_?(c.up.set(0,l[E],0),c.lookAt(h[E],0,0)):1==_?(c.up.set(0,0,l[E]),c.lookAt(0,h[E],0)):(c.up.set(0,l[E],0),c.lookAt(0,0,h[E])),Ic(i,_*ds,E>2?ds:0,ds,ds),p.setRenderTarget(i),T&&p.render(x,c),p.render(e,c)}x.geometry.dispose(),x.material.dispose(),p.toneMapping=g,p.autoClear=m,e.background=L}_setEncoding(e,t){e.value=!0===this._renderer.capabilities.isWebGL2&&t.format===pi&&t.type===Qe&&t.encoding===_t?Fc[Tt]:Fc[t.encoding]}_textureToCubeUV(e,t){const n=this._renderer,i=e.mapping===Re||e.mapping===pt;i?null==this._cubemapShader&&(this._cubemapShader=Mh()):null==this._equirectShader&&(this._equirectShader=bh());const a=i?this._cubemapShader:this._equirectShader,o=new $i(Bo[0],a),c=a.uniforms;c.envMap.value=e,i||c.texelSize.value.set(1/e.image.width,1/e.image.height),this._setEncoding(c.inputEncoding,e),Ic(t,0,0,3*ds,2*ds),n.setRenderTarget(t),n.render(o,jl)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let i=1;i<gh;i++){const a=Math.sqrt(Dc[i]*Dc[i]-Dc[i-1]*Dc[i-1]);this._blur(e,i-1,i,a,_h[(i-1)%_h.length])}t.autoClear=n}_blur(e,t,n,i,a){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,n,i,"latitudinal",a),this._halfBlur(o,e,n,n,i,"longitudinal",a)}_halfBlur(e,t,n,i,a,o,c){const l=this._renderer,h=this._blurMaterial;"latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!");const m=new $i(Bo[i],h),g=h.uniforms,v=vh[n]-1,x=isFinite(a)?Math.PI/(2*v):2*Math.PI/39,T=a/x,L=isFinite(a)?1+Math.floor(3*T):20;L>20&&console.warn(`sigmaRadians, ${a}, is too large and will clip, as it requested ${L} samples when the maximum is set to 20`);const E=[];let _=0;for(let $=0;$<20;++$){const fe=$/T,Me=Math.exp(-fe*fe/2);E.push(Me),0==$?_+=Me:$<L&&(_+=2*Me)}for(let $=0;$<E.length;$++)E[$]=E[$]/_;g.envMap.value=e.texture,g.samples.value=L,g.weights.value=E,g.latitudinal.value="latitudinal"===o,c&&(g.poleAxis.value=c),g.dTheta.value=x,g.mipInt.value=na-n;const D=vh[i];Ic(t,3*Math.max(0,ds-2*D),(0===i?0:2*ds)+2*D*(i>na-to?i-na+to:0),3*D,2*D),l.setRenderTarget(t),l.render(m,jl)}}function Xm(){const r=[],e=[],t=[];let n=na;for(let i=0;i<gh;i++){const a=Math.pow(2,n);e.push(a);let o=1/a;i>na-to?o=mh[i-na+to-1]:0==i&&(o=0),t.push(o);const c=1/(a-1),l=-c/2,h=1+c/2,p=[l,l,h,l,h,h,l,l,h,h,l,h],m=6,g=6,v=3,x=2,T=1,L=new Float32Array(v*g*m),E=new Float32Array(x*g*m),_=new Float32Array(T*g*m);for(let R=0;R<m;R++){const G=R%3*2/3-1,$=R>2?0:-1;L.set([G,$,0,G+2/3,$,0,G+2/3,$+1,0,G,$,0,G+2/3,$+1,0,G,$+1,0],v*g*R),E.set(p,x*g*R),_.set([R,R,R,R,R,R],T*g*R)}const D=new zn;D.setAttribute("position",new mi(L,v)),D.setAttribute("uv",new mi(E,x)),D.setAttribute("faceIndex",new mi(_,T)),r.push(D),n>to&&n--}return{_lodPlanes:r,_sizeLods:e,_sigmas:t}}function Eh(r){const e=new Li(3*ds,3*ds,r);return e.texture.mapping=zt,e.texture.name="PMREM.cubeUv",e.scissorTest=!0,e}function Ic(r,e,t,n,i){r.viewport.set(e,t,n,i),r.scissor.set(e,t,n,i)}function bh(){const r=new st(1,1);return new eo({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:r},inputEncoding:{value:Fc[Tt]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t}\n\t\t",blending:dn,depthTest:!1,depthWrite:!1})}function Mh(){return new eo({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:Fc[Tt]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) );\n\n\t\t\t}\n\t\t",blending:dn,depthTest:!1,depthWrite:!1})}function qm(r){let e=new WeakMap,t=null;function a(c){const l=c.target;l.removeEventListener("dispose",a);const h=e.get(l);void 0!==h&&(e.delete(l),h.dispose())}return{get:function n(c){if(c&&c.isTexture&&!1===c.isRenderTargetTexture){const l=c.mapping,h=l===Oe||l===Dt,p=l===Re||l===pt;if(h||p){if(e.has(c))return e.get(c).texture;{const m=c.image;if(h&&m&&m.height>0||p&&m&&function i(c){let l=0;for(let p=0;p<6;p++)void 0!==c[p]&&l++;return 6===l}(m)){const g=r.getRenderTarget();null===t&&(t=new xh(r));const v=h?t.fromEquirectangular(c):t.fromCubemap(c);return e.set(c,v),r.setRenderTarget(g),c.addEventListener("dispose",a),v.texture}return null}}}return c},dispose:function o(){e=new WeakMap,null!==t&&(t.dispose(),t=null)}}}function Ym(r){const e={};function t(n){if(void 0!==e[n])return e[n];let i;switch(n){case"WEBGL_depth_texture":i=r.getExtension("WEBGL_depth_texture")||r.getExtension("MOZ_WEBGL_depth_texture")||r.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=r.getExtension("WEBGL_compressed_texture_s3tc")||r.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=r.getExtension("WEBGL_compressed_texture_pvrtc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=r.getExtension(n)}return e[n]=i,i}return{has:function(n){return null!==t(n)},init:function(n){n.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(n){const i=t(n);return null===i&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),i}}}function Km(r,e,t,n){const i={},a=new WeakMap;function o(m){const g=m.target;null!==g.index&&e.remove(g.index);for(const x in g.attributes)e.remove(g.attributes[x]);g.removeEventListener("dispose",o),delete i[g.id];const v=a.get(g);v&&(e.remove(v),a.delete(g)),n.releaseStatesOfGeometry(g),!0===g.isInstancedBufferGeometry&&delete g._maxInstanceCount,t.memory.geometries--}function h(m){const g=[],v=m.index,x=m.attributes.position;let T=0;if(null!==v){const _=v.array;T=v.version;for(let D=0,R=_.length;D<R;D+=3){const G=_[D+0],$=_[D+1],fe=_[D+2];g.push(G,$,$,fe,fe,G)}}else{T=x.version;for(let D=0,R=x.array.length/3-1;D<R;D+=3){const G=D+0,$=D+1,fe=D+2;g.push(G,$,$,fe,fe,G)}}const L=new(zo(g)>65535?Ec:xc)(g,1);L.version=T;const E=a.get(m);E&&e.remove(E),a.set(m,L)}return{get:function c(m,g){return!0===i[g.id]||(g.addEventListener("dispose",o),i[g.id]=!0,t.memory.geometries++),g},update:function l(m){const g=m.attributes;for(const x in g)e.update(g[x],r.ARRAY_BUFFER);const v=m.morphAttributes;for(const x in v){const T=v[x];for(let L=0,E=T.length;L<E;L++)e.update(T[L],r.ARRAY_BUFFER)}},getWireframeAttribute:function p(m){const g=a.get(m);if(g){const v=m.index;null!==v&&g.version<v.version&&h(m)}else h(m);return a.get(m)}}}function Zm(r,e,t,n){const i=n.isWebGL2;let a,c,l;this.setMode=function o(g){a=g},this.setIndex=function h(g){c=g.type,l=g.bytesPerElement},this.render=function p(g,v){r.drawElements(a,v,c,g*l),t.update(v,a,1)},this.renderInstances=function m(g,v,x){if(0===x)return;let T,L;if(i)T=r,L="drawElementsInstanced";else if(T=e.get("ANGLE_instanced_arrays"),L="drawElementsInstancedANGLE",null===T)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");T[L](a,v,c,g*l,x),t.update(v,a,x)}}function Jm(r){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function i(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function n(a,o,c){switch(t.calls++,o){case r.TRIANGLES:t.triangles+=c*(a/3);break;case r.LINES:t.lines+=c*(a/2);break;case r.LINE_STRIP:t.lines+=c*(a-1);break;case r.LINE_LOOP:t.lines+=c*a;break;case r.POINTS:t.points+=c*a;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o)}}}}class Nc extends zi{constructor(e=null,t=1,n=1,i=1){super(null),this.image={data:e,width:t,height:n,depth:i},this.magFilter=Dn,this.minFilter=Dn,this.wrapR=St,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}function $m(r,e){return r[0]-e[0]}function Qm(r,e){return Math.abs(e[1])-Math.abs(r[1])}function Th(r,e){let t=1;const n=e.isInterleavedBufferAttribute?e.data.array:e.array;n instanceof Int8Array?t=127:n instanceof Int16Array?t=32767:n instanceof Int32Array?t=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",n),r.divideScalar(t)}function eg(r,e,t){const n={},i=new Float32Array(8),a=new WeakMap,o=new O,c=[];for(let h=0;h<8;h++)c[h]=[h,0];return{update:function l(h,p,m,g){const v=h.morphTargetInfluences;if(!0===e.isWebGL2){const x=p.morphAttributes.position.length;let T=a.get(p);if(void 0===T||T.count!==x){void 0!==T&&T.texture.dispose();const _=void 0!==p.morphAttributes.normal,D=p.morphAttributes.position,R=p.morphAttributes.normal||[],$=!0===_?2:1;let fe=p.attributes.position.count*$,Me=1;fe>e.maxTextureSize&&(Me=Math.ceil(fe/e.maxTextureSize),fe=e.maxTextureSize);const Je=new Float32Array(fe*Me*4*x),ke=new Nc(Je,fe,Me,x);ke.format=pi,ke.type=ki,ke.needsUpdate=!0;const be=4*$;for(let X=0;X<x;X++){const Z=D[X],ze=R[X],Xe=fe*Me*4*X;for(let Le=0;Le<Z.count;Le++){o.fromBufferAttribute(Z,Le),!0===Z.normalized&&Th(o,Z);const je=Le*be;Je[Xe+je+0]=o.x,Je[Xe+je+1]=o.y,Je[Xe+je+2]=o.z,Je[Xe+je+3]=0,!0===_&&(o.fromBufferAttribute(ze,Le),!0===ze.normalized&&Th(o,ze),Je[Xe+je+4]=o.x,Je[Xe+je+5]=o.y,Je[Xe+je+6]=o.z,Je[Xe+je+7]=0)}}T={count:x,texture:ke,size:new st(fe,Me)},a.set(p,T)}let L=0;for(let _=0;_<v.length;_++)L+=v[_];const E=p.morphTargetsRelative?1:1-L;g.getUniforms().setValue(r,"morphTargetBaseInfluence",E),g.getUniforms().setValue(r,"morphTargetInfluences",v),g.getUniforms().setValue(r,"morphTargetsTexture",T.texture,t),g.getUniforms().setValue(r,"morphTargetsTextureSize",T.size)}else{const x=void 0===v?0:v.length;let T=n[p.id];if(void 0===T||T.length!==x){T=[];for(let R=0;R<x;R++)T[R]=[R,0];n[p.id]=T}for(let R=0;R<x;R++){const G=T[R];G[0]=R,G[1]=v[R]}T.sort(Qm);for(let R=0;R<8;R++)R<x&&T[R][1]?(c[R][0]=T[R][0],c[R][1]=T[R][1]):(c[R][0]=Number.MAX_SAFE_INTEGER,c[R][1]=0);c.sort($m);const L=p.morphAttributes.position,E=p.morphAttributes.normal;let _=0;for(let R=0;R<8;R++){const G=c[R],$=G[0],fe=G[1];$!==Number.MAX_SAFE_INTEGER&&fe?(L&&p.getAttribute("morphTarget"+R)!==L[$]&&p.setAttribute("morphTarget"+R,L[$]),E&&p.getAttribute("morphNormal"+R)!==E[$]&&p.setAttribute("morphNormal"+R,E[$]),i[R]=fe,_+=fe):(L&&!0===p.hasAttribute("morphTarget"+R)&&p.deleteAttribute("morphTarget"+R),E&&!0===p.hasAttribute("morphNormal"+R)&&p.deleteAttribute("morphNormal"+R),i[R]=0)}const D=p.morphTargetsRelative?1:1-_;g.getUniforms().setValue(r,"morphTargetBaseInfluence",D),g.getUniforms().setValue(r,"morphTargetInfluences",i)}}}}function tg(r,e,t,n){let i=new WeakMap;function c(l){const h=l.target;h.removeEventListener("dispose",c),t.remove(h.instanceMatrix),null!==h.instanceColor&&t.remove(h.instanceColor)}return{update:function a(l){const h=n.render.frame,m=e.get(l,l.geometry);return i.get(m)!==h&&(e.update(m),i.set(m,h)),l.isInstancedMesh&&(!1===l.hasEventListener("dispose",c)&&l.addEventListener("dispose",c),t.update(l.instanceMatrix,r.ARRAY_BUFFER),null!==l.instanceColor&&t.update(l.instanceColor,r.ARRAY_BUFFER)),m},dispose:function o(){i=new WeakMap}}}Nc.prototype.isDataTexture2DArray=!0;class Zl extends zi{constructor(e=null,t=1,n=1,i=1){super(null),this.image={data:e,width:t,height:n,depth:i},this.magFilter=Dn,this.minFilter=Dn,this.wrapR=St,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}Zl.prototype.isDataTexture3D=!0;const wh=new zi,Sh=new Nc,Rh=new Zl,Ah=new $a,zh=[],Lh=[],Ch=new Float32Array(16),Ph=new Float32Array(9),Fh=new Float32Array(4);function ro(r,e,t){const n=r[0];if(n<=0||n>0)return r;const i=e*t;let a=zh[i];if(void 0===a&&(a=new Float32Array(i),zh[i]=a),0!==e){n.toArray(a,0);for(let o=1,c=0;o!==e;++o)c+=t,r[o].toArray(a,c)}return a}function Sr(r,e){if(r.length!==e.length)return!1;for(let t=0,n=r.length;t<n;t++)if(r[t]!==e[t])return!1;return!0}function yr(r,e){for(let t=0,n=e.length;t<n;t++)r[t]=e[t]}function Uc(r,e){let t=Lh[e];void 0===t&&(t=new Int32Array(e),Lh[e]=t);for(let n=0;n!==e;++n)t[n]=r.allocateTextureUnit();return t}function ng(r,e){const t=this.cache;t[0]!==e&&(r.uniform1f(this.addr,e),t[0]=e)}function ig(r,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y)&&(r.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Sr(t,e))return;r.uniform2fv(this.addr,e),yr(t,e)}}function rg(r,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(r.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(void 0!==e.r)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(r.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Sr(t,e))return;r.uniform3fv(this.addr,e),yr(t,e)}}function sg(r,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(r.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Sr(t,e))return;r.uniform4fv(this.addr,e),yr(t,e)}}function ag(r,e){const t=this.cache,n=e.elements;if(void 0===n){if(Sr(t,e))return;r.uniformMatrix2fv(this.addr,!1,e),yr(t,e)}else{if(Sr(t,n))return;Fh.set(n),r.uniformMatrix2fv(this.addr,!1,Fh),yr(t,n)}}function og(r,e){const t=this.cache,n=e.elements;if(void 0===n){if(Sr(t,e))return;r.uniformMatrix3fv(this.addr,!1,e),yr(t,e)}else{if(Sr(t,n))return;Ph.set(n),r.uniformMatrix3fv(this.addr,!1,Ph),yr(t,n)}}function cg(r,e){const t=this.cache,n=e.elements;if(void 0===n){if(Sr(t,e))return;r.uniformMatrix4fv(this.addr,!1,e),yr(t,e)}else{if(Sr(t,n))return;Ch.set(n),r.uniformMatrix4fv(this.addr,!1,Ch),yr(t,n)}}function lg(r,e){const t=this.cache;t[0]!==e&&(r.uniform1i(this.addr,e),t[0]=e)}function ug(r,e){const t=this.cache;Sr(t,e)||(r.uniform2iv(this.addr,e),yr(t,e))}function hg(r,e){const t=this.cache;Sr(t,e)||(r.uniform3iv(this.addr,e),yr(t,e))}function fg(r,e){const t=this.cache;Sr(t,e)||(r.uniform4iv(this.addr,e),yr(t,e))}function dg(r,e){const t=this.cache;t[0]!==e&&(r.uniform1ui(this.addr,e),t[0]=e)}function pg(r,e){const t=this.cache;Sr(t,e)||(r.uniform2uiv(this.addr,e),yr(t,e))}function mg(r,e){const t=this.cache;Sr(t,e)||(r.uniform3uiv(this.addr,e),yr(t,e))}function gg(r,e){const t=this.cache;Sr(t,e)||(r.uniform4uiv(this.addr,e),yr(t,e))}function vg(r,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(r.uniform1i(this.addr,i),n[0]=i),t.safeSetTexture2D(e||wh,i)}function yg(r,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(r.uniform1i(this.addr,i),n[0]=i),t.setTexture3D(e||Rh,i)}function _g(r,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(r.uniform1i(this.addr,i),n[0]=i),t.safeSetTextureCube(e||Ah,i)}function xg(r,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(r.uniform1i(this.addr,i),n[0]=i),t.setTexture2DArray(e||Sh,i)}function bg(r,e){r.uniform1fv(this.addr,e)}function Mg(r,e){const t=ro(e,this.size,2);r.uniform2fv(this.addr,t)}function Tg(r,e){const t=ro(e,this.size,3);r.uniform3fv(this.addr,t)}function wg(r,e){const t=ro(e,this.size,4);r.uniform4fv(this.addr,t)}function Sg(r,e){const t=ro(e,this.size,4);r.uniformMatrix2fv(this.addr,!1,t)}function Rg(r,e){const t=ro(e,this.size,9);r.uniformMatrix3fv(this.addr,!1,t)}function Ag(r,e){const t=ro(e,this.size,16);r.uniformMatrix4fv(this.addr,!1,t)}function zg(r,e){r.uniform1iv(this.addr,e)}function Lg(r,e){r.uniform2iv(this.addr,e)}function Cg(r,e){r.uniform3iv(this.addr,e)}function Pg(r,e){r.uniform4iv(this.addr,e)}function Fg(r,e){r.uniform1uiv(this.addr,e)}function Dg(r,e){r.uniform2uiv(this.addr,e)}function Ig(r,e){r.uniform3uiv(this.addr,e)}function Ng(r,e){r.uniform4uiv(this.addr,e)}function Ug(r,e,t){const n=e.length,i=Uc(t,n);r.uniform1iv(this.addr,i);for(let a=0;a!==n;++a)t.safeSetTexture2D(e[a]||wh,i[a])}function Bg(r,e,t){const n=e.length,i=Uc(t,n);r.uniform1iv(this.addr,i);for(let a=0;a!==n;++a)t.setTexture3D(e[a]||Rh,i[a])}function Og(r,e,t){const n=e.length,i=Uc(t,n);r.uniform1iv(this.addr,i);for(let a=0;a!==n;++a)t.safeSetTextureCube(e[a]||Ah,i[a])}function Hg(r,e,t){const n=e.length,i=Uc(t,n);r.uniform1iv(this.addr,i);for(let a=0;a!==n;++a)t.setTexture2DArray(e[a]||Sh,i[a])}function Gg(r,e,t){this.id=r,this.addr=t,this.cache=[],this.setValue=function Eg(r){switch(r){case 5126:return ng;case 35664:return ig;case 35665:return rg;case 35666:return sg;case 35674:return ag;case 35675:return og;case 35676:return cg;case 5124:case 35670:return lg;case 35667:case 35671:return ug;case 35668:case 35672:return hg;case 35669:case 35673:return fg;case 5125:return dg;case 36294:return pg;case 36295:return mg;case 36296:return gg;case 35678:case 36198:case 36298:case 36306:case 35682:return vg;case 35679:case 36299:case 36307:return yg;case 35680:case 36300:case 36308:case 36293:return _g;case 36289:case 36303:case 36311:case 36292:return xg}}(e.type)}function Dh(r,e,t){this.id=r,this.addr=t,this.cache=[],this.size=e.size,this.setValue=function kg(r){switch(r){case 5126:return bg;case 35664:return Mg;case 35665:return Tg;case 35666:return wg;case 35674:return Sg;case 35675:return Rg;case 35676:return Ag;case 5124:case 35670:return zg;case 35667:case 35671:return Lg;case 35668:case 35672:return Cg;case 35669:case 35673:return Pg;case 5125:return Fg;case 36294:return Dg;case 36295:return Ig;case 36296:return Ng;case 35678:case 36198:case 36298:case 36306:case 35682:return Ug;case 35679:case 36299:case 36307:return Bg;case 35680:case 36300:case 36308:case 36293:return Og;case 36289:case 36303:case 36311:case 36292:return Hg}}(e.type)}function Ih(r){this.id=r,this.seq=[],this.map={}}Dh.prototype.updateCache=function(r){const e=this.cache;r instanceof Float32Array&&e.length!==r.length&&(this.cache=new Float32Array(r.length)),yr(e,r)},Ih.prototype.setValue=function(r,e,t){const n=this.seq;for(let i=0,a=n.length;i!==a;++i){const o=n[i];o.setValue(r,e[o.id],t)}};const Jl=/(\w+)(\])?(\[|\.)?/g;function Nh(r,e){r.seq.push(e),r.map[e.id]=e}function Vg(r,e,t){const n=r.name,i=n.length;for(Jl.lastIndex=0;;){const a=Jl.exec(n);let c=a[1];const h=a[3];if("]"===a[2]&&(c|=0),void 0===h||"["===h&&Jl.lastIndex+2===i){Nh(t,void 0===h?new Gg(c,r,e):new Dh(c,r,e));break}{let m=t.map[c];void 0===m&&(m=new Ih(c),Nh(t,m)),t=m}}}function ia(r,e){this.seq=[],this.map={};const t=r.getProgramParameter(e,r.ACTIVE_UNIFORMS);for(let n=0;n<t;++n){const i=r.getActiveUniform(e,n);Vg(i,r.getUniformLocation(e,i.name),this)}}function Uh(r,e,t){const n=r.createShader(e);return r.shaderSource(n,t),r.compileShader(n),n}ia.prototype.setValue=function(r,e,t,n){const i=this.map[e];void 0!==i&&i.setValue(r,t,n)},ia.prototype.setOptional=function(r,e,t){const n=e[t];void 0!==n&&this.setValue(r,t,n)},ia.upload=function(r,e,t,n){for(let i=0,a=e.length;i!==a;++i){const o=e[i],c=t[o.id];!1!==c.needsUpdate&&o.setValue(r,c.value,n)}},ia.seqWithValue=function(r,e){const t=[];for(let n=0,i=r.length;n!==i;++n){const a=r[n];a.id in e&&t.push(a)}return t};let Wg=0;function Bh(r){switch(r){case Tt:return["Linear","( value )"];case _t:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",r),["Linear","( value )"]}}function Oh(r,e,t){const n=r.getShaderParameter(e,r.COMPILE_STATUS),i=r.getShaderInfoLog(e).trim();return n&&""===i?"":t.toUpperCase()+"\n\n"+i+"\n\n"+function Xg(r){const e=r.split("\n");for(let t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join("\n")}(r.getShaderSource(e))}function ga(r,e){const t=Bh(e);return"vec4 "+r+"( vec4 value ) { return "+t[0]+"ToLinear"+t[1]+"; }"}function jg(r,e){const t=Bh(e);return"vec4 "+r+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function qg(r,e){let t;switch(e){case W:t="Linear";break;case H:t="Reinhard";break;case ee:t="OptimizedCineon";break;case ie:t="ACESFilmic";break;case ve:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+r+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function Oo(r){return""!==r}function Hh(r,e){return r.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function kh(r,e){return r.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const Jg=/^[ \t]*#include +<([\w\d./]+)>/gm;function $l(r){return r.replace(Jg,$g)}function $g(r,e){const t=si[e];if(void 0===t)throw new Error("Can not resolve #include <"+e+">");return $l(t)}const Qg=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,e0=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Gh(r){return r.replace(e0,Vh).replace(Qg,t0)}function t0(r,e,t,n){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),Vh(0,e,t,n)}function Vh(r,e,t,n){let i="";for(let a=parseInt(e);a<parseInt(t);a++)i+=n.replace(/\[\s*i\s*\]/g,"[ "+a+" ]").replace(/UNROLLED_LOOP_INDEX/g,a);return i}function Wh(r){let e="precision "+r.precision+" float;\nprecision "+r.precision+" int;";return"highp"===r.precision?e+="\n#define HIGH_PRECISION":"mediump"===r.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===r.precision&&(e+="\n#define LOW_PRECISION"),e}function a0(r,e,t,n){const i=r.getContext(),a=t.defines;let o=t.vertexShader,c=t.fragmentShader;const l=function n0(r){let e="SHADOWMAP_TYPE_BASIC";return r.shadowMapType===tn?e="SHADOWMAP_TYPE_PCF":r.shadowMapType===di?e="SHADOWMAP_TYPE_PCF_SOFT":r.shadowMapType===Rn&&(e="SHADOWMAP_TYPE_VSM"),e}(t),h=function i0(r){let e="ENVMAP_TYPE_CUBE";if(r.envMap)switch(r.envMapMode){case Re:case pt:e="ENVMAP_TYPE_CUBE";break;case zt:case Yn:e="ENVMAP_TYPE_CUBE_UV"}return e}(t),p=function r0(r){let e="ENVMAP_MODE_REFLECTION";if(r.envMap)switch(r.envMapMode){case pt:case Yn:e="ENVMAP_MODE_REFRACTION"}return e}(t),m=function s0(r){let e="ENVMAP_BLENDING_NONE";if(r.envMap)switch(r.combine){case Nn:e="ENVMAP_BLENDING_MULTIPLY";break;case Ne:e="ENVMAP_BLENDING_MIX";break;case A:e="ENVMAP_BLENDING_ADD"}return e}(t),g=t.isWebGL2?"":function Yg(r){return[r.extensionDerivatives||r.envMapCubeUV||r.bumpMap||r.tangentSpaceNormalMap||r.clearcoatNormalMap||r.flatShading||"physical"===r.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(r.extensionFragDepth||r.logarithmicDepthBuffer)&&r.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",r.extensionDrawBuffers&&r.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(r.extensionShaderTextureLOD||r.envMap||r.transmission)&&r.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Oo).join("\n")}(t),v=function Kg(r){const e=[];for(const t in r){const n=r[t];!1!==n&&e.push("#define "+t+" "+n)}return e.join("\n")}(a),x=i.createProgram();let T,L,E=t.glslVersion?"#version "+t.glslVersion+"\n":"";t.isRawShaderMaterial?(T=[v].filter(Oo).join("\n"),T.length>0&&(T+="\n"),L=[g,v].filter(Oo).join("\n"),L.length>0&&(L+="\n")):(T=[Wh(t),"#define SHADER_NAME "+t.shaderName,v,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define MAX_BONES "+t.maxBones,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+p:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.displacementMap&&t.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.useVertexTexture?"#define BONE_TEXTURE":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&!1===t.flatShading?"#define USE_MORPHNORMALS":"",t.morphTargets&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargets&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Oo).join("\n"),L=[g,Wh(t),"#define SHADER_NAME "+t.shaderName,v,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+h:"",t.envMap?"#define "+p:"",t.envMap?"#define "+m:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(t.extensionShaderTextureLOD||t.envMap)&&t.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==P?"#define TONE_MAPPING":"",t.toneMapping!==P?si.tonemapping_pars_fragment:"",t.toneMapping!==P?qg("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.format===br?"#define OPAQUE":"",si.encodings_pars_fragment,t.map?ga("mapTexelToLinear",t.mapEncoding):"",t.matcap?ga("matcapTexelToLinear",t.matcapEncoding):"",t.envMap?ga("envMapTexelToLinear",t.envMapEncoding):"",t.emissiveMap?ga("emissiveMapTexelToLinear",t.emissiveMapEncoding):"",t.specularColorMap?ga("specularColorMapTexelToLinear",t.specularColorMapEncoding):"",t.sheenColorMap?ga("sheenColorMapTexelToLinear",t.sheenColorMapEncoding):"",t.lightMap?ga("lightMapTexelToLinear",t.lightMapEncoding):"",jg("linearToOutputTexel",t.outputEncoding),t.depthPacking?"#define DEPTH_PACKING "+t.depthPacking:"","\n"].filter(Oo).join("\n")),o=$l(o),o=Hh(o,t),o=kh(o,t),c=$l(c),c=Hh(c,t),c=kh(c,t),o=Gh(o),c=Gh(c),t.isWebGL2&&!0!==t.isRawShaderMaterial&&(E="#version 300 es\n",T=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+T,L=["#define varying in",t.glslVersion===la?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===la?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+L);const D=E+L+c,R=Uh(i,i.VERTEX_SHADER,E+T+o),G=Uh(i,i.FRAGMENT_SHADER,D);if(i.attachShader(x,R),i.attachShader(x,G),void 0!==t.index0AttributeName?i.bindAttribLocation(x,0,t.index0AttributeName):!0===t.morphTargets&&i.bindAttribLocation(x,0,"position"),i.linkProgram(x),r.debug.checkShaderErrors){const Me=i.getProgramInfoLog(x).trim(),Je=i.getShaderInfoLog(R).trim(),ke=i.getShaderInfoLog(G).trim();let be=!0,X=!0;if(!1===i.getProgramParameter(x,i.LINK_STATUS)){be=!1;const Z=Oh(i,R,"vertex"),ze=Oh(i,G,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(x,i.VALIDATE_STATUS)+"\n\nProgram Info Log: "+Me+"\n"+Z+"\n"+ze)}else""!==Me?console.warn("THREE.WebGLProgram: Program Info Log:",Me):(""===Je||""===ke)&&(X=!1);X&&(this.diagnostics={runnable:be,programLog:Me,vertexShader:{log:Je,prefix:T},fragmentShader:{log:ke,prefix:L}})}let $,fe;return i.deleteShader(R),i.deleteShader(G),this.getUniforms=function(){return void 0===$&&($=new ia(i,x)),$},this.getAttributes=function(){return void 0===fe&&(fe=function Zg(r,e){const t={},n=r.getProgramParameter(e,r.ACTIVE_ATTRIBUTES);for(let i=0;i<n;i++){const a=r.getActiveAttrib(e,i),o=a.name;let c=1;a.type===r.FLOAT_MAT2&&(c=2),a.type===r.FLOAT_MAT3&&(c=3),a.type===r.FLOAT_MAT4&&(c=4),t[o]={type:a.type,location:r.getAttribLocation(e,o),locationSize:c}}return t}(i,x)),fe},this.destroy=function(){n.releaseStatesOfProgram(this),i.deleteProgram(x),this.program=void 0},this.name=t.shaderName,this.id=Wg++,this.cacheKey=e,this.usedTimes=1,this.program=x,this.vertexShader=R,this.fragmentShader=G,this}let o0=0;class c0{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const n=e.fragmentShader,i=this._getShaderStage(e.vertexShader),a=this._getShaderStage(n),o=this._getShaderCacheForMaterial(e);return!1===o.has(i)&&(o.add(i),i.usedTimes++),!1===o.has(a)&&(o.add(a),a.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,0===n.usedTimes&&this.shaderCache.delete(n);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;return!1===t.has(e)&&t.set(e,new Set),t.get(e)}_getShaderStage(e){const t=this.shaderCache;if(!1===t.has(e)){const n=new l0;t.set(e,n)}return t.get(e)}}class l0{constructor(){this.id=o0++,this.usedTimes=0}}function u0(r,e,t,n,i,a,o){const c=new gc,l=new c0,h=[],p=i.isWebGL2,m=i.logarithmicDepthBuffer,g=i.floatVertexTextures,v=i.maxVertexUniforms,x=i.vertexTextures;let T=i.precision;const L={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function _(X){let Z;return X&&X.isTexture?Z=X.encoding:X&&X.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),Z=X.texture.encoding):Z=Tt,p&&X&&X.isTexture&&X.format===pi&&X.type===Qe&&X.encoding===_t&&(Z=Tt),Z}return{getParameters:function D(X,Z,ze,Xe,Le){const je=Xe.fog,Jt=(X.isMeshStandardMaterial?t:e).get(X.envMap||(X.isMeshStandardMaterial?Xe.environment:null)),ot=L[X.type],ht=Le.isSkinnedMesh?function E(X){const ze=X.skeleton.bones;if(g)return 1024;{const Le=Math.floor((v-20)/4),je=Math.min(Le,ze.length);return je<ze.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+ze.length+" bones. This GPU supports "+je+"."),0):je}}(Le):0;let $t,qt,ln,fi;if(null!==X.precision&&(T=i.getMaxPrecision(X.precision),T!==X.precision&&console.warn("THREE.WebGLProgram.getParameters:",X.precision,"not supported, using",T,"instead.")),ot){const En=is[ot];$t=En.vertexShader,qt=En.fragmentShader}else $t=X.vertexShader,qt=X.fragmentShader,l.update(X),ln=l.getVertexShaderID(X),fi=l.getFragmentShaderID(X);const Ae=r.getRenderTarget(),Qn=X.alphaTest>0,Mn=X.clearcoat>0;return{isWebGL2:p,shaderID:ot,shaderName:X.type,vertexShader:$t,fragmentShader:qt,defines:X.defines,customVertexShaderID:ln,customFragmentShaderID:fi,isRawShaderMaterial:!0===X.isRawShaderMaterial,glslVersion:X.glslVersion,precision:T,instancing:!0===Le.isInstancedMesh,instancingColor:!0===Le.isInstancedMesh&&null!==Le.instanceColor,supportsVertexTextures:x,outputEncoding:null!==Ae?_(Ae.texture):r.outputEncoding,map:!!X.map,mapEncoding:_(X.map),matcap:!!X.matcap,matcapEncoding:_(X.matcap),envMap:!!Jt,envMapMode:Jt&&Jt.mapping,envMapEncoding:_(Jt),envMapCubeUV:!!Jt&&(Jt.mapping===zt||Jt.mapping===Yn),lightMap:!!X.lightMap,lightMapEncoding:_(X.lightMap),aoMap:!!X.aoMap,emissiveMap:!!X.emissiveMap,emissiveMapEncoding:_(X.emissiveMap),bumpMap:!!X.bumpMap,normalMap:!!X.normalMap,objectSpaceNormalMap:X.normalMapType===An,tangentSpaceNormalMap:X.normalMapType===Bt,clearcoat:Mn,clearcoatMap:Mn&&!!X.clearcoatMap,clearcoatRoughnessMap:Mn&&!!X.clearcoatRoughnessMap,clearcoatNormalMap:Mn&&!!X.clearcoatNormalMap,displacementMap:!!X.displacementMap,roughnessMap:!!X.roughnessMap,metalnessMap:!!X.metalnessMap,specularMap:!!X.specularMap,specularIntensityMap:!!X.specularIntensityMap,specularColorMap:!!X.specularColorMap,specularColorMapEncoding:_(X.specularColorMap),alphaMap:!!X.alphaMap,alphaTest:Qn,gradientMap:!!X.gradientMap,sheen:X.sheen>0,sheenColorMap:!!X.sheenColorMap,sheenColorMapEncoding:_(X.sheenColorMap),sheenRoughnessMap:!!X.sheenRoughnessMap,transmission:X.transmission>0,transmissionMap:!!X.transmissionMap,thicknessMap:!!X.thicknessMap,combine:X.combine,vertexTangents:!!X.normalMap&&!!Le.geometry&&!!Le.geometry.attributes.tangent,vertexColors:X.vertexColors,vertexAlphas:!0===X.vertexColors&&!!Le.geometry&&!!Le.geometry.attributes.color&&4===Le.geometry.attributes.color.itemSize,vertexUvs:!!(X.map||X.bumpMap||X.normalMap||X.specularMap||X.alphaMap||X.emissiveMap||X.roughnessMap||X.metalnessMap||X.clearcoatMap||X.clearcoatRoughnessMap||X.clearcoatNormalMap||X.displacementMap||X.transmissionMap||X.thicknessMap||X.specularIntensityMap||X.specularColorMap||X.sheenColorMap||X.sheenRoughnessMap),uvsVertexOnly:!(X.map||X.bumpMap||X.normalMap||X.specularMap||X.alphaMap||X.emissiveMap||X.roughnessMap||X.metalnessMap||X.clearcoatNormalMap||X.transmission>0||X.transmissionMap||X.thicknessMap||X.specularIntensityMap||X.specularColorMap||X.sheen>0||X.sheenColorMap||X.sheenRoughnessMap||!X.displacementMap),fog:!!je,useFog:X.fog,fogExp2:je&&je.isFogExp2,flatShading:!!X.flatShading,sizeAttenuation:X.sizeAttenuation,logarithmicDepthBuffer:m,skinning:!0===Le.isSkinnedMesh&&ht>0,maxBones:ht,useVertexTexture:g,morphTargets:!!Le.geometry&&!!Le.geometry.morphAttributes.position,morphNormals:!!Le.geometry&&!!Le.geometry.morphAttributes.normal,morphTargetsCount:Le.geometry&&Le.geometry.morphAttributes.position?Le.geometry.morphAttributes.position.length:0,numDirLights:Z.directional.length,numPointLights:Z.point.length,numSpotLights:Z.spot.length,numRectAreaLights:Z.rectArea.length,numHemiLights:Z.hemi.length,numDirLightShadows:Z.directionalShadowMap.length,numPointLightShadows:Z.pointShadowMap.length,numSpotLightShadows:Z.spotShadowMap.length,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,format:X.format,dithering:X.dithering,shadowMapEnabled:r.shadowMap.enabled&&ze.length>0,shadowMapType:r.shadowMap.type,toneMapping:X.toneMapped?r.toneMapping:P,physicallyCorrectLights:r.physicallyCorrectLights,premultipliedAlpha:X.premultipliedAlpha,doubleSided:X.side===ti,flipSided:X.side===Qt,depthPacking:void 0!==X.depthPacking&&X.depthPacking,index0AttributeName:X.index0AttributeName,extensionDerivatives:X.extensions&&X.extensions.derivatives,extensionFragDepth:X.extensions&&X.extensions.fragDepth,extensionDrawBuffers:X.extensions&&X.extensions.drawBuffers,extensionShaderTextureLOD:X.extensions&&X.extensions.shaderTextureLOD,rendererExtensionFragDepth:p||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:p||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:p||n.has("EXT_shader_texture_lod"),customProgramCacheKey:X.customProgramCacheKey()}},getProgramCacheKey:function R(X){const Z=[];if(X.shaderID?Z.push(X.shaderID):(Z.push(X.customVertexShaderID),Z.push(X.customFragmentShaderID)),void 0!==X.defines)for(const ze in X.defines)Z.push(ze),Z.push(X.defines[ze]);return!1===X.isRawShaderMaterial&&(function G(X,Z){X.push(Z.precision),X.push(Z.outputEncoding),X.push(Z.mapEncoding),X.push(Z.matcapEncoding),X.push(Z.envMapMode),X.push(Z.envMapEncoding),X.push(Z.lightMapEncoding),X.push(Z.emissiveMapEncoding),X.push(Z.combine),X.push(Z.vertexUvs),X.push(Z.fogExp2),X.push(Z.sizeAttenuation),X.push(Z.maxBones),X.push(Z.morphTargetsCount),X.push(Z.numDirLights),X.push(Z.numPointLights),X.push(Z.numSpotLights),X.push(Z.numHemiLights),X.push(Z.numRectAreaLights),X.push(Z.numDirLightShadows),X.push(Z.numPointLightShadows),X.push(Z.numSpotLightShadows),X.push(Z.shadowMapType),X.push(Z.toneMapping),X.push(Z.numClippingPlanes),X.push(Z.numClipIntersection),X.push(Z.format),X.push(Z.specularColorMapEncoding),X.push(Z.sheenColorMapEncoding)}(Z,X),function $(X,Z){c.disableAll(),Z.isWebGL2&&c.enable(0),Z.supportsVertexTextures&&c.enable(1),Z.instancing&&c.enable(2),Z.instancingColor&&c.enable(3),Z.map&&c.enable(4),Z.matcap&&c.enable(5),Z.envMap&&c.enable(6),Z.envMapCubeUV&&c.enable(7),Z.lightMap&&c.enable(8),Z.aoMap&&c.enable(9),Z.emissiveMap&&c.enable(10),Z.bumpMap&&c.enable(11),Z.normalMap&&c.enable(12),Z.objectSpaceNormalMap&&c.enable(13),Z.tangentSpaceNormalMap&&c.enable(14),Z.clearcoat&&c.enable(15),Z.clearcoatMap&&c.enable(16),Z.clearcoatRoughnessMap&&c.enable(17),Z.clearcoatNormalMap&&c.enable(18),Z.displacementMap&&c.enable(19),Z.specularMap&&c.enable(20),Z.roughnessMap&&c.enable(21),Z.metalnessMap&&c.enable(22),Z.gradientMap&&c.enable(23),Z.alphaMap&&c.enable(24),Z.alphaTest&&c.enable(25),Z.vertexColors&&c.enable(26),Z.vertexAlphas&&c.enable(27),Z.vertexUvs&&c.enable(28),Z.vertexTangents&&c.enable(29),Z.uvsVertexOnly&&c.enable(30),Z.fog&&c.enable(31),X.push(c.mask),c.disableAll(),Z.useFog&&c.enable(0),Z.flatShading&&c.enable(1),Z.logarithmicDepthBuffer&&c.enable(2),Z.skinning&&c.enable(3),Z.useVertexTexture&&c.enable(4),Z.morphTargets&&c.enable(5),Z.morphNormals&&c.enable(6),Z.premultipliedAlpha&&c.enable(7),Z.shadowMapEnabled&&c.enable(8),Z.physicallyCorrectLights&&c.enable(9),Z.doubleSided&&c.enable(10),Z.flipSided&&c.enable(11),Z.depthPacking&&c.enable(12),Z.dithering&&c.enable(13),Z.specularIntensityMap&&c.enable(14),Z.specularColorMap&&c.enable(15),Z.transmission&&c.enable(16),Z.transmissionMap&&c.enable(17),Z.thicknessMap&&c.enable(18),Z.sheen&&c.enable(19),Z.sheenColorMap&&c.enable(20),Z.sheenRoughnessMap&&c.enable(21),X.push(c.mask)}(Z,X),Z.push(r.outputEncoding)),Z.push(X.customProgramCacheKey),Z.join()},getUniforms:function fe(X){const Z=L[X.type];let ze;return ze=Z?dh.clone(is[Z].uniforms):X.uniforms,ze},acquireProgram:function Me(X,Z){let ze;for(let Xe=0,Le=h.length;Xe<Le;Xe++){const je=h[Xe];if(je.cacheKey===Z){ze=je,++ze.usedTimes;break}}return void 0===ze&&(ze=new a0(r,Z,X,a),h.push(ze)),ze},releaseProgram:function Je(X){if(0==--X.usedTimes){const Z=h.indexOf(X);h[Z]=h[h.length-1],h.pop(),X.destroy()}},releaseShaderCache:function ke(X){l.remove(X)},programs:h,dispose:function be(){l.dispose()}}}function h0(){let r=new WeakMap;return{get:function e(a){let o=r.get(a);return void 0===o&&(o={},r.set(a,o)),o},remove:function t(a){r.delete(a)},update:function n(a,o,c){r.get(a)[o]=c},dispose:function i(){r=new WeakMap}}}function f0(r,e){return r.groupOrder!==e.groupOrder?r.groupOrder-e.groupOrder:r.renderOrder!==e.renderOrder?r.renderOrder-e.renderOrder:r.material.id!==e.material.id?r.material.id-e.material.id:r.z!==e.z?r.z-e.z:r.id-e.id}function Xh(r,e){return r.groupOrder!==e.groupOrder?r.groupOrder-e.groupOrder:r.renderOrder!==e.renderOrder?r.renderOrder-e.renderOrder:r.z!==e.z?e.z-r.z:r.id-e.id}function jh(){const r=[];let e=0;const t=[],n=[],i=[];function o(m,g,v,x,T,L){let E=r[e];return void 0===E?(E={id:m.id,object:m,geometry:g,material:v,groupOrder:x,renderOrder:m.renderOrder,z:T,group:L},r[e]=E):(E.id=m.id,E.object=m,E.geometry=g,E.material=v,E.groupOrder=x,E.renderOrder=m.renderOrder,E.z=T,E.group=L),e++,E}return{opaque:t,transmissive:n,transparent:i,init:function a(){e=0,t.length=0,n.length=0,i.length=0},push:function c(m,g,v,x,T,L){const E=o(m,g,v,x,T,L);v.transmission>0?n.push(E):!0===v.transparent?i.push(E):t.push(E)},unshift:function l(m,g,v,x,T,L){const E=o(m,g,v,x,T,L);v.transmission>0?n.unshift(E):!0===v.transparent?i.unshift(E):t.unshift(E)},finish:function p(){for(let m=e,g=r.length;m<g;m++){const v=r[m];if(null===v.id)break;v.id=null,v.object=null,v.geometry=null,v.material=null,v.group=null}},sort:function h(m,g){t.length>1&&t.sort(m||f0),n.length>1&&n.sort(g||Xh),i.length>1&&i.sort(g||Xh)}}}function d0(){let r=new WeakMap;return{get:function e(n,i){let a;return!1===r.has(n)?(a=new jh,r.set(n,[a])):i>=r.get(n).length?(a=new jh,r.get(n).push(a)):a=r.get(n)[i],a},dispose:function t(){r=new WeakMap}}}function p0(){const r={};return{get:function(e){if(void 0!==r[e.id])return r[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new O,color:new Wt};break;case"SpotLight":t={position:new O,direction:new O,color:new Wt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new O,color:new Wt,distance:0,decay:0};break;case"HemisphereLight":t={direction:new O,skyColor:new Wt,groundColor:new Wt};break;case"RectAreaLight":t={color:new Wt,position:new O,halfWidth:new O,halfHeight:new O}}return r[e.id]=t,t}}}let g0=0;function v0(r,e){return(e.castShadow?1:0)-(r.castShadow?1:0)}function y0(r,e){const t=new p0,n=function m0(){const r={};return{get:function(e){if(void 0!==r[e.id])return r[e.id];let t;switch(e.type){case"DirectionalLight":case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new st};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new st,shadowCameraNear:1,shadowCameraFar:1e3}}return r[e.id]=t,t}}}(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let p=0;p<9;p++)i.probe.push(new O);const a=new O,o=new fn,c=new fn;return{setup:function l(p,m){let g=0,v=0,x=0;for(let Je=0;Je<9;Je++)i.probe[Je].set(0,0,0);let T=0,L=0,E=0,_=0,D=0,R=0,G=0,$=0;p.sort(v0);const fe=!0!==m?Math.PI:1;for(let Je=0,ke=p.length;Je<ke;Je++){const be=p[Je],X=be.color,Z=be.intensity,ze=be.distance,Xe=be.shadow&&be.shadow.map?be.shadow.map.texture:null;if(be.isAmbientLight)g+=X.r*Z*fe,v+=X.g*Z*fe,x+=X.b*Z*fe;else if(be.isLightProbe)for(let Le=0;Le<9;Le++)i.probe[Le].addScaledVector(be.sh.coefficients[Le],Z);else if(be.isDirectionalLight){const Le=t.get(be);if(Le.color.copy(be.color).multiplyScalar(be.intensity*fe),be.castShadow){const je=be.shadow,Gt=n.get(be);Gt.shadowBias=je.bias,Gt.shadowNormalBias=je.normalBias,Gt.shadowRadius=je.radius,Gt.shadowMapSize=je.mapSize,i.directionalShadow[T]=Gt,i.directionalShadowMap[T]=Xe,i.directionalShadowMatrix[T]=be.shadow.matrix,R++}i.directional[T]=Le,T++}else if(be.isSpotLight){const Le=t.get(be);if(Le.position.setFromMatrixPosition(be.matrixWorld),Le.color.copy(X).multiplyScalar(Z*fe),Le.distance=ze,Le.coneCos=Math.cos(be.angle),Le.penumbraCos=Math.cos(be.angle*(1-be.penumbra)),Le.decay=be.decay,be.castShadow){const je=be.shadow,Gt=n.get(be);Gt.shadowBias=je.bias,Gt.shadowNormalBias=je.normalBias,Gt.shadowRadius=je.radius,Gt.shadowMapSize=je.mapSize,i.spotShadow[E]=Gt,i.spotShadowMap[E]=Xe,i.spotShadowMatrix[E]=be.shadow.matrix,$++}i.spot[E]=Le,E++}else if(be.isRectAreaLight){const Le=t.get(be);Le.color.copy(X).multiplyScalar(Z),Le.halfWidth.set(.5*be.width,0,0),Le.halfHeight.set(0,.5*be.height,0),i.rectArea[_]=Le,_++}else if(be.isPointLight){const Le=t.get(be);if(Le.color.copy(be.color).multiplyScalar(be.intensity*fe),Le.distance=be.distance,Le.decay=be.decay,be.castShadow){const je=be.shadow,Gt=n.get(be);Gt.shadowBias=je.bias,Gt.shadowNormalBias=je.normalBias,Gt.shadowRadius=je.radius,Gt.shadowMapSize=je.mapSize,Gt.shadowCameraNear=je.camera.near,Gt.shadowCameraFar=je.camera.far,i.pointShadow[L]=Gt,i.pointShadowMap[L]=Xe,i.pointShadowMatrix[L]=be.shadow.matrix,G++}i.point[L]=Le,L++}else if(be.isHemisphereLight){const Le=t.get(be);Le.skyColor.copy(be.color).multiplyScalar(Z*fe),Le.groundColor.copy(be.groundColor).multiplyScalar(Z*fe),i.hemi[D]=Le,D++}}_>0&&(e.isWebGL2||!0===r.has("OES_texture_float_linear")?(i.rectAreaLTC1=kt.LTC_FLOAT_1,i.rectAreaLTC2=kt.LTC_FLOAT_2):!0===r.has("OES_texture_half_float_linear")?(i.rectAreaLTC1=kt.LTC_HALF_1,i.rectAreaLTC2=kt.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),i.ambient[0]=g,i.ambient[1]=v,i.ambient[2]=x;const Me=i.hash;(Me.directionalLength!==T||Me.pointLength!==L||Me.spotLength!==E||Me.rectAreaLength!==_||Me.hemiLength!==D||Me.numDirectionalShadows!==R||Me.numPointShadows!==G||Me.numSpotShadows!==$)&&(i.directional.length=T,i.spot.length=E,i.rectArea.length=_,i.point.length=L,i.hemi.length=D,i.directionalShadow.length=R,i.directionalShadowMap.length=R,i.pointShadow.length=G,i.pointShadowMap.length=G,i.spotShadow.length=$,i.spotShadowMap.length=$,i.directionalShadowMatrix.length=R,i.pointShadowMatrix.length=G,i.spotShadowMatrix.length=$,Me.directionalLength=T,Me.pointLength=L,Me.spotLength=E,Me.rectAreaLength=_,Me.hemiLength=D,Me.numDirectionalShadows=R,Me.numPointShadows=G,Me.numSpotShadows=$,i.version=g0++)},setupView:function h(p,m){let g=0,v=0,x=0,T=0,L=0;const E=m.matrixWorldInverse;for(let _=0,D=p.length;_<D;_++){const R=p[_];if(R.isDirectionalLight){const G=i.directional[g];G.direction.setFromMatrixPosition(R.matrixWorld),a.setFromMatrixPosition(R.target.matrixWorld),G.direction.sub(a),G.direction.transformDirection(E),g++}else if(R.isSpotLight){const G=i.spot[x];G.position.setFromMatrixPosition(R.matrixWorld),G.position.applyMatrix4(E),G.direction.setFromMatrixPosition(R.matrixWorld),a.setFromMatrixPosition(R.target.matrixWorld),G.direction.sub(a),G.direction.transformDirection(E),x++}else if(R.isRectAreaLight){const G=i.rectArea[T];G.position.setFromMatrixPosition(R.matrixWorld),G.position.applyMatrix4(E),c.identity(),o.copy(R.matrixWorld),o.premultiply(E),c.extractRotation(o),G.halfWidth.set(.5*R.width,0,0),G.halfHeight.set(0,.5*R.height,0),G.halfWidth.applyMatrix4(c),G.halfHeight.applyMatrix4(c),T++}else if(R.isPointLight){const G=i.point[v];G.position.setFromMatrixPosition(R.matrixWorld),G.position.applyMatrix4(E),v++}else if(R.isHemisphereLight){const G=i.hemi[L];G.direction.setFromMatrixPosition(R.matrixWorld),G.direction.transformDirection(E),G.direction.normalize(),L++}}},state:i}}function qh(r,e){const t=new y0(r,e),n=[],i=[];return{init:function a(){n.length=0,i.length=0},state:{lightsArray:n,shadowsArray:i,lights:t},setupLights:function l(m){t.setup(n,m)},setupLightsView:function h(m){t.setupView(n,m)},pushLight:function o(m){n.push(m)},pushShadow:function c(m){i.push(m)}}}function _0(r,e){let t=new WeakMap;return{get:function n(a,o=0){let c;return!1===t.has(a)?(c=new qh(r,e),t.set(a,[c])):o>=t.get(a).length?(c=new qh(r,e),t.get(a).push(c)):c=t.get(a)[o],c},dispose:function i(){t=new WeakMap}}}class Bc extends rr{constructor(e){super(),this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}Bc.prototype.isMeshDepthMaterial=!0;class Oc extends rr{constructor(e){super(),this.type="MeshDistanceMaterial",this.referencePosition=new O,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}Oc.prototype.isMeshDistanceMaterial=!0;const x0="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",E0="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}";function Yh(r,e,t){let n=new No;const i=new st,a=new st,o=new rn,c=new Bc({depthPacking:It}),l=new Oc,h={},p=t.maxTextureSize,m={0:Qt,1:_n,2:ti},g=new Fs({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new st},radius:{value:4}},vertexShader:x0,fragmentShader:E0}),v=g.clone();v.defines.HORIZONTAL_PASS=1;const x=new zn;x.setAttribute("position",new mi(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const T=new $i(x,g),L=this;function E(R,G){const $=e.update(T);g.defines.VSM_SAMPLES!==R.blurSamples&&(g.defines.VSM_SAMPLES=R.blurSamples,v.defines.VSM_SAMPLES=R.blurSamples,g.needsUpdate=!0,v.needsUpdate=!0),g.uniforms.shadow_pass.value=R.map.texture,g.uniforms.resolution.value=R.mapSize,g.uniforms.radius.value=R.radius,r.setRenderTarget(R.mapPass),r.clear(),r.renderBufferDirect(G,null,$,g,T,null),v.uniforms.shadow_pass.value=R.mapPass.texture,v.uniforms.resolution.value=R.mapSize,v.uniforms.radius.value=R.radius,r.setRenderTarget(R.map),r.clear(),r.renderBufferDirect(G,null,$,v,T,null)}function _(R,G,$,fe,Me,Je,ke){let be=null;const X=!0===fe.isPointLight?R.customDistanceMaterial:R.customDepthMaterial;if(be=void 0!==X?X:!0===fe.isPointLight?l:c,r.localClippingEnabled&&!0===$.clipShadows&&0!==$.clippingPlanes.length||$.displacementMap&&0!==$.displacementScale||$.alphaMap&&$.alphaTest>0){const Z=be.uuid,ze=$.uuid;let Xe=h[Z];void 0===Xe&&(Xe={},h[Z]=Xe);let Le=Xe[ze];void 0===Le&&(Le=be.clone(),Xe[ze]=Le),be=Le}return be.visible=$.visible,be.wireframe=$.wireframe,be.side=ke===Rn?null!==$.shadowSide?$.shadowSide:$.side:null!==$.shadowSide?$.shadowSide:m[$.side],be.alphaMap=$.alphaMap,be.alphaTest=$.alphaTest,be.clipShadows=$.clipShadows,be.clippingPlanes=$.clippingPlanes,be.clipIntersection=$.clipIntersection,be.displacementMap=$.displacementMap,be.displacementScale=$.displacementScale,be.displacementBias=$.displacementBias,be.wireframeLinewidth=$.wireframeLinewidth,be.linewidth=$.linewidth,!0===fe.isPointLight&&!0===be.isMeshDistanceMaterial&&(be.referencePosition.setFromMatrixPosition(fe.matrixWorld),be.nearDistance=Me,be.farDistance=Je),be}function D(R,G,$,fe,Me){if(!1===R.visible)return;if(R.layers.test(G.layers)&&(R.isMesh||R.isLine||R.isPoints)&&(R.castShadow||R.receiveShadow&&Me===Rn)&&(!R.frustumCulled||n.intersectsObject(R))){R.modelViewMatrix.multiplyMatrices($.matrixWorldInverse,R.matrixWorld);const be=e.update(R),X=R.material;if(Array.isArray(X)){const Z=be.groups;for(let ze=0,Xe=Z.length;ze<Xe;ze++){const Le=Z[ze],je=X[Le.materialIndex];if(je&&je.visible){const Gt=_(R,0,je,fe,$.near,$.far,Me);r.renderBufferDirect($,null,be,Gt,R,Le)}}}else if(X.visible){const Z=_(R,0,X,fe,$.near,$.far,Me);r.renderBufferDirect($,null,be,Z,R,null)}}const ke=R.children;for(let be=0,X=ke.length;be<X;be++)D(ke[be],G,$,fe,Me)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=tn,this.render=function(R,G,$){if(!1===L.enabled||!1===L.autoUpdate&&!1===L.needsUpdate||0===R.length)return;const fe=r.getRenderTarget(),Me=r.getActiveCubeFace(),Je=r.getActiveMipmapLevel(),ke=r.state;ke.setBlending(dn),ke.buffers.color.setClear(1,1,1,1),ke.buffers.depth.setTest(!0),ke.setScissorTest(!1);for(let be=0,X=R.length;be<X;be++){const Z=R[be],ze=Z.shadow;if(void 0===ze){console.warn("THREE.WebGLShadowMap:",Z,"has no shadow.");continue}if(!1===ze.autoUpdate&&!1===ze.needsUpdate)continue;i.copy(ze.mapSize);const Xe=ze.getFrameExtents();if(i.multiply(Xe),a.copy(ze.mapSize),(i.x>p||i.y>p)&&(i.x>p&&(a.x=Math.floor(p/Xe.x),i.x=a.x*Xe.x,ze.mapSize.x=a.x),i.y>p&&(a.y=Math.floor(p/Xe.y),i.y=a.y*Xe.y,ze.mapSize.y=a.y)),null===ze.map&&!ze.isPointLightShadow&&this.type===Rn){const je={minFilter:Cn,magFilter:Cn,format:pi};ze.map=new Li(i.x,i.y,je),ze.map.texture.name=Z.name+".shadowMap",ze.mapPass=new Li(i.x,i.y,je),ze.camera.updateProjectionMatrix()}null===ze.map&&(ze.map=new Li(i.x,i.y,{minFilter:Dn,magFilter:Dn,format:pi}),ze.map.texture.name=Z.name+".shadowMap",ze.camera.updateProjectionMatrix()),r.setRenderTarget(ze.map),r.clear();const Le=ze.getViewportCount();for(let je=0;je<Le;je++){const Gt=ze.getViewport(je);o.set(a.x*Gt.x,a.y*Gt.y,a.x*Gt.z,a.y*Gt.w),ke.viewport(o),ze.updateMatrices(Z,je),n=ze.getFrustum(),D(G,$,ze.camera,Z,this.type)}!ze.isPointLightShadow&&this.type===Rn&&E(ze,$),ze.needsUpdate=!1}L.needsUpdate=!1,r.setRenderTarget(fe,Me,Je)}}function b0(r,e,t){const n=t.isWebGL2,c=new function i(){let pe=!1;const Nt=new rn;let Lt=null;const Xn=new rn(0,0,0,0);return{setMask:function(mn){Lt!==mn&&!pe&&(r.colorMask(mn,mn,mn,mn),Lt=mn)},setLocked:function(mn){pe=mn},setClear:function(mn,ri,jt,ei,Bi){!0===Bi&&(mn*=ei,ri*=ei,jt*=ei),Nt.set(mn,ri,jt,ei),!1===Xn.equals(Nt)&&(r.clearColor(mn,ri,jt,ei),Xn.copy(Nt))},reset:function(){pe=!1,Lt=null,Xn.set(-1,0,0,0)}}},l=new function a(){let pe=!1,Nt=null,Lt=null,Xn=null;return{setTest:function(mn){mn?qt(r.DEPTH_TEST):ln(r.DEPTH_TEST)},setMask:function(mn){Nt!==mn&&!pe&&(r.depthMask(mn),Nt=mn)},setFunc:function(mn){if(Lt!==mn){if(mn)switch(mn){case Ue:r.depthFunc(r.NEVER);break;case se:r.depthFunc(r.ALWAYS);break;case w:r.depthFunc(r.LESS);break;case Yt:r.depthFunc(r.LEQUAL);break;case xn:r.depthFunc(r.EQUAL);break;case bn:r.depthFunc(r.GEQUAL);break;case Zn:r.depthFunc(r.GREATER);break;case gn:r.depthFunc(r.NOTEQUAL);break;default:r.depthFunc(r.LEQUAL)}else r.depthFunc(r.LEQUAL);Lt=mn}},setLocked:function(mn){pe=mn},setClear:function(mn){Xn!==mn&&(r.clearDepth(mn),Xn=mn)},reset:function(){pe=!1,Nt=null,Lt=null,Xn=null}}},h=new function o(){let pe=!1,Nt=null,Lt=null,Xn=null,mn=null,ri=null,jt=null,ei=null,Bi=null;return{setTest:function(Ci){pe||(Ci?qt(r.STENCIL_TEST):ln(r.STENCIL_TEST))},setMask:function(Ci){Nt!==Ci&&!pe&&(r.stencilMask(Ci),Nt=Ci)},setFunc:function(Ci,_s,xs){(Lt!==Ci||Xn!==_s||mn!==xs)&&(r.stencilFunc(Ci,_s,xs),Lt=Ci,Xn=_s,mn=xs)},setOp:function(Ci,_s,xs){(ri!==Ci||jt!==_s||ei!==xs)&&(r.stencilOp(Ci,_s,xs),ri=Ci,jt=_s,ei=xs)},setLocked:function(Ci){pe=Ci},setClear:function(Ci){Bi!==Ci&&(r.clearStencil(Ci),Bi=Ci)},reset:function(){pe=!1,Nt=null,Lt=null,Xn=null,mn=null,ri=null,jt=null,ei=null,Bi=null}}};let p={},m={},g=null,v=!1,x=null,T=null,L=null,E=null,_=null,D=null,R=null,G=!1,$=null,fe=null,Me=null,Je=null,ke=null;const be=r.getParameter(r.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let X=!1,Z=0;const ze=r.getParameter(r.VERSION);-1!==ze.indexOf("WebGL")?(Z=parseFloat(/^WebGL (\d)/.exec(ze)[1]),X=Z>=1):-1!==ze.indexOf("OpenGL ES")&&(Z=parseFloat(/^OpenGL ES (\d)/.exec(ze)[1]),X=Z>=2);let Xe=null,Le={};const je=r.getParameter(r.SCISSOR_BOX),Gt=r.getParameter(r.VIEWPORT),Jt=(new rn).fromArray(je),ot=(new rn).fromArray(Gt);function ht(pe,Nt,Lt){const Xn=new Uint8Array(4),mn=r.createTexture();r.bindTexture(pe,mn),r.texParameteri(pe,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(pe,r.TEXTURE_MAG_FILTER,r.NEAREST);for(let ri=0;ri<Lt;ri++)r.texImage2D(Nt+ri,0,r.RGBA,1,1,0,r.RGBA,r.UNSIGNED_BYTE,Xn);return mn}const $t={};function qt(pe){!0!==p[pe]&&(r.enable(pe),p[pe]=!0)}function ln(pe){!1!==p[pe]&&(r.disable(pe),p[pe]=!1)}$t[r.TEXTURE_2D]=ht(r.TEXTURE_2D,r.TEXTURE_2D,1),$t[r.TEXTURE_CUBE_MAP]=ht(r.TEXTURE_CUBE_MAP,r.TEXTURE_CUBE_MAP_POSITIVE_X,6),c.setClear(0,0,0,1),l.setClear(1),h.setClear(0),qt(r.DEPTH_TEST),l.setFunc(Yt),Ei(!1),it(Ge),qt(r.CULL_FACE),vn(dn);const Qn={[Kt]:r.FUNC_ADD,[qn]:r.FUNC_SUBTRACT,[kn]:r.FUNC_REVERSE_SUBTRACT};if(n)Qn[nn]=r.MIN,Qn[In]=r.MAX;else{const pe=e.get("EXT_blend_minmax");null!==pe&&(Qn[nn]=pe.MIN_EXT,Qn[In]=pe.MAX_EXT)}const Mn={[Ln]:r.ZERO,[Ti]:r.ONE,[nr]:r.SRC_COLOR,[at]:r.SRC_ALPHA,[De]:r.SRC_ALPHA_SATURATE,[Ut]:r.DST_COLOR,[Ct]:r.DST_ALPHA,[Xi]:r.ONE_MINUS_SRC_COLOR,[qe]:r.ONE_MINUS_SRC_ALPHA,[Se]:r.ONE_MINUS_DST_COLOR,[ut]:r.ONE_MINUS_DST_ALPHA};function vn(pe,Nt,Lt,Xn,mn,ri,jt,ei){if(pe!==dn){if(!1===v&&(qt(r.BLEND),v=!0),pe===cn)mn=mn||Nt,ri=ri||Lt,jt=jt||Xn,(Nt!==T||mn!==_)&&(r.blendEquationSeparate(Qn[Nt],Qn[mn]),T=Nt,_=mn),(Lt!==L||Xn!==E||ri!==D||jt!==R)&&(r.blendFuncSeparate(Mn[Lt],Mn[Xn],Mn[ri],Mn[jt]),L=Lt,E=Xn,D=ri,R=jt),x=pe,G=null;else if(pe!==x||ei!==G){if((T!==Kt||_!==Kt)&&(r.blendEquation(r.FUNC_ADD),T=Kt,_=Kt),ei)switch(pe){case xt:r.blendFuncSeparate(r.ONE,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA);break;case sn:r.blendFunc(r.ONE,r.ONE);break;case gt:r.blendFuncSeparate(r.ZERO,r.ZERO,r.ONE_MINUS_SRC_COLOR,r.ONE_MINUS_SRC_ALPHA);break;case en:r.blendFuncSeparate(r.ZERO,r.SRC_COLOR,r.ZERO,r.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",pe)}else switch(pe){case xt:r.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA);break;case sn:r.blendFunc(r.SRC_ALPHA,r.ONE);break;case gt:r.blendFunc(r.ZERO,r.ONE_MINUS_SRC_COLOR);break;case en:r.blendFunc(r.ZERO,r.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",pe)}L=null,E=null,D=null,R=null,x=pe,G=ei}}else!0===v&&(ln(r.BLEND),v=!1)}function Ei(pe){$!==pe&&(r.frontFace(pe?r.CW:r.CCW),$=pe)}function it(pe){pe!==mt?(qt(r.CULL_FACE),pe!==fe&&r.cullFace(pe===Ge?r.BACK:pe===J?r.FRONT:r.FRONT_AND_BACK)):ln(r.CULL_FACE),fe=pe}function Ft(pe,Nt,Lt){pe?(qt(r.POLYGON_OFFSET_FILL),(Je!==Nt||ke!==Lt)&&(r.polygonOffset(Nt,Lt),Je=Nt,ke=Lt)):ln(r.POLYGON_OFFSET_FILL)}function Xt(pe){void 0===pe&&(pe=r.TEXTURE0+be-1),Xe!==pe&&(r.activeTexture(pe),Xe=pe)}return{buffers:{color:c,depth:l,stencil:h},enable:qt,disable:ln,bindFramebuffer:function fi(pe,Nt){return m[pe]!==Nt&&(r.bindFramebuffer(pe,Nt),m[pe]=Nt,n&&(pe===r.DRAW_FRAMEBUFFER&&(m[r.FRAMEBUFFER]=Nt),pe===r.FRAMEBUFFER&&(m[r.DRAW_FRAMEBUFFER]=Nt)),!0)},useProgram:function Ae(pe){return g!==pe&&(r.useProgram(pe),g=pe,!0)},setBlending:vn,setMaterial:function En(pe,Nt){pe.side===ti?ln(r.CULL_FACE):qt(r.CULL_FACE);let Lt=pe.side===Qt;Nt&&(Lt=!Lt),Ei(Lt),pe.blending===xt&&!1===pe.transparent?vn(dn):vn(pe.blending,pe.blendEquation,pe.blendSrc,pe.blendDst,pe.blendEquationAlpha,pe.blendSrcAlpha,pe.blendDstAlpha,pe.premultipliedAlpha),l.setFunc(pe.depthFunc),l.setTest(pe.depthTest),l.setMask(pe.depthWrite),c.setMask(pe.colorWrite);const Xn=pe.stencilWrite;h.setTest(Xn),Xn&&(h.setMask(pe.stencilWriteMask),h.setFunc(pe.stencilFunc,pe.stencilRef,pe.stencilFuncMask),h.setOp(pe.stencilFail,pe.stencilZFail,pe.stencilZPass)),Ft(pe.polygonOffset,pe.polygonOffsetFactor,pe.polygonOffsetUnits),!0===pe.alphaToCoverage?qt(r.SAMPLE_ALPHA_TO_COVERAGE):ln(r.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:Ei,setCullFace:it,setLineWidth:function wt(pe){pe!==Me&&(X&&r.lineWidth(pe),Me=pe)},setPolygonOffset:Ft,setScissorTest:function an(pe){pe?qt(r.SCISSOR_TEST):ln(r.SCISSOR_TEST)},activeTexture:Xt,bindTexture:function Vn(pe,Nt){null===Xe&&Xt();let Lt=Le[Xe];void 0===Lt&&(Lt={type:void 0,texture:void 0},Le[Xe]=Lt),(Lt.type!==pe||Lt.texture!==Nt)&&(r.bindTexture(pe,Nt||$t[pe]),Lt.type=pe,Lt.texture=Nt)},unbindTexture:function Wn(){const pe=Le[Xe];void 0!==pe&&void 0!==pe.type&&(r.bindTexture(pe.type,null),pe.type=void 0,pe.texture=void 0)},compressedTexImage2D:function ai(){try{r.compressedTexImage2D.apply(r,arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}},texImage2D:function Vt(){try{r.texImage2D.apply(r,arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}},texImage3D:function bt(){try{r.texImage3D.apply(r,arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}},texStorage2D:function vt(){try{r.texStorage2D.apply(r,arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}},texStorage3D:function Mt(){try{r.texStorage3D.apply(r,arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}},texSubImage2D:function Hi(){try{r.texSubImage2D.apply(r,arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}},texSubImage3D:function ne(){try{r.texSubImage3D.apply(r,arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}},compressedTexSubImage2D:function Y(){try{r.compressedTexSubImage2D.apply(r,arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}},scissor:function Bn(pe){!1===Jt.equals(pe)&&(r.scissor(pe.x,pe.y,pe.z,pe.w),Jt.copy(pe))},viewport:function Sn(pe){!1===ot.equals(pe)&&(r.viewport(pe.x,pe.y,pe.z,pe.w),ot.copy(pe))},reset:function Ot(){r.disable(r.BLEND),r.disable(r.CULL_FACE),r.disable(r.DEPTH_TEST),r.disable(r.POLYGON_OFFSET_FILL),r.disable(r.SCISSOR_TEST),r.disable(r.STENCIL_TEST),r.disable(r.SAMPLE_ALPHA_TO_COVERAGE),r.blendEquation(r.FUNC_ADD),r.blendFunc(r.ONE,r.ZERO),r.blendFuncSeparate(r.ONE,r.ZERO,r.ONE,r.ZERO),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0),r.depthMask(!0),r.depthFunc(r.LESS),r.clearDepth(1),r.stencilMask(4294967295),r.stencilFunc(r.ALWAYS,0,4294967295),r.stencilOp(r.KEEP,r.KEEP,r.KEEP),r.clearStencil(0),r.cullFace(r.BACK),r.frontFace(r.CCW),r.polygonOffset(0,0),r.activeTexture(r.TEXTURE0),r.bindFramebuffer(r.FRAMEBUFFER,null),!0===n&&(r.bindFramebuffer(r.DRAW_FRAMEBUFFER,null),r.bindFramebuffer(r.READ_FRAMEBUFFER,null)),r.useProgram(null),r.lineWidth(1),r.scissor(0,0,r.canvas.width,r.canvas.height),r.viewport(0,0,r.canvas.width,r.canvas.height),p={},Xe=null,Le={},m={},g=null,v=!1,x=null,T=null,L=null,E=null,_=null,D=null,R=null,G=!1,$=null,fe=null,Me=null,Je=null,ke=null,Jt.set(0,0,r.canvas.width,r.canvas.height),ot.set(0,0,r.canvas.width,r.canvas.height),c.reset(),l.reset(),h.reset()}}}function M0(r,e,t,n,i,a,o){const c=i.isWebGL2,l=i.maxTextures,h=i.maxCubemapSize,p=i.maxTextureSize,m=i.maxSamples,v=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):void 0,x=new WeakMap;let T,L=!1;try{L=typeof OffscreenCanvas<"u"&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch{}function E(ne,Y){return L?new OffscreenCanvas(ne,Y):Oa("canvas")}function _(ne,Y,vt,Mt){let Vt=1;if((ne.width>Mt||ne.height>Mt)&&(Vt=Mt/Math.max(ne.width,ne.height)),Vt<1||!0===Y){if(typeof HTMLImageElement<"u"&&ne instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&ne instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&ne instanceof ImageBitmap){const bt=Y?Ua:Math.floor,Bn=bt(Vt*ne.width),Sn=bt(Vt*ne.height);void 0===T&&(T=E(Bn,Sn));const Ot=vt?E(Bn,Sn):T;return Ot.width=Bn,Ot.height=Sn,Ot.getContext("2d").drawImage(ne,0,0,Bn,Sn),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+ne.width+"x"+ne.height+") to ("+Bn+"x"+Sn+")."),Ot}return"data"in ne&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+ne.width+"x"+ne.height+")."),ne}return ne}function D(ne){return wr(ne.width)&&wr(ne.height)}function G(ne,Y){return ne.generateMipmaps&&Y&&ne.minFilter!==Dn&&ne.minFilter!==Cn}function $(ne){r.generateMipmap(ne)}function fe(ne,Y,vt,Mt){if(!1===c)return Y;if(null!==ne){if(void 0!==r[ne])return r[ne];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+ne+"'")}let Vt=Y;return Y===r.RED&&(vt===r.FLOAT&&(Vt=r.R32F),vt===r.HALF_FLOAT&&(Vt=r.R16F),vt===r.UNSIGNED_BYTE&&(Vt=r.R8)),Y===r.RGB&&(vt===r.FLOAT&&(Vt=r.RGB32F),vt===r.HALF_FLOAT&&(Vt=r.RGB16F),vt===r.UNSIGNED_BYTE&&(Vt=r.RGB8)),Y===r.RGBA&&(vt===r.FLOAT&&(Vt=r.RGBA32F),vt===r.HALF_FLOAT&&(Vt=r.RGBA16F),vt===r.UNSIGNED_BYTE&&(Vt=Mt===_t?r.SRGB8_ALPHA8:r.RGBA8)),(Vt===r.R16F||Vt===r.R32F||Vt===r.RGBA16F||Vt===r.RGBA32F)&&e.get("EXT_color_buffer_float"),Vt}function Me(ne,Y,vt){return!0===G(ne,vt)||ne.isFramebufferTexture&&ne.minFilter!==Dn&&ne.minFilter!==Cn?Math.log2(Math.max(Y.width,Y.height))+1:void 0!==ne.mipmaps&&ne.mipmaps.length>0?ne.mipmaps.length:ne.isCompressedTexture&&Array.isArray(ne.image)?Y.mipmaps.length:1}function Je(ne){return ne===Dn||ne===vi||ne===xr?r.NEAREST:r.LINEAR}function ke(ne){const Y=ne.target;Y.removeEventListener("dispose",ke),function X(ne){const Y=n.get(ne);void 0!==Y.__webglInit&&(r.deleteTexture(Y.__webglTexture),n.remove(ne))}(Y),Y.isVideoTexture&&x.delete(Y),o.memory.textures--}function be(ne){const Y=ne.target;Y.removeEventListener("dispose",be),function Z(ne){const Y=ne.texture,vt=n.get(ne),Mt=n.get(Y);if(ne){if(void 0!==Mt.__webglTexture&&(r.deleteTexture(Mt.__webglTexture),o.memory.textures--),ne.depthTexture&&ne.depthTexture.dispose(),ne.isWebGLCubeRenderTarget)for(let Vt=0;Vt<6;Vt++)r.deleteFramebuffer(vt.__webglFramebuffer[Vt]),vt.__webglDepthbuffer&&r.deleteRenderbuffer(vt.__webglDepthbuffer[Vt]);else r.deleteFramebuffer(vt.__webglFramebuffer),vt.__webglDepthbuffer&&r.deleteRenderbuffer(vt.__webglDepthbuffer),vt.__webglMultisampledFramebuffer&&r.deleteFramebuffer(vt.__webglMultisampledFramebuffer),vt.__webglColorRenderbuffer&&r.deleteRenderbuffer(vt.__webglColorRenderbuffer),vt.__webglDepthRenderbuffer&&r.deleteRenderbuffer(vt.__webglDepthRenderbuffer);if(ne.isWebGLMultipleRenderTargets)for(let Vt=0,bt=Y.length;Vt<bt;Vt++){const Bn=n.get(Y[Vt]);Bn.__webglTexture&&(r.deleteTexture(Bn.__webglTexture),o.memory.textures--),n.remove(Y[Vt])}n.remove(Y),n.remove(ne)}}(Y)}let ze=0;function je(ne,Y){const vt=n.get(ne);if(ne.isVideoTexture&&function Xt(ne){const Y=o.render.frame;x.get(ne)!==Y&&(x.set(ne,Y),ne.update())}(ne),ne.version>0&&vt.__version!==ne.version){const Mt=ne.image;if(void 0===Mt)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==Mt.complete)return void fi(vt,ne,Y);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}t.activeTexture(r.TEXTURE0+Y),t.bindTexture(r.TEXTURE_2D,vt.__webglTexture)}function ot(ne,Y){const vt=n.get(ne);ne.version>0&&vt.__version!==ne.version?function Ae(ne,Y,vt){if(6!==Y.image.length)return;ln(ne,Y),t.activeTexture(r.TEXTURE0+vt),t.bindTexture(r.TEXTURE_CUBE_MAP,ne.__webglTexture),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,Y.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Y.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,Y.unpackAlignment),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,r.NONE);const Mt=Y&&(Y.isCompressedTexture||Y.image[0].isCompressedTexture),Vt=Y.image[0]&&Y.image[0].isDataTexture,bt=[];for(let jt=0;jt<6;jt++)bt[jt]=Mt||Vt?Vt?Y.image[jt].image:Y.image[jt]:_(Y.image[jt],!1,!0,h);const Bn=bt[0],Sn=D(Bn)||c,Ot=a.convert(Y.format),pe=a.convert(Y.type),Nt=fe(Y.internalFormat,Ot,pe,Y.encoding),Lt=c&&!0!==Y.isVideoTexture,Xn=void 0===ne.__version;let ri,mn=Me(Y,Bn,Sn);if(qt(r.TEXTURE_CUBE_MAP,Y,Sn),Mt){Lt&&Xn&&t.texStorage2D(r.TEXTURE_CUBE_MAP,mn,Nt,Bn.width,Bn.height);for(let jt=0;jt<6;jt++){ri=bt[jt].mipmaps;for(let ei=0;ei<ri.length;ei++){const Bi=ri[ei];Y.format!==pi&&Y.format!==br?null!==Ot?Lt?t.compressedTexSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+jt,ei,0,0,Bi.width,Bi.height,Ot,Bi.data):t.compressedTexImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+jt,ei,Nt,Bi.width,Bi.height,0,Bi.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Lt?t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+jt,ei,0,0,Bi.width,Bi.height,Ot,pe,Bi.data):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+jt,ei,Nt,Bi.width,Bi.height,0,Ot,pe,Bi.data)}}}else{ri=Y.mipmaps,Lt&&Xn&&(ri.length>0&&mn++,t.texStorage2D(r.TEXTURE_CUBE_MAP,mn,Nt,bt[0].width,bt[0].height));for(let jt=0;jt<6;jt++)if(Vt){Lt?t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+jt,0,0,0,bt[jt].width,bt[jt].height,Ot,pe,bt[jt].data):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+jt,0,Nt,bt[jt].width,bt[jt].height,0,Ot,pe,bt[jt].data);for(let ei=0;ei<ri.length;ei++){const Ci=ri[ei].image[jt].image;Lt?t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+jt,ei+1,0,0,Ci.width,Ci.height,Ot,pe,Ci.data):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+jt,ei+1,Nt,Ci.width,Ci.height,0,Ot,pe,Ci.data)}}else{Lt?t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+jt,0,0,0,Ot,pe,bt[jt]):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+jt,0,Nt,Ot,pe,bt[jt]);for(let ei=0;ei<ri.length;ei++){const Bi=ri[ei];Lt?t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+jt,ei+1,0,0,Ot,pe,Bi.image[jt]):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+jt,ei+1,Nt,Ot,pe,Bi.image[jt])}}}G(Y,Sn)&&$(r.TEXTURE_CUBE_MAP),ne.__version=Y.version,Y.onUpdate&&Y.onUpdate(Y)}(vt,ne,Y):(t.activeTexture(r.TEXTURE0+Y),t.bindTexture(r.TEXTURE_CUBE_MAP,vt.__webglTexture))}const ht={[ni]:r.REPEAT,[St]:r.CLAMP_TO_EDGE,[un]:r.MIRRORED_REPEAT},$t={[Dn]:r.NEAREST,[vi]:r.NEAREST_MIPMAP_NEAREST,[xr]:r.NEAREST_MIPMAP_LINEAR,[Cn]:r.LINEAR,[Jn]:r.LINEAR_MIPMAP_NEAREST,[Dr]:r.LINEAR_MIPMAP_LINEAR};function qt(ne,Y,vt){if(vt?(r.texParameteri(ne,r.TEXTURE_WRAP_S,ht[Y.wrapS]),r.texParameteri(ne,r.TEXTURE_WRAP_T,ht[Y.wrapT]),(ne===r.TEXTURE_3D||ne===r.TEXTURE_2D_ARRAY)&&r.texParameteri(ne,r.TEXTURE_WRAP_R,ht[Y.wrapR]),r.texParameteri(ne,r.TEXTURE_MAG_FILTER,$t[Y.magFilter]),r.texParameteri(ne,r.TEXTURE_MIN_FILTER,$t[Y.minFilter])):(r.texParameteri(ne,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(ne,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),(ne===r.TEXTURE_3D||ne===r.TEXTURE_2D_ARRAY)&&r.texParameteri(ne,r.TEXTURE_WRAP_R,r.CLAMP_TO_EDGE),(Y.wrapS!==St||Y.wrapT!==St)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),r.texParameteri(ne,r.TEXTURE_MAG_FILTER,Je(Y.magFilter)),r.texParameteri(ne,r.TEXTURE_MIN_FILTER,Je(Y.minFilter)),Y.minFilter!==Dn&&Y.minFilter!==Cn&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===e.has("EXT_texture_filter_anisotropic")){const Mt=e.get("EXT_texture_filter_anisotropic");if(Y.type===ki&&!1===e.has("OES_texture_float_linear")||!1===c&&Y.type===_i&&!1===e.has("OES_texture_half_float_linear"))return;(Y.anisotropy>1||n.get(Y).__currentAnisotropy)&&(r.texParameterf(ne,Mt.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Y.anisotropy,i.getMaxAnisotropy())),n.get(Y).__currentAnisotropy=Y.anisotropy)}}function ln(ne,Y){void 0===ne.__webglInit&&(ne.__webglInit=!0,Y.addEventListener("dispose",ke),ne.__webglTexture=r.createTexture(),o.memory.textures++)}function fi(ne,Y,vt){let Mt=r.TEXTURE_2D;Y.isDataTexture2DArray&&(Mt=r.TEXTURE_2D_ARRAY),Y.isDataTexture3D&&(Mt=r.TEXTURE_3D),ln(ne,Y),t.activeTexture(r.TEXTURE0+vt),t.bindTexture(Mt,ne.__webglTexture),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,Y.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Y.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,Y.unpackAlignment),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,r.NONE);const Vt=function R(ne){return!c&&(ne.wrapS!==St||ne.wrapT!==St||ne.minFilter!==Dn&&ne.minFilter!==Cn)}(Y)&&!1===D(Y.image),bt=_(Y.image,Vt,!1,p),Bn=D(bt)||c,Sn=a.convert(Y.format);let Nt,Ot=a.convert(Y.type),pe=fe(Y.internalFormat,Sn,Ot,Y.encoding);qt(Mt,Y,Bn);const Lt=Y.mipmaps,Xn=c&&!0!==Y.isVideoTexture,mn=void 0===ne.__version,ri=Me(Y,bt,Bn);if(Y.isDepthTexture)pe=r.DEPTH_COMPONENT,c?pe=Y.type===ki?r.DEPTH_COMPONENT32F:Y.type===hr?r.DEPTH_COMPONENT24:Y.type===Jr?r.DEPTH24_STENCIL8:r.DEPTH_COMPONENT16:Y.type===ki&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),Y.format===Pi&&pe===r.DEPTH_COMPONENT&&Y.type!==cr&&Y.type!==hr&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),Y.type=cr,Ot=a.convert(Y.type)),Y.format===Fi&&pe===r.DEPTH_COMPONENT&&(pe=r.DEPTH_STENCIL,Y.type!==Jr&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),Y.type=Jr,Ot=a.convert(Y.type))),Xn&&mn?t.texStorage2D(r.TEXTURE_2D,1,pe,bt.width,bt.height):t.texImage2D(r.TEXTURE_2D,0,pe,bt.width,bt.height,0,Sn,Ot,null);else if(Y.isDataTexture)if(Lt.length>0&&Bn){Xn&&mn&&t.texStorage2D(r.TEXTURE_2D,ri,pe,Lt[0].width,Lt[0].height);for(let jt=0,ei=Lt.length;jt<ei;jt++)Nt=Lt[jt],Xn?t.texSubImage2D(r.TEXTURE_2D,0,0,0,Nt.width,Nt.height,Sn,Ot,Nt.data):t.texImage2D(r.TEXTURE_2D,jt,pe,Nt.width,Nt.height,0,Sn,Ot,Nt.data);Y.generateMipmaps=!1}else Xn?(mn&&t.texStorage2D(r.TEXTURE_2D,ri,pe,bt.width,bt.height),t.texSubImage2D(r.TEXTURE_2D,0,0,0,bt.width,bt.height,Sn,Ot,bt.data)):t.texImage2D(r.TEXTURE_2D,0,pe,bt.width,bt.height,0,Sn,Ot,bt.data);else if(Y.isCompressedTexture){Xn&&mn&&t.texStorage2D(r.TEXTURE_2D,ri,pe,Lt[0].width,Lt[0].height);for(let jt=0,ei=Lt.length;jt<ei;jt++)Nt=Lt[jt],Y.format!==pi&&Y.format!==br?null!==Sn?Xn?t.compressedTexSubImage2D(r.TEXTURE_2D,jt,0,0,Nt.width,Nt.height,Sn,Nt.data):t.compressedTexImage2D(r.TEXTURE_2D,jt,pe,Nt.width,Nt.height,0,Nt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Xn?t.texSubImage2D(r.TEXTURE_2D,jt,0,0,Nt.width,Nt.height,Sn,Ot,Nt.data):t.texImage2D(r.TEXTURE_2D,jt,pe,Nt.width,Nt.height,0,Sn,Ot,Nt.data)}else if(Y.isDataTexture2DArray)Xn?(mn&&t.texStorage3D(r.TEXTURE_2D_ARRAY,ri,pe,bt.width,bt.height,bt.depth),t.texSubImage3D(r.TEXTURE_2D_ARRAY,0,0,0,0,bt.width,bt.height,bt.depth,Sn,Ot,bt.data)):t.texImage3D(r.TEXTURE_2D_ARRAY,0,pe,bt.width,bt.height,bt.depth,0,Sn,Ot,bt.data);else if(Y.isDataTexture3D)Xn?(mn&&t.texStorage3D(r.TEXTURE_3D,ri,pe,bt.width,bt.height,bt.depth),t.texSubImage3D(r.TEXTURE_3D,0,0,0,0,bt.width,bt.height,bt.depth,Sn,Ot,bt.data)):t.texImage3D(r.TEXTURE_3D,0,pe,bt.width,bt.height,bt.depth,0,Sn,Ot,bt.data);else if(Y.isFramebufferTexture)Xn&&mn?t.texStorage2D(r.TEXTURE_2D,ri,pe,bt.width,bt.height):t.texImage2D(r.TEXTURE_2D,0,pe,bt.width,bt.height,0,Sn,Ot,null);else if(Lt.length>0&&Bn){Xn&&mn&&t.texStorage2D(r.TEXTURE_2D,ri,pe,Lt[0].width,Lt[0].height);for(let jt=0,ei=Lt.length;jt<ei;jt++)Nt=Lt[jt],Xn?t.texSubImage2D(r.TEXTURE_2D,jt,0,0,Sn,Ot,Nt):t.texImage2D(r.TEXTURE_2D,jt,pe,Sn,Ot,Nt);Y.generateMipmaps=!1}else Xn?(mn&&t.texStorage2D(r.TEXTURE_2D,ri,pe,bt.width,bt.height),t.texSubImage2D(r.TEXTURE_2D,0,0,0,Sn,Ot,bt)):t.texImage2D(r.TEXTURE_2D,0,pe,Sn,Ot,bt);G(Y,Bn)&&$(Mt),ne.__version=Y.version,Y.onUpdate&&Y.onUpdate(Y)}function Qn(ne,Y,vt,Mt,Vt){const bt=a.convert(vt.format),Bn=a.convert(vt.type),Sn=fe(vt.internalFormat,bt,Bn,vt.encoding);n.get(Y).__hasExternalTextures||(Vt===r.TEXTURE_3D||Vt===r.TEXTURE_2D_ARRAY?t.texImage3D(Vt,0,Sn,Y.width,Y.height,Y.depth,0,bt,Bn,null):t.texImage2D(Vt,0,Sn,Y.width,Y.height,0,bt,Bn,null)),t.bindFramebuffer(r.FRAMEBUFFER,ne),Y.useRenderToTexture?v.framebufferTexture2DMultisampleEXT(r.FRAMEBUFFER,Mt,Vt,n.get(vt).__webglTexture,0,an(Y)):r.framebufferTexture2D(r.FRAMEBUFFER,Mt,Vt,n.get(vt).__webglTexture,0),t.bindFramebuffer(r.FRAMEBUFFER,null)}function Mn(ne,Y,vt){if(r.bindRenderbuffer(r.RENDERBUFFER,ne),Y.depthBuffer&&!Y.stencilBuffer){let Mt=r.DEPTH_COMPONENT16;if(vt||Y.useRenderToTexture){const Vt=Y.depthTexture;Vt&&Vt.isDepthTexture&&(Vt.type===ki?Mt=r.DEPTH_COMPONENT32F:Vt.type===hr&&(Mt=r.DEPTH_COMPONENT24));const bt=an(Y);Y.useRenderToTexture?v.renderbufferStorageMultisampleEXT(r.RENDERBUFFER,bt,Mt,Y.width,Y.height):r.renderbufferStorageMultisample(r.RENDERBUFFER,bt,Mt,Y.width,Y.height)}else r.renderbufferStorage(r.RENDERBUFFER,Mt,Y.width,Y.height);r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,ne)}else if(Y.depthBuffer&&Y.stencilBuffer){const Mt=an(Y);vt&&Y.useRenderbuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,Mt,r.DEPTH24_STENCIL8,Y.width,Y.height):Y.useRenderToTexture?v.renderbufferStorageMultisampleEXT(r.RENDERBUFFER,Mt,r.DEPTH24_STENCIL8,Y.width,Y.height):r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,Y.width,Y.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,ne)}else{const Mt=!0===Y.isWebGLMultipleRenderTargets?Y.texture[0]:Y.texture,Vt=a.convert(Mt.format),bt=a.convert(Mt.type),Bn=fe(Mt.internalFormat,Vt,bt,Mt.encoding),Sn=an(Y);vt&&Y.useRenderbuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,Sn,Bn,Y.width,Y.height):Y.useRenderToTexture?v.renderbufferStorageMultisampleEXT(r.RENDERBUFFER,Sn,Bn,Y.width,Y.height):r.renderbufferStorage(r.RENDERBUFFER,Bn,Y.width,Y.height)}r.bindRenderbuffer(r.RENDERBUFFER,null)}function En(ne){const Y=n.get(ne),vt=!0===ne.isWebGLCubeRenderTarget;if(ne.depthTexture&&!Y.__autoAllocateDepthBuffer){if(vt)throw new Error("target.depthTexture not supported in Cube render targets");!function vn(ne,Y){if(Y&&Y.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(r.FRAMEBUFFER,ne),!Y.depthTexture||!Y.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!n.get(Y.depthTexture).__webglTexture||Y.depthTexture.image.width!==Y.width||Y.depthTexture.image.height!==Y.height)&&(Y.depthTexture.image.width=Y.width,Y.depthTexture.image.height=Y.height,Y.depthTexture.needsUpdate=!0),je(Y.depthTexture,0);const Mt=n.get(Y.depthTexture).__webglTexture,Vt=an(Y);if(Y.depthTexture.format===Pi)Y.useRenderToTexture?v.framebufferTexture2DMultisampleEXT(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,Mt,0,Vt):r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,Mt,0);else{if(Y.depthTexture.format!==Fi)throw new Error("Unknown depthTexture format");Y.useRenderToTexture?v.framebufferTexture2DMultisampleEXT(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.TEXTURE_2D,Mt,0,Vt):r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.TEXTURE_2D,Mt,0)}}(Y.__webglFramebuffer,ne)}else if(vt){Y.__webglDepthbuffer=[];for(let Mt=0;Mt<6;Mt++)t.bindFramebuffer(r.FRAMEBUFFER,Y.__webglFramebuffer[Mt]),Y.__webglDepthbuffer[Mt]=r.createRenderbuffer(),Mn(Y.__webglDepthbuffer[Mt],ne,!1)}else t.bindFramebuffer(r.FRAMEBUFFER,Y.__webglFramebuffer),Y.__webglDepthbuffer=r.createRenderbuffer(),Mn(Y.__webglDepthbuffer,ne,!1);t.bindFramebuffer(r.FRAMEBUFFER,null)}function an(ne){return c&&(ne.useRenderbuffer||ne.useRenderToTexture)?Math.min(m,ne.samples):0}let Vn=!1,Wn=!1;this.allocateTextureUnit=function Le(){const ne=ze;return ne>=l&&console.warn("THREE.WebGLTextures: Trying to use "+ne+" texture units while this GPU supports only "+l),ze+=1,ne},this.resetTextureUnits=function Xe(){ze=0},this.setTexture2D=je,this.setTexture2DArray=function Gt(ne,Y){const vt=n.get(ne);ne.version>0&&vt.__version!==ne.version?fi(vt,ne,Y):(t.activeTexture(r.TEXTURE0+Y),t.bindTexture(r.TEXTURE_2D_ARRAY,vt.__webglTexture))},this.setTexture3D=function Jt(ne,Y){const vt=n.get(ne);ne.version>0&&vt.__version!==ne.version?fi(vt,ne,Y):(t.activeTexture(r.TEXTURE0+Y),t.bindTexture(r.TEXTURE_3D,vt.__webglTexture))},this.setTextureCube=ot,this.rebindTextures=function Ei(ne,Y,vt){const Mt=n.get(ne);void 0!==Y&&Qn(Mt.__webglFramebuffer,ne,ne.texture,r.COLOR_ATTACHMENT0,r.TEXTURE_2D),void 0!==vt&&En(ne)},this.setupRenderTarget=function it(ne){const Y=ne.texture,vt=n.get(ne),Mt=n.get(Y);ne.addEventListener("dispose",be),!0!==ne.isWebGLMultipleRenderTargets&&(void 0===Mt.__webglTexture&&(Mt.__webglTexture=r.createTexture()),Mt.__version=Y.version,o.memory.textures++);const Vt=!0===ne.isWebGLCubeRenderTarget,bt=!0===ne.isWebGLMultipleRenderTargets,Bn=Y.isDataTexture3D||Y.isDataTexture2DArray,Sn=D(ne)||c;if(c&&Y.format===br&&(Y.type===ki||Y.type===_i)&&(Y.format=pi,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),Vt){vt.__webglFramebuffer=[];for(let Ot=0;Ot<6;Ot++)vt.__webglFramebuffer[Ot]=r.createFramebuffer()}else if(vt.__webglFramebuffer=r.createFramebuffer(),bt)if(i.drawBuffers){const Ot=ne.texture;for(let pe=0,Nt=Ot.length;pe<Nt;pe++){const Lt=n.get(Ot[pe]);void 0===Lt.__webglTexture&&(Lt.__webglTexture=r.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(ne.useRenderbuffer)if(c){vt.__webglMultisampledFramebuffer=r.createFramebuffer(),vt.__webglColorRenderbuffer=r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,vt.__webglColorRenderbuffer);const Ot=a.convert(Y.format),pe=a.convert(Y.type),Nt=fe(Y.internalFormat,Ot,pe,Y.encoding),Lt=an(ne);r.renderbufferStorageMultisample(r.RENDERBUFFER,Lt,Nt,ne.width,ne.height),t.bindFramebuffer(r.FRAMEBUFFER,vt.__webglMultisampledFramebuffer),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,vt.__webglColorRenderbuffer),r.bindRenderbuffer(r.RENDERBUFFER,null),ne.depthBuffer&&(vt.__webglDepthRenderbuffer=r.createRenderbuffer(),Mn(vt.__webglDepthRenderbuffer,ne,!0)),t.bindFramebuffer(r.FRAMEBUFFER,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(Vt){t.bindTexture(r.TEXTURE_CUBE_MAP,Mt.__webglTexture),qt(r.TEXTURE_CUBE_MAP,Y,Sn);for(let Ot=0;Ot<6;Ot++)Qn(vt.__webglFramebuffer[Ot],ne,Y,r.COLOR_ATTACHMENT0,r.TEXTURE_CUBE_MAP_POSITIVE_X+Ot);G(Y,Sn)&&$(r.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(bt){const Ot=ne.texture;for(let pe=0,Nt=Ot.length;pe<Nt;pe++){const Lt=Ot[pe],Xn=n.get(Lt);t.bindTexture(r.TEXTURE_2D,Xn.__webglTexture),qt(r.TEXTURE_2D,Lt,Sn),Qn(vt.__webglFramebuffer,ne,Lt,r.COLOR_ATTACHMENT0+pe,r.TEXTURE_2D),G(Lt,Sn)&&$(r.TEXTURE_2D)}t.unbindTexture()}else{let Ot=r.TEXTURE_2D;Bn&&(c?Ot=Y.isDataTexture3D?r.TEXTURE_3D:r.TEXTURE_2D_ARRAY:console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.")),t.bindTexture(Ot,Mt.__webglTexture),qt(Ot,Y,Sn),Qn(vt.__webglFramebuffer,ne,Y,r.COLOR_ATTACHMENT0,Ot),G(Y,Sn)&&$(Ot),t.unbindTexture()}ne.depthBuffer&&En(ne)},this.updateRenderTargetMipmap=function wt(ne){const Y=D(ne)||c,vt=!0===ne.isWebGLMultipleRenderTargets?ne.texture:[ne.texture];for(let Mt=0,Vt=vt.length;Mt<Vt;Mt++){const bt=vt[Mt];if(G(bt,Y)){const Bn=ne.isWebGLCubeRenderTarget?r.TEXTURE_CUBE_MAP:r.TEXTURE_2D,Sn=n.get(bt).__webglTexture;t.bindTexture(Bn,Sn),$(Bn),t.unbindTexture()}}},this.updateMultisampleRenderTarget=function Ft(ne){if(ne.useRenderbuffer)if(c){const Y=ne.width,vt=ne.height;let Mt=r.COLOR_BUFFER_BIT;const Vt=[r.COLOR_ATTACHMENT0],bt=ne.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT;ne.depthBuffer&&Vt.push(bt),ne.ignoreDepthForMultisampleCopy||(ne.depthBuffer&&(Mt|=r.DEPTH_BUFFER_BIT),ne.stencilBuffer&&(Mt|=r.STENCIL_BUFFER_BIT));const Bn=n.get(ne);t.bindFramebuffer(r.READ_FRAMEBUFFER,Bn.__webglMultisampledFramebuffer),t.bindFramebuffer(r.DRAW_FRAMEBUFFER,Bn.__webglFramebuffer),ne.ignoreDepthForMultisampleCopy&&(r.invalidateFramebuffer(r.READ_FRAMEBUFFER,[bt]),r.invalidateFramebuffer(r.DRAW_FRAMEBUFFER,[bt])),r.blitFramebuffer(0,0,Y,vt,0,0,Y,vt,Mt,r.NEAREST),r.invalidateFramebuffer(r.READ_FRAMEBUFFER,Vt),t.bindFramebuffer(r.READ_FRAMEBUFFER,null),t.bindFramebuffer(r.DRAW_FRAMEBUFFER,Bn.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.setupDepthRenderbuffer=En,this.setupFrameBufferTexture=Qn,this.safeSetTexture2D=function ai(ne,Y){ne&&ne.isWebGLRenderTarget&&(!1===Vn&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),Vn=!0),ne=ne.texture),je(ne,Y)},this.safeSetTextureCube=function Hi(ne,Y){ne&&ne.isWebGLCubeRenderTarget&&(!1===Wn&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),Wn=!0),ne=ne.texture),ot(ne,Y)}}function Kh(r,e,t){const n=t.isWebGL2;return{convert:function i(a){let o;if(a===Qe)return r.UNSIGNED_BYTE;if(a===fr)return r.UNSIGNED_SHORT_4_4_4_4;if(a===Un)return r.UNSIGNED_SHORT_5_5_5_1;if(a===cc)return r.UNSIGNED_SHORT_5_6_5;if(a===Er)return r.BYTE;if(a===Pn)return r.SHORT;if(a===cr)return r.UNSIGNED_SHORT;if(a===Zr)return r.INT;if(a===hr)return r.UNSIGNED_INT;if(a===ki)return r.FLOAT;if(a===_i)return n?r.HALF_FLOAT:(o=e.get("OES_texture_half_float"),null!==o?o.HALF_FLOAT_OES:null);if(a===Tn)return r.ALPHA;if(a===br)return r.RGB;if(a===pi)return r.RGBA;if(a===Ia)return r.LUMINANCE;if(a===Ar)return r.LUMINANCE_ALPHA;if(a===Pi)return r.DEPTH_COMPONENT;if(a===Fi)return r.DEPTH_STENCIL;if(a===Bs)return r.RED;if(a===d)return r.RED_INTEGER;if(a===S)return r.RG;if(a===C)return r.RG_INTEGER;if(a===U)return r.RGB_INTEGER;if(a===le)return r.RGBA_INTEGER;if(a===_e||a===ye||a===ae||a===K){if(o=e.get("WEBGL_compressed_texture_s3tc"),null===o)return null;if(a===_e)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(a===ye)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(a===ae)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(a===K)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(a===me||a===Ee||a===Be||a===we){if(o=e.get("WEBGL_compressed_texture_pvrtc"),null===o)return null;if(a===me)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(a===Ee)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(a===Be)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(a===we)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(a===Ie)return o=e.get("WEBGL_compressed_texture_etc1"),null!==o?o.COMPRESSED_RGB_ETC1_WEBGL:null;if((a===xe||a===Ce)&&(o=e.get("WEBGL_compressed_texture_etc"),null!==o)){if(a===xe)return o.COMPRESSED_RGB8_ETC2;if(a===Ce)return o.COMPRESSED_RGBA8_ETC2_EAC}return a===N||a===j||a===ge||a===V||a===Q||a===z||a===B||a===Te||a===Fe||a===te||a===He||a===rt||a===I||a===oe||a===Et||a===Ht||a===Kn||a===hi||a===Zt||a===tt||a===pn||a===Os||a===Ir||a===Hr||a===Hs||a===Ts||a===Zi||a===zr?(o=e.get("WEBGL_compressed_texture_astc"),null!==o?a:null):a===Ze?(o=e.get("EXT_texture_compression_bptc"),null!==o?a:null):a===Jr?n?r.UNSIGNED_INT_24_8:(o=e.get("WEBGL_depth_texture"),null!==o?o.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}class Ql extends ar{constructor(e=[]){super(),this.cameras=e}}Ql.prototype.isArrayCamera=!0;class va extends li{constructor(){super(),this.type="Group"}}va.prototype.isGroup=!0;const T0={type:"move"};class eu{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new va,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new va,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new O,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new O),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new va,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new O,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new O),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let i=null,a=null,o=null;const c=this._targetRay,l=this._grip,h=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState)if(null!==c&&(i=t.getPose(e.targetRaySpace,n),null!==i&&(c.matrix.fromArray(i.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),i.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(i.linearVelocity)):c.hasLinearVelocity=!1,i.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(i.angularVelocity)):c.hasAngularVelocity=!1,this.dispatchEvent(T0))),h&&e.hand){o=!0;for(const T of e.hand.values()){const L=t.getJointPose(T,n);if(void 0===h.joints[T.jointName]){const _=new va;_.matrixAutoUpdate=!1,_.visible=!1,h.joints[T.jointName]=_,h.add(_)}const E=h.joints[T.jointName];null!==L&&(E.matrix.fromArray(L.transform.matrix),E.matrix.decompose(E.position,E.rotation,E.scale),E.jointRadius=L.radius),E.visible=null!==L}const g=h.joints["index-finger-tip"].position.distanceTo(h.joints["thumb-tip"].position),v=.02,x=.005;h.inputState.pinching&&g>v+x?(h.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!h.inputState.pinching&&g<=v-x&&(h.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==l&&e.gripSpace&&(a=t.getPose(e.gripSpace,n),null!==a&&(l.matrix.fromArray(a.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),a.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(a.linearVelocity)):l.hasLinearVelocity=!1,a.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(a.angularVelocity)):l.hasAngularVelocity=!1));return null!==c&&(c.visible=null!==i),null!==l&&(l.visible=null!==a),null!==h&&(h.visible=null!==o),this}}class Hc extends zi{constructor(e,t,n,i,a,o,c,l,h,p){if((p=void 0!==p?p:Pi)!==Pi&&p!==Fi)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&p===Pi&&(n=cr),void 0===n&&p===Fi&&(n=Jr),super(null,i,a,o,c,l,p,n,h),this.image={width:e,height:t},this.magFilter=void 0!==c?c:Dn,this.minFilter=void 0!==l?l:Dn,this.flipY=!1,this.generateMipmaps=!1}}Hc.prototype.isDepthTexture=!0;class w0 extends Xr{constructor(e,t){super();const n=this;let i=null,a=1,o=null,c="local-floor";const l=e.extensions.has("WEBGL_multisampled_render_to_texture");let h=null,p=null,m=null,g=null,v=!1,x=null;const T=t.getContextAttributes();let L=null,E=null;const _=[],D=new Map,R=new ar;R.layers.enable(1),R.viewport=new rn;const G=new ar;G.layers.enable(2),G.viewport=new rn;const $=[R,G],fe=new Ql;fe.layers.enable(1),fe.layers.enable(2);let Me=null,Je=null;function ke(ot){const ht=D.get(ot.inputSource);ht&&ht.dispatchEvent({type:ot.type,data:ot.inputSource})}function be(){D.forEach(function(ot,ht){ot.disconnect(ht)}),D.clear(),Me=null,Je=null,e.setRenderTarget(L),g=null,m=null,p=null,i=null,E=null,Jt.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function X(ot){const ht=i.inputSources;for(let $t=0;$t<_.length;$t++)D.set(ht[$t],_[$t]);for(let $t=0;$t<ot.removed.length;$t++){const qt=ot.removed[$t],ln=D.get(qt);ln&&(ln.dispatchEvent({type:"disconnected",data:qt}),D.delete(qt))}for(let $t=0;$t<ot.added.length;$t++){const qt=ot.added[$t],ln=D.get(qt);ln&&ln.dispatchEvent({type:"connected",data:qt})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(ot){let ht=_[ot];return void 0===ht&&(ht=new eu,_[ot]=ht),ht.getTargetRaySpace()},this.getControllerGrip=function(ot){let ht=_[ot];return void 0===ht&&(ht=new eu,_[ot]=ht),ht.getGripSpace()},this.getHand=function(ot){let ht=_[ot];return void 0===ht&&(ht=new eu,_[ot]=ht),ht.getHandSpace()},this.setFramebufferScaleFactor=function(ot){a=ot,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(ot){c=ot,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return o},this.getBaseLayer=function(){return null!==m?m:g},this.getBinding=function(){return p},this.getFrame=function(){return x},this.getSession=function(){return i},this.setSession=async function(ot){if(i=ot,null!==i){if(L=e.getRenderTarget(),i.addEventListener("select",ke),i.addEventListener("selectstart",ke),i.addEventListener("selectend",ke),i.addEventListener("squeeze",ke),i.addEventListener("squeezestart",ke),i.addEventListener("squeezeend",ke),i.addEventListener("end",be),i.addEventListener("inputsourceschange",X),!0!==T.xrCompatible&&await t.makeXRCompatible(),void 0===i.renderState.layers||!1===e.capabilities.isWebGL2)g=new XRWebGLLayer(i,t,{antialias:void 0!==i.renderState.layers||T.antialias,alpha:T.alpha,depth:T.depth,stencil:T.stencil,framebufferScaleFactor:a}),i.updateRenderState({baseLayer:g}),E=new Li(g.framebufferWidth,g.framebufferHeight,{format:pi,type:Qe,encoding:e.outputEncoding});else{v=T.antialias;let ht=null,$t=null,qt=null;T.depth&&(qt=T.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,ht=T.stencil?Fi:Pi,$t=T.stencil?Jr:cr);const ln={colorFormat:T.alpha||v?t.RGBA8:t.RGB8,depthFormat:qt,scaleFactor:a};p=new XRWebGLBinding(i,t),m=p.createProjectionLayer(ln),i.updateRenderState({layers:[m]}),E=v?new mr(m.textureWidth,m.textureHeight,{format:pi,type:Qe,depthTexture:new Hc(m.textureWidth,m.textureHeight,$t,void 0,void 0,void 0,void 0,void 0,void 0,ht),stencilBuffer:T.stencil,ignoreDepth:m.ignoreDepthValues,useRenderToTexture:l,encoding:e.outputEncoding}):new Li(m.textureWidth,m.textureHeight,{format:T.alpha?pi:br,type:Qe,depthTexture:new Hc(m.textureWidth,m.textureHeight,$t,void 0,void 0,void 0,void 0,void 0,void 0,ht),stencilBuffer:T.stencil,ignoreDepth:m.ignoreDepthValues,encoding:e.outputEncoding})}this.setFoveation(1),o=await i.requestReferenceSpace(c),Jt.setContext(i),Jt.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}};const Z=new O,ze=new O;function Le(ot,ht){null===ht?ot.matrixWorld.copy(ot.matrix):ot.matrixWorld.multiplyMatrices(ht.matrixWorld,ot.matrix),ot.matrixWorldInverse.copy(ot.matrixWorld).invert()}this.updateCamera=function(ot){if(null===i)return;fe.near=G.near=R.near=ot.near,fe.far=G.far=R.far=ot.far,(Me!==fe.near||Je!==fe.far)&&(i.updateRenderState({depthNear:fe.near,depthFar:fe.far}),Me=fe.near,Je=fe.far);const ht=ot.parent,$t=fe.cameras;Le(fe,ht);for(let ln=0;ln<$t.length;ln++)Le($t[ln],ht);fe.matrixWorld.decompose(fe.position,fe.quaternion,fe.scale),ot.position.copy(fe.position),ot.quaternion.copy(fe.quaternion),ot.scale.copy(fe.scale),ot.matrix.copy(fe.matrix),ot.matrixWorld.copy(fe.matrixWorld);const qt=ot.children;for(let ln=0,fi=qt.length;ln<fi;ln++)qt[ln].updateMatrixWorld(!0);2===$t.length?function Xe(ot,ht,$t){Z.setFromMatrixPosition(ht.matrixWorld),ze.setFromMatrixPosition($t.matrixWorld);const qt=Z.distanceTo(ze),ln=ht.projectionMatrix.elements,fi=$t.projectionMatrix.elements,Ae=ln[14]/(ln[10]-1),Qn=ln[14]/(ln[10]+1),Mn=(ln[9]+1)/ln[5],vn=(ln[9]-1)/ln[5],En=(ln[8]-1)/ln[0],Ei=(fi[8]+1)/fi[0],it=Ae*En,wt=Ae*Ei,Ft=qt/(-En+Ei),an=Ft*-En;ht.matrixWorld.decompose(ot.position,ot.quaternion,ot.scale),ot.translateX(an),ot.translateZ(Ft),ot.matrixWorld.compose(ot.position,ot.quaternion,ot.scale),ot.matrixWorldInverse.copy(ot.matrixWorld).invert();const Xt=Ae+Ft,Vn=Qn+Ft;ot.projectionMatrix.makePerspective(it-an,wt+(qt-an),Mn*Qn/Vn*Xt,vn*Qn/Vn*Xt,Xt,Vn)}(fe,R,G):fe.projectionMatrix.copy(R.projectionMatrix)},this.getCamera=function(){return fe},this.getFoveation=function(){return null!==m?m.fixedFoveation:null!==g?g.fixedFoveation:void 0},this.setFoveation=function(ot){null!==m&&(m.fixedFoveation=ot),null!==g&&void 0!==g.fixedFoveation&&(g.fixedFoveation=ot)};let je=null;const Jt=new ph;Jt.setAnimationLoop(function Gt(ot,ht){if(h=ht.getViewerPose(o),x=ht,null!==h){const qt=h.views;null!==g&&(e.setRenderTargetFramebuffer(E,g.framebuffer),e.setRenderTarget(E));let ln=!1;qt.length!==fe.cameras.length&&(fe.cameras.length=0,ln=!0);for(let fi=0;fi<qt.length;fi++){const Ae=qt[fi];let Qn=null;if(null!==g)Qn=g.getViewport(Ae);else{const vn=p.getViewSubImage(m,Ae);Qn=vn.viewport,0===fi&&(e.setRenderTargetTextures(E,vn.colorTexture,m.ignoreDepthValues?void 0:vn.depthStencilTexture),e.setRenderTarget(E))}const Mn=$[fi];Mn.matrix.fromArray(Ae.transform.matrix),Mn.projectionMatrix.fromArray(Ae.projectionMatrix),Mn.viewport.set(Qn.x,Qn.y,Qn.width,Qn.height),0===fi&&fe.matrix.copy(Mn.matrix),!0===ln&&fe.cameras.push(Mn)}}const $t=i.inputSources;for(let qt=0;qt<_.length;qt++)_[qt].update($t[qt],ht,o);je&&je(ot,ht),x=null}),this.setAnimationLoop=function(ot){je=ot},this.dispose=function(){}}}function S0(r){function n(E,_){E.opacity.value=_.opacity,_.color&&E.diffuse.value.copy(_.color),_.emissive&&E.emissive.value.copy(_.emissive).multiplyScalar(_.emissiveIntensity),_.map&&(E.map.value=_.map),_.alphaMap&&(E.alphaMap.value=_.alphaMap),_.specularMap&&(E.specularMap.value=_.specularMap),_.alphaTest>0&&(E.alphaTest.value=_.alphaTest);const D=r.get(_).envMap;let R,G;D&&(E.envMap.value=D,E.flipEnvMap.value=D.isCubeTexture&&!1===D.isRenderTargetTexture?-1:1,E.reflectivity.value=_.reflectivity,E.ior.value=_.ior,E.refractionRatio.value=_.refractionRatio),_.lightMap&&(E.lightMap.value=_.lightMap,E.lightMapIntensity.value=_.lightMapIntensity),_.aoMap&&(E.aoMap.value=_.aoMap,E.aoMapIntensity.value=_.aoMapIntensity),_.map?R=_.map:_.specularMap?R=_.specularMap:_.displacementMap?R=_.displacementMap:_.normalMap?R=_.normalMap:_.bumpMap?R=_.bumpMap:_.roughnessMap?R=_.roughnessMap:_.metalnessMap?R=_.metalnessMap:_.alphaMap?R=_.alphaMap:_.emissiveMap?R=_.emissiveMap:_.clearcoatMap?R=_.clearcoatMap:_.clearcoatNormalMap?R=_.clearcoatNormalMap:_.clearcoatRoughnessMap?R=_.clearcoatRoughnessMap:_.specularIntensityMap?R=_.specularIntensityMap:_.specularColorMap?R=_.specularColorMap:_.transmissionMap?R=_.transmissionMap:_.thicknessMap?R=_.thicknessMap:_.sheenColorMap?R=_.sheenColorMap:_.sheenRoughnessMap&&(R=_.sheenRoughnessMap),void 0!==R&&(R.isWebGLRenderTarget&&(R=R.texture),!0===R.matrixAutoUpdate&&R.updateMatrix(),E.uvTransform.value.copy(R.matrix)),_.aoMap?G=_.aoMap:_.lightMap&&(G=_.lightMap),void 0!==G&&(G.isWebGLRenderTarget&&(G=G.texture),!0===G.matrixAutoUpdate&&G.updateMatrix(),E.uv2Transform.value.copy(G.matrix))}function m(E,_){E.roughness.value=_.roughness,E.metalness.value=_.metalness,_.roughnessMap&&(E.roughnessMap.value=_.roughnessMap),_.metalnessMap&&(E.metalnessMap.value=_.metalnessMap),_.emissiveMap&&(E.emissiveMap.value=_.emissiveMap),_.bumpMap&&(E.bumpMap.value=_.bumpMap,E.bumpScale.value=_.bumpScale,_.side===Qt&&(E.bumpScale.value*=-1)),_.normalMap&&(E.normalMap.value=_.normalMap,E.normalScale.value.copy(_.normalScale),_.side===Qt&&E.normalScale.value.negate()),_.displacementMap&&(E.displacementMap.value=_.displacementMap,E.displacementScale.value=_.displacementScale,E.displacementBias.value=_.displacementBias),r.get(_).envMap&&(E.envMapIntensity.value=_.envMapIntensity)}return{refreshFogUniforms:function e(E,_){E.fogColor.value.copy(_.color),_.isFog?(E.fogNear.value=_.near,E.fogFar.value=_.far):_.isFogExp2&&(E.fogDensity.value=_.density)},refreshMaterialUniforms:function t(E,_,D,R,G){_.isMeshBasicMaterial?n(E,_):_.isMeshLambertMaterial?(n(E,_),function l(E,_){_.emissiveMap&&(E.emissiveMap.value=_.emissiveMap)}(E,_)):_.isMeshToonMaterial?(n(E,_),function p(E,_){_.gradientMap&&(E.gradientMap.value=_.gradientMap),_.emissiveMap&&(E.emissiveMap.value=_.emissiveMap),_.bumpMap&&(E.bumpMap.value=_.bumpMap,E.bumpScale.value=_.bumpScale,_.side===Qt&&(E.bumpScale.value*=-1)),_.normalMap&&(E.normalMap.value=_.normalMap,E.normalScale.value.copy(_.normalScale),_.side===Qt&&E.normalScale.value.negate()),_.displacementMap&&(E.displacementMap.value=_.displacementMap,E.displacementScale.value=_.displacementScale,E.displacementBias.value=_.displacementBias)}(E,_)):_.isMeshPhongMaterial?(n(E,_),function h(E,_){E.specular.value.copy(_.specular),E.shininess.value=Math.max(_.shininess,1e-4),_.emissiveMap&&(E.emissiveMap.value=_.emissiveMap),_.bumpMap&&(E.bumpMap.value=_.bumpMap,E.bumpScale.value=_.bumpScale,_.side===Qt&&(E.bumpScale.value*=-1)),_.normalMap&&(E.normalMap.value=_.normalMap,E.normalScale.value.copy(_.normalScale),_.side===Qt&&E.normalScale.value.negate()),_.displacementMap&&(E.displacementMap.value=_.displacementMap,E.displacementScale.value=_.displacementScale,E.displacementBias.value=_.displacementBias)}(E,_)):_.isMeshStandardMaterial?(n(E,_),_.isMeshPhysicalMaterial?function g(E,_,D){m(E,_),E.ior.value=_.ior,_.sheen>0&&(E.sheenColor.value.copy(_.sheenColor).multiplyScalar(_.sheen),E.sheenRoughness.value=_.sheenRoughness,_.sheenColorMap&&(E.sheenColorMap.value=_.sheenColorMap),_.sheenRoughnessMap&&(E.sheenRoughnessMap.value=_.sheenRoughnessMap)),_.clearcoat>0&&(E.clearcoat.value=_.clearcoat,E.clearcoatRoughness.value=_.clearcoatRoughness,_.clearcoatMap&&(E.clearcoatMap.value=_.clearcoatMap),_.clearcoatRoughnessMap&&(E.clearcoatRoughnessMap.value=_.clearcoatRoughnessMap),_.clearcoatNormalMap&&(E.clearcoatNormalScale.value.copy(_.clearcoatNormalScale),E.clearcoatNormalMap.value=_.clearcoatNormalMap,_.side===Qt&&E.clearcoatNormalScale.value.negate())),_.transmission>0&&(E.transmission.value=_.transmission,E.transmissionSamplerMap.value=D.texture,E.transmissionSamplerSize.value.set(D.width,D.height),_.transmissionMap&&(E.transmissionMap.value=_.transmissionMap),E.thickness.value=_.thickness,_.thicknessMap&&(E.thicknessMap.value=_.thicknessMap),E.attenuationDistance.value=_.attenuationDistance,E.attenuationColor.value.copy(_.attenuationColor)),E.specularIntensity.value=_.specularIntensity,E.specularColor.value.copy(_.specularColor),_.specularIntensityMap&&(E.specularIntensityMap.value=_.specularIntensityMap),_.specularColorMap&&(E.specularColorMap.value=_.specularColorMap)}(E,_,G):m(E,_)):_.isMeshMatcapMaterial?(n(E,_),function v(E,_){_.matcap&&(E.matcap.value=_.matcap),_.bumpMap&&(E.bumpMap.value=_.bumpMap,E.bumpScale.value=_.bumpScale,_.side===Qt&&(E.bumpScale.value*=-1)),_.normalMap&&(E.normalMap.value=_.normalMap,E.normalScale.value.copy(_.normalScale),_.side===Qt&&E.normalScale.value.negate()),_.displacementMap&&(E.displacementMap.value=_.displacementMap,E.displacementScale.value=_.displacementScale,E.displacementBias.value=_.displacementBias)}(E,_)):_.isMeshDepthMaterial?(n(E,_),function x(E,_){_.displacementMap&&(E.displacementMap.value=_.displacementMap,E.displacementScale.value=_.displacementScale,E.displacementBias.value=_.displacementBias)}(E,_)):_.isMeshDistanceMaterial?(n(E,_),function T(E,_){_.displacementMap&&(E.displacementMap.value=_.displacementMap,E.displacementScale.value=_.displacementScale,E.displacementBias.value=_.displacementBias),E.referencePosition.value.copy(_.referencePosition),E.nearDistance.value=_.nearDistance,E.farDistance.value=_.farDistance}(E,_)):_.isMeshNormalMaterial?(n(E,_),function L(E,_){_.bumpMap&&(E.bumpMap.value=_.bumpMap,E.bumpScale.value=_.bumpScale,_.side===Qt&&(E.bumpScale.value*=-1)),_.normalMap&&(E.normalMap.value=_.normalMap,E.normalScale.value.copy(_.normalScale),_.side===Qt&&E.normalScale.value.negate()),_.displacementMap&&(E.displacementMap.value=_.displacementMap,E.displacementScale.value=_.displacementScale,E.displacementBias.value=_.displacementBias)}(E,_)):_.isLineBasicMaterial?(function i(E,_){E.diffuse.value.copy(_.color),E.opacity.value=_.opacity}(E,_),_.isLineDashedMaterial&&function a(E,_){E.dashSize.value=_.dashSize,E.totalSize.value=_.dashSize+_.gapSize,E.scale.value=_.scale}(E,_)):_.isPointsMaterial?function o(E,_,D,R){let G;E.diffuse.value.copy(_.color),E.opacity.value=_.opacity,E.size.value=_.size*D,E.scale.value=.5*R,_.map&&(E.map.value=_.map),_.alphaMap&&(E.alphaMap.value=_.alphaMap),_.alphaTest>0&&(E.alphaTest.value=_.alphaTest),_.map?G=_.map:_.alphaMap&&(G=_.alphaMap),void 0!==G&&(!0===G.matrixAutoUpdate&&G.updateMatrix(),E.uvTransform.value.copy(G.matrix))}(E,_,D,R):_.isSpriteMaterial?function c(E,_){let D;E.diffuse.value.copy(_.color),E.opacity.value=_.opacity,E.rotation.value=_.rotation,_.map&&(E.map.value=_.map),_.alphaMap&&(E.alphaMap.value=_.alphaMap),_.alphaTest>0&&(E.alphaTest.value=_.alphaTest),_.map?D=_.map:_.alphaMap&&(D=_.alphaMap),void 0!==D&&(!0===D.matrixAutoUpdate&&D.updateMatrix(),E.uvTransform.value.copy(D.matrix))}(E,_):_.isShadowMaterial?(E.color.value.copy(_.color),E.opacity.value=_.opacity):_.isShaderMaterial&&(_.uniformsNeedUpdate=!1)}}}function Ri(r={}){const e=void 0!==r.canvas?r.canvas:function R0(){const r=Oa("canvas");return r.style.display="block",r}(),t=void 0!==r.context?r.context:null,n=void 0!==r.alpha&&r.alpha,i=void 0===r.depth||r.depth,a=void 0===r.stencil||r.stencil,o=void 0!==r.antialias&&r.antialias,c=void 0===r.premultipliedAlpha||r.premultipliedAlpha,l=void 0!==r.preserveDrawingBuffer&&r.preserveDrawingBuffer,h=void 0!==r.powerPreference?r.powerPreference:"default",p=void 0!==r.failIfMajorPerformanceCaveat&&r.failIfMajorPerformanceCaveat;let m=null,g=null;const v=[],x=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Tt,this.physicallyCorrectLights=!1,this.toneMapping=P,this.toneMappingExposure=1;const T=this;let L=!1,E=0,_=0,D=null,R=-1,G=null;const $=new rn,fe=new rn;let Me=null,Je=e.width,ke=e.height,be=1,X=null,Z=null;const ze=new rn(0,0,Je,ke),Xe=new rn(0,0,Je,ke);let Le=!1;const je=[],Gt=new No;let Jt=!1,ot=!1,ht=null;const $t=new fn,qt=new O,ln={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function fi(){return null===D?be:1}let Mn,vn,En,Ei,it,wt,Ft,an,Xt,Vn,Wn,ai,Hi,ne,Y,vt,Mt,Vt,bt,Bn,Sn,Ot,pe,Ae=t;function Qn(q,Pe){for(let Ye=0;Ye<q.length;Ye++){const ft=e.getContext(q[Ye],Pe);if(null!==ft)return ft}return null}try{const q={alpha:n,depth:i,stencil:a,antialias:o,premultipliedAlpha:c,preserveDrawingBuffer:l,powerPreference:h,failIfMajorPerformanceCaveat:p};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${Rt}`),e.addEventListener("webglcontextlost",Xn,!1),e.addEventListener("webglcontextrestored",mn,!1),null===Ae){const Pe=["webgl2","webgl","experimental-webgl"];if(!0===T.isWebGL1Renderer&&Pe.shift(),Ae=Qn(Pe,q),null===Ae)throw Qn(Pe)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===Ae.getShaderPrecisionFormat&&(Ae.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(q){throw console.error("THREE.WebGLRenderer: "+q.message),q}function Nt(){Mn=new Ym(Ae),vn=new Gm(Ae,Mn,r),Mn.init(vn),Ot=new Kh(Ae,Mn,vn),En=new b0(Ae,Mn,vn),je[0]=Ae.BACK,Ei=new Jm(Ae),it=new h0,wt=new M0(Ae,Mn,En,it,vn,Ot,Ei),Ft=new Wm(T),an=new qm(T),Xt=new Wd(Ae,vn),pe=new Hm(Ae,Mn,Xt,vn),Vn=new Km(Ae,Xt,Ei,pe),Wn=new tg(Ae,Vn,Xt,Ei),bt=new eg(Ae,vn,wt),vt=new Vm(it),ai=new u0(T,Ft,an,Mn,vn,pe,vt),Hi=new S0(it),ne=new d0,Y=new _0(Mn,vn),Vt=new Om(T,Ft,En,Wn,c),Mt=new Yh(T,Wn,vn),Bn=new km(Ae,Mn,Ei,vn),Sn=new Zm(Ae,Mn,Ei,vn),Ei.programs=ai.programs,T.capabilities=vn,T.extensions=Mn,T.properties=it,T.renderLists=ne,T.shadowMap=Mt,T.state=En,T.info=Ei}Nt();const Lt=new w0(T,Ae);function Xn(q){q.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),L=!0}function mn(){console.log("THREE.WebGLRenderer: Context Restored."),L=!1;const q=Ei.autoReset,Pe=Mt.enabled,Ye=Mt.autoUpdate,Ve=Mt.needsUpdate,ft=Mt.type;Nt(),Ei.autoReset=q,Mt.enabled=Pe,Mt.autoUpdate=Ye,Mt.needsUpdate=Ve,Mt.type=ft}function ri(q){const Pe=q.target;Pe.removeEventListener("dispose",ri),function jt(q){(function ei(q){const Pe=it.get(q).programs;void 0!==Pe&&(Pe.forEach(function(Ye){ai.releaseProgram(Ye)}),q.isShaderMaterial&&ai.releaseShaderCache(q))})(q),it.remove(q)}(Pe)}this.xr=Lt,this.getContext=function(){return Ae},this.getContextAttributes=function(){return Ae.getContextAttributes()},this.forceContextLoss=function(){const q=Mn.get("WEBGL_lose_context");q&&q.loseContext()},this.forceContextRestore=function(){const q=Mn.get("WEBGL_lose_context");q&&q.restoreContext()},this.getPixelRatio=function(){return be},this.setPixelRatio=function(q){void 0!==q&&(be=q,this.setSize(Je,ke,!1))},this.getSize=function(q){return q.set(Je,ke)},this.setSize=function(q,Pe,Ye){Lt.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(Je=q,ke=Pe,e.width=Math.floor(q*be),e.height=Math.floor(Pe*be),!1!==Ye&&(e.style.width=q+"px",e.style.height=Pe+"px"),this.setViewport(0,0,q,Pe))},this.getDrawingBufferSize=function(q){return q.set(Je*be,ke*be).floor()},this.setDrawingBufferSize=function(q,Pe,Ye){Je=q,ke=Pe,be=Ye,e.width=Math.floor(q*Ye),e.height=Math.floor(Pe*Ye),this.setViewport(0,0,q,Pe)},this.getCurrentViewport=function(q){return q.copy($)},this.getViewport=function(q){return q.copy(ze)},this.setViewport=function(q,Pe,Ye,Ve){q.isVector4?ze.set(q.x,q.y,q.z,q.w):ze.set(q,Pe,Ye,Ve),En.viewport($.copy(ze).multiplyScalar(be).floor())},this.getScissor=function(q){return q.copy(Xe)},this.setScissor=function(q,Pe,Ye,Ve){q.isVector4?Xe.set(q.x,q.y,q.z,q.w):Xe.set(q,Pe,Ye,Ve),En.scissor(fe.copy(Xe).multiplyScalar(be).floor())},this.getScissorTest=function(){return Le},this.setScissorTest=function(q){En.setScissorTest(Le=q)},this.setOpaqueSort=function(q){X=q},this.setTransparentSort=function(q){Z=q},this.getClearColor=function(q){return q.copy(Vt.getClearColor())},this.setClearColor=function(){Vt.setClearColor.apply(Vt,arguments)},this.getClearAlpha=function(){return Vt.getClearAlpha()},this.setClearAlpha=function(){Vt.setClearAlpha.apply(Vt,arguments)},this.clear=function(q,Pe,Ye){let Ve=0;(void 0===q||q)&&(Ve|=Ae.COLOR_BUFFER_BIT),(void 0===Pe||Pe)&&(Ve|=Ae.DEPTH_BUFFER_BIT),(void 0===Ye||Ye)&&(Ve|=Ae.STENCIL_BUFFER_BIT),Ae.clear(Ve)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",Xn,!1),e.removeEventListener("webglcontextrestored",mn,!1),ne.dispose(),Y.dispose(),it.dispose(),Ft.dispose(),an.dispose(),Wn.dispose(),pe.dispose(),ai.dispose(),Lt.dispose(),Lt.removeEventListener("sessionstart",_s),Lt.removeEventListener("sessionend",xs),ht&&(ht.dispose(),ht=null),Fa.stop()},this.renderBufferDirect=function(q,Pe,Ye,Ve,ft,On){null===Pe&&(Pe=ln);const jn=ft.isMesh&&ft.matrixWorld.determinant()<0,oi=function zy(q,Pe,Ye,Ve,ft){!0!==Pe.isScene&&(Pe=ln),wt.resetTextureUnits();const On=Pe.fog,oi=null===D?T.outputEncoding:D.texture.encoding,Hn=(Ve.isMeshStandardMaterial?an:Ft).get(Ve.envMap||(Ve.isMeshStandardMaterial?Pe.environment:null)),bi=!0===Ve.vertexColors&&!!Ye.attributes.color&&4===Ye.attributes.color.itemSize,ci=!!Ve.normalMap&&!!Ye.attributes.tangent,gi=!!Ye.morphAttributes.position,Wi=!!Ye.morphAttributes.normal,Da=Ye.morphAttributes.position?Ye.morphAttributes.position.length:0,Mo=Ve.toneMapped?T.toneMapping:P,wi=it.get(Ve),Es=g.state.lights;!0!==Jt||!0!==ot&&q===G||vt.setState(Ve,q,q===G&&Ve.id===R);let tr=!1;Ve.version===wi.__version?(wi.needsLights&&wi.lightsStateVersion!==Es.state.version||wi.outputEncoding!==oi||ft.isInstancedMesh&&!1===wi.instancing||!ft.isInstancedMesh&&!0===wi.instancing||ft.isSkinnedMesh&&!1===wi.skinning||!ft.isSkinnedMesh&&!0===wi.skinning||wi.envMap!==Hn||Ve.fog&&wi.fog!==On||void 0!==wi.numClippingPlanes&&(wi.numClippingPlanes!==vt.numPlanes||wi.numIntersection!==vt.numIntersection)||wi.vertexAlphas!==bi||wi.vertexTangents!==ci||wi.morphTargets!==gi||wi.morphNormals!==Wi||wi.toneMapping!==Mo||!0===vn.isWebGL2&&wi.morphTargetsCount!==Da)&&(tr=!0):(tr=!0,wi.__version=Ve.version);let bs=wi.currentProgram;!0===tr&&(bs=Yu(Ve,Pe,ft));let Ml=!1,Ms=!1,Us=!1;const _r=bs.getUniforms(),oc=wi.uniforms;if(En.useProgram(bs.program)&&(Ml=!0,Ms=!0,Us=!0),Ve.id!==R&&(R=Ve.id,Ms=!0),Ml||G!==q){if(_r.setValue(Ae,"projectionMatrix",q.projectionMatrix),vn.logarithmicDepthBuffer&&_r.setValue(Ae,"logDepthBufFC",2/(Math.log(q.far+1)/Math.LN2)),G!==q&&(G=q,Ms=!0,Us=!0),Ve.isShaderMaterial||Ve.isMeshPhongMaterial||Ve.isMeshToonMaterial||Ve.isMeshStandardMaterial||Ve.envMap){const as=_r.map.cameraPosition;void 0!==as&&as.setValue(Ae,qt.setFromMatrixPosition(q.matrixWorld))}(Ve.isMeshPhongMaterial||Ve.isMeshToonMaterial||Ve.isMeshLambertMaterial||Ve.isMeshBasicMaterial||Ve.isMeshStandardMaterial||Ve.isShaderMaterial)&&_r.setValue(Ae,"isOrthographic",!0===q.isOrthographicCamera),(Ve.isMeshPhongMaterial||Ve.isMeshToonMaterial||Ve.isMeshLambertMaterial||Ve.isMeshBasicMaterial||Ve.isMeshStandardMaterial||Ve.isShaderMaterial||Ve.isShadowMaterial||ft.isSkinnedMesh)&&_r.setValue(Ae,"viewMatrix",q.matrixWorldInverse)}if(ft.isSkinnedMesh){_r.setOptional(Ae,ft,"bindMatrix"),_r.setOptional(Ae,ft,"bindMatrixInverse");const as=ft.skeleton;as&&(vn.floatVertexTextures?(null===as.boneTexture&&as.computeBoneTexture(),_r.setValue(Ae,"boneTexture",as.boneTexture,wt),_r.setValue(Ae,"boneTextureSize",as.boneTextureSize)):_r.setOptional(Ae,as,"boneMatrices"))}return Ye&&(void 0!==Ye.morphAttributes.position||void 0!==Ye.morphAttributes.normal)&&bt.update(ft,Ye,Ve,bs),(Ms||wi.receiveShadow!==ft.receiveShadow)&&(wi.receiveShadow=ft.receiveShadow,_r.setValue(Ae,"receiveShadow",ft.receiveShadow)),Ms&&(_r.setValue(Ae,"toneMappingExposure",T.toneMappingExposure),wi.needsLights&&function Ly(q,Pe){q.ambientLightColor.needsUpdate=Pe,q.lightProbe.needsUpdate=Pe,q.directionalLights.needsUpdate=Pe,q.directionalLightShadows.needsUpdate=Pe,q.pointLights.needsUpdate=Pe,q.pointLightShadows.needsUpdate=Pe,q.spotLights.needsUpdate=Pe,q.spotLightShadows.needsUpdate=Pe,q.rectAreaLights.needsUpdate=Pe,q.hemisphereLights.needsUpdate=Pe}(oc,Us),On&&Ve.fog&&Hi.refreshFogUniforms(oc,On),Hi.refreshMaterialUniforms(oc,Ve,be,ke,ht),ia.upload(Ae,wi.uniformsList,oc,wt)),Ve.isShaderMaterial&&!0===Ve.uniformsNeedUpdate&&(ia.upload(Ae,wi.uniformsList,oc,wt),Ve.uniformsNeedUpdate=!1),Ve.isSpriteMaterial&&_r.setValue(Ae,"center",ft.center),_r.setValue(Ae,"modelViewMatrix",ft.modelViewMatrix),_r.setValue(Ae,"normalMatrix",ft.normalMatrix),_r.setValue(Ae,"modelMatrix",ft.matrixWorld),bs}(q,Pe,Ye,Ve,ft);En.setMaterial(Ve,jn);let Hn=Ye.index;const bi=Ye.attributes.position;if(null===Hn){if(void 0===bi||0===bi.count)return}else if(0===Hn.count)return;let ci=1;!0===Ve.wireframe&&(Hn=Vn.getWireframeAttribute(Ye),ci=2),pe.setup(ft,Ve,oi,Ye,Hn);let gi,Wi=Bn;null!==Hn&&(gi=Xt.get(Hn),Wi=Sn,Wi.setIndex(gi));const Da=null!==Hn?Hn.count:bi.count,Mo=Ye.drawRange.start*ci,wi=Ye.drawRange.count*ci,Es=null!==On?On.start*ci:0,tr=null!==On?On.count*ci:1/0,bs=Math.max(Mo,Es),Ml=Math.min(Da,Mo+wi,Es+tr)-1,Ms=Math.max(0,Ml-bs+1);if(0!==Ms){if(ft.isMesh)!0===Ve.wireframe?(En.setLineWidth(Ve.wireframeLinewidth*fi()),Wi.setMode(Ae.LINES)):Wi.setMode(Ae.TRIANGLES);else if(ft.isLine){let Us=Ve.linewidth;void 0===Us&&(Us=1),En.setLineWidth(Us*fi()),Wi.setMode(ft.isLineSegments?Ae.LINES:ft.isLineLoop?Ae.LINE_LOOP:Ae.LINE_STRIP)}else ft.isPoints?Wi.setMode(Ae.POINTS):ft.isSprite&&Wi.setMode(Ae.TRIANGLES);if(ft.isInstancedMesh)Wi.renderInstances(bs,Ms,ft.count);else if(Ye.isInstancedBufferGeometry){const Us=Math.min(Ye.instanceCount,Ye._maxInstanceCount);Wi.renderInstances(bs,Ms,Us)}else Wi.render(bs,Ms)}},this.compile=function(q,Pe){g=Y.get(q),g.init(),x.push(g),q.traverseVisible(function(Ye){Ye.isLight&&Ye.layers.test(Pe.layers)&&(g.pushLight(Ye),Ye.castShadow&&g.pushShadow(Ye))}),g.setupLights(T.physicallyCorrectLights),q.traverse(function(Ye){const Ve=Ye.material;if(Ve)if(Array.isArray(Ve))for(let ft=0;ft<Ve.length;ft++)Yu(Ve[ft],q,Ye);else Yu(Ve,q,Ye)}),x.pop(),g=null};let Bi=null;function _s(){Fa.stop()}function xs(){Fa.start()}const Fa=new ph;function Rd(q,Pe,Ye,Ve){if(!1===q.visible)return;if(q.layers.test(Pe.layers))if(q.isGroup)Ye=q.renderOrder;else if(q.isLOD)!0===q.autoUpdate&&q.update(Pe);else if(q.isLight)g.pushLight(q),q.castShadow&&g.pushShadow(q);else if(q.isSprite){if(!q.frustumCulled||Gt.intersectsSprite(q)){Ve&&qt.setFromMatrixPosition(q.matrixWorld).applyMatrix4($t);const jn=Wn.update(q),oi=q.material;oi.visible&&m.push(q,jn,oi,Ye,qt.z,null)}}else if((q.isMesh||q.isLine||q.isPoints)&&(q.isSkinnedMesh&&q.skeleton.frame!==Ei.render.frame&&(q.skeleton.update(),q.skeleton.frame=Ei.render.frame),!q.frustumCulled||Gt.intersectsObject(q))){Ve&&qt.setFromMatrixPosition(q.matrixWorld).applyMatrix4($t);const jn=Wn.update(q),oi=q.material;if(Array.isArray(oi)){const Hn=jn.groups;for(let bi=0,ci=Hn.length;bi<ci;bi++){const gi=Hn[bi],Wi=oi[gi.materialIndex];Wi&&Wi.visible&&m.push(q,jn,Wi,Ye,qt.z,gi)}}else oi.visible&&m.push(q,jn,oi,Ye,qt.z,null)}const On=q.children;for(let jn=0,oi=On.length;jn<oi;jn++)Rd(On[jn],Pe,Ye,Ve)}function Ad(q,Pe,Ye,Ve){const ft=q.opaque,On=q.transmissive,jn=q.transparent;g.setupLightsView(Ye),On.length>0&&function Ry(q,Pe,Ye){null===ht&&(ht=new(!0===o&&!0===vn.isWebGL2?mr:Li)(1024,1024,{generateMipmaps:!0,type:null!==Ot.convert(_i)?_i:Qe,minFilter:Dr,magFilter:Dn,wrapS:St,wrapT:St,useRenderToTexture:Mn.has("WEBGL_multisampled_render_to_texture")}));const Ve=T.getRenderTarget();T.setRenderTarget(ht),T.clear();const ft=T.toneMapping;T.toneMapping=P,bl(q,Pe,Ye),T.toneMapping=ft,wt.updateMultisampleRenderTarget(ht),wt.updateRenderTargetMipmap(ht),T.setRenderTarget(Ve)}(ft,Pe,Ye),Ve&&En.viewport($.copy(Ve)),ft.length>0&&bl(ft,Pe,Ye),On.length>0&&bl(On,Pe,Ye),jn.length>0&&bl(jn,Pe,Ye)}function bl(q,Pe,Ye){const Ve=!0===Pe.isScene?Pe.overrideMaterial:null;for(let ft=0,On=q.length;ft<On;ft++){const jn=q[ft],oi=jn.object,Hn=jn.geometry,bi=null===Ve?jn.material:Ve,ci=jn.group;oi.layers.test(Ye.layers)&&Ay(oi,Pe,Ye,Hn,bi,ci)}}function Ay(q,Pe,Ye,Ve,ft,On){q.onBeforeRender(T,Pe,Ye,Ve,ft,On),q.modelViewMatrix.multiplyMatrices(Ye.matrixWorldInverse,q.matrixWorld),q.normalMatrix.getNormalMatrix(q.modelViewMatrix),ft.onBeforeRender(T,Pe,Ye,Ve,q,On),!0===ft.transparent&&ft.side===ti?(ft.side=Qt,ft.needsUpdate=!0,T.renderBufferDirect(Ye,Pe,Ve,ft,q,On),ft.side=_n,ft.needsUpdate=!0,T.renderBufferDirect(Ye,Pe,Ve,ft,q,On),ft.side=ti):T.renderBufferDirect(Ye,Pe,Ve,ft,q,On),q.onAfterRender(T,Pe,Ye,Ve,ft,On)}function Yu(q,Pe,Ye){!0!==Pe.isScene&&(Pe=ln);const Ve=it.get(q),ft=g.state.lights,jn=ft.state.version,oi=ai.getParameters(q,ft.state,g.state.shadowsArray,Pe,Ye),Hn=ai.getProgramCacheKey(oi);let bi=Ve.programs;Ve.environment=q.isMeshStandardMaterial?Pe.environment:null,Ve.fog=Pe.fog,Ve.envMap=(q.isMeshStandardMaterial?an:Ft).get(q.envMap||Ve.environment),void 0===bi&&(q.addEventListener("dispose",ri),bi=new Map,Ve.programs=bi);let ci=bi.get(Hn);if(void 0!==ci){if(Ve.currentProgram===ci&&Ve.lightsStateVersion===jn)return zd(q,oi),ci}else oi.uniforms=ai.getUniforms(q),q.onBuild(Ye,oi,T),q.onBeforeCompile(oi,T),ci=ai.acquireProgram(oi,Hn),bi.set(Hn,ci),Ve.uniforms=oi.uniforms;const gi=Ve.uniforms;(!q.isShaderMaterial&&!q.isRawShaderMaterial||!0===q.clipping)&&(gi.clippingPlanes=vt.uniform),zd(q,oi),Ve.needsLights=function Cy(q){return q.isMeshLambertMaterial||q.isMeshToonMaterial||q.isMeshPhongMaterial||q.isMeshStandardMaterial||q.isShadowMaterial||q.isShaderMaterial&&!0===q.lights}(q),Ve.lightsStateVersion=jn,Ve.needsLights&&(gi.ambientLightColor.value=ft.state.ambient,gi.lightProbe.value=ft.state.probe,gi.directionalLights.value=ft.state.directional,gi.directionalLightShadows.value=ft.state.directionalShadow,gi.spotLights.value=ft.state.spot,gi.spotLightShadows.value=ft.state.spotShadow,gi.rectAreaLights.value=ft.state.rectArea,gi.ltc_1.value=ft.state.rectAreaLTC1,gi.ltc_2.value=ft.state.rectAreaLTC2,gi.pointLights.value=ft.state.point,gi.pointLightShadows.value=ft.state.pointShadow,gi.hemisphereLights.value=ft.state.hemi,gi.directionalShadowMap.value=ft.state.directionalShadowMap,gi.directionalShadowMatrix.value=ft.state.directionalShadowMatrix,gi.spotShadowMap.value=ft.state.spotShadowMap,gi.spotShadowMatrix.value=ft.state.spotShadowMatrix,gi.pointShadowMap.value=ft.state.pointShadowMap,gi.pointShadowMatrix.value=ft.state.pointShadowMatrix);const Wi=ci.getUniforms(),Da=ia.seqWithValue(Wi.seq,gi);return Ve.currentProgram=ci,Ve.uniformsList=Da,ci}function zd(q,Pe){const Ye=it.get(q);Ye.outputEncoding=Pe.outputEncoding,Ye.instancing=Pe.instancing,Ye.skinning=Pe.skinning,Ye.morphTargets=Pe.morphTargets,Ye.morphNormals=Pe.morphNormals,Ye.morphTargetsCount=Pe.morphTargetsCount,Ye.numClippingPlanes=Pe.numClippingPlanes,Ye.numIntersection=Pe.numClipIntersection,Ye.vertexAlphas=Pe.vertexAlphas,Ye.vertexTangents=Pe.vertexTangents,Ye.toneMapping=Pe.toneMapping}Fa.setAnimationLoop(function Ci(q){Bi&&Bi(q)}),typeof window<"u"&&Fa.setContext(window),this.setAnimationLoop=function(q){Bi=q,Lt.setAnimationLoop(q),null===q?Fa.stop():Fa.start()},Lt.addEventListener("sessionstart",_s),Lt.addEventListener("sessionend",xs),this.render=function(q,Pe){if(void 0===Pe||!0===Pe.isCamera){if(!0!==L){if(!0===q.autoUpdate&&q.updateMatrixWorld(),null===Pe.parent&&Pe.updateMatrixWorld(),!0===Lt.enabled&&!0===Lt.isPresenting&&(!0===Lt.cameraAutoUpdate&&Lt.updateCamera(Pe),Pe=Lt.getCamera()),!0===q.isScene&&q.onBeforeRender(T,q,Pe,D),g=Y.get(q,x.length),g.init(),x.push(g),$t.multiplyMatrices(Pe.projectionMatrix,Pe.matrixWorldInverse),Gt.setFromProjectionMatrix($t),ot=this.localClippingEnabled,Jt=vt.init(this.clippingPlanes,ot,Pe),m=ne.get(q,v.length),m.init(),v.push(m),Rd(q,Pe,0,T.sortObjects),m.finish(),!0===T.sortObjects&&m.sort(X,Z),!0===Jt&&vt.beginShadows(),Mt.render(g.state.shadowsArray,q,Pe),!0===Jt&&vt.endShadows(),!0===this.info.autoReset&&this.info.reset(),Vt.render(m,q),g.setupLights(T.physicallyCorrectLights),Pe.isArrayCamera){const Ve=Pe.cameras;for(let ft=0,On=Ve.length;ft<On;ft++){const jn=Ve[ft];Ad(m,q,jn,jn.viewport)}}else Ad(m,q,Pe);null!==D&&(wt.updateMultisampleRenderTarget(D),wt.updateRenderTargetMipmap(D)),!0===q.isScene&&q.onAfterRender(T,q,Pe),En.buffers.depth.setTest(!0),En.buffers.depth.setMask(!0),En.buffers.color.setMask(!0),En.setPolygonOffset(!1),pe.resetDefaultState(),R=-1,G=null,x.pop(),g=x.length>0?x[x.length-1]:null,v.pop(),m=v.length>0?v[v.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return E},this.getActiveMipmapLevel=function(){return _},this.getRenderTarget=function(){return D},this.setRenderTargetTextures=function(q,Pe,Ye){it.get(q.texture).__webglTexture=Pe,it.get(q.depthTexture).__webglTexture=Ye;const Ve=it.get(q);Ve.__hasExternalTextures=!0,Ve.__hasExternalTextures&&(Ve.__autoAllocateDepthBuffer=void 0===Ye,Ve.__autoAllocateDepthBuffer||q.useRenderToTexture&&(console.warn("render-to-texture extension was disabled because an external texture was provided"),q.useRenderToTexture=!1,q.useRenderbuffer=!0))},this.setRenderTargetFramebuffer=function(q,Pe){const Ye=it.get(q);Ye.__webglFramebuffer=Pe,Ye.__useDefaultFramebuffer=void 0===Pe},this.setRenderTarget=function(q,Pe=0,Ye=0){D=q,E=Pe,_=Ye;let Ve=!0;if(q){const Hn=it.get(q);void 0!==Hn.__useDefaultFramebuffer?(En.bindFramebuffer(Ae.FRAMEBUFFER,null),Ve=!1):void 0===Hn.__webglFramebuffer?wt.setupRenderTarget(q):Hn.__hasExternalTextures&&wt.rebindTextures(q,it.get(q.texture).__webglTexture,it.get(q.depthTexture).__webglTexture)}let ft=null,On=!1,jn=!1;if(q){const Hn=q.texture;(Hn.isDataTexture3D||Hn.isDataTexture2DArray)&&(jn=!0);const bi=it.get(q).__webglFramebuffer;q.isWebGLCubeRenderTarget?(ft=bi[Pe],On=!0):ft=q.useRenderbuffer?it.get(q).__webglMultisampledFramebuffer:bi,$.copy(q.viewport),fe.copy(q.scissor),Me=q.scissorTest}else $.copy(ze).multiplyScalar(be).floor(),fe.copy(Xe).multiplyScalar(be).floor(),Me=Le;if(En.bindFramebuffer(Ae.FRAMEBUFFER,ft)&&vn.drawBuffers&&Ve){let Hn=!1;if(q)if(q.isWebGLMultipleRenderTargets){const bi=q.texture;if(je.length!==bi.length||je[0]!==Ae.COLOR_ATTACHMENT0){for(let ci=0,gi=bi.length;ci<gi;ci++)je[ci]=Ae.COLOR_ATTACHMENT0+ci;je.length=bi.length,Hn=!0}}else(1!==je.length||je[0]!==Ae.COLOR_ATTACHMENT0)&&(je[0]=Ae.COLOR_ATTACHMENT0,je.length=1,Hn=!0);else(1!==je.length||je[0]!==Ae.BACK)&&(je[0]=Ae.BACK,je.length=1,Hn=!0);Hn&&(vn.isWebGL2?Ae.drawBuffers(je):Mn.get("WEBGL_draw_buffers").drawBuffersWEBGL(je))}if(En.viewport($),En.scissor(fe),En.setScissorTest(Me),On){const Hn=it.get(q.texture);Ae.framebufferTexture2D(Ae.FRAMEBUFFER,Ae.COLOR_ATTACHMENT0,Ae.TEXTURE_CUBE_MAP_POSITIVE_X+Pe,Hn.__webglTexture,Ye)}else if(jn){const Hn=it.get(q.texture);Ae.framebufferTextureLayer(Ae.FRAMEBUFFER,Ae.COLOR_ATTACHMENT0,Hn.__webglTexture,Ye||0,Pe||0)}R=-1},this.readRenderTargetPixels=function(q,Pe,Ye,Ve,ft,On,jn){if(!q||!q.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let oi=it.get(q).__webglFramebuffer;if(q.isWebGLCubeRenderTarget&&void 0!==jn&&(oi=oi[jn]),oi){En.bindFramebuffer(Ae.FRAMEBUFFER,oi);try{const Hn=q.texture,bi=Hn.format,ci=Hn.type;if(bi!==pi&&Ot.convert(bi)!==Ae.getParameter(Ae.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const gi=ci===_i&&(Mn.has("EXT_color_buffer_half_float")||vn.isWebGL2&&Mn.has("EXT_color_buffer_float"));if(!(ci===Qe||Ot.convert(ci)===Ae.getParameter(Ae.IMPLEMENTATION_COLOR_READ_TYPE)||ci===ki&&(vn.isWebGL2||Mn.has("OES_texture_float")||Mn.has("WEBGL_color_buffer_float"))||gi))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");Ae.checkFramebufferStatus(Ae.FRAMEBUFFER)===Ae.FRAMEBUFFER_COMPLETE?Pe>=0&&Pe<=q.width-Ve&&Ye>=0&&Ye<=q.height-ft&&Ae.readPixels(Pe,Ye,Ve,ft,Ot.convert(bi),Ot.convert(ci),On):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const Hn=null!==D?it.get(D).__webglFramebuffer:null;En.bindFramebuffer(Ae.FRAMEBUFFER,Hn)}}},this.copyFramebufferToTexture=function(q,Pe,Ye=0){if(!0!==Pe.isFramebufferTexture)return void console.error("THREE.WebGLRenderer: copyFramebufferToTexture() can only be used with FramebufferTexture.");const Ve=Math.pow(2,-Ye),ft=Math.floor(Pe.image.width*Ve),On=Math.floor(Pe.image.height*Ve);wt.setTexture2D(Pe,0),Ae.copyTexSubImage2D(Ae.TEXTURE_2D,Ye,0,0,q.x,q.y,ft,On),En.unbindTexture()},this.copyTextureToTexture=function(q,Pe,Ye,Ve=0){const ft=Pe.image.width,On=Pe.image.height,jn=Ot.convert(Ye.format),oi=Ot.convert(Ye.type);wt.setTexture2D(Ye,0),Ae.pixelStorei(Ae.UNPACK_FLIP_Y_WEBGL,Ye.flipY),Ae.pixelStorei(Ae.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ye.premultiplyAlpha),Ae.pixelStorei(Ae.UNPACK_ALIGNMENT,Ye.unpackAlignment),Pe.isDataTexture?Ae.texSubImage2D(Ae.TEXTURE_2D,Ve,q.x,q.y,ft,On,jn,oi,Pe.image.data):Pe.isCompressedTexture?Ae.compressedTexSubImage2D(Ae.TEXTURE_2D,Ve,q.x,q.y,Pe.mipmaps[0].width,Pe.mipmaps[0].height,jn,Pe.mipmaps[0].data):Ae.texSubImage2D(Ae.TEXTURE_2D,Ve,q.x,q.y,jn,oi,Pe.image),0===Ve&&Ye.generateMipmaps&&Ae.generateMipmap(Ae.TEXTURE_2D),En.unbindTexture()},this.copyTextureToTexture3D=function(q,Pe,Ye,Ve,ft=0){if(T.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const On=q.max.x-q.min.x+1,jn=q.max.y-q.min.y+1,oi=q.max.z-q.min.z+1,Hn=Ot.convert(Ve.format),bi=Ot.convert(Ve.type);let ci;if(Ve.isDataTexture3D)wt.setTexture3D(Ve,0),ci=Ae.TEXTURE_3D;else{if(!Ve.isDataTexture2DArray)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");wt.setTexture2DArray(Ve,0),ci=Ae.TEXTURE_2D_ARRAY}Ae.pixelStorei(Ae.UNPACK_FLIP_Y_WEBGL,Ve.flipY),Ae.pixelStorei(Ae.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ve.premultiplyAlpha),Ae.pixelStorei(Ae.UNPACK_ALIGNMENT,Ve.unpackAlignment);const gi=Ae.getParameter(Ae.UNPACK_ROW_LENGTH),Wi=Ae.getParameter(Ae.UNPACK_IMAGE_HEIGHT),Da=Ae.getParameter(Ae.UNPACK_SKIP_PIXELS),Mo=Ae.getParameter(Ae.UNPACK_SKIP_ROWS),wi=Ae.getParameter(Ae.UNPACK_SKIP_IMAGES),Es=Ye.isCompressedTexture?Ye.mipmaps[0]:Ye.image;Ae.pixelStorei(Ae.UNPACK_ROW_LENGTH,Es.width),Ae.pixelStorei(Ae.UNPACK_IMAGE_HEIGHT,Es.height),Ae.pixelStorei(Ae.UNPACK_SKIP_PIXELS,q.min.x),Ae.pixelStorei(Ae.UNPACK_SKIP_ROWS,q.min.y),Ae.pixelStorei(Ae.UNPACK_SKIP_IMAGES,q.min.z),Ye.isDataTexture||Ye.isDataTexture3D?Ae.texSubImage3D(ci,ft,Pe.x,Pe.y,Pe.z,On,jn,oi,Hn,bi,Es.data):Ye.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),Ae.compressedTexSubImage3D(ci,ft,Pe.x,Pe.y,Pe.z,On,jn,oi,Hn,Es.data)):Ae.texSubImage3D(ci,ft,Pe.x,Pe.y,Pe.z,On,jn,oi,Hn,bi,Es),Ae.pixelStorei(Ae.UNPACK_ROW_LENGTH,gi),Ae.pixelStorei(Ae.UNPACK_IMAGE_HEIGHT,Wi),Ae.pixelStorei(Ae.UNPACK_SKIP_PIXELS,Da),Ae.pixelStorei(Ae.UNPACK_SKIP_ROWS,Mo),Ae.pixelStorei(Ae.UNPACK_SKIP_IMAGES,wi),0===ft&&Ve.generateMipmaps&&Ae.generateMipmap(ci),En.unbindTexture()},this.initTexture=function(q){wt.setTexture2D(q,0),En.unbindTexture()},this.resetState=function(){E=0,_=0,D=null,En.reset(),pe.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}Ri.prototype.isWebGLRenderer=!0;class Zh extends Ri{}Zh.prototype.isWebGL1Renderer=!0;class Ho{constructor(e,t=25e-5){this.name="",this.color=new Wt(e),this.density=t}clone(){return new Ho(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}Ho.prototype.isFogExp2=!0;class ko{constructor(e,t=1,n=1e3){this.name="",this.color=new Wt(e),this.near=t,this.far=n}clone(){return new ko(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}ko.prototype.isFog=!0;class kc extends li{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}kc.prototype.isScene=!0;class ya{constructor(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=pr,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=er()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let i=0,a=this.stride;i<a;i++)this.array[e+i]=t.array[n+i];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=er()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=er()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}ya.prototype.isInterleavedBuffer=!0;const Yi=new O;class ra{constructor(e,t,n,i=!1){this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=!0===i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)Yi.x=this.getX(t),Yi.y=this.getY(t),Yi.z=this.getZ(t),Yi.applyMatrix4(e),this.setXYZ(t,Yi.x,Yi.y,Yi.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Yi.x=this.getX(t),Yi.y=this.getY(t),Yi.z=this.getZ(t),Yi.applyNormalMatrix(e),this.setXYZ(t,Yi.x,Yi.y,Yi.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Yi.x=this.getX(t),Yi.y=this.getY(t),Yi.z=this.getZ(t),Yi.transformDirection(e),this.setXYZ(t,Yi.x,Yi.y,Yi.z);return this}setX(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,t,n){return this.data.array[(e=e*this.data.stride+this.offset)+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,i){return this.data.array[(e=e*this.data.stride+this.offset)+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this}setXYZW(e,t,n,i,a){return this.data.array[(e=e*this.data.stride+this.offset)+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=a,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const i=n*this.data.stride+this.offset;for(let a=0;a<this.itemSize;a++)t.push(this.data.array[i+a])}return new mi(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new ra(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const i=n*this.data.stride+this.offset;for(let a=0;a<this.itemSize;a++)t.push(this.data.array[i+a])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}ra.prototype.isInterleavedBufferAttribute=!0;class Gc extends rr{constructor(e){super(),this.type="SpriteMaterial",this.color=new Wt(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}}let so;Gc.prototype.isSpriteMaterial=!0;const Go=new O,ao=new O,oo=new O,co=new st,Vo=new st,Jh=new fn,Vc=new O,Wo=new O,Wc=new O,$h=new st,tu=new st,Qh=new st;class Xc extends li{constructor(e){if(super(),this.type="Sprite",void 0===so){so=new zn;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),n=new ya(t,5);so.setIndex([0,1,2,0,2,3]),so.setAttribute("position",new ra(n,3,0,!1)),so.setAttribute("uv",new ra(n,2,3,!1))}this.geometry=so,this.material=void 0!==e?e:new Gc,this.center=new st(.5,.5)}raycast(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),ao.setFromMatrixScale(this.matrixWorld),Jh.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),oo.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&ao.multiplyScalar(-oo.z);const n=this.material.rotation;let i,a;0!==n&&(a=Math.cos(n),i=Math.sin(n));const o=this.center;jc(Vc.set(-.5,-.5,0),oo,o,ao,i,a),jc(Wo.set(.5,-.5,0),oo,o,ao,i,a),jc(Wc.set(.5,.5,0),oo,o,ao,i,a),$h.set(0,0),tu.set(1,0),Qh.set(1,1);let c=e.ray.intersectTriangle(Vc,Wo,Wc,!1,Go);if(null===c&&(jc(Wo.set(-.5,.5,0),oo,o,ao,i,a),tu.set(0,1),c=e.ray.intersectTriangle(Vc,Wc,Wo,!1,Go),null===c))return;const l=e.ray.origin.distanceTo(Go);l<e.near||l>e.far||t.push({distance:l,point:Go.clone(),uv:qi.getUV(Go,Vc,Wo,Wc,$h,tu,Qh,new st),face:null,object:this})}copy(e){return super.copy(e),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}function jc(r,e,t,n,i,a){co.subVectors(r,t).addScalar(.5).multiply(n),void 0!==i?(Vo.x=a*co.x-i*co.y,Vo.y=i*co.x+a*co.y):Vo.copy(co),r.copy(e),r.x+=Vo.x,r.y+=Vo.y,r.applyMatrix4(Jh)}Xc.prototype.isSprite=!0;const qc=new O,ef=new O;class tf extends li{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let n=0,i=t.length;n<i;n++){const a=t[n];this.addLevel(a.object.clone(),a.distance)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0){t=Math.abs(t);const n=this.levels;let i;for(i=0;i<n.length&&!(t<n[i].distance);i++);return n.splice(i,0,{distance:t,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let n,i;for(n=1,i=t.length;n<i&&!(e<t[n].distance);n++);return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){qc.setFromMatrixPosition(this.matrixWorld);const i=e.ray.origin.distanceTo(qc);this.getObjectForDistance(i).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){qc.setFromMatrixPosition(e.matrixWorld),ef.setFromMatrixPosition(this.matrixWorld);const n=qc.distanceTo(ef)/e.zoom;let i,a;for(t[0].object.visible=!0,i=1,a=t.length;i<a&&n>=t[i].distance;i++)t[i-1].object.visible=!1,t[i].object.visible=!0;for(this._currentLevel=i-1;i<a;i++)t[i].object.visible=!1}}toJSON(e){const t=super.toJSON(e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let i=0,a=n.length;i<a;i++){const o=n[i];t.object.levels.push({object:o.object.uuid,distance:o.distance})}return t}}const nf=new O,rf=new rn,sf=new rn,A0=new O,af=new fn;class Yc extends $i{constructor(e,t){super(e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new fn,this.bindMatrixInverse=new fn}copy(e){return super.copy(e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new rn,t=this.geometry.attributes.skinWeight;for(let n=0,i=t.count;n<i;n++){e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.w=t.getW(n);const a=1/e.manhattanLength();a!==1/0?e.multiplyScalar(a):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){const n=this.skeleton,i=this.geometry;rf.fromBufferAttribute(i.attributes.skinIndex,e),sf.fromBufferAttribute(i.attributes.skinWeight,e),nf.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let a=0;a<4;a++){const o=sf.getComponent(a);if(0!==o){const c=rf.getComponent(a);af.multiplyMatrices(n.bones[c].matrixWorld,n.boneInverses[c]),t.addScaledVector(A0.copy(nf).applyMatrix4(af),o)}}return t.applyMatrix4(this.bindMatrixInverse)}}Yc.prototype.isSkinnedMesh=!0;class Kc extends li{constructor(){super(),this.type="Bone"}}Kc.prototype.isBone=!0;class _a extends zi{constructor(e=null,t=1,n=1,i,a,o,c,l,h=Dn,p=Dn,m,g){super(null,o,c,l,h,p,i,a,m,g),this.image={data:e,width:t,height:n},this.magFilter=h,this.minFilter=p,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}_a.prototype.isDataTexture=!0;const of=new fn,z0=new fn;class Zc{constructor(e=[],t=[]){this.uuid=er(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let n=0,i=this.bones.length;n<i;n++)this.boneInverses.push(new fn)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const n=new fn;this.bones[e]&&n.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(n)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&n.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&(n.parent&&n.parent.isBone?(n.matrix.copy(n.parent.matrixWorld).invert(),n.matrix.multiply(n.matrixWorld)):n.matrix.copy(n.matrixWorld),n.matrix.decompose(n.position,n.quaternion,n.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let a=0,o=e.length;a<o;a++)of.multiplyMatrices(e[a]?e[a].matrixWorld:z0,t[a]),of.toArray(n,16*a);null!==i&&(i.needsUpdate=!0)}clone(){return new Zc(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=Ws(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new _a(t,e,e,pi,ki);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const i=this.bones[t];if(i.name===e)return i}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,i=e.bones.length;n<i;n++){const a=e.bones[n];let o=t[a];void 0===o&&(console.warn("THREE.Skeleton: No bone found with UUID:",a),o=new Kc),this.bones.push(o),this.boneInverses.push((new fn).fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let i=0,a=t.length;i<a;i++)e.bones.push(t[i].uuid),e.boneInverses.push(n[i].toArray());return e}}class xa extends mi{constructor(e,t,n,i=1){"number"==typeof n&&(i=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(e,t,n),this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}xa.prototype.isInstancedBufferAttribute=!0;const cf=new fn,lf=new fn,Jc=[],Xo=new $i;class nu extends $i{constructor(e,t,n){super(e,t),this.instanceMatrix=new xa(new Float32Array(16*n),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}copy(e){return super.copy(e),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){const n=this.matrixWorld,i=this.count;if(Xo.geometry=this.geometry,Xo.material=this.material,void 0!==Xo.material)for(let a=0;a<i;a++){this.getMatrixAt(a,cf),lf.multiplyMatrices(n,cf),Xo.matrixWorld=lf,Xo.raycast(e,Jc);for(let o=0,c=Jc.length;o<c;o++){const l=Jc[o];l.instanceId=a,l.object=this,t.push(l)}Jc.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new xa(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}nu.prototype.isInstancedMesh=!0;class or extends rr{constructor(e){super(),this.type="LineBasicMaterial",this.color=new Wt(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this}}or.prototype.isLineBasicMaterial=!0;const uf=new O,hf=new O,ff=new fn,iu=new Js,$c=new Ks;class Ds extends li{constructor(e=new zn,t=new or){super(),this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,n=[0];for(let i=1,a=t.count;i<a;i++)uf.fromBufferAttribute(t,i-1),hf.fromBufferAttribute(t,i),n[i]=n[i-1],n[i]+=uf.distanceTo(hf);e.setAttribute("lineDistance",new on(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,a=e.params.Line.threshold,o=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),$c.copy(n.boundingSphere),$c.applyMatrix4(i),$c.radius+=a,!1===e.ray.intersectsSphere($c))return;ff.copy(i).invert(),iu.copy(e.ray).applyMatrix4(ff);const c=a/((this.scale.x+this.scale.y+this.scale.z)/3),l=c*c,h=new O,p=new O,m=new O,g=new O,v=this.isLineSegments?2:1;if(n.isBufferGeometry){const x=n.index,L=n.attributes.position;if(null!==x)for(let D=Math.max(0,o.start),R=Math.min(x.count,o.start+o.count)-1;D<R;D+=v){const G=x.getX(D),$=x.getX(D+1);if(h.fromBufferAttribute(L,G),p.fromBufferAttribute(L,$),iu.distanceSqToSegment(h,p,g,m)>l)continue;g.applyMatrix4(this.matrixWorld);const Me=e.ray.origin.distanceTo(g);Me<e.near||Me>e.far||t.push({distance:Me,point:m.clone().applyMatrix4(this.matrixWorld),index:D,face:null,faceIndex:null,object:this})}else for(let D=Math.max(0,o.start),R=Math.min(L.count,o.start+o.count)-1;D<R;D+=v){if(h.fromBufferAttribute(L,D),p.fromBufferAttribute(L,D+1),iu.distanceSqToSegment(h,p,g,m)>l)continue;g.applyMatrix4(this.matrixWorld);const $=e.ray.origin.distanceTo(g);$<e.near||$>e.far||t.push({distance:$,point:m.clone().applyMatrix4(this.matrixWorld),index:D,face:null,faceIndex:null,object:this})}}else n.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let a=0,o=i.length;a<o;a++){const c=i[a].name||String(a);this.morphTargetInfluences.push(0),this.morphTargetDictionary[c]=a}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}Ds.prototype.isLine=!0;const df=new O,pf=new O;class Fr extends Ds{constructor(e,t){super(e,t),this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,n=[];for(let i=0,a=t.count;i<a;i+=2)df.fromBufferAttribute(t,i),pf.fromBufferAttribute(t,i+1),n[i]=0===i?0:n[i-1],n[i+1]=n[i]+df.distanceTo(pf);e.setAttribute("lineDistance",new on(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}Fr.prototype.isLineSegments=!0;class ru extends Ds{constructor(e,t){super(e,t),this.type="LineLoop"}}ru.prototype.isLineLoop=!0;class Ea extends rr{constructor(e){super(),this.type="PointsMaterial",this.color=new Wt(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this}}Ea.prototype.isPointsMaterial=!0;const mf=new fn,su=new Js,Qc=new Ks,el=new O;class jo extends li{constructor(e=new zn,t=new Ea){super(),this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,a=e.params.Points.threshold,o=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Qc.copy(n.boundingSphere),Qc.applyMatrix4(i),Qc.radius+=a,!1===e.ray.intersectsSphere(Qc))return;mf.copy(i).invert(),su.copy(e.ray).applyMatrix4(mf);const c=a/((this.scale.x+this.scale.y+this.scale.z)/3),l=c*c;if(n.isBufferGeometry){const h=n.index,m=n.attributes.position;if(null!==h)for(let x=Math.max(0,o.start),T=Math.min(h.count,o.start+o.count);x<T;x++){const L=h.getX(x);el.fromBufferAttribute(m,L),gf(el,L,l,i,e,t,this)}else for(let x=Math.max(0,o.start),T=Math.min(m.count,o.start+o.count);x<T;x++)el.fromBufferAttribute(m,x),gf(el,x,l,i,e,t,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let a=0,o=i.length;a<o;a++){const c=i[a].name||String(a);this.morphTargetInfluences.push(0),this.morphTargetDictionary[c]=a}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}function gf(r,e,t,n,i,a,o){const c=su.distanceSqToPoint(r);if(c<t){const l=new O;su.closestPointToPoint(r,l),l.applyMatrix4(n);const h=i.ray.origin.distanceTo(l);if(h<i.near||h>i.far)return;a.push({distance:h,distanceToRay:Math.sqrt(c),point:l,index:e,face:null,object:o})}}jo.prototype.isPoints=!0;class vf extends zi{constructor(e,t,n,i,a,o,c,l,h){super(e,t,n,i,a,o,c,l,h),this.format=void 0!==c?c:br,this.minFilter=void 0!==o?o:Cn,this.magFilter=void 0!==a?a:Cn,this.generateMipmaps=!1;const p=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(function m(){p.needsUpdate=!0,e.requestVideoFrameCallback(m)})}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e==0&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}vf.prototype.isVideoTexture=!0;class yf extends zi{constructor(e,t,n){super({width:e,height:t}),this.format=n,this.magFilter=Dn,this.minFilter=Dn,this.generateMipmaps=!1,this.needsUpdate=!0}}yf.prototype.isFramebufferTexture=!0;class au extends zi{constructor(e,t,n,i,a,o,c,l,h,p,m,g){super(null,o,c,l,h,p,i,a,m,g),this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}au.prototype.isCompressedTexture=!0;class _f extends zi{constructor(e,t,n,i,a,o,c,l,h){super(e,t,n,i,a,o,c,l,h),this.needsUpdate=!0}}_f.prototype.isCanvasTexture=!0;class lo extends zn{constructor(e=1,t=8,n=0,i=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:i},t=Math.max(3,t);const a=[],o=[],c=[],l=[],h=new O,p=new st;o.push(0,0,0),c.push(0,0,1),l.push(.5,.5);for(let m=0,g=3;m<=t;m++,g+=3){const v=n+m/t*i;h.x=e*Math.cos(v),h.y=e*Math.sin(v),o.push(h.x,h.y,h.z),c.push(0,0,1),p.x=(o[g]/e+1)/2,p.y=(o[g+1]/e+1)/2,l.push(p.x,p.y)}for(let m=1;m<=t;m++)a.push(m,m+1,0);this.setIndex(a),this.setAttribute("position",new on(o,3)),this.setAttribute("normal",new on(c,3)),this.setAttribute("uv",new on(l,2))}static fromJSON(e){return new lo(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class sa extends zn{constructor(e=1,t=1,n=1,i=8,a=1,o=!1,c=0,l=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:a,openEnded:o,thetaStart:c,thetaLength:l};const h=this;i=Math.floor(i),a=Math.floor(a);const p=[],m=[],g=[],v=[];let x=0;const T=[],L=n/2;let E=0;function D(R){const G=x,$=new st,fe=new O;let Me=0;const Je=!0===R?e:t,ke=!0===R?1:-1;for(let X=1;X<=i;X++)m.push(0,L*ke,0),g.push(0,ke,0),v.push(.5,.5),x++;const be=x;for(let X=0;X<=i;X++){const ze=X/i*l+c,Xe=Math.cos(ze),Le=Math.sin(ze);fe.x=Je*Le,fe.y=L*ke,fe.z=Je*Xe,m.push(fe.x,fe.y,fe.z),g.push(0,ke,0),$.x=.5*Xe+.5,$.y=.5*Le*ke+.5,v.push($.x,$.y),x++}for(let X=0;X<i;X++){const Z=G+X,ze=be+X;!0===R?p.push(ze,ze+1,Z):p.push(ze+1,ze,Z),Me+=3}h.addGroup(E,Me,!0===R?1:2),E+=Me}(function _(){const R=new O,G=new O;let $=0;const fe=(t-e)/n;for(let Me=0;Me<=a;Me++){const Je=[],ke=Me/a,be=ke*(t-e)+e;for(let X=0;X<=i;X++){const Z=X/i,ze=Z*l+c,Xe=Math.sin(ze),Le=Math.cos(ze);G.x=be*Xe,G.y=-ke*n+L,G.z=be*Le,m.push(G.x,G.y,G.z),R.set(Xe,fe,Le).normalize(),g.push(R.x,R.y,R.z),v.push(Z,1-ke),Je.push(x++)}T.push(Je)}for(let Me=0;Me<i;Me++)for(let Je=0;Je<a;Je++){const be=T[Je+1][Me],X=T[Je+1][Me+1],Z=T[Je][Me+1];p.push(T[Je][Me],be,Z),p.push(be,X,Z),$+=6}h.addGroup(E,$,0),E+=$})(),!1===o&&(e>0&&D(!0),t>0&&D(!1)),this.setIndex(p),this.setAttribute("position",new on(m,3)),this.setAttribute("normal",new on(g,3)),this.setAttribute("uv",new on(v,2))}static fromJSON(e){return new sa(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class uo extends sa{constructor(e=1,t=1,n=8,i=1,a=!1,o=0,c=2*Math.PI){super(0,e,t,n,i,a,o,c),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:i,openEnded:a,thetaStart:o,thetaLength:c}}static fromJSON(e){return new uo(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class ps extends zn{constructor(e=[],t=[],n=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:i};const a=[],o=[];function l(_,D,R,G){const $=G+1,fe=[];for(let Me=0;Me<=$;Me++){fe[Me]=[];const Je=_.clone().lerp(R,Me/$),ke=D.clone().lerp(R,Me/$),be=$-Me;for(let X=0;X<=be;X++)fe[Me][X]=0===X&&Me===$?Je:Je.clone().lerp(ke,X/be)}for(let Me=0;Me<$;Me++)for(let Je=0;Je<2*($-Me)-1;Je++){const ke=Math.floor(Je/2);Je%2==0?(g(fe[Me][ke+1]),g(fe[Me+1][ke]),g(fe[Me][ke])):(g(fe[Me][ke+1]),g(fe[Me+1][ke+1]),g(fe[Me+1][ke]))}}function g(_){a.push(_.x,_.y,_.z)}function v(_,D){const R=3*_;D.x=e[R+0],D.y=e[R+1],D.z=e[R+2]}function T(_,D,R,G){G<0&&1===_.x&&(o[D]=_.x-1),0===R.x&&0===R.z&&(o[D]=G/2/Math.PI+.5)}function L(_){return Math.atan2(_.z,-_.x)}function E(_){return Math.atan2(-_.y,Math.sqrt(_.x*_.x+_.z*_.z))}(function c(_){const D=new O,R=new O,G=new O;for(let $=0;$<t.length;$+=3)v(t[$+0],D),v(t[$+1],R),v(t[$+2],G),l(D,R,G,_)})(i),function h(_){const D=new O;for(let R=0;R<a.length;R+=3)D.x=a[R+0],D.y=a[R+1],D.z=a[R+2],D.normalize().multiplyScalar(_),a[R+0]=D.x,a[R+1]=D.y,a[R+2]=D.z}(n),function p(){const _=new O;for(let D=0;D<a.length;D+=3){_.x=a[D+0],_.y=a[D+1],_.z=a[D+2];const R=L(_)/2/Math.PI+.5,G=E(_)/Math.PI+.5;o.push(R,1-G)}(function x(){const _=new O,D=new O,R=new O,G=new O,$=new st,fe=new st,Me=new st;for(let Je=0,ke=0;Je<a.length;Je+=9,ke+=6){_.set(a[Je+0],a[Je+1],a[Je+2]),D.set(a[Je+3],a[Je+4],a[Je+5]),R.set(a[Je+6],a[Je+7],a[Je+8]),$.set(o[ke+0],o[ke+1]),fe.set(o[ke+2],o[ke+3]),Me.set(o[ke+4],o[ke+5]),G.copy(_).add(D).add(R).divideScalar(3);const be=L(G);T($,ke+0,_,be),T(fe,ke+2,D,be),T(Me,ke+4,R,be)}})(),function m(){for(let _=0;_<o.length;_+=6){const D=o[_+0],R=o[_+2],G=o[_+4],$=Math.max(D,R,G),fe=Math.min(D,R,G);$>.9&&fe<.1&&(D<.2&&(o[_+0]+=1),R<.2&&(o[_+2]+=1),G<.2&&(o[_+4]+=1))}}()}(),this.setAttribute("position",new on(a,3)),this.setAttribute("normal",new on(a.slice(),3)),this.setAttribute("uv",new on(o,2)),0===i?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(e){return new ps(e.vertices,e.indices,e.radius,e.details)}}class ho extends ps{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,i=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new ho(e.radius,e.detail)}}const tl=new O,nl=new O,ou=new O,il=new qi;class cu extends zn{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},null!==e){const i=Math.pow(10,4),a=Math.cos(jr*t),o=e.getIndex(),c=e.getAttribute("position"),l=o?o.count:c.count,h=[0,0,0],p=["a","b","c"],m=new Array(3),g={},v=[];for(let x=0;x<l;x+=3){o?(h[0]=o.getX(x),h[1]=o.getX(x+1),h[2]=o.getX(x+2)):(h[0]=x,h[1]=x+1,h[2]=x+2);const{a:T,b:L,c:E}=il;if(T.fromBufferAttribute(c,h[0]),L.fromBufferAttribute(c,h[1]),E.fromBufferAttribute(c,h[2]),il.getNormal(ou),m[0]=`${Math.round(T.x*i)},${Math.round(T.y*i)},${Math.round(T.z*i)}`,m[1]=`${Math.round(L.x*i)},${Math.round(L.y*i)},${Math.round(L.z*i)}`,m[2]=`${Math.round(E.x*i)},${Math.round(E.y*i)},${Math.round(E.z*i)}`,m[0]!==m[1]&&m[1]!==m[2]&&m[2]!==m[0])for(let _=0;_<3;_++){const D=(_+1)%3,R=m[_],G=m[D],$=il[p[_]],fe=il[p[D]],Me=`${R}_${G}`,Je=`${G}_${R}`;Je in g&&g[Je]?(ou.dot(g[Je].normal)<=a&&(v.push($.x,$.y,$.z),v.push(fe.x,fe.y,fe.z)),g[Je]=null):Me in g||(g[Me]={index0:h[_],index1:h[D],normal:ou.clone()})}}for(const x in g)if(g[x]){const{index0:T,index1:L}=g[x];tl.fromBufferAttribute(c,T),nl.fromBufferAttribute(c,L),v.push(tl.x,tl.y,tl.z),v.push(nl.x,nl.y,nl.z)}this.setAttribute("position",new on(v,3))}}}class Or{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,i=this.getPoint(0),a=0;t.push(0);for(let o=1;o<=e;o++)n=this.getPoint(o/e),a+=n.distanceTo(i),t.push(a),i=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const n=this.getLengths();let i=0;const a=n.length;let o;o=t||e*n[a-1];let h,c=0,l=a-1;for(;c<=l;)if(i=Math.floor(c+(l-c)/2),h=n[i]-o,h<0)c=i+1;else{if(!(h>0)){l=i;break}l=i-1}if(i=l,n[i]===o)return i/(a-1);const p=n[i];return(i+(o-p)/(n[i+1]-p))/(a-1)}getTangent(e,t){let i=e-1e-4,a=e+1e-4;i<0&&(i=0),a>1&&(a=1);const o=this.getPoint(i),c=this.getPoint(a),l=t||(o.isVector2?new st:new O);return l.copy(c).sub(o).normalize(),l}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){const n=new O,i=[],a=[],o=[],c=new O,l=new fn;for(let v=0;v<=e;v++)i[v]=this.getTangentAt(v/e,new O);a[0]=new O,o[0]=new O;let h=Number.MAX_VALUE;const p=Math.abs(i[0].x),m=Math.abs(i[0].y),g=Math.abs(i[0].z);p<=h&&(h=p,n.set(1,0,0)),m<=h&&(h=m,n.set(0,1,0)),g<=h&&n.set(0,0,1),c.crossVectors(i[0],n).normalize(),a[0].crossVectors(i[0],c),o[0].crossVectors(i[0],a[0]);for(let v=1;v<=e;v++){if(a[v]=a[v-1].clone(),o[v]=o[v-1].clone(),c.crossVectors(i[v-1],i[v]),c.length()>Number.EPSILON){c.normalize();const x=Math.acos(ji(i[v-1].dot(i[v]),-1,1));a[v].applyMatrix4(l.makeRotationAxis(c,x))}o[v].crossVectors(i[v],a[v])}if(!0===t){let v=Math.acos(ji(a[0].dot(a[e]),-1,1));v/=e,i[0].dot(c.crossVectors(a[0],a[e]))>0&&(v=-v);for(let x=1;x<=e;x++)a[x].applyMatrix4(l.makeRotationAxis(i[x],v*x)),o[x].crossVectors(i[x],a[x])}return{tangents:i,normals:a,binormals:o}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class qo extends Or{constructor(e=0,t=0,n=1,i=1,a=0,o=2*Math.PI,c=!1,l=0){super(),this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=i,this.aStartAngle=a,this.aEndAngle=o,this.aClockwise=c,this.aRotation=l}getPoint(e,t){const n=t||new st,i=2*Math.PI;let a=this.aEndAngle-this.aStartAngle;const o=Math.abs(a)<Number.EPSILON;for(;a<0;)a+=i;for(;a>i;)a-=i;a<Number.EPSILON&&(a=o?0:i),!0===this.aClockwise&&!o&&(a===i?a=-i:a-=i);const c=this.aStartAngle+e*a;let l=this.aX+this.xRadius*Math.cos(c),h=this.aY+this.yRadius*Math.sin(c);if(0!==this.aRotation){const p=Math.cos(this.aRotation),m=Math.sin(this.aRotation),g=l-this.aX,v=h-this.aY;l=g*p-v*m+this.aX,h=g*m+v*p+this.aY}return n.set(l,h)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}qo.prototype.isEllipseCurve=!0;class lu extends qo{constructor(e,t,n,i,a,o){super(e,t,n,n,i,a,o),this.type="ArcCurve"}}function uu(){let r=0,e=0,t=0,n=0;function i(a,o,c,l){r=a,e=c,t=-3*a+3*o-2*c-l,n=2*a-2*o+c+l}return{initCatmullRom:function(a,o,c,l,h){i(o,c,h*(c-a),h*(l-o))},initNonuniformCatmullRom:function(a,o,c,l,h,p,m){let g=(o-a)/h-(c-a)/(h+p)+(c-o)/p,v=(c-o)/p-(l-o)/(p+m)+(l-c)/m;g*=p,v*=p,i(o,c,g,v)},calc:function(a){const o=a*a;return r+e*a+t*o+n*(o*a)}}}lu.prototype.isArcCurve=!0;const rl=new O,hu=new uu,fu=new uu,du=new uu;class pu extends Or{constructor(e=[],t=!1,n="centripetal",i=.5){super(),this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=i}getPoint(e,t=new O){const n=t,i=this.points,a=i.length,o=(a-(this.closed?0:1))*e;let h,p,c=Math.floor(o),l=o-c;this.closed?c+=c>0?0:(Math.floor(Math.abs(c)/a)+1)*a:0===l&&c===a-1&&(c=a-2,l=1),this.closed||c>0?h=i[(c-1)%a]:(rl.subVectors(i[0],i[1]).add(i[0]),h=rl);const m=i[c%a],g=i[(c+1)%a];if(this.closed||c+2<a?p=i[(c+2)%a]:(rl.subVectors(i[a-1],i[a-2]).add(i[a-1]),p=rl),"centripetal"===this.curveType||"chordal"===this.curveType){const v="chordal"===this.curveType?.5:.25;let x=Math.pow(h.distanceToSquared(m),v),T=Math.pow(m.distanceToSquared(g),v),L=Math.pow(g.distanceToSquared(p),v);T<1e-4&&(T=1),x<1e-4&&(x=T),L<1e-4&&(L=T),hu.initNonuniformCatmullRom(h.x,m.x,g.x,p.x,x,T,L),fu.initNonuniformCatmullRom(h.y,m.y,g.y,p.y,x,T,L),du.initNonuniformCatmullRom(h.z,m.z,g.z,p.z,x,T,L)}else"catmullrom"===this.curveType&&(hu.initCatmullRom(h.x,m.x,g.x,p.x,this.tension),fu.initCatmullRom(h.y,m.y,g.y,p.y,this.tension),du.initCatmullRom(h.z,m.z,g.z,p.z,this.tension));return n.set(hu.calc(l),fu.calc(l),du.calc(l)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++)this.points.push(e.points[t].clone());return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++)e.points.push(this.points[t].toArray());return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push((new O).fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function xf(r,e,t,n,i){const a=.5*(n-e),o=.5*(i-t),c=r*r;return(2*t-2*n+a+o)*(r*c)+(-3*t+3*n-2*a-o)*c+a*r+t}function Yo(r,e,t,n){return function L0(r,e){const t=1-r;return t*t*e}(r,e)+function C0(r,e){return 2*(1-r)*r*e}(r,t)+function P0(r,e){return r*r*e}(r,n)}function Ko(r,e,t,n,i){return function F0(r,e){const t=1-r;return t*t*t*e}(r,e)+function D0(r,e){const t=1-r;return 3*t*t*r*e}(r,t)+function I0(r,e){return 3*(1-r)*r*r*e}(r,n)+function N0(r,e){return r*r*r*e}(r,i)}pu.prototype.isCatmullRomCurve3=!0;class sl extends Or{constructor(e=new st,t=new st,n=new st,i=new st){super(),this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new st){const n=t,i=this.v0,a=this.v1,o=this.v2,c=this.v3;return n.set(Ko(e,i.x,a.x,o.x,c.x),Ko(e,i.y,a.y,o.y,c.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}sl.prototype.isCubicBezierCurve=!0;class mu extends Or{constructor(e=new O,t=new O,n=new O,i=new O){super(),this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new O){const n=t,i=this.v0,a=this.v1,o=this.v2,c=this.v3;return n.set(Ko(e,i.x,a.x,o.x,c.x),Ko(e,i.y,a.y,o.y,c.y),Ko(e,i.z,a.z,o.z,c.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}mu.prototype.isCubicBezierCurve3=!0;class Zo extends Or{constructor(e=new st,t=new st){super(),this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new st){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){const n=t||new st;return n.copy(this.v2).sub(this.v1).normalize(),n}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}Zo.prototype.isLineCurve=!0;class Ef extends Or{constructor(e=new O,t=new O){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=e,this.v2=t}getPoint(e,t=new O){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class al extends Or{constructor(e=new st,t=new st,n=new st){super(),this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new st){const n=t,i=this.v0,a=this.v1,o=this.v2;return n.set(Yo(e,i.x,a.x,o.x),Yo(e,i.y,a.y,o.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}al.prototype.isQuadraticBezierCurve=!0;class ol extends Or{constructor(e=new O,t=new O,n=new O){super(),this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new O){const n=t,i=this.v0,a=this.v1,o=this.v2;return n.set(Yo(e,i.x,a.x,o.x),Yo(e,i.y,a.y,o.y),Yo(e,i.z,a.z,o.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}ol.prototype.isQuadraticBezierCurve3=!0;class cl extends Or{constructor(e=[]){super(),this.type="SplineCurve",this.points=e}getPoint(e,t=new st){const n=t,i=this.points,a=(i.length-1)*e,o=Math.floor(a),c=a-o,l=i[0===o?o:o-1],h=i[o],p=i[o>i.length-2?i.length-1:o+1],m=i[o>i.length-3?i.length-1:o+2];return n.set(xf(c,l.x,h.x,p.x,m.x),xf(c,l.y,h.y,p.y,m.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++)this.points.push(e.points[t].clone());return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++)e.points.push(this.points[t].toArray());return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push((new st).fromArray(i))}return this}}cl.prototype.isSplineCurve=!0;var gu=Object.freeze({__proto__:null,ArcCurve:lu,CatmullRomCurve3:pu,CubicBezierCurve:sl,CubicBezierCurve3:mu,EllipseCurve:qo,LineCurve:Zo,LineCurve3:Ef,QuadraticBezierCurve:al,QuadraticBezierCurve3:ol,SplineCurve:cl});class bf extends Or{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Zo(t,e))}getPoint(e,t){const n=e*this.getLength(),i=this.getCurveLengths();let a=0;for(;a<i.length;){if(i[a]>=n){const o=i[a]-n,c=this.curves[a],l=c.getLength();return c.getPointAt(0===l?0:1-o/l,t)}a++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,i=this.curves.length;n<i;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let n;for(let i=0,a=this.curves;i<a.length;i++){const o=a[i],l=o.getPoints(o&&o.isEllipseCurve?2*e:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?e*o.points.length:e);for(let h=0;h<l.length;h++){const p=l[h];n&&n.equals(p)||(t.push(p),n=p)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++)this.curves.push(e.curves[t].clone());return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++)e.curves.push(this.curves[t].toJSON());return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const i=e.curves[t];this.curves.push((new gu[i.type]).fromJSON(i))}return this}}class Jo extends bf{constructor(e){super(),this.type="Path",this.currentPoint=new st,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new Zo(this.currentPoint.clone(),new st(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,i){const a=new al(this.currentPoint.clone(),new st(e,t),new st(n,i));return this.curves.push(a),this.currentPoint.set(n,i),this}bezierCurveTo(e,t,n,i,a,o){const c=new sl(this.currentPoint.clone(),new st(e,t),new st(n,i),new st(a,o));return this.curves.push(c),this.currentPoint.set(a,o),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new cl(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,i,a,o){return this.absarc(e+this.currentPoint.x,t+this.currentPoint.y,n,i,a,o),this}absarc(e,t,n,i,a,o){return this.absellipse(e,t,n,n,i,a,o),this}ellipse(e,t,n,i,a,o,c,l){return this.absellipse(e+this.currentPoint.x,t+this.currentPoint.y,n,i,a,o,c,l),this}absellipse(e,t,n,i,a,o,c,l){const h=new qo(e,t,n,i,a,o,c,l);if(this.curves.length>0){const m=h.getPoint(0);m.equals(this.currentPoint)||this.lineTo(m.x,m.y)}this.curves.push(h);const p=h.getPoint(1);return this.currentPoint.copy(p),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class ms extends Jo{constructor(e){super(e),this.uuid=er(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,i=this.holes.length;n<i;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++)this.holes.push(e.holes[t].clone());return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++)e.holes.push(this.holes[t].toJSON());return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const i=e.holes[t];this.holes.push((new Jo).fromJSON(i))}return this}}function Mf(r,e,t,n,i){let a,o;if(i===function Q0(r,e,t,n){let i=0;for(let a=e,o=t-n;a<t;a+=n)i+=(r[o]-r[a])*(r[a+1]+r[o+1]),o=a;return i}(r,e,t,n)>0)for(a=e;a<t;a+=n)o=Sf(a,r[a],r[a+1],o);else for(a=t-n;a>=e;a-=n)o=Sf(a,r[a],r[a+1],o);return o&&ll(o,o.next)&&(ec(o),o=o.next),o}function aa(r,e){if(!r)return r;e||(e=r);let n,t=r;do{if(n=!1,t.steiner||!ll(t,t.next)&&0!==Gi(t.prev,t,t.next))t=t.next;else{if(ec(t),t=e=t.prev,t===t.next)break;n=!0}}while(n||t!==e);return e}function $o(r,e,t,n,i,a,o){if(!r)return;!o&&a&&function q0(r,e,t,n){let i=r;do{null===i.z&&(i.z=vu(i.x,i.y,e,t,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==r);i.prevZ.nextZ=null,i.prevZ=null,function Y0(r){let e,t,n,i,a,o,c,l,h=1;do{for(t=r,r=null,a=null,o=0;t;){for(o++,n=t,c=0,e=0;e<h&&(c++,n=n.nextZ,n);e++);for(l=h;c>0||l>0&&n;)0!==c&&(0===l||!n||t.z<=n.z)?(i=t,t=t.nextZ,c--):(i=n,n=n.nextZ,l--),a?a.nextZ=i:r=i,i.prevZ=a,a=i;t=n}a.nextZ=null,h*=2}while(o>1)}(i)}(r,n,i,a);let l,h,c=r;for(;r.prev!==r.next;)if(l=r.prev,h=r.next,a?O0(r,n,i,a):B0(r))e.push(l.i/t),e.push(r.i/t),e.push(h.i/t),ec(r),r=h.next,c=h.next;else if((r=h)===c){o?1===o?$o(r=H0(aa(r),e,t),e,t,n,i,a,2):2===o&&k0(r,e,t,n,i,a):$o(aa(r),e,t,n,i,a,1);break}}function B0(r){const e=r.prev,t=r,n=r.next;if(Gi(e,t,n)>=0)return!1;let i=r.next.next;for(;i!==r.prev;){if(fo(e.x,e.y,t.x,t.y,n.x,n.y,i.x,i.y)&&Gi(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function O0(r,e,t,n){const i=r.prev,a=r,o=r.next;if(Gi(i,a,o)>=0)return!1;const h=i.x>a.x?i.x>o.x?i.x:o.x:a.x>o.x?a.x:o.x,p=i.y>a.y?i.y>o.y?i.y:o.y:a.y>o.y?a.y:o.y,m=vu(i.x<a.x?i.x<o.x?i.x:o.x:a.x<o.x?a.x:o.x,i.y<a.y?i.y<o.y?i.y:o.y:a.y<o.y?a.y:o.y,e,t,n),g=vu(h,p,e,t,n);let v=r.prevZ,x=r.nextZ;for(;v&&v.z>=m&&x&&x.z<=g;){if(v!==r.prev&&v!==r.next&&fo(i.x,i.y,a.x,a.y,o.x,o.y,v.x,v.y)&&Gi(v.prev,v,v.next)>=0||(v=v.prevZ,x!==r.prev&&x!==r.next&&fo(i.x,i.y,a.x,a.y,o.x,o.y,x.x,x.y)&&Gi(x.prev,x,x.next)>=0))return!1;x=x.nextZ}for(;v&&v.z>=m;){if(v!==r.prev&&v!==r.next&&fo(i.x,i.y,a.x,a.y,o.x,o.y,v.x,v.y)&&Gi(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;x&&x.z<=g;){if(x!==r.prev&&x!==r.next&&fo(i.x,i.y,a.x,a.y,o.x,o.y,x.x,x.y)&&Gi(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function H0(r,e,t){let n=r;do{const i=n.prev,a=n.next.next;!ll(i,a)&&Tf(i,n,n.next,a)&&Qo(i,a)&&Qo(a,i)&&(e.push(i.i/t),e.push(n.i/t),e.push(a.i/t),ec(n),ec(n.next),n=r=a),n=n.next}while(n!==r);return aa(n)}function k0(r,e,t,n,i,a){let o=r;do{let c=o.next.next;for(;c!==o.prev;){if(o.i!==c.i&&Z0(o,c)){let l=wf(o,c);return o=aa(o,o.next),l=aa(l,l.next),$o(o,e,t,n,i,a),void $o(l,e,t,n,i,a)}c=c.next}o=o.next}while(o!==r)}function V0(r,e){return r.x-e.x}function W0(r,e){if(e=function X0(r,e){let t=e;const n=r.x,i=r.y;let o,a=-1/0;do{if(i<=t.y&&i>=t.next.y&&t.next.y!==t.y){const g=t.x+(i-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(g<=n&&g>a){if(a=g,g===n){if(i===t.y)return t;if(i===t.next.y)return t.next}o=t.x<t.next.x?t:t.next}}t=t.next}while(t!==e);if(!o)return null;if(n===a)return o;const c=o,l=o.x,h=o.y;let m,p=1/0;t=o;do{n>=t.x&&t.x>=l&&n!==t.x&&fo(i<h?n:a,i,l,h,i<h?a:n,i,t.x,t.y)&&(m=Math.abs(i-t.y)/(n-t.x),Qo(t,r)&&(m<p||m===p&&(t.x>o.x||t.x===o.x&&j0(o,t)))&&(o=t,p=m)),t=t.next}while(t!==c);return o}(r,e),e){const t=wf(e,r);aa(e,e.next),aa(t,t.next)}}function j0(r,e){return Gi(r.prev,r,e.prev)<0&&Gi(e.next,r,r.next)<0}function vu(r,e,t,n,i){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=32767*(r-t)*i)|r<<8))|r<<4))|r<<2))|r<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function K0(r){let e=r,t=r;do{(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next}while(e!==r);return t}function fo(r,e,t,n,i,a,o,c){return(i-o)*(e-c)-(r-o)*(a-c)>=0&&(r-o)*(n-c)-(t-o)*(e-c)>=0&&(t-o)*(a-c)-(i-o)*(n-c)>=0}function Z0(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!function J0(r,e){let t=r;do{if(t.i!==r.i&&t.next.i!==r.i&&t.i!==e.i&&t.next.i!==e.i&&Tf(t,t.next,r,e))return!0;t=t.next}while(t!==r);return!1}(r,e)&&(Qo(r,e)&&Qo(e,r)&&function $0(r,e){let t=r,n=!1;const i=(r.x+e.x)/2,a=(r.y+e.y)/2;do{t.y>a!=t.next.y>a&&t.next.y!==t.y&&i<(t.next.x-t.x)*(a-t.y)/(t.next.y-t.y)+t.x&&(n=!n),t=t.next}while(t!==r);return n}(r,e)&&(Gi(r.prev,r,e.prev)||Gi(r,e.prev,e))||ll(r,e)&&Gi(r.prev,r,r.next)>0&&Gi(e.prev,e,e.next)>0)}function Gi(r,e,t){return(e.y-r.y)*(t.x-e.x)-(e.x-r.x)*(t.y-e.y)}function ll(r,e){return r.x===e.x&&r.y===e.y}function Tf(r,e,t,n){const i=hl(Gi(r,e,t)),a=hl(Gi(r,e,n)),o=hl(Gi(t,n,r)),c=hl(Gi(t,n,e));return!!(i!==a&&o!==c||0===i&&ul(r,t,e)||0===a&&ul(r,n,e)||0===o&&ul(t,r,n)||0===c&&ul(t,e,n))}function ul(r,e,t){return e.x<=Math.max(r.x,t.x)&&e.x>=Math.min(r.x,t.x)&&e.y<=Math.max(r.y,t.y)&&e.y>=Math.min(r.y,t.y)}function hl(r){return r>0?1:r<0?-1:0}function Qo(r,e){return Gi(r.prev,r,r.next)<0?Gi(r,e,r.next)>=0&&Gi(r,r.prev,e)>=0:Gi(r,e,r.prev)<0||Gi(r,r.next,e)<0}function wf(r,e){const t=new yu(r.i,r.x,r.y),n=new yu(e.i,e.x,e.y),i=r.next,a=e.prev;return r.next=e,e.prev=r,t.next=i,i.prev=t,n.next=t,t.prev=n,a.next=n,n.prev=a,n}function Sf(r,e,t,n){const i=new yu(r,e,t);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function ec(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function yu(r,e,t){this.i=r,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class gs{static area(e){const t=e.length;let n=0;for(let i=t-1,a=0;a<t;i=a++)n+=e[i].x*e[a].y-e[a].x*e[i].y;return.5*n}static isClockWise(e){return gs.area(e)<0}static triangulateShape(e,t){const n=[],i=[],a=[];Rf(e),Af(n,e);let o=e.length;t.forEach(Rf);for(let l=0;l<t.length;l++)i.push(o),o+=t[l].length,Af(n,t[l]);const c=function(r,e,t=2){const n=e&&e.length,i=n?e[0]*t:r.length;let a=Mf(r,0,i,t,!0);const o=[];if(!a||a.next===a.prev)return o;let c,l,h,p,m,g,v;if(n&&(a=function G0(r,e,t,n){const i=[];let a,o,c,l,h;for(a=0,o=e.length;a<o;a++)c=e[a]*n,l=a<o-1?e[a+1]*n:r.length,h=Mf(r,c,l,n,!1),h===h.next&&(h.steiner=!0),i.push(K0(h));for(i.sort(V0),a=0;a<i.length;a++)W0(i[a],t),t=aa(t,t.next);return t}(r,e,a,t)),r.length>80*t){c=h=r[0],l=p=r[1];for(let x=t;x<i;x+=t)m=r[x],g=r[x+1],m<c&&(c=m),g<l&&(l=g),m>h&&(h=m),g>p&&(p=g);v=Math.max(h-c,p-l),v=0!==v?1/v:0}return $o(a,o,t,c,l,v),o}(n,i);for(let l=0;l<c.length;l+=3)a.push(c.slice(l,l+3));return a}}function Rf(r){const e=r.length;e>2&&r[e-1].equals(r[0])&&r.pop()}function Af(r,e){for(let t=0;t<e.length;t++)r.push(e[t].x),r.push(e[t].y)}class vs extends zn{constructor(e=new ms([new st(.5,.5),new st(-.5,.5),new st(-.5,-.5),new st(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,i=[],a=[];for(let c=0,l=e.length;c<l;c++)o(e[c]);function o(c){const l=[],h=void 0!==t.curveSegments?t.curveSegments:12,p=void 0!==t.steps?t.steps:1;let m=void 0!==t.depth?t.depth:1,g=void 0===t.bevelEnabled||t.bevelEnabled,v=void 0!==t.bevelThickness?t.bevelThickness:.2,x=void 0!==t.bevelSize?t.bevelSize:v-.1,T=void 0!==t.bevelOffset?t.bevelOffset:0,L=void 0!==t.bevelSegments?t.bevelSegments:3;const E=t.extrudePath,_=void 0!==t.UVGenerator?t.UVGenerator:ev;void 0!==t.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),m=t.amount);let D,G,$,fe,Me,R=!1;E&&(D=E.getSpacedPoints(p),R=!0,g=!1,G=E.computeFrenetFrames(p,!1),$=new O,fe=new O,Me=new O),g||(L=0,v=0,x=0,T=0);const Je=c.extractPoints(h);let ke=Je.shape;const be=Je.holes;if(!gs.isClockWise(ke)){ke=ke.reverse();for(let it=0,wt=be.length;it<wt;it++){const Ft=be[it];gs.isClockWise(Ft)&&(be[it]=Ft.reverse())}}const Z=gs.triangulateShape(ke,be),ze=ke;for(let it=0,wt=be.length;it<wt;it++)ke=ke.concat(be[it]);function Xe(it,wt,Ft){return wt||console.error("THREE.ExtrudeGeometry: vec does not exist"),wt.clone().multiplyScalar(Ft).add(it)}const Le=ke.length,je=Z.length;function Gt(it,wt,Ft){let an,Xt,Vn;const Wn=it.x-wt.x,ai=it.y-wt.y,Hi=Ft.x-it.x,ne=Ft.y-it.y,Y=Wn*Wn+ai*ai;if(Math.abs(Wn*ne-ai*Hi)>Number.EPSILON){const Mt=Math.sqrt(Y),Vt=Math.sqrt(Hi*Hi+ne*ne),bt=wt.x-ai/Mt,Bn=wt.y+Wn/Mt,pe=((Ft.x-ne/Vt-bt)*ne-(Ft.y+Hi/Vt-Bn)*Hi)/(Wn*ne-ai*Hi);an=bt+Wn*pe-it.x,Xt=Bn+ai*pe-it.y;const Nt=an*an+Xt*Xt;if(Nt<=2)return new st(an,Xt);Vn=Math.sqrt(Nt/2)}else{let Mt=!1;Wn>Number.EPSILON?Hi>Number.EPSILON&&(Mt=!0):Wn<-Number.EPSILON?Hi<-Number.EPSILON&&(Mt=!0):Math.sign(ai)===Math.sign(ne)&&(Mt=!0),Mt?(an=-ai,Xt=Wn,Vn=Math.sqrt(Y)):(an=Wn,Xt=ai,Vn=Math.sqrt(Y/2))}return new st(an/Vn,Xt/Vn)}const Jt=[];for(let it=0,wt=ze.length,Ft=wt-1,an=it+1;it<wt;it++,Ft++,an++)Ft===wt&&(Ft=0),an===wt&&(an=0),Jt[it]=Gt(ze[it],ze[Ft],ze[an]);const ot=[];let ht,$t=Jt.concat();for(let it=0,wt=be.length;it<wt;it++){const Ft=be[it];ht=[];for(let an=0,Xt=Ft.length,Vn=Xt-1,Wn=an+1;an<Xt;an++,Vn++,Wn++)Vn===Xt&&(Vn=0),Wn===Xt&&(Wn=0),ht[an]=Gt(Ft[an],Ft[Vn],Ft[Wn]);ot.push(ht),$t=$t.concat(ht)}for(let it=0;it<L;it++){const wt=it/L,Ft=v*Math.cos(wt*Math.PI/2),an=x*Math.sin(wt*Math.PI/2)+T;for(let Xt=0,Vn=ze.length;Xt<Vn;Xt++){const Wn=Xe(ze[Xt],Jt[Xt],an);Qn(Wn.x,Wn.y,-Ft)}for(let Xt=0,Vn=be.length;Xt<Vn;Xt++){const Wn=be[Xt];ht=ot[Xt];for(let ai=0,Hi=Wn.length;ai<Hi;ai++){const ne=Xe(Wn[ai],ht[ai],an);Qn(ne.x,ne.y,-Ft)}}}const qt=x+T;for(let it=0;it<Le;it++){const wt=g?Xe(ke[it],$t[it],qt):ke[it];R?(fe.copy(G.normals[0]).multiplyScalar(wt.x),$.copy(G.binormals[0]).multiplyScalar(wt.y),Me.copy(D[0]).add(fe).add($),Qn(Me.x,Me.y,Me.z)):Qn(wt.x,wt.y,0)}for(let it=1;it<=p;it++)for(let wt=0;wt<Le;wt++){const Ft=g?Xe(ke[wt],$t[wt],qt):ke[wt];R?(fe.copy(G.normals[it]).multiplyScalar(Ft.x),$.copy(G.binormals[it]).multiplyScalar(Ft.y),Me.copy(D[it]).add(fe).add($),Qn(Me.x,Me.y,Me.z)):Qn(Ft.x,Ft.y,m/p*it)}for(let it=L-1;it>=0;it--){const wt=it/L,Ft=v*Math.cos(wt*Math.PI/2),an=x*Math.sin(wt*Math.PI/2)+T;for(let Xt=0,Vn=ze.length;Xt<Vn;Xt++){const Wn=Xe(ze[Xt],Jt[Xt],an);Qn(Wn.x,Wn.y,m+Ft)}for(let Xt=0,Vn=be.length;Xt<Vn;Xt++){const Wn=be[Xt];ht=ot[Xt];for(let ai=0,Hi=Wn.length;ai<Hi;ai++){const ne=Xe(Wn[ai],ht[ai],an);R?Qn(ne.x,ne.y+D[p-1].y,D[p-1].x+Ft):Qn(ne.x,ne.y,m+Ft)}}}function Ae(it,wt){let Ft=it.length;for(;--Ft>=0;){const an=Ft;let Xt=Ft-1;Xt<0&&(Xt=it.length-1);for(let Vn=0,Wn=p+2*L;Vn<Wn;Vn++){const ai=Le*Vn,Hi=Le*(Vn+1);vn(wt+an+ai,wt+Xt+ai,wt+Xt+Hi,wt+an+Hi)}}}function Qn(it,wt,Ft){l.push(it),l.push(wt),l.push(Ft)}function Mn(it,wt,Ft){En(it),En(wt),En(Ft);const an=i.length/3,Xt=_.generateTopUV(n,i,an-3,an-2,an-1);Ei(Xt[0]),Ei(Xt[1]),Ei(Xt[2])}function vn(it,wt,Ft,an){En(it),En(wt),En(an),En(wt),En(Ft),En(an);const Xt=i.length/3,Vn=_.generateSideWallUV(n,i,Xt-6,Xt-3,Xt-2,Xt-1);Ei(Vn[0]),Ei(Vn[1]),Ei(Vn[3]),Ei(Vn[1]),Ei(Vn[2]),Ei(Vn[3])}function En(it){i.push(l[3*it+0]),i.push(l[3*it+1]),i.push(l[3*it+2])}function Ei(it){a.push(it.x),a.push(it.y)}(function ln(){const it=i.length/3;if(g){let wt=0,Ft=Le*wt;for(let an=0;an<je;an++){const Xt=Z[an];Mn(Xt[2]+Ft,Xt[1]+Ft,Xt[0]+Ft)}wt=p+2*L,Ft=Le*wt;for(let an=0;an<je;an++){const Xt=Z[an];Mn(Xt[0]+Ft,Xt[1]+Ft,Xt[2]+Ft)}}else{for(let wt=0;wt<je;wt++){const Ft=Z[wt];Mn(Ft[2],Ft[1],Ft[0])}for(let wt=0;wt<je;wt++){const Ft=Z[wt];Mn(Ft[0]+Le*p,Ft[1]+Le*p,Ft[2]+Le*p)}}n.addGroup(it,i.length/3-it,0)})(),function fi(){const it=i.length/3;let wt=0;Ae(ze,wt),wt+=ze.length;for(let Ft=0,an=be.length;Ft<an;Ft++){const Xt=be[Ft];Ae(Xt,wt),wt+=Xt.length}n.addGroup(it,i.length/3-it,1)}()}this.setAttribute("position",new on(i,3)),this.setAttribute("uv",new on(a,2)),this.computeVertexNormals()}toJSON(){const e=super.toJSON();return function tv(r,e,t){if(t.shapes=[],Array.isArray(r))for(let n=0,i=r.length;n<i;n++)t.shapes.push(r[n].uuid);else t.shapes.push(r.uuid);return void 0!==e.extrudePath&&(t.options.extrudePath=e.extrudePath.toJSON()),t}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){const n=[];for(let a=0,o=e.shapes.length;a<o;a++)n.push(t[e.shapes[a]]);const i=e.options.extrudePath;return void 0!==i&&(e.options.extrudePath=(new gu[i.type]).fromJSON(i)),new vs(n,e.options)}}const ev={generateTopUV:function(r,e,t,n,i){const c=e[3*n],l=e[3*n+1],h=e[3*i],p=e[3*i+1];return[new st(e[3*t],e[3*t+1]),new st(c,l),new st(h,p)]},generateSideWallUV:function(r,e,t,n,i,a){const o=e[3*t],c=e[3*t+1],l=e[3*t+2],h=e[3*n],p=e[3*n+1],m=e[3*n+2],g=e[3*i],v=e[3*i+1],x=e[3*i+2],T=e[3*a],L=e[3*a+1],E=e[3*a+2];return Math.abs(c-p)<Math.abs(o-h)?[new st(o,1-l),new st(h,1-m),new st(g,1-x),new st(T,1-E)]:[new st(c,1-l),new st(p,1-m),new st(v,1-x),new st(L,1-E)]}};class po extends ps{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new po(e.radius,e.detail)}}class mo extends zn{constructor(e=[new st(0,.5),new st(.5,0),new st(0,-.5)],t=12,n=0,i=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:i},t=Math.floor(t),i=ji(i,0,2*Math.PI);const a=[],o=[],c=[],l=[],h=[],p=1/t,m=new O,g=new st,v=new O,x=new O,T=new O;let L=0,E=0;for(let _=0;_<=e.length-1;_++)switch(_){case 0:L=e[_+1].x-e[_].x,E=e[_+1].y-e[_].y,v.x=1*E,v.y=-L,v.z=0*E,T.copy(v),v.normalize(),l.push(v.x,v.y,v.z);break;case e.length-1:l.push(T.x,T.y,T.z);break;default:L=e[_+1].x-e[_].x,E=e[_+1].y-e[_].y,v.x=1*E,v.y=-L,v.z=0*E,x.copy(v),v.x+=T.x,v.y+=T.y,v.z+=T.z,v.normalize(),l.push(v.x,v.y,v.z),T.copy(x)}for(let _=0;_<=t;_++){const D=n+_*p*i,R=Math.sin(D),G=Math.cos(D);for(let $=0;$<=e.length-1;$++)m.x=e[$].x*R,m.y=e[$].y,m.z=e[$].x*G,o.push(m.x,m.y,m.z),g.x=_/t,g.y=$/(e.length-1),c.push(g.x,g.y),h.push(l[3*$+0]*R,l[3*$+1],l[3*$+0]*G)}for(let _=0;_<t;_++)for(let D=0;D<e.length-1;D++){const R=D+_*e.length,$=R+e.length,fe=R+e.length+1,Me=R+1;a.push(R,$,Me),a.push($,fe,Me)}this.setIndex(a),this.setAttribute("position",new on(o,3)),this.setAttribute("uv",new on(c,2)),this.setAttribute("normal",new on(h,3))}static fromJSON(e){return new mo(e.points,e.segments,e.phiStart,e.phiLength)}}class ba extends ps{constructor(e=1,t=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new ba(e.radius,e.detail)}}class go extends zn{constructor(e=.5,t=1,n=8,i=1,a=0,o=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:i,thetaStart:a,thetaLength:o},n=Math.max(3,n);const c=[],l=[],h=[],p=[];let m=e;const g=(t-e)/(i=Math.max(1,i)),v=new O,x=new st;for(let T=0;T<=i;T++){for(let L=0;L<=n;L++){const E=a+L/n*o;v.x=m*Math.cos(E),v.y=m*Math.sin(E),l.push(v.x,v.y,v.z),h.push(0,0,1),x.x=(v.x/t+1)/2,x.y=(v.y/t+1)/2,p.push(x.x,x.y)}m+=g}for(let T=0;T<i;T++){const L=T*(n+1);for(let E=0;E<n;E++){const _=E+L,R=_+n+1,G=_+n+2,$=_+1;c.push(_,R,$),c.push(R,G,$)}}this.setIndex(c),this.setAttribute("position",new on(l,3)),this.setAttribute("normal",new on(h,3)),this.setAttribute("uv",new on(p,2))}static fromJSON(e){return new go(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class Ma extends zn{constructor(e=new ms([new st(0,.5),new st(-.5,-.5),new st(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],i=[],a=[],o=[];let c=0,l=0;if(!1===Array.isArray(e))h(e);else for(let p=0;p<e.length;p++)h(e[p]),this.addGroup(c,l,p),c+=l,l=0;function h(p){const m=i.length/3,g=p.extractPoints(t);let v=g.shape;const x=g.holes;!1===gs.isClockWise(v)&&(v=v.reverse());for(let L=0,E=x.length;L<E;L++){const _=x[L];!0===gs.isClockWise(_)&&(x[L]=_.reverse())}const T=gs.triangulateShape(v,x);for(let L=0,E=x.length;L<E;L++)v=v.concat(x[L]);for(let L=0,E=v.length;L<E;L++){const _=v[L];i.push(_.x,_.y,0),a.push(0,0,1),o.push(_.x,_.y)}for(let L=0,E=T.length;L<E;L++){const _=T[L];n.push(_[0]+m,_[1]+m,_[2]+m),l+=3}}this.setIndex(n),this.setAttribute("position",new on(i,3)),this.setAttribute("normal",new on(a,3)),this.setAttribute("uv",new on(o,2))}toJSON(){const e=super.toJSON();return function nv(r,e){if(e.shapes=[],Array.isArray(r))for(let t=0,n=r.length;t<n;t++)e.shapes.push(r[t].uuid);else e.shapes.push(r.uuid);return e}(this.parameters.shapes,e)}static fromJSON(e,t){const n=[];for(let i=0,a=e.shapes.length;i<a;i++)n.push(t[e.shapes[i]]);return new Ma(n,e.curveSegments)}}class Ta extends zn{constructor(e=1,t=32,n=16,i=0,a=2*Math.PI,o=0,c=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:a,thetaStart:o,thetaLength:c},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const l=Math.min(o+c,Math.PI);let h=0;const p=[],m=new O,g=new O,v=[],x=[],T=[],L=[];for(let E=0;E<=n;E++){const _=[],D=E/n;let R=0;0==E&&0==o?R=.5/t:E==n&&l==Math.PI&&(R=-.5/t);for(let G=0;G<=t;G++){const $=G/t;m.x=-e*Math.cos(i+$*a)*Math.sin(o+D*c),m.y=e*Math.cos(o+D*c),m.z=e*Math.sin(i+$*a)*Math.sin(o+D*c),x.push(m.x,m.y,m.z),g.copy(m).normalize(),T.push(g.x,g.y,g.z),L.push($+R,1-D),_.push(h++)}p.push(_)}for(let E=0;E<n;E++)for(let _=0;_<t;_++){const R=p[E][_],G=p[E+1][_],$=p[E+1][_+1];(0!==E||o>0)&&v.push(p[E][_+1],R,$),(E!==n-1||l<Math.PI)&&v.push(R,G,$)}this.setIndex(v),this.setAttribute("position",new on(x,3)),this.setAttribute("normal",new on(T,3)),this.setAttribute("uv",new on(L,2))}static fromJSON(e){return new Ta(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class vo extends ps{constructor(e=1,t=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new vo(e.radius,e.detail)}}class yo extends zn{constructor(e=1,t=.4,n=8,i=6,a=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:a},n=Math.floor(n),i=Math.floor(i);const o=[],c=[],l=[],h=[],p=new O,m=new O,g=new O;for(let v=0;v<=n;v++)for(let x=0;x<=i;x++){const T=x/i*a,L=v/n*Math.PI*2;m.x=(e+t*Math.cos(L))*Math.cos(T),m.y=(e+t*Math.cos(L))*Math.sin(T),m.z=t*Math.sin(L),c.push(m.x,m.y,m.z),p.x=e*Math.cos(T),p.y=e*Math.sin(T),g.subVectors(m,p).normalize(),l.push(g.x,g.y,g.z),h.push(x/i),h.push(v/n)}for(let v=1;v<=n;v++)for(let x=1;x<=i;x++){const L=(i+1)*(v-1)+x-1,E=(i+1)*(v-1)+x,_=(i+1)*v+x;o.push((i+1)*v+x-1,L,_),o.push(L,E,_)}this.setIndex(o),this.setAttribute("position",new on(c,3)),this.setAttribute("normal",new on(l,3)),this.setAttribute("uv",new on(h,2))}static fromJSON(e){return new yo(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class _o extends zn{constructor(e=1,t=.4,n=64,i=8,a=2,o=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:i,p:a,q:o},n=Math.floor(n),i=Math.floor(i);const c=[],l=[],h=[],p=[],m=new O,g=new O,v=new O,x=new O,T=new O,L=new O,E=new O;for(let D=0;D<=n;++D){const R=D/n*a*Math.PI*2;_(R,a,o,e,v),_(R+.01,a,o,e,x),L.subVectors(x,v),E.addVectors(x,v),T.crossVectors(L,E),E.crossVectors(T,L),T.normalize(),E.normalize();for(let G=0;G<=i;++G){const $=G/i*Math.PI*2,fe=-t*Math.cos($),Me=t*Math.sin($);m.x=v.x+(fe*E.x+Me*T.x),m.y=v.y+(fe*E.y+Me*T.y),m.z=v.z+(fe*E.z+Me*T.z),l.push(m.x,m.y,m.z),g.subVectors(m,v).normalize(),h.push(g.x,g.y,g.z),p.push(D/n),p.push(G/i)}}for(let D=1;D<=n;D++)for(let R=1;R<=i;R++){const $=(i+1)*D+(R-1),fe=(i+1)*D+R,Me=(i+1)*(D-1)+R;c.push((i+1)*(D-1)+(R-1),$,Me),c.push($,fe,Me)}function _(D,R,G,$,fe){const Me=Math.cos(D),Je=Math.sin(D),ke=G/R*D,be=Math.cos(ke);fe.x=$*(2+be)*.5*Me,fe.y=$*(2+be)*Je*.5,fe.z=$*Math.sin(ke)*.5}this.setIndex(c),this.setAttribute("position",new on(l,3)),this.setAttribute("normal",new on(h,3)),this.setAttribute("uv",new on(p,2))}static fromJSON(e){return new _o(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class xo extends zn{constructor(e=new ol(new O(-1,-1,0),new O(-1,1,0),new O(1,1,0)),t=64,n=1,i=8,a=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:i,closed:a};const o=e.computeFrenetFrames(t,a);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const c=new O,l=new O,h=new st;let p=new O;const m=[],g=[],v=[],x=[];function L(D){p=e.getPointAt(D/t,p);const R=o.normals[D],G=o.binormals[D];for(let $=0;$<=i;$++){const fe=$/i*Math.PI*2,Me=Math.sin(fe),Je=-Math.cos(fe);l.x=Je*R.x+Me*G.x,l.y=Je*R.y+Me*G.y,l.z=Je*R.z+Me*G.z,l.normalize(),g.push(l.x,l.y,l.z),c.x=p.x+n*l.x,c.y=p.y+n*l.y,c.z=p.z+n*l.z,m.push(c.x,c.y,c.z)}}(function T(){for(let D=0;D<t;D++)L(D);L(!1===a?t:0),function _(){for(let D=0;D<=t;D++)for(let R=0;R<=i;R++)h.x=D/t,h.y=R/i,v.push(h.x,h.y)}(),function E(){for(let D=1;D<=t;D++)for(let R=1;R<=i;R++){const $=(i+1)*D+(R-1),fe=(i+1)*D+R,Me=(i+1)*(D-1)+R;x.push((i+1)*(D-1)+(R-1),$,Me),x.push($,fe,Me)}}()})(),this.setIndex(x),this.setAttribute("position",new on(m,3)),this.setAttribute("normal",new on(g,3)),this.setAttribute("uv",new on(v,2))}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new xo((new gu[e.path.type]).fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class _u extends zn{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},null!==e){const t=[],n=new Set,i=new O,a=new O;if(null!==e.index){const o=e.attributes.position,c=e.index;let l=e.groups;0===l.length&&(l=[{start:0,count:c.count,materialIndex:0}]);for(let h=0,p=l.length;h<p;++h){const m=l[h],g=m.start;for(let x=g,T=g+m.count;x<T;x+=3)for(let L=0;L<3;L++){const E=c.getX(x+L),_=c.getX(x+(L+1)%3);i.fromBufferAttribute(o,E),a.fromBufferAttribute(o,_),!0===zf(i,a,n)&&(t.push(i.x,i.y,i.z),t.push(a.x,a.y,a.z))}}}else{const o=e.attributes.position;for(let c=0,l=o.count/3;c<l;c++)for(let h=0;h<3;h++){const m=3*c+(h+1)%3;i.fromBufferAttribute(o,3*c+h),a.fromBufferAttribute(o,m),!0===zf(i,a,n)&&(t.push(i.x,i.y,i.z),t.push(a.x,a.y,a.z))}}this.setAttribute("position",new on(t,3))}}}function zf(r,e,t){const n=`${r.x},${r.y},${r.z}-${e.x},${e.y},${e.z}`,i=`${e.x},${e.y},${e.z}-${r.x},${r.y},${r.z}`;return!0!==t.has(n)&&!0!==t.has(i)&&(t.add(n,i),!0)}var Lf=Object.freeze({__proto__:null,BoxGeometry:Ps,BoxBufferGeometry:Ps,CircleGeometry:lo,CircleBufferGeometry:lo,ConeGeometry:uo,ConeBufferGeometry:uo,CylinderGeometry:sa,CylinderBufferGeometry:sa,DodecahedronGeometry:ho,DodecahedronBufferGeometry:ho,EdgesGeometry:cu,ExtrudeGeometry:vs,ExtrudeBufferGeometry:vs,IcosahedronGeometry:po,IcosahedronBufferGeometry:po,LatheGeometry:mo,LatheBufferGeometry:mo,OctahedronGeometry:ba,OctahedronBufferGeometry:ba,PlaneGeometry:pa,PlaneBufferGeometry:pa,PolyhedronGeometry:ps,PolyhedronBufferGeometry:ps,RingGeometry:go,RingBufferGeometry:go,ShapeGeometry:Ma,ShapeBufferGeometry:Ma,SphereGeometry:Ta,SphereBufferGeometry:Ta,TetrahedronGeometry:vo,TetrahedronBufferGeometry:vo,TorusGeometry:yo,TorusBufferGeometry:yo,TorusKnotGeometry:_o,TorusKnotBufferGeometry:_o,TubeGeometry:xo,TubeBufferGeometry:xo,WireframeGeometry:_u});class xu extends rr{constructor(e){super(),this.type="ShadowMaterial",this.color=new Wt(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}}xu.prototype.isShadowMaterial=!0;class fl extends rr{constructor(e){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Wt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Wt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Bt,this.normalScale=new st(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}fl.prototype.isMeshStandardMaterial=!0;class Eu extends fl{constructor(e){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new st(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return ji(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.sheenColor=new Wt(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new Wt(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Wt(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(e)}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}Eu.prototype.isMeshPhysicalMaterial=!0;class bu extends rr{constructor(e){super(),this.type="MeshPhongMaterial",this.color=new Wt(16777215),this.specular=new Wt(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Wt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Bt,this.normalScale=new st(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Nn,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}bu.prototype.isMeshPhongMaterial=!0;class Mu extends rr{constructor(e){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Wt(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Wt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Bt,this.normalScale=new st(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}Mu.prototype.isMeshToonMaterial=!0;class Tu extends rr{constructor(e){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Bt,this.normalScale=new st(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}Tu.prototype.isMeshNormalMaterial=!0;class wu extends rr{constructor(e){super(),this.type="MeshLambertMaterial",this.color=new Wt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Wt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Nn,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}wu.prototype.isMeshLambertMaterial=!0;class Su extends rr{constructor(e){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Wt(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Bt,this.normalScale=new st(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this}}Su.prototype.isMeshMatcapMaterial=!0;class Ru extends or{constructor(e){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}Ru.prototype.isLineDashedMaterial=!0;var iv=Object.freeze({__proto__:null,ShadowMaterial:xu,SpriteMaterial:Gc,RawShaderMaterial:eo,ShaderMaterial:Fs,PointsMaterial:Ea,MeshPhysicalMaterial:Eu,MeshStandardMaterial:fl,MeshPhongMaterial:bu,MeshToonMaterial:Mu,MeshNormalMaterial:Tu,MeshLambertMaterial:wu,MeshDepthMaterial:Bc,MeshDistanceMaterial:Oc,MeshBasicMaterial:Cs,MeshMatcapMaterial:Su,LineDashedMaterial:Ru,LineBasicMaterial:or,Material:rr});const Oi={arraySlice:function(r,e,t){return Oi.isTypedArray(r)?new r.constructor(r.subarray(e,void 0!==t?t:r.length)):r.slice(e,t)},convertArray:function(r,e,t){return!r||!t&&r.constructor===e?r:"number"==typeof e.BYTES_PER_ELEMENT?new e(r):Array.prototype.slice.call(r)},isTypedArray:function(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)},getKeyframeOrder:function(r){const t=r.length,n=new Array(t);for(let i=0;i!==t;++i)n[i]=i;return n.sort(function e(i,a){return r[i]-r[a]}),n},sortedArray:function(r,e,t){const n=r.length,i=new r.constructor(n);for(let a=0,o=0;o!==n;++a){const c=t[a]*e;for(let l=0;l!==e;++l)i[o++]=r[c+l]}return i},flattenJSON:function(r,e,t,n){let i=1,a=r[0];for(;void 0!==a&&void 0===a[n];)a=r[i++];if(void 0===a)return;let o=a[n];if(void 0!==o)if(Array.isArray(o))do{o=a[n],void 0!==o&&(e.push(a.time),t.push.apply(t,o)),a=r[i++]}while(void 0!==a);else if(void 0!==o.toArray)do{o=a[n],void 0!==o&&(e.push(a.time),o.toArray(t,t.length)),a=r[i++]}while(void 0!==a);else do{o=a[n],void 0!==o&&(e.push(a.time),t.push(o)),a=r[i++]}while(void 0!==a)},subclip:function(r,e,t,n,i=30){const a=r.clone();a.name=e;const o=[];for(let l=0;l<a.tracks.length;++l){const h=a.tracks[l],p=h.getValueSize(),m=[],g=[];for(let v=0;v<h.times.length;++v){const x=h.times[v]*i;if(!(x<t||x>=n)){m.push(h.times[v]);for(let T=0;T<p;++T)g.push(h.values[v*p+T])}}0!==m.length&&(h.times=Oi.convertArray(m,h.times.constructor),h.values=Oi.convertArray(g,h.values.constructor),o.push(h))}a.tracks=o;let c=1/0;for(let l=0;l<a.tracks.length;++l)c>a.tracks[l].times[0]&&(c=a.tracks[l].times[0]);for(let l=0;l<a.tracks.length;++l)a.tracks[l].shift(-1*c);return a.resetDuration(),a},makeClipAdditive:function(r,e=0,t=r,n=30){n<=0&&(n=30);const i=t.tracks.length,a=e/n;for(let o=0;o<i;++o){const c=t.tracks[o],l=c.ValueTypeName;if("bool"===l||"string"===l)continue;const h=r.tracks.find(function(E){return E.name===c.name&&E.ValueTypeName===l});if(void 0===h)continue;let p=0;const m=c.getValueSize();c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(p=m/3);let g=0;const v=h.getValueSize();h.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(g=v/3);const x=c.times.length-1;let T;if(a<=c.times[0])T=Oi.arraySlice(c.values,p,m-p);else if(a>=c.times[x]){const E=x*m+p;T=Oi.arraySlice(c.values,E,E+m-p)}else{const E=c.createInterpolant(),_=p,D=m-p;E.evaluate(a),T=Oi.arraySlice(E.resultBuffer,_,D)}"quaternion"===l&&(new Ni).fromArray(T).normalize().conjugate().toArray(T);const L=h.times.length;for(let E=0;E<L;++E){const _=E*v+g;if("quaternion"===l)Ni.multiplyQuaternionsFlat(h.values,_,T,0,h.values,_);else{const D=v-2*g;for(let R=0;R<D;++R)h.values[_+R]-=T[R]}}}return r.blendMode=2501,r}};class Is{constructor(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,i=t[n],a=t[n-1];e:{t:{let o;n:{i:if(!(e<i)){for(let c=n+2;;){if(void 0===i){if(e<a)break i;return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,e,a)}if(n===c)break;if(a=i,i=t[++n],e<i)break t}o=t.length;break n}if(e>=a)break e;{const c=t[1];e<c&&(n=2,a=c);for(let l=n-2;;){if(void 0===a)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(n===l)break;if(i=a,a=t[--n-1],e>=a)break t}o=n,n=0}}for(;n<o;){const c=n+o>>>1;e<t[c]?o=c:n=c+1}if(i=t[n],a=t[n-1],void 0===a)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(void 0===i)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,a,e)}this._cachedIndex=n,this.intervalChanged_(n,a,i)}return this.interpolate_(n,a,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,a=e*i;for(let o=0;o!==i;++o)t[o]=n[a+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}Is.prototype.beforeStart_=Is.prototype.copySampleValue_,Is.prototype.afterEnd_=Is.prototype.copySampleValue_;class Cf extends Is{constructor(e,t,n,i){super(e,t,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:M,endingEnd:M}}intervalChanged_(e,t,n){const i=this.parameterPositions;let a=e-2,o=e+1,c=i[a],l=i[o];if(void 0===c)switch(this.getSettings_().endingStart){case F:a=e,c=2*t-n;break;case de:a=i.length-2,c=t+i[a]-i[a+1];break;default:a=e,c=n}if(void 0===l)switch(this.getSettings_().endingEnd){case F:o=e,l=2*n-t;break;case de:o=1,l=n+i[1]-i[0];break;default:o=e-1,l=t}const h=.5*(n-t),p=this.valueSize;this._weightPrev=h/(t-c),this._weightNext=h/(l-n),this._offsetPrev=a*p,this._offsetNext=o*p}interpolate_(e,t,n,i){const a=this.resultBuffer,o=this.sampleValues,c=this.valueSize,l=e*c,h=l-c,p=this._offsetPrev,m=this._offsetNext,g=this._weightPrev,v=this._weightNext,x=(n-t)/(i-t),T=x*x,L=T*x,E=-g*L+2*g*T-g*x,_=(1+g)*L+(-1.5-2*g)*T+(-.5+g)*x+1,D=(-1-v)*L+(1.5+v)*T+.5*x,R=v*L-v*T;for(let G=0;G!==c;++G)a[G]=E*o[p+G]+_*o[h+G]+D*o[l+G]+R*o[m+G];return a}}class Au extends Is{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const a=this.resultBuffer,o=this.sampleValues,c=this.valueSize,l=e*c,h=l-c,p=(n-t)/(i-t),m=1-p;for(let g=0;g!==c;++g)a[g]=o[h+g]*m+o[l+g]*p;return a}}class Pf extends Is{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e){return this.copySampleValue_(e-1)}}class rs{constructor(e,t,n,i){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Oi.convertArray(t,this.TimeBufferType),this.values=Oi.convertArray(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:Oi.convertArray(e.times,Array),values:Oi.convertArray(e.values,Array)};const i=e.getInterpolation();i!==e.DefaultInterpolation&&(n.interpolation=i)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new Pf(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Au(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new Cf(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case y:t=this.InterpolantFactoryMethodDiscrete;break;case u:t=this.InterpolantFactoryMethodLinear;break;case f:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(n);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return y;case this.InterpolantFactoryMethodLinear:return u;case this.InterpolantFactoryMethodSmooth:return f}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]*=e}return this}trim(e,t){const n=this.times,i=n.length;let a=0,o=i-1;for(;a!==i&&n[a]<e;)++a;for(;-1!==o&&n[o]>t;)--o;if(++o,0!==a||o!==i){a>=o&&(o=Math.max(o,1),a=o-1);const c=this.getValueSize();this.times=Oi.arraySlice(n,a,o),this.values=Oi.arraySlice(this.values,a*c,o*c)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,i=this.values,a=n.length;0===a&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let c=0;c!==a;c++){const l=n[c];if("number"==typeof l&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,c,l),e=!1;break}if(null!==o&&o>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,c,l,o),e=!1;break}o=l}if(void 0!==i&&Oi.isTypedArray(i))for(let c=0,l=i.length;c!==l;++c){const h=i[c];if(isNaN(h)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,c,h),e=!1;break}}return e}optimize(){const e=Oi.arraySlice(this.times),t=Oi.arraySlice(this.values),n=this.getValueSize(),i=this.getInterpolation()===f,a=e.length-1;let o=1;for(let c=1;c<a;++c){let l=!1;const h=e[c];if(h!==e[c+1]&&(1!==c||h!==e[0]))if(i)l=!0;else{const m=c*n,g=m-n,v=m+n;for(let x=0;x!==n;++x){const T=t[m+x];if(T!==t[g+x]||T!==t[v+x]){l=!0;break}}}if(l){if(c!==o){e[o]=e[c];const m=c*n,g=o*n;for(let v=0;v!==n;++v)t[g+v]=t[m+v]}++o}}if(a>0){e[o]=e[a];for(let c=a*n,l=o*n,h=0;h!==n;++h)t[l+h]=t[c+h];++o}return o!==e.length?(this.times=Oi.arraySlice(e,0,o),this.values=Oi.arraySlice(t,0,o*n)):(this.times=e,this.values=t),this}clone(){const e=Oi.arraySlice(this.times,0),t=Oi.arraySlice(this.values,0),i=new(0,this.constructor)(this.name,e,t);return i.createInterpolant=this.createInterpolant,i}}rs.prototype.TimeBufferType=Float32Array,rs.prototype.ValueBufferType=Float32Array,rs.prototype.DefaultInterpolation=u;class wa extends rs{}wa.prototype.ValueTypeName="bool",wa.prototype.ValueBufferType=Array,wa.prototype.DefaultInterpolation=y,wa.prototype.InterpolantFactoryMethodLinear=void 0,wa.prototype.InterpolantFactoryMethodSmooth=void 0;class zu extends rs{}zu.prototype.ValueTypeName="color";class tc extends rs{}tc.prototype.ValueTypeName="number";class Ff extends Is{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const a=this.resultBuffer,o=this.sampleValues,c=this.valueSize,l=(n-t)/(i-t);let h=e*c;for(let p=h+c;h!==p;h+=4)Ni.slerpFlat(a,0,o,h-c,o,h,l);return a}}class Eo extends rs{InterpolantFactoryMethodLinear(e){return new Ff(this.times,this.values,this.getValueSize(),e)}}Eo.prototype.ValueTypeName="quaternion",Eo.prototype.DefaultInterpolation=u,Eo.prototype.InterpolantFactoryMethodSmooth=void 0;class Sa extends rs{}Sa.prototype.ValueTypeName="string",Sa.prototype.ValueBufferType=Array,Sa.prototype.DefaultInterpolation=y,Sa.prototype.InterpolantFactoryMethodLinear=void 0,Sa.prototype.InterpolantFactoryMethodSmooth=void 0;class nc extends rs{}nc.prototype.ValueTypeName="vector";class ic{constructor(e,t=-1,n,i=2500){this.name=e,this.tracks=n,this.duration=t,this.blendMode=i,this.uuid=er(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,i=1/(e.fps||1);for(let o=0,c=n.length;o!==c;++o)t.push(sv(n[o]).scale(i));const a=new this(e.name,e.duration,t,e.blendMode);return a.uuid=e.uuid,a}static toJSON(e){const t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let a=0,o=n.length;a!==o;++a)t.push(rs.toJSON(n[a]));return i}static CreateFromMorphTargetSequence(e,t,n,i){const a=t.length,o=[];for(let c=0;c<a;c++){let l=[],h=[];l.push((c+a-1)%a,c,(c+1)%a),h.push(0,1,0);const p=Oi.getKeyframeOrder(l);l=Oi.sortedArray(l,1,p),h=Oi.sortedArray(h,1,p),!i&&0===l[0]&&(l.push(a),h.push(h[0])),o.push(new tc(".morphTargetInfluences["+t[c].name+"]",l,h).scale(1/n))}return new this(e,-1,o)}static findByName(e,t){let n=e;Array.isArray(e)||(n=e.geometry&&e.geometry.animations||e.animations);for(let i=0;i<n.length;i++)if(n[i].name===t)return n[i];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const i={},a=/^([\w-]*?)([\d]+)$/;for(let c=0,l=e.length;c<l;c++){const h=e[c],p=h.name.match(a);if(p&&p.length>1){const m=p[1];let g=i[m];g||(i[m]=g=[]),g.push(h)}}const o=[];for(const c in i)o.push(this.CreateFromMorphTargetSequence(c,i[c],t,n));return o}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(m,g,v,x,T){if(0!==v.length){const L=[],E=[];Oi.flattenJSON(v,L,E,x),0!==L.length&&T.push(new m(g,L,E))}},i=[],a=e.name||"default",o=e.fps||30,c=e.blendMode;let l=e.length||-1;const h=e.hierarchy||[];for(let m=0;m<h.length;m++){const g=h[m].keys;if(g&&0!==g.length)if(g[0].morphTargets){const v={};let x;for(x=0;x<g.length;x++)if(g[x].morphTargets)for(let T=0;T<g[x].morphTargets.length;T++)v[g[x].morphTargets[T]]=-1;for(const T in v){const L=[],E=[];for(let _=0;_!==g[x].morphTargets.length;++_){const D=g[x];L.push(D.time),E.push(D.morphTarget===T?1:0)}i.push(new tc(".morphTargetInfluence["+T+"]",L,E))}l=v.length*(o||1)}else{const v=".bones["+t[m].name+"]";n(nc,v+".position",g,"pos",i),n(Eo,v+".quaternion",g,"rot",i),n(nc,v+".scale",g,"scl",i)}}return 0===i.length?null:new this(a,l,i,c)}resetDuration(){let t=0;for(let n=0,i=this.tracks.length;n!==i;++n){const a=this.tracks[n];t=Math.max(t,a.times[a.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function sv(r){if(void 0===r.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function rv(r){switch(r.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return tc;case"vector":case"vector2":case"vector3":case"vector4":return nc;case"color":return zu;case"quaternion":return Eo;case"bool":case"boolean":return wa;case"string":return Sa}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+r)}(r.type);if(void 0===r.times){const t=[],n=[];Oi.flattenJSON(r.keys,t,n,"value"),r.times=t,r.values=n}return void 0!==e.parse?e.parse(r):new e(r.name,r.times,r.values,r.interpolation)}const Ra={enabled:!1,files:{},add:function(r,e){!1!==this.enabled&&(this.files[r]=e)},get:function(r){if(!1!==this.enabled)return this.files[r]},remove:function(r){delete this.files[r]},clear:function(){this.files={}}};class Lu{constructor(e,t,n){const i=this;let l,a=!1,o=0,c=0;const h=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(p){c++,!1===a&&void 0!==i.onStart&&i.onStart(p,o,c),a=!0},this.itemEnd=function(p){o++,void 0!==i.onProgress&&i.onProgress(p,o,c),o===c&&(a=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(p){void 0!==i.onError&&i.onError(p)},this.resolveURL=function(p){return l?l(p):p},this.setURLModifier=function(p){return l=p,this},this.addHandler=function(p,m){return h.push(p,m),this},this.removeHandler=function(p){const m=h.indexOf(p);return-1!==m&&h.splice(m,2),this},this.getHandler=function(p){for(let m=0,g=h.length;m<g;m+=2){const v=h[m],x=h[m+1];if(v.global&&(v.lastIndex=0),v.test(p))return x}return null}}}const Df=new Lu;class Rr{constructor(e){this.manager=void 0!==e?e:Df,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise(function(i,a){n.load(e,i,t,a)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const Ns={};class ys extends Rr{constructor(e){super(e)}load(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const a=Ra.get(e);if(void 0!==a)return this.manager.itemStart(e),setTimeout(()=>{t&&t(a),this.manager.itemEnd(e)},0),a;if(void 0!==Ns[e])return void Ns[e].push({onLoad:t,onProgress:n,onError:i});Ns[e]=[],Ns[e].push({onLoad:t,onProgress:n,onError:i});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"});fetch(o).then(c=>{if(200===c.status||0===c.status){if(0===c.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||void 0===c.body.getReader)return c;const l=Ns[e],h=c.body.getReader(),p=c.headers.get("Content-Length"),m=p?parseInt(p):0,g=0!==m;let v=0;const x=new ReadableStream({start(T){!function L(){h.read().then(({done:E,value:_})=>{if(E)T.close();else{v+=_.byteLength;const D=new ProgressEvent("progress",{lengthComputable:g,loaded:v,total:m});for(let R=0,G=l.length;R<G;R++){const $=l[R];$.onProgress&&$.onProgress(D)}T.enqueue(_),L()}})}()}});return new Response(x)}throw Error(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`)}).then(c=>{switch(this.responseType){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(l=>(new DOMParser).parseFromString(l,this.mimeType));case"json":return c.json();default:return c.text()}}).then(c=>{Ra.add(e,c);const l=Ns[e];delete Ns[e];for(let h=0,p=l.length;h<p;h++){const m=l[h];m.onLoad&&m.onLoad(c)}}).catch(c=>{const l=Ns[e];if(void 0===l)throw this.manager.itemError(e),c;delete Ns[e];for(let h=0,p=l.length;h<p;h++){const m=l[h];m.onError&&m.onError(c)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class rc extends Rr{constructor(e){super(e)}load(e,t,n,i){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const a=this,o=Ra.get(e);if(void 0!==o)return a.manager.itemStart(e),setTimeout(function(){t&&t(o),a.manager.itemEnd(e)},0),o;const c=Oa("img");function l(){p(),Ra.add(e,this),t&&t(this),a.manager.itemEnd(e)}function h(m){p(),i&&i(m),a.manager.itemError(e),a.manager.itemEnd(e)}function p(){c.removeEventListener("load",l,!1),c.removeEventListener("error",h,!1)}return c.addEventListener("load",l,!1),c.addEventListener("error",h,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(c.crossOrigin=this.crossOrigin),a.manager.itemStart(e),c.src=e,c}}class If extends Rr{constructor(e){super(e)}load(e,t,n,i){const a=new $a,o=new rc(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let c=0;function l(h){o.load(e[h],function(p){a.images[h]=p,c++,6===c&&(a.needsUpdate=!0,t&&t(a))},void 0,i)}for(let h=0;h<e.length;++h)l(h);return a}}class Nf extends Rr{constructor(e){super(e)}load(e,t,n,i){const a=this,o=new _a,c=new ys(this.manager);return c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setPath(this.path),c.setWithCredentials(a.withCredentials),c.load(e,function(l){const h=a.parse(l);h&&(void 0!==h.image?o.image=h.image:void 0!==h.data&&(o.image.width=h.width,o.image.height=h.height,o.image.data=h.data),o.wrapS=void 0!==h.wrapS?h.wrapS:St,o.wrapT=void 0!==h.wrapT?h.wrapT:St,o.magFilter=void 0!==h.magFilter?h.magFilter:Cn,o.minFilter=void 0!==h.minFilter?h.minFilter:Cn,o.anisotropy=void 0!==h.anisotropy?h.anisotropy:1,void 0!==h.encoding&&(o.encoding=h.encoding),void 0!==h.flipY&&(o.flipY=h.flipY),void 0!==h.format&&(o.format=h.format),void 0!==h.type&&(o.type=h.type),void 0!==h.mipmaps&&(o.mipmaps=h.mipmaps,o.minFilter=Dr),1===h.mipmapCount&&(o.minFilter=Cn),void 0!==h.generateMipmaps&&(o.generateMipmaps=h.generateMipmaps),o.needsUpdate=!0,t&&t(o,h))},n,i),o}}class Uf extends Rr{constructor(e){super(e)}load(e,t,n,i){const a=new zi,o=new rc(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(c){a.image=c,a.needsUpdate=!0,void 0!==t&&t(a)},n,i),a}}class ss extends li{constructor(e,t=1){super(),this.type="Light",this.color=new Wt(e),this.intensity=t}dispose(){}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}ss.prototype.isLight=!0;class Cu extends ss{constructor(e,t,n){super(e,n),this.type="HemisphereLight",this.position.copy(li.DefaultUp),this.updateMatrix(),this.groundColor=new Wt(t)}copy(e){return ss.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}Cu.prototype.isHemisphereLight=!0;const Bf=new fn,Of=new O,Hf=new O;class Pu{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new st(512,512),this.map=null,this.mapPass=null,this.matrix=new fn,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new No,this._frameExtents=new st(1,1),this._viewportCount=1,this._viewports=[new rn(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;Of.setFromMatrixPosition(e.matrixWorld),t.position.copy(Of),Hf.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Hf),t.updateMatrixWorld(),Bf.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Bf),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),(512!==this.mapSize.x||512!==this.mapSize.y)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class kf extends Pu{constructor(){super(new ar(50,1,.5,500)),this.focus=1}updateMatrices(e){const t=this.camera,n=2*cs*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,a=e.distance||t.far;(n!==t.fov||i!==t.aspect||a!==t.far)&&(t.fov=n,t.aspect=i,t.far=a,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}kf.prototype.isSpotLightShadow=!0;class Fu extends ss{constructor(e,t,n=0,i=Math.PI/3,a=0,o=1){super(e,t),this.type="SpotLight",this.position.copy(li.DefaultUp),this.updateMatrix(),this.target=new li,this.distance=n,this.angle=i,this.penumbra=a,this.decay=o,this.shadow=new kf}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}Fu.prototype.isSpotLight=!0;const Gf=new fn,sc=new O,Du=new O;class Vf extends Pu{constructor(){super(new ar(90,1,.5,500)),this._frameExtents=new st(4,2),this._viewportCount=6,this._viewports=[new rn(2,1,1,1),new rn(0,1,1,1),new rn(3,1,1,1),new rn(1,1,1,1),new rn(3,0,1,1),new rn(1,0,1,1)],this._cubeDirections=[new O(1,0,0),new O(-1,0,0),new O(0,0,1),new O(0,0,-1),new O(0,1,0),new O(0,-1,0)],this._cubeUps=[new O(0,1,0),new O(0,1,0),new O(0,1,0),new O(0,1,0),new O(0,0,1),new O(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,i=this.matrix,a=e.distance||n.far;a!==n.far&&(n.far=a,n.updateProjectionMatrix()),sc.setFromMatrixPosition(e.matrixWorld),n.position.copy(sc),Du.copy(n.position),Du.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(Du),n.updateMatrixWorld(),i.makeTranslation(-sc.x,-sc.y,-sc.z),Gf.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Gf)}}Vf.prototype.isPointLightShadow=!0;class Iu extends ss{constructor(e,t,n=0,i=1){super(e,t),this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new Vf}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}Iu.prototype.isPointLight=!0;class Wf extends Pu{constructor(){super(new Uo(-5,5,5,-5,.5,500))}}Wf.prototype.isDirectionalLightShadow=!0;class Nu extends ss{constructor(e,t){super(e,t),this.type="DirectionalLight",this.position.copy(li.DefaultUp),this.updateMatrix(),this.target=new li,this.shadow=new Wf}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}Nu.prototype.isDirectionalLight=!0;class Uu extends ss{constructor(e,t){super(e,t),this.type="AmbientLight"}}Uu.prototype.isAmbientLight=!0;class Bu extends ss{constructor(e,t,n=10,i=10){super(e,t),this.type="RectAreaLight",this.width=n,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}Bu.prototype.isRectAreaLight=!0;class Ou{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new O)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,i=e.y,a=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*i),t.addScaledVector(o[2],.488603*a),t.addScaledVector(o[3],.488603*n),t.addScaledVector(o[4],n*i*1.092548),t.addScaledVector(o[5],i*a*1.092548),t.addScaledVector(o[6],.315392*(3*a*a-1)),t.addScaledVector(o[7],n*a*1.092548),t.addScaledVector(o[8],.546274*(n*n-i*i)),t}getIrradianceAt(e,t){const n=e.x,i=e.y,a=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],1.023328*i),t.addScaledVector(o[2],1.023328*a),t.addScaledVector(o[3],1.023328*n),t.addScaledVector(o[4],.858086*n*i),t.addScaledVector(o[5],.858086*i*a),t.addScaledVector(o[6],.743125*a*a-.247708),t.addScaledVector(o[7],.858086*n*a),t.addScaledVector(o[8],.429043*(n*n-i*i)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].fromArray(e,t+3*i);return this}toArray(e=[],t=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].toArray(e,t+3*i);return e}static getBasisAt(e,t){const n=e.x,i=e.y,a=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*a,t[3]=.488603*n,t[4]=1.092548*n*i,t[5]=1.092548*i*a,t[6]=.315392*(3*a*a-1),t[7]=1.092548*n*a,t[8]=.546274*(n*n-i*i)}}Ou.prototype.isSphericalHarmonics3=!0;class ac extends ss{constructor(e=new Ou,t=1){super(void 0,t),this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}ac.prototype.isLightProbe=!0;class Xf extends Rr{constructor(e){super(e),this.textures={}}load(e,t,n,i){const a=this,o=new ys(a.manager);o.setPath(a.path),o.setRequestHeader(a.requestHeader),o.setWithCredentials(a.withCredentials),o.load(e,function(c){try{t(a.parse(JSON.parse(c)))}catch(l){i?i(l):console.error(l),a.manager.itemError(e)}},n,i)}parse(e){const t=this.textures;function n(a){return void 0===t[a]&&console.warn("THREE.MaterialLoader: Undefined texture",a),t[a]}const i=new iv[e.type];if(void 0!==e.uuid&&(i.uuid=e.uuid),void 0!==e.name&&(i.name=e.name),void 0!==e.color&&void 0!==i.color&&i.color.setHex(e.color),void 0!==e.roughness&&(i.roughness=e.roughness),void 0!==e.metalness&&(i.metalness=e.metalness),void 0!==e.sheen&&(i.sheen=e.sheen),void 0!==e.sheenColor&&(i.sheenColor=(new Wt).setHex(e.sheenColor)),void 0!==e.sheenRoughness&&(i.sheenRoughness=e.sheenRoughness),void 0!==e.emissive&&void 0!==i.emissive&&i.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==i.specular&&i.specular.setHex(e.specular),void 0!==e.specularIntensity&&(i.specularIntensity=e.specularIntensity),void 0!==e.specularColor&&void 0!==i.specularColor&&i.specularColor.setHex(e.specularColor),void 0!==e.shininess&&(i.shininess=e.shininess),void 0!==e.clearcoat&&(i.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(i.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.transmission&&(i.transmission=e.transmission),void 0!==e.thickness&&(i.thickness=e.thickness),void 0!==e.attenuationDistance&&(i.attenuationDistance=e.attenuationDistance),void 0!==e.attenuationColor&&void 0!==i.attenuationColor&&i.attenuationColor.setHex(e.attenuationColor),void 0!==e.fog&&(i.fog=e.fog),void 0!==e.flatShading&&(i.flatShading=e.flatShading),void 0!==e.blending&&(i.blending=e.blending),void 0!==e.combine&&(i.combine=e.combine),void 0!==e.side&&(i.side=e.side),void 0!==e.shadowSide&&(i.shadowSide=e.shadowSide),void 0!==e.opacity&&(i.opacity=e.opacity),void 0!==e.format&&(i.format=e.format),void 0!==e.transparent&&(i.transparent=e.transparent),void 0!==e.alphaTest&&(i.alphaTest=e.alphaTest),void 0!==e.depthTest&&(i.depthTest=e.depthTest),void 0!==e.depthWrite&&(i.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(i.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(i.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(i.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(i.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(i.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(i.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(i.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(i.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(i.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(i.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(i.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(i.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(i.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(i.rotation=e.rotation),1!==e.linewidth&&(i.linewidth=e.linewidth),void 0!==e.dashSize&&(i.dashSize=e.dashSize),void 0!==e.gapSize&&(i.gapSize=e.gapSize),void 0!==e.scale&&(i.scale=e.scale),void 0!==e.polygonOffset&&(i.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(i.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(i.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.dithering&&(i.dithering=e.dithering),void 0!==e.alphaToCoverage&&(i.alphaToCoverage=e.alphaToCoverage),void 0!==e.premultipliedAlpha&&(i.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.visible&&(i.visible=e.visible),void 0!==e.toneMapped&&(i.toneMapped=e.toneMapped),void 0!==e.userData&&(i.userData=e.userData),void 0!==e.vertexColors&&(i.vertexColors="number"==typeof e.vertexColors?e.vertexColors>0:e.vertexColors),void 0!==e.uniforms)for(const a in e.uniforms){const o=e.uniforms[a];switch(i.uniforms[a]={},o.type){case"t":i.uniforms[a].value=n(o.value);break;case"c":i.uniforms[a].value=(new Wt).setHex(o.value);break;case"v2":i.uniforms[a].value=(new st).fromArray(o.value);break;case"v3":i.uniforms[a].value=(new O).fromArray(o.value);break;case"v4":i.uniforms[a].value=(new rn).fromArray(o.value);break;case"m3":i.uniforms[a].value=(new Ii).fromArray(o.value);break;case"m4":i.uniforms[a].value=(new fn).fromArray(o.value);break;default:i.uniforms[a].value=o.value}}if(void 0!==e.defines&&(i.defines=e.defines),void 0!==e.vertexShader&&(i.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(i.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(const a in e.extensions)i.extensions[a]=e.extensions[a];if(void 0!==e.shading&&(i.flatShading=1===e.shading),void 0!==e.size&&(i.size=e.size),void 0!==e.sizeAttenuation&&(i.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(i.map=n(e.map)),void 0!==e.matcap&&(i.matcap=n(e.matcap)),void 0!==e.alphaMap&&(i.alphaMap=n(e.alphaMap)),void 0!==e.bumpMap&&(i.bumpMap=n(e.bumpMap)),void 0!==e.bumpScale&&(i.bumpScale=e.bumpScale),void 0!==e.normalMap&&(i.normalMap=n(e.normalMap)),void 0!==e.normalMapType&&(i.normalMapType=e.normalMapType),void 0!==e.normalScale){let a=e.normalScale;!1===Array.isArray(a)&&(a=[a,a]),i.normalScale=(new st).fromArray(a)}return void 0!==e.displacementMap&&(i.displacementMap=n(e.displacementMap)),void 0!==e.displacementScale&&(i.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(i.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(i.roughnessMap=n(e.roughnessMap)),void 0!==e.metalnessMap&&(i.metalnessMap=n(e.metalnessMap)),void 0!==e.emissiveMap&&(i.emissiveMap=n(e.emissiveMap)),void 0!==e.emissiveIntensity&&(i.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(i.specularMap=n(e.specularMap)),void 0!==e.specularIntensityMap&&(i.specularIntensityMap=n(e.specularIntensityMap)),void 0!==e.specularColorMap&&(i.specularColorMap=n(e.specularColorMap)),void 0!==e.envMap&&(i.envMap=n(e.envMap)),void 0!==e.envMapIntensity&&(i.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(i.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(i.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(i.lightMap=n(e.lightMap)),void 0!==e.lightMapIntensity&&(i.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(i.aoMap=n(e.aoMap)),void 0!==e.aoMapIntensity&&(i.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(i.gradientMap=n(e.gradientMap)),void 0!==e.clearcoatMap&&(i.clearcoatMap=n(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(i.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(i.clearcoatNormalMap=n(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(i.clearcoatNormalScale=(new st).fromArray(e.clearcoatNormalScale)),void 0!==e.transmissionMap&&(i.transmissionMap=n(e.transmissionMap)),void 0!==e.thicknessMap&&(i.thicknessMap=n(e.thicknessMap)),void 0!==e.sheenColorMap&&(i.sheenColorMap=n(e.sheenColorMap)),void 0!==e.sheenRoughnessMap&&(i.sheenRoughnessMap=n(e.sheenRoughnessMap)),i}setTextures(e){return this.textures=e,this}}class dl{static decodeText(e){if(typeof TextDecoder<"u")return(new TextDecoder).decode(e);let t="";for(let n=0,i=e.length;n<i;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}static resolveURL(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class Hu extends zn{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}Hu.prototype.isInstancedBufferGeometry=!0;class jf extends Rr{constructor(e){super(e)}load(e,t,n,i){const a=this,o=new ys(a.manager);o.setPath(a.path),o.setRequestHeader(a.requestHeader),o.setWithCredentials(a.withCredentials),o.load(e,function(c){try{t(a.parse(JSON.parse(c)))}catch(l){i?i(l):console.error(l),a.manager.itemError(e)}},n,i)}parse(e){const t={},n={};function i(v,x){if(void 0!==t[x])return t[x];const L=v.interleavedBuffers[x],E=function a(v,x){if(void 0!==n[x])return n[x];const E=new Uint32Array(v.arrayBuffers[x]).buffer;return n[x]=E,E}(v,L.buffer),_=us(L.type,E),D=new ya(_,L.stride);return D.uuid=L.uuid,t[x]=D,D}const o=e.isInstancedBufferGeometry?new Hu:new zn,c=e.data.index;if(void 0!==c){const v=us(c.type,c.array);o.setIndex(new mi(v,1))}const l=e.data.attributes;for(const v in l){const x=l[v];let T;if(x.isInterleavedBufferAttribute){const L=i(e.data,x.data);T=new ra(L,x.itemSize,x.offset,x.normalized)}else{const L=us(x.type,x.array);T=new(x.isInstancedBufferAttribute?xa:mi)(L,x.itemSize,x.normalized)}void 0!==x.name&&(T.name=x.name),void 0!==x.usage&&T.setUsage(x.usage),void 0!==x.updateRange&&(T.updateRange.offset=x.updateRange.offset,T.updateRange.count=x.updateRange.count),o.setAttribute(v,T)}const h=e.data.morphAttributes;if(h)for(const v in h){const x=h[v],T=[];for(let L=0,E=x.length;L<E;L++){const _=x[L];let D;if(_.isInterleavedBufferAttribute){const R=i(e.data,_.data);D=new ra(R,_.itemSize,_.offset,_.normalized)}else{const R=us(_.type,_.array);D=new mi(R,_.itemSize,_.normalized)}void 0!==_.name&&(D.name=_.name),T.push(D)}o.morphAttributes[v]=T}e.data.morphTargetsRelative&&(o.morphTargetsRelative=!0);const m=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==m)for(let v=0,x=m.length;v!==x;++v){const T=m[v];o.addGroup(T.start,T.count,T.materialIndex)}const g=e.data.boundingSphere;if(void 0!==g){const v=new O;void 0!==g.center&&v.fromArray(g.center),o.boundingSphere=new Ks(v,g.radius)}return e.name&&(o.name=e.name),e.userData&&(o.userData=e.userData),o}}const lv={UVMapping:300,CubeReflectionMapping:Re,CubeRefractionMapping:pt,EquirectangularReflectionMapping:Oe,EquirectangularRefractionMapping:Dt,CubeUVReflectionMapping:zt,CubeUVRefractionMapping:Yn},qf={RepeatWrapping:ni,ClampToEdgeWrapping:St,MirroredRepeatWrapping:un},Yf={NearestFilter:Dn,NearestMipmapNearestFilter:vi,NearestMipmapLinearFilter:xr,LinearFilter:Cn,LinearMipmapNearestFilter:Jn,LinearMipmapLinearFilter:Dr};class Kf extends Rr{constructor(e){super(e),typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const a=this,o=Ra.get(e);if(void 0!==o)return a.manager.itemStart(e),setTimeout(function(){t&&t(o),a.manager.itemEnd(e)},0),o;const c={};c.credentials="anonymous"===this.crossOrigin?"same-origin":"include",c.headers=this.requestHeader,fetch(e,c).then(function(l){return l.blob()}).then(function(l){return createImageBitmap(l,Object.assign(a.options,{colorSpaceConversion:"none"}))}).then(function(l){Ra.add(e,l),t&&t(l),a.manager.itemEnd(e)}).catch(function(l){i&&i(l),a.manager.itemError(e),a.manager.itemEnd(e)}),a.manager.itemStart(e)}}let pl;Kf.prototype.isImageBitmapLoader=!0;const ku={getContext:function(){return void 0===pl&&(pl=new(window.AudioContext||window.webkitAudioContext)),pl},setContext:function(r){pl=r}};class Zf extends Rr{constructor(e){super(e)}load(e,t,n,i){const a=this,o=new ys(this.manager);o.setResponseType("arraybuffer"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(c){try{const l=c.slice(0);ku.getContext().decodeAudioData(l,function(p){t(p)})}catch(l){i?i(l):console.error(l),a.manager.itemError(e)}},n,i)}}class Jf extends ac{constructor(e,t,n=1){super(void 0,n);const i=(new Wt).set(e),a=(new Wt).set(t),o=new O(i.r,i.g,i.b),c=new O(a.r,a.g,a.b),l=Math.sqrt(Math.PI),h=l*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(c).multiplyScalar(l),this.sh.coefficients[1].copy(o).sub(c).multiplyScalar(h)}}Jf.prototype.isHemisphereLightProbe=!0;class $f extends ac{constructor(e,t=1){super(void 0,t);const n=(new Wt).set(e);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}}$f.prototype.isAmbientLightProbe=!0;const Qf=new fn,ed=new fn,Aa=new fn;class td{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=nd(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=nd();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function nd(){return(typeof performance>"u"?Date:performance).now()}const za=new O,id=new Ni,hv=new O,La=new O;class Gu extends li{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const Ca=new O,rd=new Ni,dv=new O,Pa=new O;class sd{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}}class ad{constructor(e,t,n){let i,a,o;switch(this.binding=e,this.valueSize=n,t){case"quaternion":i=this._slerp,a=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":i=this._select,a=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:i=this._lerp,a=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=a,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,i=this.valueSize,a=e*i+i;let o=this.cumulativeWeight;if(0===o){for(let c=0;c!==i;++c)n[a+c]=n[c];o=t}else o+=t,this._mixBufferRegion(n,a,0,t/o,i);this.cumulativeWeight=o}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,i=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,i=e*t+t,a=this.cumulativeWeight,o=this.cumulativeWeightAdditive,c=this.binding;this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,a<1&&this._mixBufferRegion(n,i,t*this._origIndex,1-a,t),o>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*t,1,t);for(let l=t,h=t+t;l!==h;++l)if(n[l]!==n[l+t]){c.setValue(n,i);break}}saveOriginalState(){const t=this.buffer,n=this.valueSize,i=n*this._origIndex;this.binding.getValue(t,i);for(let a=n,o=i;a!==o;++a)t[a]=t[i+a%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){this.binding.setValue(this.buffer,3*this.valueSize)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,i,a){if(i>=.5)for(let o=0;o!==a;++o)e[t+o]=e[n+o]}_slerp(e,t,n,i){Ni.slerpFlat(e,t,e,t,e,n,i)}_slerpAdditive(e,t,n,i,a){const o=this._workIndex*a;Ni.multiplyQuaternionsFlat(e,o,e,t,e,n),Ni.slerpFlat(e,t,e,t,e,o,i)}_lerp(e,t,n,i,a){const o=1-i;for(let c=0;c!==a;++c){const l=t+c;e[l]=e[l]*o+e[n+c]*i}}_lerpAdditive(e,t,n,i,a){for(let o=0;o!==a;++o){const c=t+o;e[c]=e[c]+e[n+o]*i}}}const Vu="\\[\\]\\.:\\/",mv=new RegExp("["+Vu+"]","g"),Wu="[^"+Vu+"]",gv="[^"+Vu.replace("\\.","")+"]",vv=/((?:WC+[\/:])*)/.source.replace("WC",Wu),yv=/(WCOD+)?/.source.replace("WCOD",gv),_v=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Wu),xv=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Wu),Ev=new RegExp("^"+vv+yv+_v+xv+"$"),bv=["material","materials","bones"];class xi{constructor(e,t,n){this.path=t,this.parsedPath=n||xi.parseTrackName(t),this.node=xi.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new xi.Composite(e,t,n):new xi(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(mv,"")}static parseTrackName(e){const t=Ev.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){const a=n.nodeName.substring(i+1);-1!==bv.indexOf(a)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=a)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(!t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(a){for(let o=0;o<a.length;o++){const c=a[o];if(c.name===t||c.uuid===t)return c;const l=n(c.children);if(l)return l}return null},i=n(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let i=0,a=n.length;i!==a;++i)e[t++]=n[i]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let i=0,a=n.length;i!==a;++i)n[i]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,a=n.length;i!==a;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,a=n.length;i!==a;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,i=t.propertyName;let a=t.propertyIndex;if(e||(e=xi.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(n){let h=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let p=0;p<e.length;p++)if(e[p].name===h){h=p;break}break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==h){if(void 0===e[h])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[h]}}const o=e[i];if(void 0===o)return void console.error("THREE.PropertyBinding: Trying to update property for track: "+t.nodeName+"."+i+" but it wasn't found.",e);let c=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?c=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(c=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(void 0!==a){if("morphTargetInfluences"===i){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[a]&&(a=e.morphTargetDictionary[a])}l=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=a}else void 0!==o.fromArray&&void 0!==o.toArray?(l=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(l=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=i;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][c]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}xi.Composite=class Mv{constructor(e,t,n){const i=n||xi.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();const i=this._bindings[this._targetGroup.nCachedObjects_];void 0!==i&&i.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,a=n.length;i!==a;++i)n[i].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},xi.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},xi.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},xi.prototype.GetterByBindingType=[xi.prototype._getValue_direct,xi.prototype._getValue_array,xi.prototype._getValue_arrayElement,xi.prototype._getValue_toArray],xi.prototype.SetterByBindingTypeAndVersioning=[[xi.prototype._setValue_direct,xi.prototype._setValue_direct_setNeedsUpdate,xi.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[xi.prototype._setValue_array,xi.prototype._setValue_array_setNeedsUpdate,xi.prototype._setValue_array_setMatrixWorldNeedsUpdate],[xi.prototype._setValue_arrayElement,xi.prototype._setValue_arrayElement_setNeedsUpdate,xi.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[xi.prototype._setValue_fromArray,xi.prototype._setValue_fromArray_setNeedsUpdate,xi.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class od{constructor(){this.uuid=er(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let n=0,i=arguments.length;n!==i;++n)e[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,n=this._paths,i=this._parsedPaths,a=this._bindings,o=a.length;let c,l=e.length,h=this.nCachedObjects_;for(let p=0,m=arguments.length;p!==m;++p){const g=arguments[p],v=g.uuid;let x=t[v];if(void 0===x){x=l++,t[v]=x,e.push(g);for(let T=0,L=o;T!==L;++T)a[T].push(new xi(g,n[T],i[T]))}else if(x<h){c=e[x];const T=--h,L=e[T];t[L.uuid]=x,e[x]=L,t[v]=T,e[T]=g;for(let E=0,_=o;E!==_;++E){const D=a[E];let G=D[x];D[x]=D[T],void 0===G&&(G=new xi(g,n[E],i[E])),D[T]=G}}else e[x]!==c&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=h}remove(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length;let a=this.nCachedObjects_;for(let o=0,c=arguments.length;o!==c;++o){const l=arguments[o],h=l.uuid,p=t[h];if(void 0!==p&&p>=a){const m=a++,g=e[m];t[g.uuid]=p,e[p]=g,t[h]=m,e[m]=l;for(let v=0,x=i;v!==x;++v){const T=n[v],E=T[p];T[p]=T[m],T[m]=E}}}this.nCachedObjects_=a}uncache(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length;let a=this.nCachedObjects_,o=e.length;for(let c=0,l=arguments.length;c!==l;++c){const p=arguments[c].uuid,m=t[p];if(void 0!==m)if(delete t[p],m<a){const g=--a,v=e[g],x=--o,T=e[x];t[v.uuid]=m,e[m]=v,t[T.uuid]=g,e[g]=T,e.pop();for(let L=0,E=i;L!==E;++L){const _=n[L],R=_[x];_[m]=_[g],_[g]=R,_.pop()}}else{const g=--o,v=e[g];g>0&&(t[v.uuid]=m),e[m]=v,e.pop();for(let x=0,T=i;x!==T;++x){const L=n[x];L[m]=L[g],L.pop()}}}this.nCachedObjects_=a}subscribe_(e,t){const n=this._bindingsIndicesByPath;let i=n[e];const a=this._bindings;if(void 0!==i)return a[i];const o=this._paths,c=this._parsedPaths,l=this._objects,p=this.nCachedObjects_,m=new Array(l.length);i=a.length,n[e]=i,o.push(e),c.push(t),a.push(m);for(let g=p,v=l.length;g!==v;++g)m[g]=new xi(l[g],e,t);return m}unsubscribe_(e){const t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){const i=this._paths,a=this._parsedPaths,o=this._bindings,c=o.length-1,l=o[c];t[e[c]]=n,o[n]=l,o.pop(),a[n]=a[c],a.pop(),i[n]=i[c],i.pop()}}}od.prototype.isAnimationObjectGroup=!0;class Tv{constructor(e,t,n=null,i=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=i;const a=t.tracks,o=a.length,c=new Array(o),l={endingStart:M,endingEnd:M};for(let h=0;h!==o;++h){const p=a[h].createInterpolant(null);c[h]=p,p.settings=l}this._interpolantSettings=l,this._interpolants=c,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){const i=this._clip.duration,a=e._clip.duration,c=i/a;e.warp(1,a/i,t),this.warp(c,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const i=this._mixer,a=i.time,o=this.timeScale;let c=this._timeScaleInterpolant;null===c&&(c=i._lendControlInterpolant(),this._timeScaleInterpolant=c);const l=c.parameterPositions,h=c.sampleValues;return l[0]=a,l[1]=a+n,h[0]=e/o,h[1]=t/o,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,i){if(!this.enabled)return void this._updateWeight(e);const a=this._startTime;if(null!==a){const l=(e-a)*n;if(l<0||0===n)return;this._startTime=null,t=n*l}t*=this._updateTimeScale(e);const o=this._updateTime(t),c=this._updateWeight(e);if(c>0){const l=this._interpolants,h=this._propertyBindings;if(2501===this.blendMode)for(let p=0,m=l.length;p!==m;++p)l[p].evaluate(o),h[p].accumulateAdditive(c);else for(let p=0,m=l.length;p!==m;++p)l[p].evaluate(o),h[p].accumulate(i,c)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(null!==n){const i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;null!==n&&(t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let i=this.time+e,a=this._loopCount;const o=2202===n;if(0===e)return-1===a?i:o&&1==(1&a)?t-i:i;if(2200===n){-1===a&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else{if(!(i<0)){this.time=i;break e}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===a&&(e>=0?(a=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),i>=t||i<0){const c=Math.floor(i/t);i-=t*c,a+=Math.abs(c);const l=this.repetitions-a;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===l){const h=e<0;this._setEndings(h,!h,o)}else this._setEndings(!1,!1,o);this._loopCount=a,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:c})}}else this.time=i;if(o&&1==(1&a))return t-i}return i}_setEndings(e,t,n){const i=this._interpolantSettings;n?(i.endingStart=F,i.endingEnd=F):(i.endingStart=e?this.zeroSlopeAtStart?F:M:de,i.endingEnd=t?this.zeroSlopeAtEnd?F:M:de)}_scheduleFading(e,t,n){const i=this._mixer,a=i.time;let o=this._weightInterpolant;null===o&&(o=i._lendControlInterpolant(),this._weightInterpolant=o);const c=o.parameterPositions,l=o.sampleValues;return c[0]=a,l[0]=t,c[1]=a+e,l[1]=n,this}}class cd extends Xr{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,i=e._clip.tracks,a=i.length,o=e._propertyBindings,c=e._interpolants,l=n.uuid,h=this._bindingsByRootAndName;let p=h[l];void 0===p&&(p={},h[l]=p);for(let m=0;m!==a;++m){const g=i[m],v=g.name;let x=p[v];if(void 0!==x)o[m]=x;else{if(x=o[m],void 0!==x){null===x._cacheIndex&&(++x.referenceCount,this._addInactiveBinding(x,l,v));continue}x=new ad(xi.create(n,v,t&&t._propertyBindings[m].binding.parsedPath),g.ValueTypeName,g.getValueSize()),++x.referenceCount,this._addInactiveBinding(x,l,v),o[m]=x}c[m].resultBuffer=x.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const n=(e._localRoot||this._root).uuid,i=e._clip.uuid,a=this._actionsByClip[i];this._bindAction(e,a&&a.knownActions[0]),this._addInactiveAction(e,i,n)}const t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){const a=t[n];0==a.useCount++&&(this._lendBinding(a),a.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){const a=t[n];0==--a.useCount&&(a.restoreOriginalState(),this._takeBackBinding(a))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,n){const i=this._actions,a=this._actionsByClip;let o=a[t];if(void 0===o)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,a[t]=o;else{const c=o.knownActions;e._byClipCacheIndex=c.length,c.push(e)}e._cacheIndex=i.length,i.push(e),o.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],i=e._cacheIndex;n._cacheIndex=i,t[i]=n,t.pop(),e._cacheIndex=null;const a=e._clip.uuid,o=this._actionsByClip,c=o[a],l=c.knownActions,h=l[l.length-1],p=e._byClipCacheIndex;h._byClipCacheIndex=p,l[p]=h,l.pop(),e._byClipCacheIndex=null,delete c.actionByRoot[(e._localRoot||this._root).uuid],0===l.length&&delete o[a],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){const a=t[n];0==--a.referenceCount&&this._removeInactiveBinding(a)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,i=this._nActiveActions++,a=t[i];e._cacheIndex=i,t[i]=e,a._cacheIndex=n,t[n]=a}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,i=--this._nActiveActions,a=t[i];e._cacheIndex=i,t[i]=e,a._cacheIndex=n,t[n]=a}_addInactiveBinding(e,t,n){const i=this._bindingsByRootAndName,a=this._bindings;let o=i[t];void 0===o&&(o={},i[t]=o),o[n]=e,e._cacheIndex=a.length,a.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,i=n.rootNode.uuid,a=n.path,o=this._bindingsByRootAndName,c=o[i],l=t[t.length-1],h=e._cacheIndex;l._cacheIndex=h,t[h]=l,t.pop(),delete c[a],0===Object.keys(c).length&&delete o[i]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,i=this._nActiveBindings++,a=t[i];e._cacheIndex=i,t[i]=e,a._cacheIndex=n,t[n]=a}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,i=--this._nActiveBindings,a=t[i];e._cacheIndex=i,t[i]=e,a._cacheIndex=n,t[n]=a}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return void 0===n&&(n=new Au(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,i=--this._nActiveControlInterpolants,a=t[i];e.__cacheIndex=i,t[i]=e,a.__cacheIndex=n,t[n]=a}clipAction(e,t,n){const i=t||this._root,a=i.uuid;let o="string"==typeof e?ic.findByName(i,e):e;const c=null!==o?o.uuid:e,l=this._actionsByClip[c];let h=null;if(void 0===n&&(n=null!==o?o.blendMode:2500),void 0!==l){const m=l.actionByRoot[a];if(void 0!==m&&m.blendMode===n)return m;h=l.knownActions[0],null===o&&(o=h._clip)}if(null===o)return null;const p=new Tv(this,o,t,n);return this._bindAction(p,h),this._addInactiveAction(p,c,a),p}existingAction(e,t){const n=t||this._root,i=n.uuid,a="string"==typeof e?ic.findByName(n,e):e,c=this._actionsByClip[a?a.uuid:e];return void 0!==c&&c.actionByRoot[i]||null}stopAllAction(){const e=this._actions;for(let n=this._nActiveActions-1;n>=0;--n)e[n].stop();return this}update(e){const t=this._actions,n=this._nActiveActions,i=this.time+=e*=this.timeScale,a=Math.sign(e),o=this._accuIndex^=1;for(let h=0;h!==n;++h)t[h]._update(i,e,a,o);const c=this._bindings,l=this._nActiveBindings;for(let h=0;h!==l;++h)c[h].apply(o);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,i=this._actionsByClip,a=i[n];if(void 0!==a){const o=a.knownActions;for(let c=0,l=o.length;c!==l;++c){const h=o[c];this._deactivateAction(h);const p=h._cacheIndex,m=t[t.length-1];h._cacheIndex=null,h._byClipCacheIndex=null,m._cacheIndex=p,t[p]=m,t.pop(),this._removeInactiveBindingsForAction(h)}delete i[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const o in n){const l=n[o].actionByRoot[t];void 0!==l&&(this._deactivateAction(l),this._removeInactiveAction(l))}const a=this._bindingsByRootAndName[t];if(void 0!==a)for(const o in a){const c=a[o];c.restoreOriginalState(),this._removeInactiveBinding(c)}}uncacheAction(e,t){const n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}cd.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class ml{constructor(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}clone(){return new ml(void 0===this.value.clone?this.value:this.value.clone())}}class ld extends ya{constructor(e,t,n=1){super(e,t),this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}ld.prototype.isInstancedInterleavedBuffer=!0;class ud{constructor(e,t,n,i,a){this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=i,this.count=a,this.version=0}set needsUpdate(e){!0===e&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}function hd(r,e){return r.distance-e.distance}function Xu(r,e,t,n){if(r.layers.test(e.layers)&&r.raycast(e,t),!0===n){const i=r.children;for(let a=0,o=i.length;a<o;a++)Xu(i[a],e,t,!0)}}ud.prototype.isGLBufferAttribute=!0;const fd=new st;class bo{constructor(e=new st(1/0,1/0),t=new st(-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=fd.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return fd.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}bo.prototype.isBox2=!0;const dd=new O,gl=new O;class pd{constructor(e=new O,t=new O){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){dd.subVectors(e,this.start),gl.subVectors(this.end,this.start);const n=gl.dot(gl);let a=gl.dot(dd)/n;return t&&(a=ji(a,0,1)),a}closestPointToPoint(e,t,n){const i=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(i).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}const md=new O,oa=new O,vl=new fn,ju=new fn;class gd extends Fr{constructor(e){const t=vd(e),n=new zn,i=[],a=[],o=new Wt(0,0,1),c=new Wt(0,1,0);for(let h=0;h<t.length;h++){const p=t[h];p.parent&&p.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),a.push(o.r,o.g,o.b),a.push(c.r,c.g,c.b))}n.setAttribute("position",new on(i,3)),n.setAttribute("color",new on(a,3)),super(n,new or({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,n=this.geometry,i=n.getAttribute("position");ju.copy(this.root.matrixWorld).invert();for(let a=0,o=0;a<t.length;a++){const c=t[a];c.parent&&c.parent.isBone&&(vl.multiplyMatrices(ju,c.matrixWorld),oa.setFromMatrixPosition(vl),i.setXYZ(o,oa.x,oa.y,oa.z),vl.multiplyMatrices(ju,c.parent.matrixWorld),oa.setFromMatrixPosition(vl),i.setXYZ(o+1,oa.x,oa.y,oa.z),o+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}function vd(r){const e=[];r&&r.isBone&&e.push(r);for(let t=0;t<r.children.length;t++)e.push.apply(e,vd(r.children[t]));return e}const Lv=new O,yd=new Wt,_d=new Wt;class xd extends Fr{constructor(e=10,t=10,n=4473924,i=8947848){n=new Wt(n),i=new Wt(i);const a=t/2,o=e/t,c=e/2,l=[],h=[];for(let g=0,v=0,x=-c;g<=t;g++,x+=o){l.push(-c,0,x,c,0,x),l.push(x,0,-c,x,0,c);const T=g===a?n:i;T.toArray(h,v),v+=3,T.toArray(h,v),v+=3,T.toArray(h,v),v+=3,T.toArray(h,v),v+=3}const p=new zn;p.setAttribute("position",new on(l,3)),p.setAttribute("color",new on(h,3)),super(p,new or({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}const Ed=new O,yl=new O,bd=new O,_l=new O,Vi=new Io;function Ki(r,e,t,n,i,a,o){_l.set(i,a,o).unproject(n);const c=e[r];if(void 0!==c){const l=t.getAttribute("position");for(let h=0,p=c.length;h<p;h++)l.setXYZ(c[h],_l.x,_l.y,_l.z)}}const xl=new Ji;class Md extends Fr{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),a=new zn;a.setIndex(new mi(n,1)),a.setAttribute("position",new mi(i,3)),super(a,new or({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&xl.setFromObject(this.object),xl.isEmpty())return;const t=xl.min,n=xl.max,i=this.geometry.attributes.position,a=i.array;a[0]=n.x,a[1]=n.y,a[2]=n.z,a[3]=t.x,a[4]=n.y,a[5]=n.z,a[6]=t.x,a[7]=t.y,a[8]=n.z,a[9]=n.x,a[10]=t.y,a[11]=n.z,a[12]=n.x,a[13]=n.y,a[14]=t.z,a[15]=t.x,a[16]=n.y,a[17]=t.z,a[18]=t.x,a[19]=t.y,a[20]=t.z,a[21]=n.x,a[22]=t.y,a[23]=t.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e){return Fr.prototype.copy.call(this,e),this.object=e.object,this}}const Td=new O;let El,qu;class wd extends Fr{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=new zn;i.setAttribute("position",new on(t,3)),i.setAttribute("color",new on([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(i,new or({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,t,n){const i=new Wt,a=this.geometry.attributes.color.array;return i.set(e),i.toArray(a,0),i.toArray(a,3),i.set(t),i.toArray(a,6),i.toArray(a,9),i.set(n),i.toArray(a,12),i.toArray(a,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}const Sd=new Float32Array(1),Ov=new Int32Array(Sd.buffer);Or.create=function(r,e){return console.log("THREE.Curve.create() has been deprecated"),r.prototype=Object.create(Or.prototype),r.prototype.constructor=r,r.prototype.getPoint=e,r},Jo.prototype.fromPoints=function(r){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(r)},xd.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},gd.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Rr.prototype.extractUrlBase=function(r){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),dl.extractUrlBase(r)},Rr.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},bo.prototype.center=function(r){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(r)},bo.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},bo.prototype.isIntersectionBox=function(r){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(r)},bo.prototype.size=function(r){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(r)},Ji.prototype.center=function(r){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(r)},Ji.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Ji.prototype.isIntersectionBox=function(r){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(r)},Ji.prototype.isIntersectionSphere=function(r){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(r)},Ji.prototype.size=function(r){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(r)},Ks.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},No.prototype.setFromMatrix=function(r){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(r)},pd.prototype.center=function(r){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(r)},Ii.prototype.flattenToArrayOffset=function(r,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(r,e)},Ii.prototype.multiplyVector3=function(r){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),r.applyMatrix3(this)},Ii.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},Ii.prototype.applyToBufferAttribute=function(r){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),r.applyMatrix3(this)},Ii.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},Ii.prototype.getInverse=function(r){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(r).invert()},fn.prototype.extractPosition=function(r){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(r)},fn.prototype.flattenToArrayOffset=function(r,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(r,e)},fn.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new O).setFromMatrixColumn(this,3)},fn.prototype.setRotationFromQuaternion=function(r){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(r)},fn.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},fn.prototype.multiplyVector3=function(r){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),r.applyMatrix4(this)},fn.prototype.multiplyVector4=function(r){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),r.applyMatrix4(this)},fn.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},fn.prototype.rotateAxis=function(r){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),r.transformDirection(this)},fn.prototype.crossVector=function(r){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),r.applyMatrix4(this)},fn.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},fn.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},fn.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},fn.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},fn.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},fn.prototype.applyToBufferAttribute=function(r){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),r.applyMatrix4(this)},fn.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},fn.prototype.makeFrustum=function(r,e,t,n,i,a){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(r,e,n,t,i,a)},fn.prototype.getInverse=function(r){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(r).invert()},fs.prototype.isIntersectionLine=function(r){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(r)},Ni.prototype.multiplyVector3=function(r){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),r.applyQuaternion(this)},Ni.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},Js.prototype.isIntersectionBox=function(r){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(r)},Js.prototype.isIntersectionPlane=function(r){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(r)},Js.prototype.isIntersectionSphere=function(r){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(r)},qi.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},qi.prototype.barycoordFromPoint=function(r,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(r,e)},qi.prototype.midpoint=function(r){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(r)},qi.prototypenormal=function(r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(r)},qi.prototype.plane=function(r){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(r)},qi.barycoordFromPoint=function(r,e,t,n,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),qi.getBarycoord(r,e,t,n,i)},qi.normal=function(r,e,t,n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),qi.getNormal(r,e,t,n)},ms.prototype.extractAllPoints=function(r){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(r)},ms.prototype.extrude=function(r){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new vs(this,r)},ms.prototype.makeGeometry=function(r){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Ma(this,r)},st.prototype.fromAttribute=function(r,e,t){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(r,e,t)},st.prototype.distanceToManhattan=function(r){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(r)},st.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},O.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},O.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},O.prototype.getPositionFromMatrix=function(r){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(r)},O.prototype.getScaleFromMatrix=function(r){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(r)},O.prototype.getColumnFromMatrix=function(r,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,r)},O.prototype.applyProjection=function(r){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(r)},O.prototype.fromAttribute=function(r,e,t){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(r,e,t)},O.prototype.distanceToManhattan=function(r){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(r)},O.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},rn.prototype.fromAttribute=function(r,e,t){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(r,e,t)},rn.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},li.prototype.getChildByName=function(r){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(r)},li.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},li.prototype.translate=function(r,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,r)},li.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},li.prototype.applyMatrix=function(r){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(r)},Object.defineProperties(li.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(r){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=r}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),$i.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties($i.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Yc.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},ar.prototype.setLens=function(r,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(r)},Object.defineProperties(ss.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(r){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=r}},shadowCameraLeft:{set:function(r){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=r}},shadowCameraRight:{set:function(r){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=r}},shadowCameraTop:{set:function(r){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=r}},shadowCameraBottom:{set:function(r){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=r}},shadowCameraNear:{set:function(r){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=r}},shadowCameraFar:{set:function(r){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=r}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(r){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=r}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(r){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=r}},shadowMapHeight:{set:function(r){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=r}}}),Object.defineProperties(mi.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===$n},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage($n)}}}),mi.prototype.setDynamic=function(r){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===r?$n:pr),this},mi.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},mi.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},zn.prototype.addIndex=function(r){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(r)},zn.prototype.addAttribute=function(r,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===r?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(r,e):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(r,new mi(arguments[1],arguments[2])))},zn.prototype.addDrawCall=function(r,e,t){void 0!==t&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(r,e)},zn.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},zn.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},zn.prototype.removeAttribute=function(r){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(r)},zn.prototype.applyMatrix=function(r){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(r)},Object.defineProperties(zn.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),ya.prototype.setDynamic=function(r){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===r?$n:pr),this},ya.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},vs.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},vs.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},vs.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},kc.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},ml.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this},Object.defineProperties(rr.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Wt}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(r){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===r}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(r){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=r}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}}),Object.defineProperties(Fs.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(r){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=r}}}),Ri.prototype.clearTarget=function(r,e,t,n){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(r),this.clear(e,t,n)},Ri.prototype.animate=function(r){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(r)},Ri.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},Ri.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},Ri.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},Ri.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},Ri.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},Ri.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},Ri.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},Ri.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},Ri.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},Ri.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},Ri.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},Ri.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},Ri.prototype.enableScissorTest=function(r){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(r)},Ri.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},Ri.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},Ri.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},Ri.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},Ri.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},Ri.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},Ri.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},Ri.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},Ri.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},Ri.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(Ri.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(r){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=r}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(r){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=r}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(r){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===r?_t:Tt}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}},gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}}),Object.defineProperties(Yh.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Li.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(r){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=r}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(r){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=r}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(r){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=r}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(r){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=r}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(r){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=r}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(r){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=r}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(r){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=r}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(r){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=r}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(r){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=r}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(r){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=r}}}),Gu.prototype.load=function(r){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const e=this;return(new Zf).load(r,function(n){e.setBuffer(n)}),this},sd.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},Lc.prototype.updateCubeMap=function(r,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(r,e)},Lc.prototype.clear=function(r,e,t,n){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(r,e,t,n)},qr.crossOrigin=void 0,qr.loadTexture=function(r,e,t,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const i=new Uf;i.setCrossOrigin(this.crossOrigin);const a=i.load(r,t,void 0,n);return e&&(a.mapping=e),a},qr.loadTextureCube=function(r,e,t,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const i=new If;i.setCrossOrigin(this.crossOrigin);const a=i.load(r,t,void 0,n);return e&&(a.mapping=e),a},qr.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},qr.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};const xy={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Rt}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Rt),b.ACESFilmicToneMapping=ie,b.AddEquation=Kt,b.AddOperation=A,b.AdditiveAnimationBlendMode=2501,b.AdditiveBlending=sn,b.AlphaFormat=Tn,b.AlwaysDepth=se,b.AlwaysStencilFunc=519,b.AmbientLight=Uu,b.AmbientLightProbe=$f,b.AnimationClip=ic,b.AnimationLoader=class av extends Rr{constructor(e){super(e)}load(e,t,n,i){const a=this,o=new ys(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(c){try{t(a.parse(JSON.parse(c)))}catch(l){i?i(l):console.error(l),a.manager.itemError(e)}},n,i)}parse(e){const t=[];for(let n=0;n<e.length;n++){const i=ic.parse(e[n]);t.push(i)}return t}},b.AnimationMixer=cd,b.AnimationObjectGroup=od,b.AnimationUtils=Oi,b.ArcCurve=lu,b.ArrayCamera=Ql,b.ArrowHelper=class Uv extends li{constructor(e=new O(0,0,1),t=new O(0,0,0),n=1,i=16776960,a=.2*n,o=.2*a){super(),this.type="ArrowHelper",void 0===El&&(El=new zn,El.setAttribute("position",new on([0,0,0,0,1,0],3)),qu=new sa(0,.5,1,5,1),qu.translate(0,-.5,0)),this.position.copy(t),this.line=new Ds(El,new or({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new $i(qu,new Cs({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,a,o)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{Td.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(Td,t)}}setLength(e,t=.2*e,n=.2*t){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}},b.Audio=Gu,b.AudioAnalyser=sd,b.AudioContext=ku,b.AudioListener=class fv extends li{constructor(){super(),this.type="AudioListener",this.context=ku.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new td}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(za,id,hv),La.set(0,0,-1).applyQuaternion(id),t.positionX){const i=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(za.x,i),t.positionY.linearRampToValueAtTime(za.y,i),t.positionZ.linearRampToValueAtTime(za.z,i),t.forwardX.linearRampToValueAtTime(La.x,i),t.forwardY.linearRampToValueAtTime(La.y,i),t.forwardZ.linearRampToValueAtTime(La.z,i),t.upX.linearRampToValueAtTime(n.x,i),t.upY.linearRampToValueAtTime(n.y,i),t.upZ.linearRampToValueAtTime(n.z,i)}else t.setPosition(za.x,za.y,za.z),t.setOrientation(La.x,La.y,La.z,n.x,n.y,n.z)}},b.AudioLoader=Zf,b.AxesHelper=wd,b.AxisHelper=function hy(r){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new wd(r)},b.BackSide=Qt,b.BasicDepthPacking=3200,b.BasicShadowMap=0,b.BinaryTextureLoader=function gy(r){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new Nf(r)},b.Bone=Kc,b.BooleanKeyframeTrack=wa,b.BoundingBoxHelper=function fy(r,e){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new Md(r,e)},b.Box2=bo,b.Box3=Ji,b.Box3Helper=class Iv extends Fr{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),a=new zn;a.setIndex(new mi(n,1)),a.setAttribute("position",new on([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(a,new or({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}},b.BoxBufferGeometry=Ps,b.BoxGeometry=Ps,b.BoxHelper=Md,b.BufferAttribute=mi,b.BufferGeometry=zn,b.BufferGeometryLoader=jf,b.ByteType=Er,b.Cache=Ra,b.Camera=Io,b.CameraHelper=class Dv extends Fr{constructor(e){const t=new zn,n=new or({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],a=[],o={},c=new Wt(16755200),l=new Wt(16711680),h=new Wt(43775),p=new Wt(16777215),m=new Wt(3355443);function g(x,T,L){v(x,L),v(T,L)}function v(x,T){i.push(0,0,0),a.push(T.r,T.g,T.b),void 0===o[x]&&(o[x]=[]),o[x].push(i.length/3-1)}g("n1","n2",c),g("n2","n4",c),g("n4","n3",c),g("n3","n1",c),g("f1","f2",c),g("f2","f4",c),g("f4","f3",c),g("f3","f1",c),g("n1","f1",c),g("n2","f2",c),g("n3","f3",c),g("n4","f4",c),g("p","n1",l),g("p","n2",l),g("p","n3",l),g("p","n4",l),g("u1","u2",h),g("u2","u3",h),g("u3","u1",h),g("c","t",p),g("p","c",m),g("cn1","cn2",m),g("cn3","cn4",m),g("cf1","cf2",m),g("cf3","cf4",m),t.setAttribute("position",new on(i,3)),t.setAttribute("color",new on(a,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()}update(){const e=this.geometry,t=this.pointMap;Vi.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Ki("c",t,e,Vi,0,0,-1),Ki("t",t,e,Vi,0,0,1),Ki("n1",t,e,Vi,-1,-1,-1),Ki("n2",t,e,Vi,1,-1,-1),Ki("n3",t,e,Vi,-1,1,-1),Ki("n4",t,e,Vi,1,1,-1),Ki("f1",t,e,Vi,-1,-1,1),Ki("f2",t,e,Vi,1,-1,1),Ki("f3",t,e,Vi,-1,1,1),Ki("f4",t,e,Vi,1,1,1),Ki("u1",t,e,Vi,.7,1.1,-1),Ki("u2",t,e,Vi,-.7,1.1,-1),Ki("u3",t,e,Vi,0,2,-1),Ki("cf1",t,e,Vi,-1,0,1),Ki("cf2",t,e,Vi,1,0,1),Ki("cf3",t,e,Vi,0,-1,1),Ki("cf4",t,e,Vi,0,1,1),Ki("cn1",t,e,Vi,-1,0,-1),Ki("cn2",t,e,Vi,1,0,-1),Ki("cn3",t,e,Vi,0,-1,-1),Ki("cn4",t,e,Vi,0,1,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}},b.CanvasRenderer=function yy(){console.error("THREE.CanvasRenderer has been removed")},b.CanvasTexture=_f,b.CatmullRomCurve3=pu,b.CineonToneMapping=ee,b.CircleBufferGeometry=lo,b.CircleGeometry=lo,b.ClampToEdgeWrapping=St,b.Clock=td,b.Color=Wt,b.ColorKeyframeTrack=zu,b.CompressedTexture=au,b.CompressedTextureLoader=class ov extends Rr{constructor(e){super(e)}load(e,t,n,i){const a=this,o=[],c=new au,l=new ys(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(a.withCredentials);let h=0;function p(m){l.load(e[m],function(g){const v=a.parse(g,!0);o[m]={width:v.width,height:v.height,format:v.format,mipmaps:v.mipmaps},h+=1,6===h&&(1===v.mipmapCount&&(c.minFilter=Cn),c.image=o,c.format=v.format,c.needsUpdate=!0,t&&t(c))},n,i)}if(Array.isArray(e))for(let m=0,g=e.length;m<g;++m)p(m);else l.load(e,function(m){const g=a.parse(m,!0);if(g.isCubemap){const v=g.mipmaps.length/g.mipmapCount;for(let x=0;x<v;x++){o[x]={mipmaps:[]};for(let T=0;T<g.mipmapCount;T++)o[x].mipmaps.push(g.mipmaps[x*g.mipmapCount+T]),o[x].format=g.format,o[x].width=g.width,o[x].height=g.height}c.image=o}else c.image.width=g.width,c.image.height=g.height,c.mipmaps=g.mipmaps;1===g.mipmapCount&&(c.minFilter=Cn),c.format=g.format,c.needsUpdate=!0,t&&t(c)},n,i);return c}},b.ConeBufferGeometry=uo,b.ConeGeometry=uo,b.CubeCamera=Lc,b.CubeReflectionMapping=Re,b.CubeRefractionMapping=pt,b.CubeTexture=$a,b.CubeTextureLoader=If,b.CubeUVReflectionMapping=zt,b.CubeUVRefractionMapping=Yn,b.CubicBezierCurve=sl,b.CubicBezierCurve3=mu,b.CubicInterpolant=Cf,b.CullFaceBack=Ge,b.CullFaceFront=J,b.CullFaceFrontBack=3,b.CullFaceNone=mt,b.Curve=Or,b.CurvePath=bf,b.CustomBlending=cn,b.CustomToneMapping=ve,b.CylinderBufferGeometry=sa,b.CylinderGeometry=sa,b.Cylindrical=class Rv{constructor(e=1,t=0,n=0){return this.radius=e,this.theta=t,this.y=n,this}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return(new this.constructor).copy(this)}},b.DataTexture=_a,b.DataTexture2DArray=Nc,b.DataTexture3D=Zl,b.DataTextureLoader=Nf,b.DataUtils=class Hv{static toHalfFloat(e){e>65504&&(console.warn("THREE.DataUtils.toHalfFloat(): value exceeds 65504."),e=65504),Sd[0]=e;const t=Ov[0];let n=t>>16&32768,i=t>>12&2047;const a=t>>23&255;return a<103?n:a>142?(n|=31744,n|=(255==a?0:1)&&8388607&t,n):a<113?(i|=2048,n|=(i>>114-a)+(i>>113-a&1),n):(n|=a-112<<10|i>>1,n+=1&i,n)}},b.DecrementStencilOp=7683,b.DecrementWrapStencilOp=34056,b.DefaultLoadingManager=Df,b.DepthFormat=Pi,b.DepthStencilFormat=Fi,b.DepthTexture=Hc,b.DirectionalLight=Nu,b.DirectionalLightHelper=class Fv extends li{constructor(e,t,n){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,void 0===t&&(t=1);let i=new zn;i.setAttribute("position",new on([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const a=new or({fog:!1,toneMapped:!1});this.lightPlane=new Ds(i,a),this.add(this.lightPlane),i=new zn,i.setAttribute("position",new on([0,0,0,0,0,1],3)),this.targetLine=new Ds(i,a),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){Ed.setFromMatrixPosition(this.light.matrixWorld),yl.setFromMatrixPosition(this.light.target.matrixWorld),bd.subVectors(yl,Ed),this.lightPlane.lookAt(yl),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(yl),this.targetLine.scale.z=bd.length()}},b.DiscreteInterpolant=Pf,b.DodecahedronBufferGeometry=ho,b.DodecahedronGeometry=ho,b.DoubleSide=ti,b.DstAlphaFactor=Ct,b.DstColorFactor=Ut,b.DynamicBufferAttribute=function ty(r,e){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new mi(r,e).setUsage($n)},b.DynamicCopyUsage=35050,b.DynamicDrawUsage=$n,b.DynamicReadUsage=35049,b.EdgesGeometry=cu,b.EdgesHelper=function dy(r,e){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new Fr(new cu(r.geometry),new or({color:void 0!==e?e:16777215}))},b.EllipseCurve=qo,b.EqualDepth=xn,b.EqualStencilFunc=514,b.EquirectangularReflectionMapping=Oe,b.EquirectangularRefractionMapping=Dt,b.Euler=da,b.EventDispatcher=Xr,b.ExtrudeBufferGeometry=vs,b.ExtrudeGeometry=vs,b.FaceColors=1,b.FileLoader=ys,b.FlatShading=1,b.Float16BufferAttribute=uh,b.Float32Attribute=function ly(r,e){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new on(r,e)},b.Float32BufferAttribute=on,b.Float64Attribute=function uy(r,e){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new hh(r,e)},b.Float64BufferAttribute=hh,b.FloatType=ki,b.Fog=ko,b.FogExp2=Ho,b.Font=function wy(){console.error("THREE.Font has been moved to /examples/jsm/loaders/FontLoader.js")},b.FontLoader=function Ty(){console.error("THREE.FontLoader has been moved to /examples/jsm/loaders/FontLoader.js")},b.FramebufferTexture=yf,b.FrontSide=_n,b.Frustum=No,b.GLBufferAttribute=ud,b.GLSL1="100",b.GLSL3=la,b.GreaterDepth=Zn,b.GreaterEqualDepth=bn,b.GreaterEqualStencilFunc=518,b.GreaterStencilFunc=516,b.GridHelper=xd,b.Group=va,b.HalfFloatType=_i,b.HemisphereLight=Cu,b.HemisphereLightHelper=class Cv extends li{constructor(e,t,n){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;const i=new ba(t);i.rotateY(.5*Math.PI),this.material=new Cs({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const a=i.getAttribute("position"),o=new Float32Array(3*a.count);i.setAttribute("color",new mi(o,3)),this.add(new $i(i,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");yd.copy(this.light.color),_d.copy(this.light.groundColor);for(let n=0,i=t.count;n<i;n++){const a=n<i/2?yd:_d;t.setXYZ(n,a.r,a.g,a.b)}t.needsUpdate=!0}e.lookAt(Lv.setFromMatrixPosition(this.light.matrixWorld).negate())}},b.HemisphereLightProbe=Jf,b.IcosahedronBufferGeometry=po,b.IcosahedronGeometry=po,b.ImageBitmapLoader=Kf,b.ImageLoader=rc,b.ImageUtils=qr,b.ImmediateRenderObject=function Sy(){console.error("THREE.ImmediateRenderObject has been removed.")},b.IncrementStencilOp=7682,b.IncrementWrapStencilOp=34055,b.InstancedBufferAttribute=xa,b.InstancedBufferGeometry=Hu,b.InstancedInterleavedBuffer=ld,b.InstancedMesh=nu,b.Int16Attribute=function sy(r,e){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new ch(r,e)},b.Int16BufferAttribute=ch,b.Int32Attribute=function oy(r,e){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new lh(r,e)},b.Int32BufferAttribute=lh,b.Int8Attribute=function ny(r,e){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new sh(r,e)},b.Int8BufferAttribute=sh,b.IntType=Zr,b.InterleavedBuffer=ya,b.InterleavedBufferAttribute=ra,b.Interpolant=Is,b.InterpolateDiscrete=y,b.InterpolateLinear=u,b.InterpolateSmooth=f,b.InvertStencilOp=5386,b.JSONLoader=function _y(){console.error("THREE.JSONLoader has been removed.")},b.KeepStencilOp=7680,b.KeyframeTrack=rs,b.LOD=tf,b.LatheBufferGeometry=mo,b.LatheGeometry=mo,b.Layers=gc,b.LensFlare=function Ey(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")},b.LessDepth=w,b.LessEqualDepth=Yt,b.LessEqualStencilFunc=515,b.LessStencilFunc=513,b.Light=ss,b.LightProbe=ac,b.Line=Ds,b.Line3=pd,b.LineBasicMaterial=or,b.LineCurve=Zo,b.LineCurve3=Ef,b.LineDashedMaterial=Ru,b.LineLoop=ru,b.LinePieces=1,b.LineSegments=Fr,b.LineStrip=0,b.LinearEncoding=Tt,b.LinearFilter=Cn,b.LinearInterpolant=Au,b.LinearMipMapLinearFilter=1008,b.LinearMipMapNearestFilter=1007,b.LinearMipmapLinearFilter=Dr,b.LinearMipmapNearestFilter=Jn,b.LinearToneMapping=W,b.Loader=Rr,b.LoaderUtils=dl,b.LoadingManager=Lu,b.LoopOnce=2200,b.LoopPingPong=2202,b.LoopRepeat=2201,b.LuminanceAlphaFormat=Ar,b.LuminanceFormat=Ia,b.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},b.Material=rr,b.MaterialLoader=Xf,b.Math=Qr,b.MathUtils=Qr,b.Matrix3=Ii,b.Matrix4=fn,b.MaxEquation=In,b.Mesh=$i,b.MeshBasicMaterial=Cs,b.MeshDepthMaterial=Bc,b.MeshDistanceMaterial=Oc,b.MeshFaceMaterial=function jv(r){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),r},b.MeshLambertMaterial=wu,b.MeshMatcapMaterial=Su,b.MeshNormalMaterial=Tu,b.MeshPhongMaterial=bu,b.MeshPhysicalMaterial=Eu,b.MeshStandardMaterial=fl,b.MeshToonMaterial=Mu,b.MinEquation=nn,b.MirroredRepeatWrapping=un,b.MixOperation=Ne,b.MultiMaterial=function qv(r=[]){return console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),r.isMultiMaterial=!0,r.materials=r,r.clone=function(){return r.slice()},r},b.MultiplyBlending=en,b.MultiplyOperation=Nn,b.NearestFilter=Dn,b.NearestMipMapLinearFilter=1005,b.NearestMipMapNearestFilter=1004,b.NearestMipmapLinearFilter=xr,b.NearestMipmapNearestFilter=vi,b.NeverDepth=Ue,b.NeverStencilFunc=512,b.NoBlending=dn,b.NoColors=0,b.NoToneMapping=P,b.NormalAnimationBlendMode=2500,b.NormalBlending=xt,b.NotEqualDepth=gn,b.NotEqualStencilFunc=517,b.NumberKeyframeTrack=tc,b.Object3D=li,b.ObjectLoader=class cv extends Rr{constructor(e){super(e)}load(e,t,n,i){const a=this,o=""===this.path?dl.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;const c=new ys(this.manager);c.setPath(this.path),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,function(l){let h=null;try{h=JSON.parse(l)}catch(m){return void 0!==i&&i(m),void console.error("THREE:ObjectLoader: Can't parse "+e+".",m.message)}const p=h.metadata;void 0!==p&&void 0!==p.type&&"geometry"!==p.type.toLowerCase()?a.parse(h,t):console.error("THREE.ObjectLoader: Can't load "+e)},n,i)}async loadAsync(e,t){const i=""===this.path?dl.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||i;const a=new ys(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials);const o=await a.loadAsync(e,t),c=JSON.parse(o),l=c.metadata;if(void 0===l||void 0===l.type||"geometry"===l.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+e);return await this.parseAsync(c)}parse(e,t){const n=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),a=this.parseGeometries(e.geometries,i),o=this.parseImages(e.images,function(){void 0!==t&&t(h)}),c=this.parseTextures(e.textures,o),l=this.parseMaterials(e.materials,c),h=this.parseObject(e.object,a,l,c,n),p=this.parseSkeletons(e.skeletons,h);if(this.bindSkeletons(h,p),void 0!==t){let m=!1;for(const g in o)if(o[g]instanceof HTMLImageElement){m=!0;break}!1===m&&t(h)}return h}async parseAsync(e){const t=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,n),a=await this.parseImagesAsync(e.images),o=this.parseTextures(e.textures,a),c=this.parseMaterials(e.materials,o),l=this.parseObject(e.object,i,c,o,t),h=this.parseSkeletons(e.skeletons,l);return this.bindSkeletons(l,h),l}parseShapes(e){const t={};if(void 0!==e)for(let n=0,i=e.length;n<i;n++){const a=(new ms).fromJSON(e[n]);t[a.uuid]=a}return t}parseSkeletons(e,t){const n={},i={};if(t.traverse(function(a){a.isBone&&(i[a.uuid]=a)}),void 0!==e)for(let a=0,o=e.length;a<o;a++){const c=(new Zc).fromJSON(e[a],i);n[c.uuid]=c}return n}parseGeometries(e,t){const n={};if(void 0!==e){const i=new jf;for(let a=0,o=e.length;a<o;a++){let c;const l=e[a];switch(l.type){case"BufferGeometry":case"InstancedBufferGeometry":c=i.parse(l);break;case"Geometry":console.error("THREE.ObjectLoader: The legacy Geometry type is no longer supported.");break;default:l.type in Lf?c=Lf[l.type].fromJSON(l,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${l.type}"`)}c.uuid=l.uuid,void 0!==l.name&&(c.name=l.name),!0===c.isBufferGeometry&&void 0!==l.userData&&(c.userData=l.userData),n[l.uuid]=c}}return n}parseMaterials(e,t){const n={},i={};if(void 0!==e){const a=new Xf;a.setTextures(t);for(let o=0,c=e.length;o<c;o++){const l=e[o];if("MultiMaterial"===l.type){const h=[];for(let p=0;p<l.materials.length;p++){const m=l.materials[p];void 0===n[m.uuid]&&(n[m.uuid]=a.parse(m)),h.push(n[m.uuid])}i[l.uuid]=h}else void 0===n[l.uuid]&&(n[l.uuid]=a.parse(l)),i[l.uuid]=n[l.uuid]}}return i}parseAnimations(e){const t={};if(void 0!==e)for(let n=0;n<e.length;n++){const a=ic.parse(e[n]);t[a.uuid]=a}return t}parseImages(e,t){const n=this,i={};let a;function c(l){if("string"==typeof l){const h=l;return function o(l){return n.manager.itemStart(l),a.load(l,function(){n.manager.itemEnd(l)},void 0,function(){n.manager.itemError(l),n.manager.itemEnd(l)})}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(h)?h:n.resourcePath+h)}return l.data?{data:us(l.type,l.data),width:l.width,height:l.height}:null}if(void 0!==e&&e.length>0){const l=new Lu(t);a=new rc(l),a.setCrossOrigin(this.crossOrigin);for(let h=0,p=e.length;h<p;h++){const m=e[h],g=m.url;if(Array.isArray(g)){i[m.uuid]=[];for(let v=0,x=g.length;v<x;v++){const L=c(g[v]);null!==L&&(L instanceof HTMLImageElement?i[m.uuid].push(L):i[m.uuid].push(new _a(L.data,L.width,L.height)))}}else{const v=c(m.url);null!==v&&(i[m.uuid]=v)}}}return i}async parseImagesAsync(e){const t=this,n={};let i;async function a(o){if("string"==typeof o){const c=o,l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c)?c:t.resourcePath+c;return await i.loadAsync(l)}return o.data?{data:us(o.type,o.data),width:o.width,height:o.height}:null}if(void 0!==e&&e.length>0){i=new rc(this.manager),i.setCrossOrigin(this.crossOrigin);for(let o=0,c=e.length;o<c;o++){const l=e[o],h=l.url;if(Array.isArray(h)){n[l.uuid]=[];for(let p=0,m=h.length;p<m;p++){const g=h[p],v=await a(g);null!==v&&(v instanceof HTMLImageElement?n[l.uuid].push(v):n[l.uuid].push(new _a(v.data,v.width,v.height)))}}else{const p=await a(l.url);null!==p&&(n[l.uuid]=p)}}}return n}parseTextures(e,t){function n(a,o){return"number"==typeof a?a:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",a),o[a])}const i={};if(void 0!==e)for(let a=0,o=e.length;a<o;a++){const c=e[a];let l;void 0===c.image&&console.warn('THREE.ObjectLoader: No "image" specified for',c.uuid),void 0===t[c.image]&&console.warn("THREE.ObjectLoader: Undefined image",c.image);const h=t[c.image];Array.isArray(h)?(l=new $a(h),6===h.length&&(l.needsUpdate=!0)):(l=h&&h.data?new _a(h.data,h.width,h.height):new zi(h),h&&(l.needsUpdate=!0)),l.uuid=c.uuid,void 0!==c.name&&(l.name=c.name),void 0!==c.mapping&&(l.mapping=n(c.mapping,lv)),void 0!==c.offset&&l.offset.fromArray(c.offset),void 0!==c.repeat&&l.repeat.fromArray(c.repeat),void 0!==c.center&&l.center.fromArray(c.center),void 0!==c.rotation&&(l.rotation=c.rotation),void 0!==c.wrap&&(l.wrapS=n(c.wrap[0],qf),l.wrapT=n(c.wrap[1],qf)),void 0!==c.format&&(l.format=c.format),void 0!==c.type&&(l.type=c.type),void 0!==c.encoding&&(l.encoding=c.encoding),void 0!==c.minFilter&&(l.minFilter=n(c.minFilter,Yf)),void 0!==c.magFilter&&(l.magFilter=n(c.magFilter,Yf)),void 0!==c.anisotropy&&(l.anisotropy=c.anisotropy),void 0!==c.flipY&&(l.flipY=c.flipY),void 0!==c.premultiplyAlpha&&(l.premultiplyAlpha=c.premultiplyAlpha),void 0!==c.unpackAlignment&&(l.unpackAlignment=c.unpackAlignment),void 0!==c.userData&&(l.userData=c.userData),i[c.uuid]=l}return i}parseObject(e,t,n,i,a){let o,p,m;function c(g){return void 0===t[g]&&console.warn("THREE.ObjectLoader: Undefined geometry",g),t[g]}function l(g){if(void 0!==g){if(Array.isArray(g)){const v=[];for(let x=0,T=g.length;x<T;x++){const L=g[x];void 0===n[L]&&console.warn("THREE.ObjectLoader: Undefined material",L),v.push(n[L])}return v}return void 0===n[g]&&console.warn("THREE.ObjectLoader: Undefined material",g),n[g]}}function h(g){return void 0===i[g]&&console.warn("THREE.ObjectLoader: Undefined texture",g),i[g]}switch(e.type){case"Scene":o=new kc,void 0!==e.background&&(o.background=Number.isInteger(e.background)?new Wt(e.background):h(e.background)),void 0!==e.environment&&(o.environment=h(e.environment)),void 0!==e.fog&&("Fog"===e.fog.type?o.fog=new ko(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(o.fog=new Ho(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":o=new ar(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(o.focus=e.focus),void 0!==e.zoom&&(o.zoom=e.zoom),void 0!==e.filmGauge&&(o.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(o.filmOffset=e.filmOffset),void 0!==e.view&&(o.view=Object.assign({},e.view));break;case"OrthographicCamera":o=new Uo(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(o.zoom=e.zoom),void 0!==e.view&&(o.view=Object.assign({},e.view));break;case"AmbientLight":o=new Uu(e.color,e.intensity);break;case"DirectionalLight":o=new Nu(e.color,e.intensity);break;case"PointLight":o=new Iu(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":o=new Bu(e.color,e.intensity,e.width,e.height);break;case"SpotLight":o=new Fu(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":o=new Cu(e.color,e.groundColor,e.intensity);break;case"LightProbe":o=(new ac).fromJSON(e);break;case"SkinnedMesh":p=c(e.geometry),m=l(e.material),o=new Yc(p,m),void 0!==e.bindMode&&(o.bindMode=e.bindMode),void 0!==e.bindMatrix&&o.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(o.skeleton=e.skeleton);break;case"Mesh":p=c(e.geometry),m=l(e.material),o=new $i(p,m);break;case"InstancedMesh":p=c(e.geometry),m=l(e.material);const v=e.instanceMatrix,x=e.instanceColor;o=new nu(p,m,e.count),o.instanceMatrix=new xa(new Float32Array(v.array),16),void 0!==x&&(o.instanceColor=new xa(new Float32Array(x.array),x.itemSize));break;case"LOD":o=new tf;break;case"Line":o=new Ds(c(e.geometry),l(e.material));break;case"LineLoop":o=new ru(c(e.geometry),l(e.material));break;case"LineSegments":o=new Fr(c(e.geometry),l(e.material));break;case"PointCloud":case"Points":o=new jo(c(e.geometry),l(e.material));break;case"Sprite":o=new Xc(l(e.material));break;case"Group":o=new va;break;case"Bone":o=new Kc;break;default:o=new li}if(o.uuid=e.uuid,void 0!==e.name&&(o.name=e.name),void 0!==e.matrix?(o.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(o.matrixAutoUpdate=e.matrixAutoUpdate),o.matrixAutoUpdate&&o.matrix.decompose(o.position,o.quaternion,o.scale)):(void 0!==e.position&&o.position.fromArray(e.position),void 0!==e.rotation&&o.rotation.fromArray(e.rotation),void 0!==e.quaternion&&o.quaternion.fromArray(e.quaternion),void 0!==e.scale&&o.scale.fromArray(e.scale)),void 0!==e.castShadow&&(o.castShadow=e.castShadow),void 0!==e.receiveShadow&&(o.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(o.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(o.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(o.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&o.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(o.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(o.visible=e.visible),void 0!==e.frustumCulled&&(o.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(o.renderOrder=e.renderOrder),void 0!==e.userData&&(o.userData=e.userData),void 0!==e.layers&&(o.layers.mask=e.layers),void 0!==e.children){const g=e.children;for(let v=0;v<g.length;v++)o.add(this.parseObject(g[v],t,n,i,a))}if(void 0!==e.animations){const g=e.animations;for(let v=0;v<g.length;v++)o.animations.push(a[g[v]])}if("LOD"===e.type){void 0!==e.autoUpdate&&(o.autoUpdate=e.autoUpdate);const g=e.levels;for(let v=0;v<g.length;v++){const x=g[v],T=o.getObjectByProperty("uuid",x.object);void 0!==T&&o.addLevel(T,x.distance)}}return o}bindSkeletons(e,t){0!==Object.keys(t).length&&e.traverse(function(n){if(!0===n.isSkinnedMesh&&void 0!==n.skeleton){const i=t[n.skeleton];void 0===i?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",n.skeleton):n.bind(i,n.bindMatrix)}})}setTexturePath(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}},b.ObjectSpaceNormalMap=An,b.OctahedronBufferGeometry=ba,b.OctahedronGeometry=ba,b.OneFactor=Ti,b.OneMinusDstAlphaFactor=ut,b.OneMinusDstColorFactor=Se,b.OneMinusSrcAlphaFactor=qe,b.OneMinusSrcColorFactor=Xi,b.OrthographicCamera=Uo,b.PCFShadowMap=tn,b.PCFSoftShadowMap=di,b.PMREMGenerator=xh,b.ParametricGeometry=function by(){return console.error("THREE.ParametricGeometry has been moved to /examples/jsm/geometries/ParametricGeometry.js"),new zn},b.Particle=function Kv(r){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Xc(r)},b.ParticleBasicMaterial=function $v(r){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new Ea(r)},b.ParticleSystem=function Zv(r,e){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new jo(r,e)},b.ParticleSystemMaterial=function Qv(r){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new Ea(r)},b.Path=Jo,b.PerspectiveCamera=ar,b.Plane=fs,b.PlaneBufferGeometry=pa,b.PlaneGeometry=pa,b.PlaneHelper=class Nv extends Ds{constructor(e,t=1,n=16776960){const i=n,o=new zn;o.setAttribute("position",new on([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),o.computeBoundingSphere(),super(o,new or({color:i,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const l=new zn;l.setAttribute("position",new on([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),l.computeBoundingSphere(),this.add(new $i(l,new Cs({color:i,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){let t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?Qt:_n,this.lookAt(this.plane.normal),super.updateMatrixWorld(e)}},b.PointCloud=function Yv(r,e){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new jo(r,e)},b.PointCloudMaterial=function Jv(r){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new Ea(r)},b.PointLight=Iu,b.PointLightHelper=class zv extends $i{constructor(e,t,n){super(new Ta(t,4,2),new Cs({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.light.updateMatrixWorld(),this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},b.Points=jo,b.PointsMaterial=Ea,b.PolarGridHelper=class Pv extends Fr{constructor(e=10,t=16,n=8,i=64,a=4473924,o=8947848){a=new Wt(a),o=new Wt(o);const c=[],l=[];for(let m=0;m<=t;m++){const g=m/t*(2*Math.PI),v=Math.sin(g)*e,x=Math.cos(g)*e;c.push(0,0,0),c.push(v,0,x);const T=1&m?a:o;l.push(T.r,T.g,T.b),l.push(T.r,T.g,T.b)}for(let m=0;m<=n;m++){const g=1&m?a:o,v=e-e/n*m;for(let x=0;x<i;x++){let T=x/i*(2*Math.PI),L=Math.sin(T)*v,E=Math.cos(T)*v;c.push(L,0,E),l.push(g.r,g.g,g.b),T=(x+1)/i*(2*Math.PI),L=Math.sin(T)*v,E=Math.cos(T)*v,c.push(L,0,E),l.push(g.r,g.g,g.b)}}const h=new zn;h.setAttribute("position",new on(c,3)),h.setAttribute("color",new on(l,3)),super(h,new or({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}},b.PolyhedronBufferGeometry=ps,b.PolyhedronGeometry=ps,b.PositionalAudio=class pv extends Gu{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(Ca,rd,dv),Pa.set(0,0,1).applyQuaternion(rd);const t=this.panner;if(t.positionX){const n=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(Ca.x,n),t.positionY.linearRampToValueAtTime(Ca.y,n),t.positionZ.linearRampToValueAtTime(Ca.z,n),t.orientationX.linearRampToValueAtTime(Pa.x,n),t.orientationY.linearRampToValueAtTime(Pa.y,n),t.orientationZ.linearRampToValueAtTime(Pa.z,n)}else t.setPosition(Ca.x,Ca.y,Ca.z),t.setOrientation(Pa.x,Pa.y,Pa.z)}},b.PropertyBinding=xi,b.PropertyMixer=ad,b.QuadraticBezierCurve=al,b.QuadraticBezierCurve3=ol,b.Quaternion=Ni,b.QuaternionKeyframeTrack=Eo,b.QuaternionLinearInterpolant=Ff,b.REVISION=Rt,b.RGBADepthPacking=It,b.RGBAFormat=pi,b.RGBAIntegerFormat=le,b.RGBA_ASTC_10x10_Format=rt,b.RGBA_ASTC_10x5_Format=Fe,b.RGBA_ASTC_10x6_Format=te,b.RGBA_ASTC_10x8_Format=He,b.RGBA_ASTC_12x10_Format=I,b.RGBA_ASTC_12x12_Format=oe,b.RGBA_ASTC_4x4_Format=N,b.RGBA_ASTC_5x4_Format=j,b.RGBA_ASTC_5x5_Format=ge,b.RGBA_ASTC_6x5_Format=V,b.RGBA_ASTC_6x6_Format=Q,b.RGBA_ASTC_8x5_Format=z,b.RGBA_ASTC_8x6_Format=B,b.RGBA_ASTC_8x8_Format=Te,b.RGBA_BPTC_Format=Ze,b.RGBA_ETC2_EAC_Format=Ce,b.RGBA_PVRTC_2BPPV1_Format=we,b.RGBA_PVRTC_4BPPV1_Format=Be,b.RGBA_S3TC_DXT1_Format=ye,b.RGBA_S3TC_DXT3_Format=ae,b.RGBA_S3TC_DXT5_Format=K,b.RGBFormat=br,b.RGBIntegerFormat=U,b.RGB_ETC1_Format=Ie,b.RGB_ETC2_Format=xe,b.RGB_PVRTC_2BPPV1_Format=Ee,b.RGB_PVRTC_4BPPV1_Format=me,b.RGB_S3TC_DXT1_Format=_e,b.RGFormat=S,b.RGIntegerFormat=C,b.RawShaderMaterial=eo,b.Ray=Js,b.Raycaster=class wv{constructor(e,t,n=0,i=1/0){this.ray=new Js(e,t),this.near=n,this.far=i,this.camera=null,this.layers=new gc,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,n=[]){return Xu(e,this,n,t),n.sort(hd),n}intersectObjects(e,t=!0,n=[]){for(let i=0,a=e.length;i<a;i++)Xu(e[i],this,n,t);return n.sort(hd),n}},b.RectAreaLight=Bu,b.RedFormat=Bs,b.RedIntegerFormat=d,b.ReinhardToneMapping=H,b.RepeatWrapping=ni,b.ReplaceStencilOp=7681,b.ReverseSubtractEquation=kn,b.RingBufferGeometry=go,b.RingGeometry=go,b.SRGB8_ALPHA8_ASTC_10x10_Format=Ts,b.SRGB8_ALPHA8_ASTC_10x5_Format=Ir,b.SRGB8_ALPHA8_ASTC_10x6_Format=Hr,b.SRGB8_ALPHA8_ASTC_10x8_Format=Hs,b.SRGB8_ALPHA8_ASTC_12x10_Format=Zi,b.SRGB8_ALPHA8_ASTC_12x12_Format=zr,b.SRGB8_ALPHA8_ASTC_4x4_Format=Et,b.SRGB8_ALPHA8_ASTC_5x4_Format=Ht,b.SRGB8_ALPHA8_ASTC_5x5_Format=Kn,b.SRGB8_ALPHA8_ASTC_6x5_Format=hi,b.SRGB8_ALPHA8_ASTC_6x6_Format=Zt,b.SRGB8_ALPHA8_ASTC_8x5_Format=tt,b.SRGB8_ALPHA8_ASTC_8x6_Format=pn,b.SRGB8_ALPHA8_ASTC_8x8_Format=Os,b.Scene=kc,b.SceneUtils=xy,b.ShaderChunk=si,b.ShaderLib=is,b.ShaderMaterial=Fs,b.ShadowMaterial=xu,b.Shape=ms,b.ShapeBufferGeometry=Ma,b.ShapeGeometry=Ma,b.ShapePath=class Bv{constructor(){this.type="ShapePath",this.color=new Wt,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new Jo,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,i){return this.currentPath.quadraticCurveTo(e,t,n,i),this}bezierCurveTo(e,t,n,i,a,o){return this.currentPath.bezierCurveTo(e,t,n,i,a,o),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e,t){function n(_){const D=[];for(let R=0,G=_.length;R<G;R++){const $=_[R],fe=new ms;fe.curves=$.curves,D.push(fe)}return D}function i(_,D){const R=D.length;let G=!1;for(let $=R-1,fe=0;fe<R;$=fe++){let Me=D[$],Je=D[fe],ke=Je.x-Me.x,be=Je.y-Me.y;if(Math.abs(be)>Number.EPSILON){if(be<0&&(Me=D[fe],ke=-ke,Je=D[$],be=-be),_.y<Me.y||_.y>Je.y)continue;if(_.y===Me.y){if(_.x===Me.x)return!0}else{const X=be*(_.x-Me.x)-ke*(_.y-Me.y);if(0===X)return!0;if(X<0)continue;G=!G}}else{if(_.y!==Me.y)continue;if(Je.x<=_.x&&_.x<=Me.x||Me.x<=_.x&&_.x<=Je.x)return!0}}return G}const a=gs.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===t)return n(o);let c,l,h;const p=[];if(1===o.length)return l=o[0],h=new ms,h.curves=l.curves,p.push(h),p;let m=!a(o[0].getPoints());m=e?!m:m;const g=[],v=[];let L,E,x=[],T=0;v[T]=void 0,x[T]=[];for(let _=0,D=o.length;_<D;_++)l=o[_],L=l.getPoints(),c=a(L),c=e?!c:c,c?(!m&&v[T]&&T++,v[T]={s:new ms,p:L},v[T].s.curves=l.curves,m&&T++,x[T]=[]):x[T].push({h:l,p:L[0]});if(!v[0])return n(o);if(v.length>1){let _=!1;const D=[];for(let R=0,G=v.length;R<G;R++)g[R]=[];for(let R=0,G=v.length;R<G;R++){const $=x[R];for(let fe=0;fe<$.length;fe++){const Me=$[fe];let Je=!0;for(let ke=0;ke<v.length;ke++)i(Me.p,v[ke].p)&&(R!==ke&&D.push({froms:R,tos:ke,hole:fe}),Je?(Je=!1,g[ke].push(Me)):_=!0);Je&&g[R].push(Me)}}D.length>0&&(_||(x=g))}for(let _=0,D=v.length;_<D;_++){h=v[_].s,p.push(h),E=x[_];for(let R=0,G=E.length;R<G;R++)h.holes.push(E[R].h)}return p}},b.ShapeUtils=gs,b.ShortType=Pn,b.Skeleton=Zc,b.SkeletonHelper=gd,b.SkinnedMesh=Yc,b.SmoothShading=2,b.Sphere=Ks,b.SphereBufferGeometry=Ta,b.SphereGeometry=Ta,b.Spherical=class Sv{constructor(e=1,t=0,n=0){return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(ji(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}},b.SphericalHarmonics3=Ou,b.SplineCurve=cl,b.SpotLight=Fu,b.SpotLightHelper=class Av extends li{constructor(e,t){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;const n=new zn,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let o=0,c=1,l=32;o<l;o++,c++){const h=o/l*Math.PI*2,p=c/l*Math.PI*2;i.push(Math.cos(h),Math.sin(h),1,Math.cos(p),Math.sin(p),1)}n.setAttribute("position",new on(i,3));const a=new or({fog:!1,toneMapped:!1});this.cone=new Fr(n,a),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),md.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(md),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},b.Sprite=Xc,b.SpriteMaterial=Gc,b.SrcAlphaFactor=at,b.SrcAlphaSaturateFactor=De,b.SrcColorFactor=nr,b.StaticCopyUsage=35046,b.StaticDrawUsage=pr,b.StaticReadUsage=35045,b.StereoCamera=class uv{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new ar,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new ar,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,Aa.copy(e.projectionMatrix);const i=t.eyeSep/2,a=i*t.near/t.focus,o=t.near*Math.tan(jr*t.fov*.5)/t.zoom;let c,l;ed.elements[12]=-i,Qf.elements[12]=i,c=-o*t.aspect+a,l=o*t.aspect+a,Aa.elements[0]=2*t.near/(l-c),Aa.elements[8]=(l+c)/(l-c),this.cameraL.projectionMatrix.copy(Aa),c=-o*t.aspect-a,l=o*t.aspect-a,Aa.elements[0]=2*t.near/(l-c),Aa.elements[8]=(l+c)/(l-c),this.cameraR.projectionMatrix.copy(Aa)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(ed),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(Qf)}},b.StreamCopyUsage=35042,b.StreamDrawUsage=35040,b.StreamReadUsage=35041,b.StringKeyframeTrack=Sa,b.SubtractEquation=qn,b.SubtractiveBlending=gt,b.TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},b.TangentSpaceNormalMap=Bt,b.TetrahedronBufferGeometry=vo,b.TetrahedronGeometry=vo,b.TextGeometry=function My(){return console.error("THREE.TextGeometry has been moved to /examples/jsm/geometries/TextGeometry.js"),new zn},b.Texture=zi,b.TextureLoader=Uf,b.TorusBufferGeometry=yo,b.TorusGeometry=yo,b.TorusKnotBufferGeometry=_o,b.TorusKnotGeometry=_o,b.Triangle=qi,b.TriangleFanDrawMode=2,b.TriangleStripDrawMode=1,b.TrianglesDrawMode=0,b.TubeBufferGeometry=xo,b.TubeGeometry=xo,b.UVMapping=300,b.Uint16Attribute=function ay(r,e){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new xc(r,e)},b.Uint16BufferAttribute=xc,b.Uint32Attribute=function cy(r,e){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new Ec(r,e)},b.Uint32BufferAttribute=Ec,b.Uint8Attribute=function iy(r,e){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new ah(r,e)},b.Uint8BufferAttribute=ah,b.Uint8ClampedAttribute=function ry(r,e){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new oh(r,e)},b.Uint8ClampedBufferAttribute=oh,b.Uniform=ml,b.UniformsLib=kt,b.UniformsUtils=dh,b.UnsignedByteType=Qe,b.UnsignedInt248Type=Jr,b.UnsignedIntType=hr,b.UnsignedShort4444Type=fr,b.UnsignedShort5551Type=Un,b.UnsignedShort565Type=cc,b.UnsignedShortType=cr,b.VSMShadowMap=Rn,b.Vector2=st,b.Vector3=O,b.Vector4=rn,b.VectorKeyframeTrack=nc,b.Vertex=function ey(r,e,t){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new O(r,e,t)},b.VertexColors=2,b.VideoTexture=vf,b.WebGL1Renderer=Zh,b.WebGLCubeRenderTarget=Cc,b.WebGLMultipleRenderTargets=Pr,b.WebGLMultisampleRenderTarget=mr,b.WebGLRenderTarget=Li,b.WebGLRenderTargetCube=function vy(r,e,t){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new Cc(r,t)},b.WebGLRenderer=Ri,b.WebGLUtils=Kh,b.WireframeGeometry=_u,b.WireframeHelper=function py(r,e){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new Fr(new _u(r.geometry),new or({color:void 0!==e?e:16777215}))},b.WrapAroundEnding=de,b.XHRLoader=function my(r){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new ys(r)},b.ZeroCurvatureEnding=M,b.ZeroFactor=Ln,b.ZeroSlopeEnding=F,b.ZeroStencilOp=0,b.sRGBEncoding=_t,Object.defineProperty(b,"__esModule",{value:!0})}),function(){class b extends THREE.Loader{constructor(A){super(A),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(P){return new Ge(P)}),this.register(function(P){return new Rn(P)}),this.register(function(P){return new _n(P)}),this.register(function(P){return new J(P)}),this.register(function(P){return new dt(P)}),this.register(function(P){return new $e(P)}),this.register(function(P){return new tn(P)}),this.register(function(P){return new di(P)}),this.register(function(P){return new nt(P)}),this.register(function(P){return new Qt(P)})}load(A,P,W,H){const ee=this;let ie;ie=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:THREE.LoaderUtils.extractUrlBase(A),this.manager.itemStart(A);const ve=function(Re){H?H(Re):console.error(Re),ee.manager.itemError(A),ee.manager.itemEnd(A)},ce=new THREE.FileLoader(this.manager);ce.setPath(this.path),ce.setResponseType("arraybuffer"),ce.setRequestHeader(this.requestHeader),ce.setWithCredentials(this.withCredentials),ce.load(A,function(Re){try{ee.parse(Re,ie,function(pt){P(pt),ee.manager.itemEnd(A)},ve)}catch(pt){ve(pt)}},W,ve)}setDRACOLoader(A){return this.dracoLoader=A,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(A){return this.ktx2Loader=A,this}setMeshoptDecoder(A){return this.meshoptDecoder=A,this}register(A){return-1===this.pluginCallbacks.indexOf(A)&&this.pluginCallbacks.push(A),this}unregister(A){return-1!==this.pluginCallbacks.indexOf(A)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(A),1),this}parse(A,P,W,H){let ee;const ie={},ve={};if("string"==typeof A)ee=A;else if(THREE.LoaderUtils.decodeText(new Uint8Array(A,0,4))===ti){try{ie[ue.KHR_BINARY_GLTF]=new dn(A)}catch(Oe){return void(H&&H(Oe))}ee=ie[ue.KHR_BINARY_GLTF].content}else ee=THREE.LoaderUtils.decodeText(new Uint8Array(A));const ce=JSON.parse(ee);if(void 0===ce.asset||ce.asset.version[0]<2)return void(H&&H(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const Re=new xn(ce,{path:P||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});Re.fileLoader.setRequestHeader(this.requestHeader);for(let pt=0;pt<this.pluginCallbacks.length;pt++){const Oe=this.pluginCallbacks[pt](Re);ve[Oe.name]=Oe,ie[Oe.name]=!0}if(ce.extensionsUsed)for(let pt=0;pt<ce.extensionsUsed.length;++pt){const Oe=ce.extensionsUsed[pt],Dt=ce.extensionsRequired||[];switch(Oe){case ue.KHR_MATERIALS_UNLIT:ie[Oe]=new mt;break;case ue.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:ie[Oe]=new en;break;case ue.KHR_DRACO_MESH_COMPRESSION:ie[Oe]=new xt(ce,this.dracoLoader);break;case ue.KHR_TEXTURE_TRANSFORM:ie[Oe]=new sn;break;case ue.KHR_MESH_QUANTIZATION:ie[Oe]=new cn;break;default:Dt.indexOf(Oe)>=0&&void 0===ve[Oe]&&console.warn('THREE.GLTFLoader: Unknown extension "'+Oe+'".')}}Re.setExtensions(ie),Re.setPlugins(ve),Re.parse(W,H)}parseAsync(A,P){const W=this;return new Promise(function(H,ee){W.parse(A,P,H,ee)})}}function Rt(){let Ne={};return{get:function(A){return Ne[A]},add:function(A,P){Ne[A]=P},remove:function(A){delete Ne[A]},removeAll:function(){Ne={}}}}const ue={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class nt{constructor(A){this.parser=A,this.name=ue.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const A=this.parser,P=this.parser.json.nodes||[];for(let W=0,H=P.length;W<H;W++){const ee=P[W];ee.extensions&&ee.extensions[this.name]&&void 0!==ee.extensions[this.name].light&&A._addNodeRef(this.cache,ee.extensions[this.name].light)}}_loadLight(A){const P=this.parser,W="light:"+A;let H=P.cache.get(W);if(H)return H;const ee=P.json,ce=((ee.extensions&&ee.extensions[this.name]||{}).lights||[])[A];let Re;const pt=new THREE.Color(16777215);void 0!==ce.color&&pt.fromArray(ce.color);const Oe=void 0!==ce.range?ce.range:0;switch(ce.type){case"directional":Re=new THREE.DirectionalLight(pt),Re.target.position.set(0,0,-1),Re.add(Re.target);break;case"point":Re=new THREE.PointLight(pt),Re.distance=Oe;break;case"spot":Re=new THREE.SpotLight(pt),Re.distance=Oe,ce.spot=ce.spot||{},ce.spot.innerConeAngle=void 0!==ce.spot.innerConeAngle?ce.spot.innerConeAngle:0,ce.spot.outerConeAngle=void 0!==ce.spot.outerConeAngle?ce.spot.outerConeAngle:Math.PI/4,Re.angle=ce.spot.outerConeAngle,Re.penumbra=1-ce.spot.innerConeAngle/ce.spot.outerConeAngle,Re.target.position.set(0,0,-1),Re.add(Re.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+ce.type)}return Re.position.set(0,0,0),Re.decay=2,void 0!==ce.intensity&&(Re.intensity=ce.intensity),Re.name=P.createUniqueName(ce.name||"light_"+A),H=Promise.resolve(Re),P.cache.add(W,H),H}createNodeAttachment(A){const P=this,W=this.parser,ee=W.json.nodes[A],ve=(ee.extensions&&ee.extensions[this.name]||{}).light;return void 0===ve?null:this._loadLight(ve).then(function(ce){return W._getNodeRef(P.cache,ve,ce)})}}class mt{constructor(){this.name=ue.KHR_MATERIALS_UNLIT}getMaterialType(){return THREE.MeshBasicMaterial}extendParams(A,P,W){const H=[];A.color=new THREE.Color(1,1,1),A.opacity=1;const ee=P.pbrMetallicRoughness;if(ee){if(Array.isArray(ee.baseColorFactor)){const ie=ee.baseColorFactor;A.color.fromArray(ie),A.opacity=ie[3]}void 0!==ee.baseColorTexture&&H.push(W.assignTexture(A,"map",ee.baseColorTexture))}return Promise.all(H)}}class Ge{constructor(A){this.parser=A,this.name=ue.KHR_MATERIALS_CLEARCOAT}getMaterialType(A){const W=this.parser.json.materials[A];return W.extensions&&W.extensions[this.name]?THREE.MeshPhysicalMaterial:null}extendMaterialParams(A,P){const W=this.parser,H=W.json.materials[A];if(!H.extensions||!H.extensions[this.name])return Promise.resolve();const ee=[],ie=H.extensions[this.name];if(void 0!==ie.clearcoatFactor&&(P.clearcoat=ie.clearcoatFactor),void 0!==ie.clearcoatTexture&&ee.push(W.assignTexture(P,"clearcoatMap",ie.clearcoatTexture)),void 0!==ie.clearcoatRoughnessFactor&&(P.clearcoatRoughness=ie.clearcoatRoughnessFactor),void 0!==ie.clearcoatRoughnessTexture&&ee.push(W.assignTexture(P,"clearcoatRoughnessMap",ie.clearcoatRoughnessTexture)),void 0!==ie.clearcoatNormalTexture&&(ee.push(W.assignTexture(P,"clearcoatNormalMap",ie.clearcoatNormalTexture)),void 0!==ie.clearcoatNormalTexture.scale)){const ve=ie.clearcoatNormalTexture.scale;P.clearcoatNormalScale=new THREE.Vector2(ve,ve)}return Promise.all(ee)}}class J{constructor(A){this.parser=A,this.name=ue.KHR_MATERIALS_SHEEN}getMaterialType(A){const W=this.parser.json.materials[A];return W.extensions&&W.extensions[this.name]?THREE.MeshPhysicalMaterial:null}extendMaterialParams(A,P){const W=this.parser,H=W.json.materials[A];if(!H.extensions||!H.extensions[this.name])return Promise.resolve();const ee=[];P.sheenColor=new THREE.Color(0,0,0),P.sheenRoughness=0,P.sheen=1;const ie=H.extensions[this.name];return void 0!==ie.sheenColorFactor&&P.sheenColor.fromArray(ie.sheenColorFactor),void 0!==ie.sheenRoughnessFactor&&(P.sheenRoughness=ie.sheenRoughnessFactor),void 0!==ie.sheenColorTexture&&ee.push(W.assignTexture(P,"sheenColorMap",ie.sheenColorTexture)),void 0!==ie.sheenRoughnessTexture&&ee.push(W.assignTexture(P,"sheenRoughnessMap",ie.sheenRoughnessTexture)),Promise.all(ee)}}class dt{constructor(A){this.parser=A,this.name=ue.KHR_MATERIALS_TRANSMISSION}getMaterialType(A){const W=this.parser.json.materials[A];return W.extensions&&W.extensions[this.name]?THREE.MeshPhysicalMaterial:null}extendMaterialParams(A,P){const W=this.parser,H=W.json.materials[A];if(!H.extensions||!H.extensions[this.name])return Promise.resolve();const ee=[],ie=H.extensions[this.name];return void 0!==ie.transmissionFactor&&(P.transmission=ie.transmissionFactor),void 0!==ie.transmissionTexture&&ee.push(W.assignTexture(P,"transmissionMap",ie.transmissionTexture)),Promise.all(ee)}}class $e{constructor(A){this.parser=A,this.name=ue.KHR_MATERIALS_VOLUME}getMaterialType(A){const W=this.parser.json.materials[A];return W.extensions&&W.extensions[this.name]?THREE.MeshPhysicalMaterial:null}extendMaterialParams(A,P){const W=this.parser,H=W.json.materials[A];if(!H.extensions||!H.extensions[this.name])return Promise.resolve();const ee=[],ie=H.extensions[this.name];P.thickness=void 0!==ie.thicknessFactor?ie.thicknessFactor:0,void 0!==ie.thicknessTexture&&ee.push(W.assignTexture(P,"thicknessMap",ie.thicknessTexture)),P.attenuationDistance=ie.attenuationDistance||0;const ve=ie.attenuationColor||[1,1,1];return P.attenuationColor=new THREE.Color(ve[0],ve[1],ve[2]),Promise.all(ee)}}class tn{constructor(A){this.parser=A,this.name=ue.KHR_MATERIALS_IOR}getMaterialType(A){const W=this.parser.json.materials[A];return W.extensions&&W.extensions[this.name]?THREE.MeshPhysicalMaterial:null}extendMaterialParams(A,P){const H=this.parser.json.materials[A];if(!H.extensions||!H.extensions[this.name])return Promise.resolve();const ee=H.extensions[this.name];return P.ior=void 0!==ee.ior?ee.ior:1.5,Promise.resolve()}}class di{constructor(A){this.parser=A,this.name=ue.KHR_MATERIALS_SPECULAR}getMaterialType(A){const W=this.parser.json.materials[A];return W.extensions&&W.extensions[this.name]?THREE.MeshPhysicalMaterial:null}extendMaterialParams(A,P){const W=this.parser,H=W.json.materials[A];if(!H.extensions||!H.extensions[this.name])return Promise.resolve();const ee=[],ie=H.extensions[this.name];P.specularIntensity=void 0!==ie.specularFactor?ie.specularFactor:1,void 0!==ie.specularTexture&&ee.push(W.assignTexture(P,"specularIntensityMap",ie.specularTexture));const ve=ie.specularColorFactor||[1,1,1];return P.specularColor=new THREE.Color(ve[0],ve[1],ve[2]),void 0!==ie.specularColorTexture&&ee.push(W.assignTexture(P,"specularColorMap",ie.specularColorTexture).then(function(ce){ce.encoding=THREE.sRGBEncoding})),Promise.all(ee)}}class Rn{constructor(A){this.parser=A,this.name=ue.KHR_TEXTURE_BASISU}loadTexture(A){const P=this.parser,W=P.json,H=W.textures[A];if(!H.extensions||!H.extensions[this.name])return null;const ie=W.images[H.extensions[this.name].source],ve=P.options.ktx2Loader;if(!ve){if(W.extensionsRequired&&W.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return P.loadTextureImage(A,ie,ve)}}class _n{constructor(A){this.parser=A,this.name=ue.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(A){const P=this.name,W=this.parser,H=W.json,ee=H.textures[A];if(!ee.extensions||!ee.extensions[P])return null;const ve=H.images[ee.extensions[P].source];let ce=W.textureLoader;if(ve.uri){const Re=W.options.manager.getHandler(ve.uri);null!==Re&&(ce=Re)}return this.detectSupport().then(function(Re){if(Re)return W.loadTextureImage(A,ve,ce);if(H.extensionsRequired&&H.extensionsRequired.indexOf(P)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return W.loadTexture(A)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(A){const P=new Image;P.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",P.onload=P.onerror=function(){A(1===P.height)}})),this.isSupported}}class Qt{constructor(A){this.name=ue.EXT_MESHOPT_COMPRESSION,this.parser=A}loadBufferView(A){const P=this.parser.json,W=P.bufferViews[A];if(W.extensions&&W.extensions[this.name]){const H=W.extensions[this.name],ee=this.parser.getDependency("buffer",H.buffer),ie=this.parser.options.meshoptDecoder;if(!ie||!ie.supported){if(P.extensionsRequired&&P.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([ee,ie.ready]).then(function(ve){const ce=H.byteOffset||0,Re=H.byteLength||0,pt=H.count,Oe=H.byteStride,Dt=new ArrayBuffer(pt*Oe),zt=new Uint8Array(ve[0],ce,Re);return ie.decodeGltfBuffer(new Uint8Array(Dt),pt,Oe,zt,H.mode,H.filter),Dt})}return null}}const ti="glTF";class dn{constructor(A){this.name=ue.KHR_BINARY_GLTF,this.content=null,this.body=null;const P=new DataView(A,0,12);if(this.header={magic:THREE.LoaderUtils.decodeText(new Uint8Array(A.slice(0,4))),version:P.getUint32(4,!0),length:P.getUint32(8,!0)},this.header.magic!==ti)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const W=this.header.length-12,H=new DataView(A,12);let ee=0;for(;ee<W;){const ie=H.getUint32(ee,!0);ee+=4;const ve=H.getUint32(ee,!0);if(ee+=4,1313821514===ve){const ce=new Uint8Array(A,12+ee,ie);this.content=THREE.LoaderUtils.decodeText(ce)}else if(5130562===ve){const ce=12+ee;this.body=A.slice(ce,ce+ie)}ee+=ie}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class xt{constructor(A,P){if(!P)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=ue.KHR_DRACO_MESH_COMPRESSION,this.json=A,this.dracoLoader=P,this.dracoLoader.preload()}decodePrimitive(A,P){const W=this.json,H=this.dracoLoader,ee=A.extensions[this.name].bufferView,ie=A.extensions[this.name].attributes,ve={},ce={},Re={};for(const pt in ie){const Oe=Xi[pt]||pt.toLowerCase();ve[Oe]=ie[pt]}for(const pt in A.attributes){const Oe=Xi[pt]||pt.toLowerCase();if(void 0!==ie[pt]){const Dt=W.accessors[A.attributes[pt]];Re[Oe]=In[Dt.componentType],ce[Oe]=!0===Dt.normalized}}return P.getDependency("bufferView",ee).then(function(pt){return new Promise(function(Oe){H.decodeDracoFile(pt,function(Dt){for(const zt in Dt.attributes){const ni=ce[zt];void 0!==ni&&(Dt.attributes[zt].normalized=ni)}Oe(Dt)},ve,Re)})})}}class sn{constructor(){this.name=ue.KHR_TEXTURE_TRANSFORM}extendTexture(A,P){return void 0!==P.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===P.offset&&void 0===P.rotation&&void 0===P.scale||(A=A.clone(),void 0!==P.offset&&A.offset.fromArray(P.offset),void 0!==P.rotation&&(A.rotation=P.rotation),void 0!==P.scale&&A.repeat.fromArray(P.scale),A.needsUpdate=!0),A}}class gt extends THREE.MeshStandardMaterial{constructor(A){super(),this.isGLTFSpecularGlossinessMaterial=!0;const P=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),W=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),H=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),ee=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),ie=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),ve={specular:{value:(new THREE.Color).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=ve,this.onBeforeCompile=function(ce){for(const Re in ve)ce.uniforms[Re]=ve[Re];ce.fragmentShader=ce.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",P).replace("#include <metalnessmap_pars_fragment>",W).replace("#include <roughnessmap_fragment>",H).replace("#include <metalnessmap_fragment>",ee).replace("#include <lights_physical_fragment>",ie)},Object.defineProperties(this,{specular:{get:function(){return ve.specular.value},set:function(ce){ve.specular.value=ce}},specularMap:{get:function(){return ve.specularMap.value},set:function(ce){ve.specularMap.value=ce,ce?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return ve.glossiness.value},set:function(ce){ve.glossiness.value=ce}},glossinessMap:{get:function(){return ve.glossinessMap.value},set:function(ce){ve.glossinessMap.value=ce,ce?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(A)}copy(A){return super.copy(A),this.specularMap=A.specularMap,this.specular.copy(A.specular),this.glossinessMap=A.glossinessMap,this.glossiness=A.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class en{constructor(){this.name=ue.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return gt}extendParams(A,P,W){const H=P.extensions[this.name];A.color=new THREE.Color(1,1,1),A.opacity=1;const ee=[];if(Array.isArray(H.diffuseFactor)){const ie=H.diffuseFactor;A.color.fromArray(ie),A.opacity=ie[3]}if(void 0!==H.diffuseTexture&&ee.push(W.assignTexture(A,"map",H.diffuseTexture)),A.emissive=new THREE.Color(0,0,0),A.glossiness=void 0!==H.glossinessFactor?H.glossinessFactor:1,A.specular=new THREE.Color(1,1,1),Array.isArray(H.specularFactor)&&A.specular.fromArray(H.specularFactor),void 0!==H.specularGlossinessTexture){const ie=H.specularGlossinessTexture;ee.push(W.assignTexture(A,"glossinessMap",ie)),ee.push(W.assignTexture(A,"specularMap",ie))}return Promise.all(ee)}createMaterial(A){const P=new gt(A);return P.fog=!0,P.color=A.color,P.map=void 0===A.map?null:A.map,P.lightMap=null,P.lightMapIntensity=1,P.aoMap=void 0===A.aoMap?null:A.aoMap,P.aoMapIntensity=1,P.emissive=A.emissive,P.emissiveIntensity=1,P.emissiveMap=void 0===A.emissiveMap?null:A.emissiveMap,P.bumpMap=void 0===A.bumpMap?null:A.bumpMap,P.bumpScale=1,P.normalMap=void 0===A.normalMap?null:A.normalMap,P.normalMapType=THREE.TangentSpaceNormalMap,A.normalScale&&(P.normalScale=A.normalScale),P.displacementMap=null,P.displacementScale=1,P.displacementBias=0,P.specularMap=void 0===A.specularMap?null:A.specularMap,P.specular=A.specular,P.glossinessMap=void 0===A.glossinessMap?null:A.glossinessMap,P.glossiness=A.glossiness,P.alphaMap=null,P.envMap=void 0===A.envMap?null:A.envMap,P.envMapIntensity=1,P.refractionRatio=.98,P}}class cn{constructor(){this.name=ue.KHR_MESH_QUANTIZATION}}class Kt extends THREE.Interpolant{constructor(A,P,W,H){super(A,P,W,H)}copySampleValue_(A){const P=this.resultBuffer,W=this.sampleValues,H=this.valueSize,ee=A*H*3+H;for(let ie=0;ie!==H;ie++)P[ie]=W[ee+ie];return P}}Kt.prototype.beforeStart_=Kt.prototype.copySampleValue_,Kt.prototype.afterEnd_=Kt.prototype.copySampleValue_,Kt.prototype.interpolate_=function(Ne,A,P,W){const H=this.resultBuffer,ee=this.sampleValues,ie=this.valueSize,ve=2*ie,ce=3*ie,Re=W-A,pt=(P-A)/Re,Oe=pt*pt,Dt=Oe*pt,zt=Ne*ce,Yn=zt-ce,ni=-2*Dt+3*Oe,St=Dt-Oe,un=1-ni,Dn=St-Oe+pt;for(let vi=0;vi!==ie;vi++)H[vi]=un*ee[Yn+vi+ie]+Dn*(ee[Yn+vi+ve]*Re)+ni*ee[zt+vi+ie]+St*(ee[zt+vi]*Re);return H};const qn=new THREE.Quaternion;class kn extends Kt{interpolate_(A,P,W,H){const ee=super.interpolate_(A,P,W,H);return qn.fromArray(ee).normalize().toArray(ee),ee}}const In={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Ln={9728:THREE.NearestFilter,9729:THREE.LinearFilter,9984:THREE.NearestMipmapNearestFilter,9985:THREE.LinearMipmapNearestFilter,9986:THREE.NearestMipmapLinearFilter,9987:THREE.LinearMipmapLinearFilter},Ti={33071:THREE.ClampToEdgeWrapping,33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping},nr={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Xi={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},at={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},qe={CUBICSPLINE:void 0,LINEAR:THREE.InterpolateLinear,STEP:THREE.InterpolateDiscrete};function Ut(Ne,A,P){for(const W in P.extensions)void 0===Ne[W]&&(A.userData.gltfExtensions=A.userData.gltfExtensions||{},A.userData.gltfExtensions[W]=P.extensions[W])}function Se(Ne,A){void 0!==A.extras&&("object"==typeof A.extras?Object.assign(Ne.userData,A.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+A.extras))}function Ue(Ne,A){if(Ne.updateMorphTargets(),void 0!==A.weights)for(let P=0,W=A.weights.length;P<W;P++)Ne.morphTargetInfluences[P]=A.weights[P];if(A.extras&&Array.isArray(A.extras.targetNames)){const P=A.extras.targetNames;if(Ne.morphTargetInfluences.length===P.length){Ne.morphTargetDictionary={};for(let W=0,H=P.length;W<H;W++)Ne.morphTargetDictionary[P[W]]=W}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function se(Ne){const A=Ne.extensions&&Ne.extensions[ue.KHR_DRACO_MESH_COMPRESSION];let P;return P=A?"draco:"+A.bufferView+":"+A.indices+":"+w(A.attributes):Ne.indices+":"+w(Ne.attributes)+":"+Ne.mode,P}function w(Ne){let A="";const P=Object.keys(Ne).sort();for(let W=0,H=P.length;W<H;W++)A+=P[W]+":"+Ne[P[W]]+";";return A}function Yt(Ne){switch(Ne){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class xn{constructor(A={},P={}){this.json=A,this.extensions={},this.plugins={},this.options=P,this.cache=new Rt,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.textureCache={},this.nodeNamesUsed={},this.textureLoader=typeof createImageBitmap<"u"&&!1===/Firefox|Safari/.test(navigator.userAgent)?new THREE.ImageBitmapLoader(this.options.manager):new THREE.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new THREE.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(A){this.extensions=A}setPlugins(A){this.plugins=A}parse(A,P){const W=this,H=this.json,ee=this.extensions;this.cache.removeAll(),this._invokeAll(function(ie){return ie._markDefs&&ie._markDefs()}),Promise.all(this._invokeAll(function(ie){return ie.beforeRoot&&ie.beforeRoot()})).then(function(){return Promise.all([W.getDependencies("scene"),W.getDependencies("animation"),W.getDependencies("camera")])}).then(function(ie){const ve={scene:ie[0][H.scene||0],scenes:ie[0],animations:ie[1],cameras:ie[2],asset:H.asset,parser:W,userData:{}};Ut(ee,ve,H),Se(ve,H),Promise.all(W._invokeAll(function(ce){return ce.afterRoot&&ce.afterRoot(ve)})).then(function(){A(ve)})}).catch(P)}_markDefs(){const A=this.json.nodes||[],P=this.json.skins||[],W=this.json.meshes||[];for(let H=0,ee=P.length;H<ee;H++){const ie=P[H].joints;for(let ve=0,ce=ie.length;ve<ce;ve++)A[ie[ve]].isBone=!0}for(let H=0,ee=A.length;H<ee;H++){const ie=A[H];void 0!==ie.mesh&&(this._addNodeRef(this.meshCache,ie.mesh),void 0!==ie.skin&&(W[ie.mesh].isSkinnedMesh=!0)),void 0!==ie.camera&&this._addNodeRef(this.cameraCache,ie.camera)}}_addNodeRef(A,P){void 0!==P&&(void 0===A.refs[P]&&(A.refs[P]=A.uses[P]=0),A.refs[P]++)}_getNodeRef(A,P,W){if(A.refs[P]<=1)return W;const H=W.clone(),ee=(ie,ve)=>{const ce=this.associations.get(ie);null!=ce&&this.associations.set(ve,ce);for(const[Re,pt]of ie.children.entries())ee(pt,ve.children[Re])};return ee(W,H),H.name+="_instance_"+A.uses[P]++,H}_invokeOne(A){const P=Object.values(this.plugins);P.push(this);for(let W=0;W<P.length;W++){const H=A(P[W]);if(H)return H}return null}_invokeAll(A){const P=Object.values(this.plugins);P.unshift(this);const W=[];for(let H=0;H<P.length;H++){const ee=A(P[H]);ee&&W.push(ee)}return W}getDependency(A,P){const W=A+":"+P;let H=this.cache.get(W);if(!H){switch(A){case"scene":H=this.loadScene(P);break;case"node":H=this.loadNode(P);break;case"mesh":H=this._invokeOne(function(ee){return ee.loadMesh&&ee.loadMesh(P)});break;case"accessor":H=this.loadAccessor(P);break;case"bufferView":H=this._invokeOne(function(ee){return ee.loadBufferView&&ee.loadBufferView(P)});break;case"buffer":H=this.loadBuffer(P);break;case"material":H=this._invokeOne(function(ee){return ee.loadMaterial&&ee.loadMaterial(P)});break;case"texture":H=this._invokeOne(function(ee){return ee.loadTexture&&ee.loadTexture(P)});break;case"skin":H=this.loadSkin(P);break;case"animation":H=this.loadAnimation(P);break;case"camera":H=this.loadCamera(P);break;default:throw new Error("Unknown type: "+A)}this.cache.add(W,H)}return H}getDependencies(A){let P=this.cache.get(A);if(!P){const W=this;P=Promise.all((this.json[A+("mesh"===A?"es":"s")]||[]).map(function(ee,ie){return W.getDependency(A,ie)})),this.cache.add(A,P)}return P}loadBuffer(A){const P=this.json.buffers[A],W=this.fileLoader;if(P.type&&"arraybuffer"!==P.type)throw new Error("THREE.GLTFLoader: "+P.type+" buffer type is not supported.");if(void 0===P.uri&&0===A)return Promise.resolve(this.extensions[ue.KHR_BINARY_GLTF].body);const H=this.options;return new Promise(function(ee,ie){W.load(THREE.LoaderUtils.resolveURL(P.uri,H.path),ee,void 0,function(){ie(new Error('THREE.GLTFLoader: Failed to load buffer "'+P.uri+'".'))})})}loadBufferView(A){const P=this.json.bufferViews[A];return this.getDependency("buffer",P.buffer).then(function(W){const ee=P.byteOffset||0;return W.slice(ee,ee+(P.byteLength||0))})}loadAccessor(A){const P=this,W=this.json,H=this.json.accessors[A];if(void 0===H.bufferView&&void 0===H.sparse)return Promise.resolve(null);const ee=[];return ee.push(void 0!==H.bufferView?this.getDependency("bufferView",H.bufferView):null),void 0!==H.sparse&&(ee.push(this.getDependency("bufferView",H.sparse.indices.bufferView)),ee.push(this.getDependency("bufferView",H.sparse.values.bufferView))),Promise.all(ee).then(function(ie){const ve=ie[0],ce=nr[H.type],Re=In[H.componentType],pt=Re.BYTES_PER_ELEMENT,Dt=H.byteOffset||0,zt=void 0!==H.bufferView?W.bufferViews[H.bufferView].byteStride:void 0,Yn=!0===H.normalized;let ni,St;if(zt&&zt!==pt*ce){const un=Math.floor(Dt/zt),Dn="InterleavedBuffer:"+H.bufferView+":"+H.componentType+":"+un+":"+H.count;let vi=P.cache.get(Dn);vi||(ni=new Re(ve,un*zt,H.count*zt/pt),vi=new THREE.InterleavedBuffer(ni,zt/pt),P.cache.add(Dn,vi)),St=new THREE.InterleavedBufferAttribute(vi,ce,Dt%zt/pt,Yn)}else ni=null===ve?new Re(H.count*ce):new Re(ve,Dt,H.count*ce),St=new THREE.BufferAttribute(ni,ce,Yn);if(void 0!==H.sparse){const yi=H.sparse.values.byteOffset||0,xr=new(0,In[H.sparse.indices.componentType])(ie[1],H.sparse.indices.byteOffset||0,H.sparse.count*nr.SCALAR),Si=new Re(ie[2],yi,H.sparse.count*ce);null!==ve&&(St=new THREE.BufferAttribute(St.array.slice(),St.itemSize,St.normalized));for(let Cn=0,Jn=xr.length;Cn<Jn;Cn++){const ui=xr[Cn];if(St.setX(ui,Si[Cn*ce]),ce>=2&&St.setY(ui,Si[Cn*ce+1]),ce>=3&&St.setZ(ui,Si[Cn*ce+2]),ce>=4&&St.setW(ui,Si[Cn*ce+3]),ce>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse THREE.BufferAttribute.")}}return St})}loadTexture(A){const P=this.json,ee=P.images[P.textures[A].source];let ie=this.textureLoader;if(ee.uri){const ve=this.options.manager.getHandler(ee.uri);null!==ve&&(ie=ve)}return this.loadTextureImage(A,ee,ie)}loadTextureImage(A,P,W){const H=this,ee=this.json,ie=this.options,ve=ee.textures[A],ce=(P.uri||P.bufferView)+":"+ve.sampler;if(this.textureCache[ce])return this.textureCache[ce];const Re=self.URL||self.webkitURL;let pt=P.uri||"",Oe=!1;if(void 0!==P.bufferView)pt=H.getDependency("bufferView",P.bufferView).then(function(zt){Oe=!0;const Yn=new Blob([zt],{type:P.mimeType});return pt=Re.createObjectURL(Yn),pt});else if(void 0===P.uri)throw new Error("THREE.GLTFLoader: Image "+A+" is missing URI and bufferView");const Dt=Promise.resolve(pt).then(function(zt){return new Promise(function(Yn,ni){let St=Yn;!0===W.isImageBitmapLoader&&(St=function(un){const Dn=new THREE.Texture(un);Dn.needsUpdate=!0,Yn(Dn)}),W.load(THREE.LoaderUtils.resolveURL(zt,ie.path),St,void 0,ni)})}).then(function(zt){!0===Oe&&Re.revokeObjectURL(pt),zt.flipY=!1,ve.name&&(zt.name=ve.name);const ni=(ee.samplers||{})[ve.sampler]||{};return zt.magFilter=Ln[ni.magFilter]||THREE.LinearFilter,zt.minFilter=Ln[ni.minFilter]||THREE.LinearMipmapLinearFilter,zt.wrapS=Ti[ni.wrapS]||THREE.RepeatWrapping,zt.wrapT=Ti[ni.wrapT]||THREE.RepeatWrapping,H.associations.set(zt,{textures:A}),zt}).catch(function(){return console.error("THREE.GLTFLoader: Couldn't load texture",pt),null});return this.textureCache[ce]=Dt,Dt}assignTexture(A,P,W){const H=this;return this.getDependency("texture",W.index).then(function(ee){if(void 0!==W.texCoord&&0!=W.texCoord&&!("aoMap"===P&&1==W.texCoord)&&console.warn("THREE.GLTFLoader: Custom UV set "+W.texCoord+" for texture "+P+" not yet supported."),H.extensions[ue.KHR_TEXTURE_TRANSFORM]){const ie=void 0!==W.extensions?W.extensions[ue.KHR_TEXTURE_TRANSFORM]:void 0;if(ie){const ve=H.associations.get(ee);ee=H.extensions[ue.KHR_TEXTURE_TRANSFORM].extendTexture(ee,ie),H.associations.set(ee,ve)}}return A[P]=ee,ee})}assignFinalMaterial(A){const P=A.geometry;let W=A.material;const H=void 0===P.attributes.tangent,ee=void 0!==P.attributes.color,ie=void 0===P.attributes.normal;if(A.isPoints){const ve="PointsMaterial:"+W.uuid;let ce=this.cache.get(ve);ce||(ce=new THREE.PointsMaterial,THREE.Material.prototype.copy.call(ce,W),ce.color.copy(W.color),ce.map=W.map,ce.sizeAttenuation=!1,this.cache.add(ve,ce)),W=ce}else if(A.isLine){const ve="LineBasicMaterial:"+W.uuid;let ce=this.cache.get(ve);ce||(ce=new THREE.LineBasicMaterial,THREE.Material.prototype.copy.call(ce,W),ce.color.copy(W.color),this.cache.add(ve,ce)),W=ce}if(H||ee||ie){let ve="ClonedMaterial:"+W.uuid+":";W.isGLTFSpecularGlossinessMaterial&&(ve+="specular-glossiness:"),H&&(ve+="derivative-tangents:"),ee&&(ve+="vertex-colors:"),ie&&(ve+="flat-shading:");let ce=this.cache.get(ve);ce||(ce=W.clone(),ee&&(ce.vertexColors=!0),ie&&(ce.flatShading=!0),H&&(ce.normalScale&&(ce.normalScale.y*=-1),ce.clearcoatNormalScale&&(ce.clearcoatNormalScale.y*=-1)),this.cache.add(ve,ce),this.associations.set(ce,this.associations.get(W))),W=ce}W.aoMap&&void 0===P.attributes.uv2&&void 0!==P.attributes.uv&&P.setAttribute("uv2",P.attributes.uv),A.material=W}getMaterialType(){return THREE.MeshStandardMaterial}loadMaterial(A){const P=this,H=this.extensions,ee=this.json.materials[A];let ie;const ve={},ce=ee.extensions||{},Re=[];if(ce[ue.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const Oe=H[ue.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];ie=Oe.getMaterialType(),Re.push(Oe.extendParams(ve,ee,P))}else if(ce[ue.KHR_MATERIALS_UNLIT]){const Oe=H[ue.KHR_MATERIALS_UNLIT];ie=Oe.getMaterialType(),Re.push(Oe.extendParams(ve,ee,P))}else{const Oe=ee.pbrMetallicRoughness||{};if(ve.color=new THREE.Color(1,1,1),ve.opacity=1,Array.isArray(Oe.baseColorFactor)){const Dt=Oe.baseColorFactor;ve.color.fromArray(Dt),ve.opacity=Dt[3]}void 0!==Oe.baseColorTexture&&Re.push(P.assignTexture(ve,"map",Oe.baseColorTexture)),ve.metalness=void 0!==Oe.metallicFactor?Oe.metallicFactor:1,ve.roughness=void 0!==Oe.roughnessFactor?Oe.roughnessFactor:1,void 0!==Oe.metallicRoughnessTexture&&(Re.push(P.assignTexture(ve,"metalnessMap",Oe.metallicRoughnessTexture)),Re.push(P.assignTexture(ve,"roughnessMap",Oe.metallicRoughnessTexture))),ie=this._invokeOne(function(Dt){return Dt.getMaterialType&&Dt.getMaterialType(A)}),Re.push(Promise.all(this._invokeAll(function(Dt){return Dt.extendMaterialParams&&Dt.extendMaterialParams(A,ve)})))}!0===ee.doubleSided&&(ve.side=THREE.DoubleSide);const pt=ee.alphaMode||"OPAQUE";if("BLEND"===pt?(ve.transparent=!0,ve.depthWrite=!1):(ve.format=THREE.RGBFormat,ve.transparent=!1,"MASK"===pt&&(ve.alphaTest=void 0!==ee.alphaCutoff?ee.alphaCutoff:.5)),void 0!==ee.normalTexture&&ie!==THREE.MeshBasicMaterial&&(Re.push(P.assignTexture(ve,"normalMap",ee.normalTexture)),ve.normalScale=new THREE.Vector2(1,1),void 0!==ee.normalTexture.scale)){const Oe=ee.normalTexture.scale;ve.normalScale.set(Oe,Oe)}return void 0!==ee.occlusionTexture&&ie!==THREE.MeshBasicMaterial&&(Re.push(P.assignTexture(ve,"aoMap",ee.occlusionTexture)),void 0!==ee.occlusionTexture.strength&&(ve.aoMapIntensity=ee.occlusionTexture.strength)),void 0!==ee.emissiveFactor&&ie!==THREE.MeshBasicMaterial&&(ve.emissive=(new THREE.Color).fromArray(ee.emissiveFactor)),void 0!==ee.emissiveTexture&&ie!==THREE.MeshBasicMaterial&&Re.push(P.assignTexture(ve,"emissiveMap",ee.emissiveTexture)),Promise.all(Re).then(function(){let Oe;return Oe=ie===gt?H[ue.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(ve):new ie(ve),ee.name&&(Oe.name=ee.name),Oe.map&&(Oe.map.encoding=THREE.sRGBEncoding),Oe.emissiveMap&&(Oe.emissiveMap.encoding=THREE.sRGBEncoding),Se(Oe,ee),P.associations.set(Oe,{materials:A}),ee.extensions&&Ut(H,Oe,ee),Oe})}createUniqueName(A){const P=THREE.PropertyBinding.sanitizeNodeName(A||"");let W=P;for(let H=1;this.nodeNamesUsed[W];++H)W=P+"_"+H;return this.nodeNamesUsed[W]=!0,W}loadGeometries(A){const P=this,W=this.extensions,H=this.primitiveCache;function ee(ve){return W[ue.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(ve,P).then(function(ce){return gn(ce,ve,P)})}const ie=[];for(let ve=0,ce=A.length;ve<ce;ve++){const Re=A[ve],pt=se(Re),Oe=H[pt];if(Oe)ie.push(Oe.promise);else{let Dt;Dt=Re.extensions&&Re.extensions[ue.KHR_DRACO_MESH_COMPRESSION]?ee(Re):gn(new THREE.BufferGeometry,Re,P),H[pt]={primitive:Re,promise:Dt},ie.push(Dt)}}return Promise.all(ie)}loadMesh(A){const P=this,H=this.extensions,ee=this.json.meshes[A],ie=ee.primitives,ve=[];for(let ce=0,Re=ie.length;ce<Re;ce++){const pt=void 0===ie[ce].material?(void 0===(Ne=this.cache).DefaultMaterial&&(Ne.DefaultMaterial=new THREE.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:THREE.FrontSide})),Ne.DefaultMaterial):this.getDependency("material",ie[ce].material);ve.push(pt)}var Ne;return ve.push(P.loadGeometries(ie)),Promise.all(ve).then(function(ce){const Re=ce.slice(0,ce.length-1),pt=ce[ce.length-1],Oe=[];for(let zt=0,Yn=pt.length;zt<Yn;zt++){const ni=pt[zt],St=ie[zt];let un;const Dn=Re[zt];if(4===St.mode||5===St.mode||6===St.mode||void 0===St.mode)un=!0===ee.isSkinnedMesh?new THREE.SkinnedMesh(ni,Dn):new THREE.Mesh(ni,Dn),!0===un.isSkinnedMesh&&!un.geometry.attributes.skinWeight.normalized&&un.normalizeSkinWeights(),5===St.mode?un.geometry=Nn(un.geometry,THREE.TriangleStripDrawMode):6===St.mode&&(un.geometry=Nn(un.geometry,THREE.TriangleFanDrawMode));else if(1===St.mode)un=new THREE.LineSegments(ni,Dn);else if(3===St.mode)un=new THREE.Line(ni,Dn);else if(2===St.mode)un=new THREE.LineLoop(ni,Dn);else{if(0!==St.mode)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+St.mode);un=new THREE.Points(ni,Dn)}Object.keys(un.geometry.morphAttributes).length>0&&Ue(un,ee),un.name=P.createUniqueName(ee.name||"mesh_"+A),Se(un,ee),St.extensions&&Ut(H,un,St),P.assignFinalMaterial(un),Oe.push(un)}for(let zt=0,Yn=Oe.length;zt<Yn;zt++)P.associations.set(Oe[zt],{meshes:A,primitives:zt});if(1===Oe.length)return Oe[0];const Dt=new THREE.Group;P.associations.set(Dt,{meshes:A});for(let zt=0,Yn=Oe.length;zt<Yn;zt++)Dt.add(Oe[zt]);return Dt})}loadCamera(A){let P;const W=this.json.cameras[A],H=W[W.type];if(H)return"perspective"===W.type?P=new THREE.PerspectiveCamera(THREE.MathUtils.radToDeg(H.yfov),H.aspectRatio||1,H.znear||1,H.zfar||2e6):"orthographic"===W.type&&(P=new THREE.OrthographicCamera(-H.xmag,H.xmag,H.ymag,-H.ymag,H.znear,H.zfar)),W.name&&(P.name=this.createUniqueName(W.name)),Se(P,W),Promise.resolve(P);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(A){const P=this.json.skins[A],W={joints:P.joints};return void 0===P.inverseBindMatrices?Promise.resolve(W):this.getDependency("accessor",P.inverseBindMatrices).then(function(H){return W.inverseBindMatrices=H,W})}loadAnimation(A){const W=this.json.animations[A],H=[],ee=[],ie=[],ve=[],ce=[];for(let Re=0,pt=W.channels.length;Re<pt;Re++){const Oe=W.channels[Re],Dt=W.samplers[Oe.sampler],zt=Oe.target,ni=void 0!==W.parameters?W.parameters[Dt.input]:Dt.input,St=void 0!==W.parameters?W.parameters[Dt.output]:Dt.output;H.push(this.getDependency("node",void 0!==zt.node?zt.node:zt.id)),ee.push(this.getDependency("accessor",ni)),ie.push(this.getDependency("accessor",St)),ve.push(Dt),ce.push(zt)}return Promise.all([Promise.all(H),Promise.all(ee),Promise.all(ie),Promise.all(ve),Promise.all(ce)]).then(function(Re){const pt=Re[0],Oe=Re[1],Dt=Re[2],zt=Re[3],Yn=Re[4],ni=[];for(let un=0,Dn=pt.length;un<Dn;un++){const vi=pt[un],yi=Oe[un],xr=Dt[un],Si=zt[un],Cn=Yn[un];if(void 0===vi)continue;let Jn;switch(vi.updateMatrix(),vi.matrixAutoUpdate=!0,at[Cn.path]){case at.weights:Jn=THREE.NumberKeyframeTrack;break;case at.rotation:Jn=THREE.QuaternionKeyframeTrack;break;default:Jn=THREE.VectorKeyframeTrack}const ui=vi.name?vi.name:vi.uuid,Dr=void 0!==Si.interpolation?qe[Si.interpolation]:THREE.InterpolateLinear,Kr=[];at[Cn.path]===at.weights?vi.traverse(function(Er){Er.morphTargetInfluences&&Kr.push(Er.name?Er.name:Er.uuid)}):Kr.push(ui);let Qe=xr.array;if(xr.normalized){const Er=Yt(Qe.constructor),Pn=new Float32Array(Qe.length);for(let cr=0,Zr=Qe.length;cr<Zr;cr++)Pn[cr]=Qe[cr]*Er;Qe=Pn}for(let Er=0,Pn=Kr.length;Er<Pn;Er++){const cr=new Jn(Kr[Er]+"."+at[Cn.path],yi.array,Qe,Dr);"CUBICSPLINE"===Si.interpolation&&(cr.createInterpolant=function(hr){return new(this instanceof THREE.QuaternionKeyframeTrack?kn:Kt)(this.times,this.values,this.getValueSize()/3,hr)},cr.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),ni.push(cr)}}return new THREE.AnimationClip(W.name?W.name:"animation_"+A,void 0,ni)})}createNodeMesh(A){const W=this,H=this.json.nodes[A];return void 0===H.mesh?null:W.getDependency("mesh",H.mesh).then(function(ee){const ie=W._getNodeRef(W.meshCache,H.mesh,ee);return void 0!==H.weights&&ie.traverse(function(ve){if(ve.isMesh)for(let ce=0,Re=H.weights.length;ce<Re;ce++)ve.morphTargetInfluences[ce]=H.weights[ce]}),ie})}loadNode(A){const W=this.extensions,H=this,ee=this.json.nodes[A],ie=ee.name?H.createUniqueName(ee.name):"";return function(){const ve=[],ce=H._invokeOne(function(Re){return Re.createNodeMesh&&Re.createNodeMesh(A)});return ce&&ve.push(ce),void 0!==ee.camera&&ve.push(H.getDependency("camera",ee.camera).then(function(Re){return H._getNodeRef(H.cameraCache,ee.camera,Re)})),H._invokeAll(function(Re){return Re.createNodeAttachment&&Re.createNodeAttachment(A)}).forEach(function(Re){ve.push(Re)}),Promise.all(ve)}().then(function(ve){let ce;if(ce=!0===ee.isBone?new THREE.Bone:ve.length>1?new THREE.Group:1===ve.length?ve[0]:new THREE.Object3D,ce!==ve[0])for(let Re=0,pt=ve.length;Re<pt;Re++)ce.add(ve[Re]);if(ee.name&&(ce.userData.name=ee.name,ce.name=ie),Se(ce,ee),ee.extensions&&Ut(W,ce,ee),void 0!==ee.matrix){const Re=new THREE.Matrix4;Re.fromArray(ee.matrix),ce.applyMatrix4(Re)}else void 0!==ee.translation&&ce.position.fromArray(ee.translation),void 0!==ee.rotation&&ce.quaternion.fromArray(ee.rotation),void 0!==ee.scale&&ce.scale.fromArray(ee.scale);return H.associations.has(ce)||H.associations.set(ce,{}),H.associations.get(ce).nodes=A,ce})}loadScene(A){const P=this.json,W=this.extensions,H=this.json.scenes[A],ee=this,ie=new THREE.Group;H.name&&(ie.name=ee.createUniqueName(H.name)),Se(ie,H),H.extensions&&Ut(W,ie,H);const ve=H.nodes||[],ce=[];for(let Re=0,pt=ve.length;Re<pt;Re++)ce.push(bn(ve[Re],ie,P,ee));return Promise.all(ce).then(function(){return ee.associations=(pt=>{const Oe=new Map;for(const[Dt,zt]of ee.associations)(Dt instanceof THREE.Material||Dt instanceof THREE.Texture)&&Oe.set(Dt,zt);return pt.traverse(Dt=>{const zt=ee.associations.get(Dt);null!=zt&&Oe.set(Dt,zt)}),Oe})(ie),ie})}}function bn(Ne,A,P,W){const H=P.nodes[Ne];return W.getDependency("node",Ne).then(function(ee){if(void 0===H.skin)return ee;let ie;return W.getDependency("skin",H.skin).then(function(ve){ie=ve;const ce=[];for(let Re=0,pt=ie.joints.length;Re<pt;Re++)ce.push(W.getDependency("node",ie.joints[Re]));return Promise.all(ce)}).then(function(ve){return ee.traverse(function(ce){if(!ce.isMesh)return;const Re=[],pt=[];for(let Oe=0,Dt=ve.length;Oe<Dt;Oe++){const zt=ve[Oe];if(zt){Re.push(zt);const Yn=new THREE.Matrix4;void 0!==ie.inverseBindMatrices&&Yn.fromArray(ie.inverseBindMatrices.array,16*Oe),pt.push(Yn)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',ie.joints[Oe])}ce.bind(new THREE.Skeleton(Re,pt),ce.matrixWorld)}),ee})}).then(function(ee){A.add(ee);const ie=[];if(H.children){const ve=H.children;for(let ce=0,Re=ve.length;ce<Re;ce++)ie.push(bn(ve[ce],ee,P,W))}return Promise.all(ie)})}function gn(Ne,A,P){const W=A.attributes,H=[];function ee(ie,ve){return P.getDependency("accessor",ie).then(function(ce){Ne.setAttribute(ve,ce)})}for(const ie in W){const ve=Xi[ie]||ie.toLowerCase();ve in Ne.attributes||H.push(ee(W[ie],ve))}if(void 0!==A.indices&&!Ne.index){const ie=P.getDependency("accessor",A.indices).then(function(ve){Ne.setIndex(ve)});H.push(ie)}return Se(Ne,A),function Zn(Ne,A,P){const W=A.attributes,H=new THREE.Box3;if(void 0===W.POSITION)return;{const ve=P.json.accessors[W.POSITION],ce=ve.min,Re=ve.max;if(void 0===ce||void 0===Re)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(H.set(new THREE.Vector3(ce[0],ce[1],ce[2]),new THREE.Vector3(Re[0],Re[1],Re[2])),ve.normalized){const pt=Yt(In[ve.componentType]);H.min.multiplyScalar(pt),H.max.multiplyScalar(pt)}}const ee=A.targets;if(void 0!==ee){const ve=new THREE.Vector3,ce=new THREE.Vector3;for(let Re=0,pt=ee.length;Re<pt;Re++){const Oe=ee[Re];if(void 0!==Oe.POSITION){const Dt=P.json.accessors[Oe.POSITION],zt=Dt.min,Yn=Dt.max;if(void 0!==zt&&void 0!==Yn){if(ce.setX(Math.max(Math.abs(zt[0]),Math.abs(Yn[0]))),ce.setY(Math.max(Math.abs(zt[1]),Math.abs(Yn[1]))),ce.setZ(Math.max(Math.abs(zt[2]),Math.abs(Yn[2]))),Dt.normalized){const ni=Yt(In[Dt.componentType]);ce.multiplyScalar(ni)}ve.max(ce)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}H.expandByVector(ve)}Ne.boundingBox=H;const ie=new THREE.Sphere;H.getCenter(ie.center),ie.radius=H.min.distanceTo(H.max)/2,Ne.boundingSphere=ie}(Ne,A,P),Promise.all(H).then(function(){return void 0!==A.targets?function De(Ne,A,P){let W=!1,H=!1;for(let ve=0,ce=A.length;ve<ce;ve++){const Re=A[ve];if(void 0!==Re.POSITION&&(W=!0),void 0!==Re.NORMAL&&(H=!0),W&&H)break}if(!W&&!H)return Promise.resolve(Ne);const ee=[],ie=[];for(let ve=0,ce=A.length;ve<ce;ve++){const Re=A[ve];if(W){const pt=void 0!==Re.POSITION?P.getDependency("accessor",Re.POSITION):Ne.attributes.position;ee.push(pt)}if(H){const pt=void 0!==Re.NORMAL?P.getDependency("accessor",Re.NORMAL):Ne.attributes.normal;ie.push(pt)}}return Promise.all([Promise.all(ee),Promise.all(ie)]).then(function(ve){const Re=ve[1];return W&&(Ne.morphAttributes.position=ve[0]),H&&(Ne.morphAttributes.normal=Re),Ne.morphTargetsRelative=!0,Ne})}(Ne,A.targets,P):Ne})}function Nn(Ne,A){let P=Ne.getIndex();if(null===P){const ie=[],ve=Ne.getAttribute("position");if(void 0===ve)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),Ne;for(let ce=0;ce<ve.count;ce++)ie.push(ce);Ne.setIndex(ie),P=Ne.getIndex()}const W=P.count-2,H=[];if(A===THREE.TriangleFanDrawMode)for(let ie=1;ie<=W;ie++)H.push(P.getX(0)),H.push(P.getX(ie)),H.push(P.getX(ie+1));else for(let ie=0;ie<W;ie++)ie%2==0?(H.push(P.getX(ie)),H.push(P.getX(ie+1)),H.push(P.getX(ie+2))):(H.push(P.getX(ie+2)),H.push(P.getX(ie+1)),H.push(P.getX(ie)));H.length/3!==W&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const ee=Ne.clone();return ee.setIndex(H),ee}THREE.GLTFLoader=b}(),function(){class b extends THREE.DataTextureLoader{constructor(ue){super(ue),this.type=THREE.HalfFloatType}parse(ue){const $e=function(gt,en){switch(gt){case 1:console.error("THREE.RGBELoader Read Error: "+(en||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(en||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(en||""));break;default:console.error("THREE.RGBELoader: Error: "+(en||""))}return-1},Qt=function(gt,en,cn){en=en||1024;let qn=gt.pos,kn=-1,nn=0,In="",Ln=String.fromCharCode.apply(null,new Uint16Array(gt.subarray(qn,qn+128)));for(;0>(kn=Ln.indexOf("\n"))&&nn<en&&qn<gt.byteLength;)In+=Ln,nn+=Ln.length,qn+=128,Ln+=String.fromCharCode.apply(null,new Uint16Array(gt.subarray(qn,qn+128)));return-1<kn&&(!1!==cn&&(gt.pos+=nn+kn+1),In+Ln.slice(0,kn))},We=function(gt,en,cn,Kt){const kn=Math.pow(2,gt[en+3]-128)/255;cn[Kt+0]=gt[en+0]*kn,cn[Kt+1]=gt[en+1]*kn,cn[Kt+2]=gt[en+2]*kn},dn=function(gt,en,cn,Kt){const kn=Math.pow(2,gt[en+3]-128)/255;cn[Kt+0]=THREE.DataUtils.toHalfFloat(Math.min(gt[en+0]*kn,65504)),cn[Kt+1]=THREE.DataUtils.toHalfFloat(Math.min(gt[en+1]*kn,65504)),cn[Kt+2]=THREE.DataUtils.toHalfFloat(Math.min(gt[en+2]*kn,65504))},xt=new Uint8Array(ue);xt.pos=0;const sn=function(gt){const cn=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,Kt=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,qn=/^\s*FORMAT=(\S+)\s*$/,kn=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,nn={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let In,Ln;if(gt.pos>=gt.byteLength||!(In=Qt(gt)))return $e(1,"no header found");if(!(Ln=In.match(/^#\?(\S+)/)))return $e(3,"bad initial token");for(nn.valid|=1,nn.programtype=Ln[1],nn.string+=In+"\n";In=Qt(gt),!1!==In;)if(nn.string+=In+"\n","#"!==In.charAt(0)){if((Ln=In.match(cn))&&(nn.gamma=parseFloat(Ln[1],10)),(Ln=In.match(Kt))&&(nn.exposure=parseFloat(Ln[1],10)),(Ln=In.match(qn))&&(nn.valid|=2,nn.format=Ln[1]),(Ln=In.match(kn))&&(nn.valid|=4,nn.height=parseInt(Ln[1],10),nn.width=parseInt(Ln[2],10)),2&nn.valid&&4&nn.valid)break}else nn.comments+=In+"\n";return 2&nn.valid?4&nn.valid?nn:$e(3,"missing image size specifier"):$e(3,"missing format specifier")}(xt);if(-1!==sn){const gt=sn.width,en=sn.height,cn=function(gt,en,cn){const Kt=en;if(Kt<8||Kt>32767||2!==gt[0]||2!==gt[1]||128&gt[2])return new Uint8Array(gt);if(Kt!==(gt[2]<<8|gt[3]))return $e(3,"wrong scanline width");const qn=new Uint8Array(4*en*cn);if(!qn.length)return $e(4,"unable to allocate buffer space");let kn=0,nn=0;const In=4*Kt,Ln=new Uint8Array(4),Ti=new Uint8Array(In);let nr=cn;for(;nr>0&&nn<gt.byteLength;){if(nn+4>gt.byteLength)return $e(1);if(Ln[0]=gt[nn++],Ln[1]=gt[nn++],Ln[2]=gt[nn++],Ln[3]=gt[nn++],2!=Ln[0]||2!=Ln[1]||(Ln[2]<<8|Ln[3])!=Kt)return $e(3,"bad rgbe scanline format");let at,Xi=0;for(;Xi<In&&nn<gt.byteLength;){at=gt[nn++];const Ct=at>128;if(Ct&&(at-=128),0===at||Xi+at>In)return $e(3,"bad scanline data");if(Ct){const ut=gt[nn++];for(let Ut=0;Ut<at;Ut++)Ti[Xi++]=ut}else Ti.set(gt.subarray(nn,nn+at),Xi),Xi+=at,nn+=at}const qe=Kt;for(let Ct=0;Ct<qe;Ct++){let ut=0;qn[kn]=Ti[Ct+ut],ut+=Kt,qn[kn+1]=Ti[Ct+ut],ut+=Kt,qn[kn+2]=Ti[Ct+ut],ut+=Kt,qn[kn+3]=Ti[Ct+ut],kn+=4}nr--}return qn}(xt.subarray(xt.pos),gt,en);if(-1!==cn){let Kt,qn,kn,nn;switch(this.type){case THREE.FloatType:nn=cn.length/4;const In=new Float32Array(3*nn);for(let Ti=0;Ti<nn;Ti++)We(cn,4*Ti,In,3*Ti);Kt=In,qn=THREE.RGBFormat,kn=THREE.FloatType;break;case THREE.HalfFloatType:nn=cn.length/4;const Ln=new Uint16Array(3*nn);for(let Ti=0;Ti<nn;Ti++)dn(cn,4*Ti,Ln,3*Ti);Kt=Ln,qn=THREE.RGBFormat,kn=THREE.HalfFloatType;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:gt,height:en,data:Kt,header:sn.string,gamma:sn.gamma,exposure:sn.exposure,format:qn,type:kn}}}return null}setDataType(ue){return this.type=ue,this}load(ue,nt,mt,Ge){return super.load(ue,function J(dt,$e){switch(dt.type){case THREE.FloatType:case THREE.HalfFloatType:dt.encoding=THREE.LinearEncoding,dt.minFilter=THREE.LinearFilter,dt.magFilter=THREE.LinearFilter,dt.generateMipmaps=!1,dt.flipY=!0}nt&&nt(dt,$e)},mt,Ge)}}THREE.RGBELoader=b}(),function(){const ue=new THREE.OrthographicCamera(-1,1,1,-1,0,1),nt=new THREE.BufferGeometry;nt.setAttribute("position",new THREE.Float32BufferAttribute([-1,3,0,-1,-1,0,3,-1,0],3)),nt.setAttribute("uv",new THREE.Float32BufferAttribute([0,2,0,0,2,0],2)),THREE.EffectComposer=class b{constructor(J,dt){if(this.renderer=J,void 0===dt){const $e={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat},tn=J.getSize(new THREE.Vector2);this._pixelRatio=J.getPixelRatio(),this._width=tn.width,this._height=tn.height,(dt=new THREE.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,$e)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=dt.width,this._height=dt.height;this.renderTarget1=dt,this.renderTarget2=dt.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],void 0===THREE.CopyShader&&console.error("THREE.EffectComposer relies on THREE.CopyShader"),void 0===THREE.ShaderPass&&console.error("THREE.EffectComposer relies on THREE.ShaderPass"),this.copyPass=new THREE.ShaderPass(THREE.CopyShader),this.clock=new THREE.Clock}swapBuffers(){const J=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=J}addPass(J){this.passes.push(J),J.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(J,dt){this.passes.splice(dt,0,J),J.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(J){const dt=this.passes.indexOf(J);-1!==dt&&this.passes.splice(dt,1)}isLastEnabledPass(J){for(let dt=J+1;dt<this.passes.length;dt++)if(this.passes[dt].enabled)return!1;return!0}render(J){void 0===J&&(J=this.clock.getDelta());const dt=this.renderer.getRenderTarget();let $e=!1;for(let tn=0,di=this.passes.length;tn<di;tn++){const Rn=this.passes[tn];if(!1!==Rn.enabled){if(Rn.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(tn),Rn.render(this.renderer,this.writeBuffer,this.readBuffer,J,$e),Rn.needsSwap){if($e){const _n=this.renderer.getContext(),Qt=this.renderer.state.buffers.stencil;Qt.setFunc(_n.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,J),Qt.setFunc(_n.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==THREE.MaskPass&&(Rn instanceof THREE.MaskPass?$e=!0:Rn instanceof THREE.ClearMaskPass&&($e=!1))}}this.renderer.setRenderTarget(dt)}reset(J){if(void 0===J){const dt=this.renderer.getSize(new THREE.Vector2);this._pixelRatio=this.renderer.getPixelRatio(),this._width=dt.width,this._height=dt.height,(J=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=J,this.renderTarget2=J.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(J,dt){this._width=J,this._height=dt;const $e=this._width*this._pixelRatio,tn=this._height*this._pixelRatio;this.renderTarget1.setSize($e,tn),this.renderTarget2.setSize($e,tn);for(let di=0;di<this.passes.length;di++)this.passes[di].setSize($e,tn)}setPixelRatio(J){this._pixelRatio=J,this.setSize(this._width,this._height)}},THREE.FullScreenQuad=class mt{constructor(J){this._mesh=new THREE.Mesh(nt,J)}dispose(){this._mesh.geometry.dispose()}render(J){J.render(this._mesh,ue)}get material(){return this._mesh.material}set material(J){this._mesh.material=J}},THREE.Pass=class Rt{constructor(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}}(),function(){class b extends THREE.Pass{constructor(ue,nt){super(),this.textureID=void 0!==nt?nt:"tDiffuse",ue instanceof THREE.ShaderMaterial?(this.uniforms=ue.uniforms,this.material=ue):ue&&(this.uniforms=THREE.UniformsUtils.clone(ue.uniforms),this.material=new THREE.ShaderMaterial({defines:Object.assign({},ue.defines),uniforms:this.uniforms,vertexShader:ue.vertexShader,fragmentShader:ue.fragmentShader})),this.fsQuad=new THREE.FullScreenQuad(this.material)}render(ue,nt,mt){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=mt.texture),this.fsQuad.material=this.material,this.renderToScreen?(ue.setRenderTarget(null),this.fsQuad.render(ue)):(ue.setRenderTarget(nt),this.clear&&ue.clear(ue.autoClearColor,ue.autoClearDepth,ue.autoClearStencil),this.fsQuad.render(ue))}}THREE.ShaderPass=b}(),function(){class b extends THREE.Pass{constructor(ue,nt,mt,Ge,J){super(),this.scene=ue,this.camera=nt,this.overrideMaterial=mt,this.clearColor=Ge,this.clearAlpha=void 0!==J?J:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new THREE.Color}render(ue,nt,mt){const Ge=ue.autoClear;let J,dt;ue.autoClear=!1,void 0!==this.overrideMaterial&&(dt=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(ue.getClearColor(this._oldClearColor),J=ue.getClearAlpha(),ue.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&ue.clearDepth(),ue.setRenderTarget(this.renderToScreen?null:mt),this.clear&&ue.clear(ue.autoClearColor,ue.autoClearDepth,ue.autoClearStencil),ue.render(this.scene,this.camera),this.clearColor&&ue.setClearColor(this._oldClearColor,J),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=dt),ue.autoClear=Ge}}THREE.RenderPass=b}(),THREE.CopyShader={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor = opacity * texel;\n\n\t\t}"},function(){class b extends THREE.Pass{constructor(ue,nt,mt,Ge){super(),this.strength=void 0!==nt?nt:1,this.radius=mt,this.threshold=Ge,this.resolution=void 0!==ue?new THREE.Vector2(ue.x,ue.y):new THREE.Vector2(256,256),this.clearColor=new THREE.Color(0,0,0);const J={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat};this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;let dt=Math.round(this.resolution.x/2),$e=Math.round(this.resolution.y/2);this.renderTargetBright=new THREE.WebGLRenderTarget(dt,$e,J),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let Qt=0;Qt<this.nMips;Qt++){const ti=new THREE.WebGLRenderTarget(dt,$e,J);ti.texture.name="UnrealBloomPass.h"+Qt,ti.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(ti);const At=new THREE.WebGLRenderTarget(dt,$e,J);At.texture.name="UnrealBloomPass.v"+Qt,At.texture.generateMipmaps=!1,this.renderTargetsVertical.push(At),dt=Math.round(dt/2),$e=Math.round($e/2)}void 0===THREE.LuminosityHighPassShader&&console.error("THREE.UnrealBloomPass relies on THREE.LuminosityHighPassShader");const tn=THREE.LuminosityHighPassShader;this.highPassUniforms=THREE.UniformsUtils.clone(tn.uniforms),this.highPassUniforms.luminosityThreshold.value=Ge,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new THREE.ShaderMaterial({uniforms:this.highPassUniforms,vertexShader:tn.vertexShader,fragmentShader:tn.fragmentShader,defines:{}}),this.separableBlurMaterials=[];const di=[3,5,7,9,11];dt=Math.round(this.resolution.x/2),$e=Math.round(this.resolution.y/2);for(let Qt=0;Qt<this.nMips;Qt++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(di[Qt])),this.separableBlurMaterials[Qt].uniforms.texSize.value=new THREE.Vector2(dt,$e),dt=Math.round(dt/2),$e=Math.round($e/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=nt,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0,this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1),new THREE.Vector3(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,void 0===THREE.CopyShader&&console.error("THREE.UnrealBloomPass relies on THREE.CopyShader");const _n=THREE.CopyShader;this.copyUniforms=THREE.UniformsUtils.clone(_n.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new THREE.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:_n.vertexShader,fragmentShader:_n.fragmentShader,blending:THREE.AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new THREE.Color,this.oldClearAlpha=1,this.basic=new THREE.MeshBasicMaterial,this.fsQuad=new THREE.FullScreenQuad(null)}dispose(){for(let ue=0;ue<this.renderTargetsHorizontal.length;ue++)this.renderTargetsHorizontal[ue].dispose();for(let ue=0;ue<this.renderTargetsVertical.length;ue++)this.renderTargetsVertical[ue].dispose();this.renderTargetBright.dispose()}setSize(ue,nt){let mt=Math.round(ue/2),Ge=Math.round(nt/2);this.renderTargetBright.setSize(mt,Ge);for(let J=0;J<this.nMips;J++)this.renderTargetsHorizontal[J].setSize(mt,Ge),this.renderTargetsVertical[J].setSize(mt,Ge),this.separableBlurMaterials[J].uniforms.texSize.value=new THREE.Vector2(mt,Ge),mt=Math.round(mt/2),Ge=Math.round(Ge/2)}render(ue,nt,mt,Ge,J){ue.getClearColor(this._oldClearColor),this.oldClearAlpha=ue.getClearAlpha();const dt=ue.autoClear;ue.autoClear=!1,ue.setClearColor(this.clearColor,0),J&&ue.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=mt.texture,ue.setRenderTarget(null),ue.clear(),this.fsQuad.render(ue)),this.highPassUniforms.tDiffuse.value=mt.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,ue.setRenderTarget(this.renderTargetBright),ue.clear(),this.fsQuad.render(ue);let $e=this.renderTargetBright;for(let tn=0;tn<this.nMips;tn++)this.fsQuad.material=this.separableBlurMaterials[tn],this.separableBlurMaterials[tn].uniforms.colorTexture.value=$e.texture,this.separableBlurMaterials[tn].uniforms.direction.value=b.BlurDirectionX,ue.setRenderTarget(this.renderTargetsHorizontal[tn]),ue.clear(),this.fsQuad.render(ue),this.separableBlurMaterials[tn].uniforms.colorTexture.value=this.renderTargetsHorizontal[tn].texture,this.separableBlurMaterials[tn].uniforms.direction.value=b.BlurDirectionY,ue.setRenderTarget(this.renderTargetsVertical[tn]),ue.clear(),this.fsQuad.render(ue),$e=this.renderTargetsVertical[tn];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,ue.setRenderTarget(this.renderTargetsHorizontal[0]),ue.clear(),this.fsQuad.render(ue),this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,J&&ue.state.buffers.stencil.setTest(!0),this.renderToScreen?(ue.setRenderTarget(null),this.fsQuad.render(ue)):(ue.setRenderTarget(mt),this.fsQuad.render(ue)),ue.setClearColor(this._oldClearColor,this.oldClearAlpha),ue.autoClear=dt}getSeperableBlurMaterial(ue){return new THREE.ShaderMaterial({defines:{KERNEL_RADIUS:ue,SIGMA:ue},uniforms:{colorTexture:{value:null},texSize:{value:new THREE.Vector2(.5,.5)},direction:{value:new THREE.Vector2(.5,.5)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\n\t\t\t\tuniform vec2 direction;\n\n\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\n\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\n\t\t\t\t}\n\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\n          float fSigma = float(SIGMA);\n          float weightSum = gaussianPdf(0.0, fSigma);\n          vec4 color = texture2D( colorTexture, vUv);\n          vec4 diffuseSum = color * weightSum;\n          for( int i = 1; i < KERNEL_RADIUS; i ++ ) {\n            float x = float(i);\n            float w = gaussianPdf(x, fSigma);\n            vec2 uvOffset = direction * invSize * x;\n            vec4 sample1 = texture2D( colorTexture, vUv + uvOffset);\n            vec4 sample2 = texture2D( colorTexture, vUv - uvOffset);\n            diffuseSum += (sample1 + sample2) * w;\n            weightSum += 2.0 * w;\n          }          gl_FragColor = diffuseSum / weightSum;\n\t\t\t\t}"})}getCompositeMaterial(ue){return new THREE.ShaderMaterial({defines:{NUM_MIPS:ue},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\n\t\t\t\tuniform sampler2D blurTexture1;\n\t\t\t\tuniform sampler2D blurTexture2;\n\t\t\t\tuniform sampler2D blurTexture3;\n\t\t\t\tuniform sampler2D blurTexture4;\n\t\t\t\tuniform sampler2D blurTexture5;\n\t\t\t\tuniform sampler2D dirtTexture;\n\t\t\t\tuniform float bloomStrength;\n\t\t\t\tuniform float bloomRadius;\n\t\t\t\tuniform float bloomFactors[NUM_MIPS];\n\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\n\n\t\t\t\tfloat lerpBloomFactor(const in float factor) {\n\t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\n\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\n\t\t\t\t}"})}}b.BlurDirectionX=new THREE.Vector2(1,0),b.BlurDirectionY=new THREE.Vector2(0,1),THREE.UnrealBloomPass=b}(),function(){const b={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new THREE.Color(0)},defaultOpacity:{value:0}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform vec3 defaultColor;\n\t\tuniform float defaultOpacity;\n\t\tuniform float luminosityThreshold;\n\t\tuniform float smoothWidth;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\n\t\t\tvec3 luma = vec3( 0.299, 0.587, 0.114 );\n\n\t\t\tfloat v = dot( texel.xyz, luma );\n\n\t\t\tvec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );\n\n\t\t\tfloat alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );\n\n\t\t\tgl_FragColor = mix( outputColor, texel, alpha );\n\n\t\t}"};THREE.LuminosityHighPassShader=b}(),function(){class b extends THREE.Pass{constructor(nt,mt,Ge,J){super(),this.scene=nt,this.camera=mt,this.sampleLevel=4,this.unbiased=!0,this.clearColor=void 0!==Ge?Ge:0,this.clearAlpha=void 0!==J?J:0,this._oldClearColor=new THREE.Color,void 0===THREE.CopyShader&&console.error("THREE.SSAARenderPass relies on THREE.CopyShader");const dt=THREE.CopyShader;this.copyUniforms=THREE.UniformsUtils.clone(dt.uniforms),this.copyMaterial=new THREE.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:dt.vertexShader,fragmentShader:dt.fragmentShader,premultipliedAlpha:!0,transparent:!0,blending:THREE.AdditiveBlending,depthTest:!1,depthWrite:!1}),this.fsQuad=new THREE.FullScreenQuad(this.copyMaterial)}dispose(){this.sampleRenderTarget&&(this.sampleRenderTarget.dispose(),this.sampleRenderTarget=null)}setSize(nt,mt){this.sampleRenderTarget&&this.sampleRenderTarget.setSize(nt,mt)}render(nt,mt,Ge){this.sampleRenderTarget||(this.sampleRenderTarget=new THREE.WebGLRenderTarget(Ge.width,Ge.height,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat}),this.sampleRenderTarget.texture.name="SSAARenderPass.sample");const J=Rt[Math.max(0,Math.min(this.sampleLevel,5))],dt=nt.autoClear;nt.autoClear=!1,nt.getClearColor(this._oldClearColor);const $e=nt.getClearAlpha(),tn=1/J.length;this.copyUniforms.tDiffuse.value=this.sampleRenderTarget.texture;const Rn={fullWidth:Ge.width,fullHeight:Ge.height,offsetX:0,offsetY:0,width:Ge.width,height:Ge.height},_n=Object.assign({},this.camera.view);_n.enabled&&Object.assign(Rn,_n);for(let Qt=0;Qt<J.length;Qt++){const ti=J[Qt];this.camera.setViewOffset&&this.camera.setViewOffset(Rn.fullWidth,Rn.fullHeight,Rn.offsetX+.0625*ti[0],Rn.offsetY+.0625*ti[1],Rn.width,Rn.height);let At=tn;this.unbiased&&(At+=.03125*((Qt+.5)/J.length-.5)),this.copyUniforms.opacity.value=At,nt.setClearColor(this.clearColor,this.clearAlpha),nt.setRenderTarget(this.sampleRenderTarget),nt.clear(),nt.render(this.scene,this.camera),nt.setRenderTarget(this.renderToScreen?null:mt),0===Qt&&(nt.setClearColor(0,0),nt.clear()),this.fsQuad.render(nt)}this.camera.setViewOffset&&_n.enabled?this.camera.setViewOffset(_n.fullWidth,_n.fullHeight,_n.offsetX,_n.offsetY,_n.width,_n.height):this.camera.clearViewOffset&&this.camera.clearViewOffset(),nt.autoClear=dt,nt.setClearColor(this._oldClearColor,$e)}}const Rt=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];THREE.SSAARenderPass=b}(),function(){class b extends THREE.SSAARenderPass{constructor(nt,mt,Ge,J){super(nt,mt,Ge,J),this.sampleLevel=0,this.accumulate=!1}render(nt,mt,Ge,J){if(!this.accumulate)return super.render(nt,mt,Ge,J),void(this.accumulateIndex=-1);const dt=Rt[5];this.sampleRenderTarget||(this.sampleRenderTarget=new THREE.WebGLRenderTarget(Ge.width,Ge.height,this.params),this.sampleRenderTarget.texture.name="TAARenderPass.sample"),this.holdRenderTarget||(this.holdRenderTarget=new THREE.WebGLRenderTarget(Ge.width,Ge.height,this.params),this.holdRenderTarget.texture.name="TAARenderPass.hold"),this.accumulate&&-1===this.accumulateIndex&&(super.render(nt,this.holdRenderTarget,Ge,J),this.accumulateIndex=0);const $e=nt.autoClear;nt.autoClear=!1;const tn=1/dt.length;if(this.accumulateIndex>=0&&this.accumulateIndex<dt.length){this.copyUniforms.opacity.value=tn,this.copyUniforms.tDiffuse.value=mt.texture;const Rn=Math.pow(2,this.sampleLevel);for(let _n=0;_n<Rn;_n++){const ti=dt[this.accumulateIndex];if(this.camera.setViewOffset&&this.camera.setViewOffset(Ge.width,Ge.height,.0625*ti[0],.0625*ti[1],Ge.width,Ge.height),nt.setRenderTarget(mt),nt.clear(),nt.render(this.scene,this.camera),nt.setRenderTarget(this.sampleRenderTarget),0===this.accumulateIndex&&nt.clear(),this.fsQuad.render(nt),this.accumulateIndex++,this.accumulateIndex>=dt.length)break}this.camera.clearViewOffset&&this.camera.clearViewOffset()}const di=this.accumulateIndex*tn;di>0&&(this.copyUniforms.opacity.value=1,this.copyUniforms.tDiffuse.value=this.sampleRenderTarget.texture,nt.setRenderTarget(mt),nt.clear(),this.fsQuad.render(nt)),di<1&&(this.copyUniforms.opacity.value=1-di,this.copyUniforms.tDiffuse.value=this.holdRenderTarget.texture,nt.setRenderTarget(mt),0===di&&nt.clear(),this.fsQuad.render(nt)),nt.autoClear=$e}}const Rt=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];THREE.TAARenderPass=b}();const WebARRocksMirror=function(){const b={canvasFace:null,canvasThree:null,videoURL:null,width:window.innerWidth,height:window.innerHeight,specWebARRocksFace:{NNCPath:"../../neuralNets/NN_GLASSES_5.json",scanSettings:{threshold:.9}},landmarksStabilizerSpec:{},isLightReconstructionEnabled:!1,lightReconstructionIntensityPow:3,lightReconstructionAmbIntensityFactor:30,lightReconstructionDirIntensityFactor:30,lightReconstructionTotalIntensityMin:.1,isGlasses:!0,modelURL:null,occluderURL:null,envmapURL:null,pointLightIntensity:.8,pointLightY:200,hemiLightIntensity:.8,bloom:null,taaLevel:0,branchFadingZ:-.9,branchFadingTransition:.6,branchBendingAngle:5,branchBendingZ:0,resizeDelay:50,rotationContraints:null,dracoDecoderPath:"../../libs/three/v136/examples/js/libs/draco/",debugOccluder:!1},Rt={faceAccessory:new THREE.Object3D,envMap:null,loadingManager:null};let ue=null,nt=null;let Ge=-1;const J=Math.PI/180;let dt=null;function $e(At,We,dn){return At.replace(We,We+"\n"+dn)}function Rn(At,We){if(!At)return _n(),void(We&&We(null));const dn=new THREE.GLTFLoader(Rt.loadingManager);if(THREE.DRACOLoader){const xt=new THREE.DRACOLoader;xt.setDecoderPath(ue.dracoDecoderPath),dn.setDRACOLoader(xt)}dn.load(At,function(xt){const sn=xt.scene.clone();(function di(At){ue.isGlasses&&(At.scale.multiplyScalar(78),At.position.set(0,40,53),At.rotation.set(-.3,0,0)),At.traverse(function(We){if(!We.material)return;let dn=We.material;if(dn.userData){const sn=dn.userData;for(let gt in sn)dn[gt]=sn[gt]}let xt=ue.isGlasses;xt=xt&&dn.name&&-1!==dn.name.indexOf("frame"),We.material=function tn(At,We){const dn=At.clone();return dn.fog=!1,dn.onBeforeCompile=function(xt){let sn=xt.vertexShader,gt=xt.fragmentShader;if(We){const en={uBranchFading:{value:new THREE.Vector2(ue.branchFadingZ,ue.branchFadingTransition)},uBranchBendingAngle:{value:ue.branchBendingAngle*J},uBranchBendingZ:{value:ue.branchBendingZ}};Object.assign(xt.uniforms,en),sn="uniform float uBranchBendingAngle, uBranchBendingZ;\n"+sn;let cn="float zBranch = max(0.0, uBranchBendingZ-position.z);\n";cn+="float bendBranchDx = tan(uBranchBendingAngle) * zBranch;\n",cn+="transformed.x += sign(transformed.x) * bendBranchDx;\n",cn+="transformed.z *= (1.0 - bendBranchDx);\n",sn=$e(sn,"#include <begin_vertex>",cn),sn="varying float vPosZ;\n"+sn,sn=$e(sn,"#include <fog_vertex>","vPosZ = position.z;"),gt="uniform vec2 uBranchFading;\n varying float vPosZ;\n"+gt,gt=$e(gt,"#include <dithering_fragment>","gl_FragColor *= smoothstep(uBranchFading.x - uBranchFading.y * 0.5, uBranchFading.x + uBranchFading.y * 0.5, vPosZ);")}xt.vertexShader=sn,xt.fragmentShader=gt},dn}(We.material,xt),We.material.depthWrite=!0})})(sn),_n(),Rt.faceAccessory=sn,nt.threeFaceFollowers&&nt.threeFaceFollowers.forEach(function(gt){gt.add(sn.clone())}),We&&We(sn)})}function _n(){nt.threeFaceFollowers&&Rt.faceAccessory&&(nt.threeFaceFollowers.forEach(function(At){if(At.children.length)for(let We=At.children.length-1;We>=0;--We){const dn=At.children[We];dn.userData.isOccluder||At.remove(dn)}}),Rt.faceAccessory=null)}return{init:function(At){return new Promise(function(We,dn){if(-1!==Ge)return void dn("ALREADY_INITIALIZED");if(!THREE)return void dn("NO_THREE");Ge=-2,ue=Object.assign({},b,At),Rt.loadingManager=new THREE.LoadingManager;const xt=window.devicePixelRatio||1,sn=ue.width*xt,gt=ue.height*xt;ue.canvasFace.width=sn,ue.canvasFace.height=gt,ue.canvasThree.width=sn,ue.canvasThree.height=gt;const en={spec:ue.specWebARRocksFace,canvas:ue.canvasFace,canvasThree:ue.canvasThree,videoURL:ue.videoURL,isPostProcessing:!!ue.bloom,taaLevel:ue.taaLevel,isLightReconstructionEnabled:ue.isLightReconstructionEnabled,lightReconstructionIntensityPow:ue.lightReconstructionIntensityPow,lightReconstructionAmbIntensityFactor:ue.lightReconstructionAmbIntensityFactor,lightReconstructionDirIntensityFactor:ue.lightReconstructionDirIntensityFactor,lightReconstructionTotalIntensityMin:ue.lightReconstructionTotalIntensityMin,landmarksStabilizerSpec:ue.landmarksStabilizerSpec,rotationContraints:ue.rotationContraints,callbackReady:function(cn,Kt){if(cn)return dn(cn),void(Ge=-3);nt=Kt,function Qt(){const At=nt.threeRenderer,We=nt.threeScene,dn=nt.threeComposer;if(At.toneMapping=THREE.ACESFilmicToneMapping,At.outputEncoding=THREE.sRGBEncoding,ue.envmapURL){const xt=new THREE.PMREMGenerator(At);xt.compileEquirectangularShader(),new THREE.RGBELoader(Rt.loadingManager).setDataType(THREE.HalfFloatType).load(ue.envmapURL,function(sn){Rt.envMap=xt.fromEquirectangular(sn).texture,xt.dispose(),We.environment=Rt.envMap})}if(!ue.isLightReconstructionEnabled){if(ue.hemiLightIntensity>0){const xt=new THREE.HemisphereLight(16777215,0,ue.hemiLightIntensity);We.add(xt)}if(ue.pointLightIntensity>0){const xt=new THREE.PointLight(16777215,ue.pointLightIntensity);xt.position.set(0,ue.pointLightY,0),We.add(xt)}}if(ue.occluderURL&&WebARRocksFaceThreeHelper.add_occluderFromFile(ue.occluderURL,null,Rt.loadingManager,ue.debugOccluder),ue.modelURL&&Rn(ue.modelURL,null),ue.bloom){const xt=new THREE.UnrealBloomPass(new THREE.Vector2(ue.canvasThree.width,ue.canvasThree.height),ue.bloom.strength,ue.bloom.radius,ue.bloom.threshold);dn.addPass(xt)}Rt.loadingManager.onLoad=function(){console.log("INFO in WebARRocksMirror: everything has been loaded"),ue.callback&&ue.callback(Rt)}}(),Ge=0,We()}};At.solvePnPObjPointsPositions&&(en.solvePnPObjPointsPositions=At.solvePnPObjPointsPositions),At.solvePnPImgPointsLabels&&(en.solvePnPImgPointsLabels=At.solvePnPImgPointsLabels),WebARRocksFaceThreeHelper.init(en)})},load:function(At,We){Rn(At,We)},pause:function(At){return 0===Ge&&(WEBARROCKSFACE.toggle_pause(!0,At),Ge=1,!0)},resume:function(At){return 1===Ge&&(WEBARROCKSFACE.toggle_pause(!1,At),Ge=0,!0)},capture_image:function(At){if(1!==Ge&&0!==Ge)return!1;const We=WEBARROCKSFACE.capture_image(!0),dn=We.width,xt=We.height,sn=nt.threeRenderer.domElement,gt=document.createElement("canvas");gt.width=dn,gt.height=xt;const en=gt.getContext("2d");en.translate(dn,0),en.scale(-1,1),en.drawImage(We,0,0),en.drawImage(sn,0,0),At(gt)},resize:function(At,We){return(1===Ge||0===Ge)&&(null!==dt&&window.clearTimeout(dt),dt=setTimeout(function(){const dn=window.devicePixelRatio?window.devicePixelRatio:1;WebARRocksFaceThreeHelper.resize(At*dn,We*dn),dt=null},ue.resizeDelay),!0)},destroy:function(){return new Promise(function(At,We){WEBARROCKSFACE.destroy().finally(function(){Ge=-1,nt.threeRenderer&&(nt.threeRenderer=null),At()})})}}}();function OneEuroFilter(b){const Rt=filter_lowPass(nt(b.minCutOff,b.freq)),ue=filter_lowPass(nt(b.dcutoff,b.freq));function nt(mt,Ge){return 1/(1+1/(2*Math.PI*mt)/(1/Ge))}this.filter=function(mt,Ge,J){const dt=Rt.has_lastRawValue()?(mt-Rt.get_lastRawValue())*J:0,$e=ue.filter_withAlpha(dt,nt(b.dcutoff,J)),tn=b.minCutOff+Ge*Math.abs($e);return Rt.filter_withAlpha(mt,nt(tn,J))},this.reset=function(){Rt.reset(),ue.reset()},this.force=function(mt){Rt.force(mt)}}function filter_lowPass(b,Rt){let ue=Rt||0,nt=ue,mt=!0;return{filter_withAlpha:function(dt,$e){return b=$e,function Ge(dt){return ue=dt,mt?(nt=dt,mt=!1):nt=b*dt+(1-b)*nt,nt}(dt)},has_lastRawValue:function(){return!mt},get_lastRawValue:function(){return ue},reset:function(){mt=!0,ue=Rt||0,nt=ue},force:function(dt){ue=dt,nt=dt}}}function compute_distanceNNInput(b,Rt,ue,nt){return.5*ue*Math.abs(b-Rt)/nt}function clamp(b,Rt,ue){return Math.min(Math.max(b,Rt),ue)}function smoothStep(b,Rt){const ue=clamp((Rt-b[0])/(b[1]-b[0]),0,1);return ue*ue*(3-2*ue)}function mix(b,Rt,ue){return b*(1-ue)+Rt*ue}const WebARRocksLMStabilizer={instance:function(Rt){const nt=Object.assign({},{freq:30,freqRange:[5,144],minCutOff:.001,beta:50,adaptativeBetaPow:2,dcutoff:1,NNInputSizePx:128,forceFilterNNInputPxRange:[.8,2],isDebug:!1},Rt),mt=[],Ge=[],J=typeof performance>"u"?Date:performance;let dt=-1,$e=nt.freq;const tn=1/nt.freqRange[1];return{update:function(Rn,_n,Qt,ti){const At=Rn.length;for(;mt.length<2*At;){const gt=new OneEuroFilter(nt);mt.push(gt)}if(Ge.length!==At){Ge.splice(0);for(let gt=0;gt<At;++gt)Ge.push([0,0])}const We=_n/Qt,dn=J.now()/1e3;-1!==dt&&($e=1/Math.max(tn,dn-dt),$e=Math.min(Math.max($e,nt.freqRange[0]),nt.freqRange[1])),dt=dn;const xt=60/Math.min($e,60),sn=nt.beta*Math.pow(xt,nt.adaptativeBetaPow);for(let gt=0;gt<At;++gt){const en=Rn[gt][0],cn=Rn[gt][1];let Kt=mt[2*gt].filter(en,sn,$e),qn=mt[2*gt+1].filter(cn,sn,$e);const kn=compute_distanceNNInput(en,Kt,nt.NNInputSizePx,ti),nn=compute_distanceNNInput(cn,qn,nt.NNInputSizePx,ti*We),In=Math.max(kn,nn);if(In>nt.forceFilterNNInputPxRange[0]){nt.isDebug&&console.log("INFO in OneEuroLMStabilizer: Force stalling");const Ln=smoothStep(nt.forceFilterNNInputPxRange,In);Kt=mix(Kt,en,Ln),qn=mix(qn,cn,Ln),mt[2*gt].force(Kt),mt[2*gt+1].force(qn)}Ge[gt][0]=Kt,Ge[gt][1]=qn}return Ge},reset:function(){$e=nt.freq,dt=-1,mt.forEach(Rn=>{Rn.reset()})}}}};try{module.exports=WebARRocksLMStabilizer}catch{console.log("ES6 Module not exported")}